<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="游戏同步" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1611648384532" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle" zoom="1.077">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3.0 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0.0 cm" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.8999999999999995 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="106" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="概念" POSITION="right" ID="ID_1338789825" CREATED="1583397196411" MODIFIED="1611648395648">
<edge COLOR="#7c007c"/>
<node TEXT=" 网络同步 = 实时的多端数据同步+实时的多端表现同步" ID="ID_1504473271" CREATED="1611649169391" MODIFIED="1611649170878"/>
<node TEXT="多个客户端表现效果和服务端的数据是一致的" ID="ID_1013910424" CREATED="1583397201492" MODIFIED="1583397251828"/>
<node TEXT=" 同步是一个网络游戏概念，单机游戏不需要同步" ID="ID_516005995" CREATED="1583397259354" MODIFIED="1583397269716"/>
</node>
<node TEXT="帧同步" POSITION="right" ID="ID_1728033984" CREATED="1583395998424" MODIFIED="1611648395650">
<edge COLOR="#007c7c"/>
<node TEXT=" 具分逻辑帧和渲染帧，逻辑帧就是lockstep里面的“Step”，也可以叫做“turn”，“bucket”或者“步" ID="ID_995262203" CREATED="1611653270226" MODIFIED="1611653307323"/>
<node TEXT=" 帧同步不是单指某个具体算法，而是范指“保证每帧（逻辑帧）输入一致”的一系列算法" ID="ID_417877992" CREATED="1611654771687" MODIFIED="1611654772865"/>
<node TEXT=" 一系列算法" ID="ID_1605901707" CREATED="1611654793629" MODIFIED="1611654794600">
<node TEXT=" 帧锁定，乐观帧锁定，lockstep，bucket 同步等等" ID="ID_998552767" CREATED="1611654806469" MODIFIED="1611654808315"/>
</node>
<node TEXT=" 具体优化手段" ID="ID_814500236" CREATED="1611654827309" MODIFIED="1611654828271">
<node TEXT=" 要不要回滚？" ID="ID_1951340976" CREATED="1611654837901" MODIFIED="1611654840662"/>
<node TEXT=" 服务端要不要跑一套完整逻辑？" ID="ID_1128414664" CREATED="1611654840900" MODIFIED="1611654841830"/>
<node TEXT=" 操作要不要是键盘鼠标？还是高阶命令？" ID="ID_997934290" CREATED="1611654849205" MODIFIED="1611654850270"/>
<node TEXT=" 客户端要不要像视频播放器一样保证平滑缓存 1-2 帧？" ID="ID_1053197935" CREATED="1611654856260" MODIFIED="1611654857169"/>
<node TEXT=" 或者要不要保证平滑加一层显示对象的坐标插值？" ID="ID_981740123" CREATED="1611654861924" MODIFIED="1611654862864"/>
</node>
<node TEXT="同步流程" ID="ID_1895748945" CREATED="1583486646583" MODIFIED="1583486652505">
<node TEXT="1. 同步随机种子：游戏中设计随机数的使用，通过同步随机数种子可以保持随机数的一致性" ID="ID_1409187435" CREATED="1583487167407" MODIFIED="1583487188784"/>
<node TEXT=" 2. 客户端上传操作指令给服务器，操作指令包含游戏操作和当前帧索引" ID="ID_1877761744" CREATED="1583487251652" MODIFIED="1583487256653"/>
<node TEXT="3. 游戏广播所有客户端的操作，如果没有操作也要广播空指令来驱动游戏帧前进" ID="ID_200449850" CREATED="1583487263676" MODIFIED="1583487266718"/>
</node>
<node TEXT="思想" ID="ID_1964100582" CREATED="1583488242126" MODIFIED="1583488246769">
<node TEXT=" 相同的输入 + 相同的时机 = 相同的显示" ID="ID_1267421276" CREATED="1583488251510" MODIFIED="1583488253343"/>
<node TEXT=" 多个客户端的操作，如果这些操作在各个客户端上都是一样的，那么多个客户端的显示也就是一样的" ID="ID_1493742276" CREATED="1583488271494" MODIFIED="1583491824508"/>
<node TEXT=" 各个客户端的运算要绝对一致，不能依赖诸如本地时间、本地随机等”输入“，而要一切以网络来的数据为主" ID="ID_30312245" CREATED="1583491844524" MODIFIED="1583491855279"/>
<node TEXT=" 帧同步的目的在于消除网络波动性带给玩家的卡顿以及忽快忽慢的不良体验" ID="ID_1467716263" CREATED="1583491876052" MODIFIED="1583491882430"/>
</node>
<node TEXT=" “锁定帧”同步（Lock-step）" ID="ID_1487970237" CREATED="1583401327336" MODIFIED="1583401328403">
<node TEXT=" lockstep更适合网络环境良好的内网，或者对操作延迟不敏感的类型" ID="ID_209432790" CREATED="1583405307671" MODIFIED="1583405311185"/>
<node TEXT=" 锁定帧同步的核心在于“同步帧”" ID="ID_531183429" CREATED="1583401336007" MODIFIED="1583401337025"/>
<node TEXT=" 将运算帧分为同步帧和非同步帧" ID="ID_1516373823" CREATED="1583401345480" MODIFIED="1583401346897"/>
<node TEXT="在非同步帧时" ID="ID_344605554" CREATED="1583401362312" MODIFIED="1583401379010">
<node TEXT="收集本地玩家的所有输入，并将其发送给网络上的其他玩家" ID="ID_1816092622" CREATED="1583401375130" MODIFIED="1583401386752"/>
<node TEXT=" 同时保存网络上其他玩家发送过来的数据包" ID="ID_906204111" CREATED="1583401380672" MODIFIED="1583401382497"/>
</node>
<node TEXT=" 到了同步帧时" ID="ID_517821860" CREATED="1583401397632" MODIFIED="1583401400448">
<node TEXT=" 将网络上的所有操作拿出来，并且在游戏中演算它们" ID="ID_1897753126" CREATED="1583401412465" MODIFIED="1583401418873"/>
<node TEXT=" 等待数据可能会导致一个玩家卡顿、所有玩家都无法进行游戏" ID="ID_196554589" CREATED="1583401489111" MODIFIED="1583401527434"/>
</node>
</node>
<node TEXT=" 网络协议的实现" ID="ID_434186721" CREATED="1583402536808" MODIFIED="1583402538361">
<node TEXT=" 基于可靠传输的UDP" ID="ID_1152629419" CREATED="1583402643558" MODIFIED="1583402644617">
<node TEXT=" 是指在UDP上加一层封装，自己去实现丢包处理，消息序列，重传等类似TCP的消息处理方式" ID="ID_963478690" CREATED="1583402653959" MODIFIED="1583402655183"/>
<node TEXT=" 保证上层逻辑在处理数据包的时候，不需要考虑包的顺序，丢包等" ID="ID_98877462" CREATED="1583402667134" MODIFIED="1583402672080"/>
<node TEXT=" 类似的实现有Enet，KCP等" ID="ID_1120377573" CREATED="1583402672671" MODIFIED="1583402673616"/>
</node>
<node TEXT=" 冗余信息的UDP" ID="ID_1918977063" CREATED="1583402678895" MODIFIED="1583402679888">
<node TEXT=" 是指需要上层逻辑自己处理丢包，乱序，重传等问题，底层直接用原始的UDP" ID="ID_888319300" CREATED="1583402694943" MODIFIED="1583402718199"/>
<node TEXT=" 常见的处理方式，就是两端的消息里面，带有确认帧信息" ID="ID_6715588" CREATED="1583402706998" MODIFIED="1583404990355"/>
<node TEXT="  比如客户端（C）通知服务器（S）第100帧的数据，S收到后通知C，已收到C的第100帧，如果C一直没收到S的通知（丢包，乱序等原因），就会继续发送第100帧的数据给S，直到收到S的确认信息" ID="ID_474577233" CREATED="1583405178056" MODIFIED="1583405179769"/>
</node>
</node>
<node TEXT="三座大山" ID="ID_800044167" CREATED="1583406999024" MODIFIED="1583407004241">
<node TEXT="同步性" ID="ID_1859707235" CREATED="1583407004440" MODIFIED="1583407013960">
<node TEXT="所有运算基于整数，没有浮点数" ID="ID_1454664837" CREATED="1583481819885" MODIFIED="1583481836087"/>
<node TEXT=" 浮点数是用分子分母表达的" ID="ID_587123286" CREATED="1583481854364" MODIFIED="1583481857167"/>
</node>
<node TEXT="网络问题" ID="ID_550330548" CREATED="1583458398162" MODIFIED="1583463835583">
<node TEXT="buffer" ID="ID_359070632" CREATED="1583482949553" MODIFIED="1583482953682">
<node TEXT="帧同步有点像在看电影，它传统的帧同步需要有buffer" ID="ID_1866003251" CREATED="1583482423226" MODIFIED="1583483328428"/>
<node TEXT=" 每个玩家输入会转发给所有客户端，互相会有编号，按顺序输入帧" ID="ID_893000504" CREATED="1583483330135" MODIFIED="1583483331833"/>
<node TEXT="帧buffer小，延迟低，卡顿多" ID="ID_1693682167" CREATED="1583482351155" MODIFIED="1583482377940"/>
<node TEXT="帧buffer大，延迟高，卡顿少" ID="ID_1750066710" CREATED="1583482378771" MODIFIED="1583482396277"/>
</node>
<node TEXT="本地插值平滑加逻辑与表现分离" ID="ID_1901368425" CREATED="1583482975457" MODIFIED="1583483514129">
<node TEXT=" 客户端只负责一些模型、动画、它的位置，它会根据绑定的逻辑对象状态、速度、方向来进行一个插值" ID="ID_938495596" CREATED="1583483465256" MODIFIED="1583483466305"/>
<node TEXT=" 做到逻辑帧率和渲染帧率不一样" ID="ID_30596573" CREATED="1583483500319" MODIFIED="1583483505288"/>
<node TEXT=" 插值平滑和逻辑表现分离，画面不抖了，延迟感也是很好的" ID="ID_1654484156" CREATED="1583483533391" MODIFIED="1583483534968"/>
</node>
<node TEXT="TCP换成UDP" ID="ID_1387112597" CREATED="1583482960920" MODIFIED="1583482968570">
<node TEXT=" TCP很难恢复重连" ID="ID_1844220502" CREATED="1583483552519" MODIFIED="1583483553480"/>
<node TEXT=" 在网络比较差的情况下做插值" ID="ID_811143755" CREATED="1583483571551" MODIFIED="1583483572856"/>
</node>
</node>
<node TEXT="性能问题" ID="ID_823959526" CREATED="1583463837662" MODIFIED="1583463845878">
<node TEXT="降热点" ID="ID_441164247" CREATED="1583484188509" MODIFIED="1583484560264">
<node TEXT="对象的显示隐藏放在不同的渲染层里面，尽量让整个游戏帧率是平滑的过程" ID="ID_627649349" CREATED="1583484235573" MODIFIED="1583484274846"/>
<node TEXT=" 首先，从程序的结构上面能找到更优的，它的优化效果就是最明显的" ID="ID_586266162" CREATED="1583484316679" MODIFIED="1583484336777"/>
<node TEXT=" 其次，如果你的结构都是用的最好，就去挖掘局部的算法，调整你代码的一些写法" ID="ID_1729497357" CREATED="1583484326373" MODIFIED="1583484348062"/>
<node TEXT=" 最后，如果局部的算法都已经调到最优还是没有什么办法，那只有一条路，就是牺牲整个质量，就是分帧降频" ID="ID_241600035" CREATED="1583484348636" MODIFIED="1583484349774"/>
</node>
<node TEXT="降GC" ID="ID_1128517137" CREATED="1583484298941" MODIFIED="1583484563804">
<node TEXT="不用反射，反射有GC性能开销" ID="ID_1644741045" CREATED="1583484204814" MODIFIED="1583484235328"/>
<node TEXT=" 装箱和拆箱的行为也是尽量少用" ID="ID_81779149" CREATED="1583484360901" MODIFIED="1583484362142"/>
</node>
<node TEXT=" 降Drawcall" ID="ID_1256075790" CREATED="1583484447644" MODIFIED="1583484568141"/>
<node TEXT=" 裁剪" ID="ID_1973900088" CREATED="1583484450596" MODIFIED="1583484458726">
<node TEXT=" 帧同步里面是不能裁剪的" ID="ID_1025230314" CREATED="1583484459748" MODIFIED="1583484460559"/>
<node TEXT=" 表现里面我看不到的可以降低频率或者不更新它，这在表现里面可以做的" ID="ID_1120881811" CREATED="1583484490140" MODIFIED="1583484493607"/>
</node>
</node>
</node>
<node TEXT="优点" ID="ID_1714578840" CREATED="1583406344538" MODIFIED="1583406347141">
<node TEXT=" 它的开发效率比较高，开发思路完全就跟写单机一样" ID="ID_1915330080" CREATED="1583406374874" MODIFIED="1583406381652"/>
<node TEXT=" 实现更强的打击感" ID="ID_1065184025" CREATED="1583406399707" MODIFIED="1583406401260"/>
<node TEXT=" 流量消耗是稳定的" ID="ID_178243606" CREATED="1583406419466" MODIFIED="1583406420531"/>
</node>
<node TEXT="缺点" ID="ID_242705155" CREATED="1583406347302" MODIFIED="1583406349957">
<node TEXT=" 最致命的缺点是网络要求比较高" ID="ID_1262644935" CREATED="1583406457986" MODIFIED="1583406460467">
<node TEXT=" 帧同步是锁帧的，如果有网络的抖动，一段时间调用次数不稳定，网络命令的延迟就会挤压，引起卡顿" ID="ID_1918890162" CREATED="1583406478427" MODIFIED="1583406479595"/>
</node>
<node TEXT=" 反外挂能力很弱" ID="ID_916365679" CREATED="1583406488737" MODIFIED="1583406543866"/>
<node TEXT=" 断线重回时间很长" ID="ID_410505206" CREATED="1583406520217" MODIFIED="1583406541661"/>
<node TEXT=" 逻辑性能优化有很大的压力" ID="ID_1047200607" CREATED="1583406537234" MODIFIED="1583406538300">
<node TEXT=" 游戏的每一个逻辑对象都是需要在客户端进行运算的" ID="ID_82121988" CREATED="1583406699096" MODIFIED="1583406700275"/>
<node TEXT=" 帧同步无法做非常多的对象都需要更新的游戏场景" ID="ID_953677175" CREATED="1583406717528" MODIFIED="1583406718874"/>
</node>
</node>
</node>
<node TEXT=" 帧锁定同步" FOLDED="true" POSITION="right" ID="ID_1517574728" CREATED="1611566610175" MODIFIED="1611648395652">
<edge COLOR="#7c7c00"/>
<node TEXT=" 算法概念" ID="ID_561119304" CREATED="1611566686903" MODIFIED="1611566688096">
<node TEXT=" 该算法普遍要求网速RTT要在100ms以内，一般人数不超过8人" ID="ID_712320074" CREATED="1611566699173" MODIFIED="1611566700584"/>
<node TEXT=" 保证所有客户端每帧的输入都一样， 可以像单机游戏一样编写网络游戏" ID="ID_1584894150" CREATED="1611631551282" MODIFIED="1611631564326"/>
<node TEXT=" 所有客户端任意时刻逻辑都是统一的，缺点是一个人卡机，所有人等待（帧间无等待改进）" ID="ID_997373457" CREATED="1611566721405" MODIFIED="1611631533551"/>
</node>
<node TEXT="流程" ID="ID_633751035" CREATED="1611566832845" MODIFIED="1611566855312">
<node TEXT=" 1.客户端定时（比如每五帧）上传控制信息" ID="ID_989516140" CREATED="1611566867932" MODIFIED="1611566924950"/>
<node TEXT=" 2.服务器收到所有控制信息后广播给所有客户端" ID="ID_1963034833" CREATED="1611566883062" MODIFIED="1611566943334"/>
<node TEXT=" 3.客户端用服务器发来的更新消息中的控制信息进行游戏" ID="ID_996111634" CREATED="1611566891987" MODIFIED="1611566928756"/>
<node TEXT=" 4.如果客户端进行到下一个关键帧（5帧后）时没有收到服务器的更新消息则等待。(锁锁定)" ID="ID_1571005438" CREATED="1611566960708" MODIFIED="1611566975719"/>
<node TEXT=" 5.如果客户端进行到下一个关键帧时已经接收到了服务器的更新消息，则将上面的数据用于游戏，并采集当前鼠标键盘输入发送给服务器，同时继续进行下去。" ID="ID_672992717" CREATED="1611566993627" MODIFIED="1611566998693"/>
<node TEXT=" 6。服务端采集到所有数据后再次发送下一个关键帧更新消息" ID="ID_1576515414" CREATED="1611567005635" MODIFIED="1611567011054"/>
</node>
<node TEXT=" 应用案例" ID="ID_1171029216" CREATED="1611626142491" MODIFIED="1611626143764">
<node TEXT=" 大部分RTS即时战略游戏，街霸II(xbox360)，Callus模拟器" ID="ID_300425451" CREATED="1611626148381" MODIFIED="1611626174004"/>
</node>
<node TEXT="客户端逻辑" ID="ID_938429550" CREATED="1611626550678" MODIFIED="1611626557623">
<node ID="ID_388673601" CREATED="1611626604872" MODIFIED="1611626604872"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      1.判断当前帧F是否关键帧K1：如果不是跳转（7）。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1329230653" CREATED="1611626604872" MODIFIED="1611626604872"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      2.如果是关键帧，则察看有没有K1的UPDATE数据，如果没有的话重复2等待。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1584703749" CREATED="1611626604874" MODIFIED="1611626604874"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      3.采集当前K1的输入作为CTRL数据与K1编号一起发送给服务器
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_893451692" CREATED="1611626604877" MODIFIED="1611626604877"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      4.从UPDATE K1中得到下一个关键帧的号码K2以及到下一个关键帧之间的输入数据I。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1514445177" CREATED="1611626604878" MODIFIED="1611626604878"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      5.从这个关键帧到下 一个关键帧K2之间的虚拟输入都用I。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1443082007" CREATED="1611626604880" MODIFIED="1611626604880"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      6.令K1 = K2。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1541981000" CREATED="1611626604882" MODIFIED="1611626604882"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      7.执行该帧逻辑
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_351130165" CREATED="1611626604884" MODIFIED="1611626604884"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      8.跳转（1）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_709783015" CREATED="1611629653388" MODIFIED="1611629653388"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">ClientUpdate</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()</i></font></span>:<br/>    F = GetCurFrame<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font><span style="color: #cc7832"><font color="#cc7832">if </font></span>F <span style="color: #cc7832"><font color="#cc7832">is not </font></span><span style="font-family: 宋体,monospace"><font face="宋体,monospace">关键帧</font></span>K1:<br/>        execute<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>F<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">        </span></i></font><span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>K1 = F<br/>    <span style="font-family: 宋体,monospace"><font face="宋体,monospace">采集</font></span>K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">编号<br/></font></span><font face="宋体,monospace"><span style="font-family: 宋体,monospace">    采集当前</span></font>K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">的输入作为</font></span>CTRL<span style="font-family: 宋体,monospace"><font face="宋体,monospace">数据<br/></font></span><font face="宋体,monospace"><span style="font-family: 宋体,monospace">    发送到服务器<br/></span><span style="font-family: 宋体,monospace"><br/></span><span style="font-family: 宋体,monospace">    从</span></font>UPDATE K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">中获取下一个关键帧</font></span>K2<br/>    <span style="font-family: 宋体,monospace"><font face="宋体,monospace">从</font></span>UPDATE K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">中获取</font></span>K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">到</font></span>K2<span style="font-family: 宋体,monospace"><font face="宋体,monospace">之间的输入数据</font></span>I<br/>    <span style="font-family: 宋体,monospace"><font face="宋体,monospace">从</font></span>K1<span style="font-family: 宋体,monospace"><font face="宋体,monospace">到</font></span>K2<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="font-family: 宋体,monospace"><font face="宋体,monospace">虚拟输入都用</font></span>I<br/><br/>    setCurFrame<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>K2<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>execute<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>K1<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)  </i></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">执行该帧逻辑<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font>ClientUpdate<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()  </i></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">跳转下一当前帧<br/></font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="服务器逻辑" ID="ID_667202974" CREATED="1611626759336" MODIFIED="1611626764888">
<node ID="ID_405762374" CREATED="1611626969644" MODIFIED="1611626969644"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      1.收集所有客户端本关键帧K1的CTRL数据（Ctrl-K）等待知道收集完成所有的CTRL-K。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1293307066" CREATED="1611626969644" MODIFIED="1611626969644"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      2.根据所有CTRL-K，计算下一个关键帧K2的Update，3.计算再下一个关键帧的编号K3。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1777882631" CREATED="1611626969646" MODIFIED="1611626969646"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      4.将Update发送给所有客户端
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_128827356" CREATED="1611626969648" MODIFIED="1611626969648"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      5.令K1=K2
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_213830793" CREATED="1611626969649" MODIFIED="1611626969649"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      6.跳转（1）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1564268996" CREATED="1611629666337" MODIFIED="1611629666337"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">ServerUpdate</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()</i></font></span>:<br/>    <span style="color: #72737a"><font color="#72737a">K1 </font></span>= GetCurFrame<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>ctrlK = GetAllK1CTRL<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>K2<span style="color: #cc7832"><font color="#cc7832">, </font></span>k2Data = CalK2<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>ctrlK<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>k3Num = CalK3<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>k2Data<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>sendClient<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>k2Data<span style="color: #cc7832"><font color="#cc7832">, </font></span>k3Num<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>setCurFrame<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>K2<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>ServerUpdate<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()</i></font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="" ID="ID_17532642" CREATED="1611629796806" MODIFIED="1611629801320">
<hook URI="游戏杂记_files/png_1166965206396185314.png" SIZE="0.8333333" NAME="ExternalObject"/>
</node>
<node TEXT="乐观帧锁定" ID="ID_890453036" CREATED="1611629841264" MODIFIED="1611629853991">
<node TEXT="概念" ID="ID_1524527227" CREATED="1611629958049" MODIFIED="1611629962674">
<node TEXT="主要解决传统帧锁定网速慢的会卡到网速快的问题" ID="ID_1821001690" CREATED="1611629854232" MODIFIED="1611629903639"/>
<node TEXT=" 用“定时不等待”的方式再每次Interval时钟发生时固定将操作广播给所有用户" ID="ID_1848391135" CREATED="1611629945856" MODIFIED="1611629953766"/>
<node TEXT=" 不依赖具体每个玩家是否有操作更新" ID="ID_879631116" CREATED="1611629950568" MODIFIED="1611629951555"/>
<node TEXT=" 网速慢的玩家不会卡到快的玩家，只会感觉自己操作延迟而已" ID="ID_1607998883" CREATED="1611630533205" MODIFIED="1611630534459"/>
</node>
<node TEXT="8玩家网游" ID="ID_431861394" CREATED="1611629967655" MODIFIED="1611630268083">
<node TEXT=" 操作映射记录" ID="ID_1375963795" CREATED="1611630282703" MODIFIED="1611630309968">
<node TEXT="单个用户当前键盘上下左右攻击跳跃是否按下用一个32位整数描述" ID="ID_1125230513" CREATED="1611630316927" MODIFIED="1611630322296"/>
<node TEXT=" 服务端描述一局游戏中最多8玩家的键盘操作为：int player_keyboards[8];" ID="ID_125894439" CREATED="1611630329766" MODIFIED="1611630331700"/>
</node>
<node TEXT="同步到客户端" ID="ID_1899173793" CREATED="1611630351534" MODIFIED="1611630369328">
<node TEXT=" 服务端每秒钟50次向所有客户端发送更新消息（包含所有客户端的操作和递增的帧号）" ID="ID_848158246" CREATED="1611630375566" MODIFIED="1611630376730"/>
<node TEXT=" clientUpdate=（FrameID，player_keyboards）" ID="ID_1005721359" CREATED="1611630381783" MODIFIED="1611630404304"/>
</node>
<node TEXT="客户端表现" ID="ID_297499577" CREATED="1611630416750" MODIFIED="1611630425087">
<node TEXT=" 客户端就像播放游戏录像一样不停的播放这些包含每帧所有玩家操作的update消息" ID="ID_1872362521" CREATED="1611630432246" MODIFIED="1611630433387"/>
<node TEXT=" 客户端如果没有update数据了，就必须等待，直到有数据到来" ID="ID_1510880768" CREATED="1611630439957" MODIFIED="1611630442573"/>
<node TEXT=" 客户端如果一下子收到很多连续的update，则快进播放" ID="ID_234943112" CREATED="1611630450047" MODIFIED="1611630451702"/>
</node>
<node TEXT="同步到服务器" ID="ID_363396543" CREATED="1611630464006" MODIFIED="1611630469480">
<node TEXT=" 只有按键按下或者放开，就会发送消息给服务端（而不是到每帧开始才采集键盘）" ID="ID_1097523856" CREATED="1611630484926" MODIFIED="1611630486129"/>
<node TEXT=" 消息只包含一个整数。服务端收到以后，改写player_keyboards" ID="ID_943823486" CREATED="1611630492885" MODIFIED="1611630494428"/>
</node>
</node>
</node>
<node TEXT=" 指令缓存" ID="ID_1361044408" CREATED="1611630546573" MODIFIED="1611630547396">
<node TEXT="  客户端任何操作都是可靠消息发送到服务端，服务端缓存在对应玩家的指令队列里面，然后定时向所有人广播所有队列里面的历史操作，广播完成后清空队列，等待新的指令上传" ID="ID_1108639607" CREATED="1611631469586" MODIFIED="1611631471252"/>
<node TEXT=" 可以把整段战斗过程的操作和随机数种子记录下来" ID="ID_1581076953" CREATED="1611631265330" MODIFIED="1611631452527"/>
<node TEXT=" 当录像播放" ID="ID_1207004198" CREATED="1611631333595" MODIFIED="1611631335029"/>
<node TEXT="验算" ID="ID_816545241" CREATED="1611631408186" MODIFIED="1611631410749">
<node TEXT="交给另外一台服务端延迟验算，或交给其他空闲的客户端验算" ID="ID_1466090056" CREATED="1611631346922" MODIFIED="1611631404397"/>
<node TEXT="  将验算结果的 hash值进行比较，如果相同则认可，如果不通则记录或者处理" ID="ID_441208318" CREATED="1611631379076" MODIFIED="1611631381124"/>
</node>
</node>
</node>
<node TEXT=" 确定性锁步同步 Deterministic Lockstep" POSITION="right" ID="ID_58422334" CREATED="1611651893842" MODIFIED="1611652019407">
<edge COLOR="#00ffff"/>
<node TEXT=" 确定性锁步同步" ID="ID_145063445" CREATED="1611651916098" MODIFIED="1611651917146"/>
<node TEXT=" 每个客户端本地运行着一个独立的系统，该系统每0.02秒钟对玩家的动作 (鼠标操作和键盘操作，包括前后移动、使用道具、开火等) 采样一次得到一个 tick command" ID="ID_464444524" CREATED="1611651942465" MODIFIED="1611651943651"/>
<node TEXT=" tick command 发送给其他所有玩家，每个玩家都缓存来自其他所有玩家的 tick commands" ID="ID_1795695985" CREATED="1611651964098" MODIFIED="1611651985979"/>
<node TEXT=" 当某个玩家收到所有其他玩家的 tick commands 后，他的本地游戏状态会推进到下一帧" ID="ID_1935782280" CREATED="1611651967569" MODIFIED="1611651999333"/>
</node>
<node TEXT=" 锁步同步协议 Lockstep Protocol" POSITION="right" ID="ID_1512550452" CREATED="1611651760858" MODIFIED="1611652031579">
<edge COLOR="#ff00ff"/>
<node TEXT="概念" ID="ID_573971310" CREATED="1611652237950" MODIFIED="1611652241376">
<node TEXT=" Lockstep protocol并不是Deterministic Lockstep" ID="ID_457564597" CREATED="1611651880586" MODIFIED="1611651887673"/>
<node TEXT="锁步同步协议对抗lookahead cheat类型的外挂" ID="ID_833999387" CREATED="1611651774602" MODIFIED="1611651793940"/>
</node>
<node TEXT="lookahead cheats" ID="ID_1835063090" CREATED="1611651816770" MODIFIED="1611651817610">
<node TEXT="" ID="ID_439037654" CREATED="1611652437709" MODIFIED="1611652441138">
<hook URI="游戏同步_files/png_8837598887562866569.png" SIZE="0.55046785" NAME="ExternalObject"/>
</node>
<node TEXT="假装网络信号不好丢弃第K步的操作，第K+1步再发送" ID="ID_206943659" CREATED="1611651825898" MODIFIED="1611651829423"/>
<node TEXT="每次都将自己的操作信息推迟发送，等到看到了别人的决策后再决定执行什么" ID="ID_191272673" CREATED="1611651849114" MODIFIED="1611651856996"/>
</node>
<node TEXT="每一步都分两次发送信息" ID="ID_1846689492" CREATED="1611652298332" MODIFIED="1611652304005">
<node TEXT="" ID="ID_1467287169" CREATED="1611652620255" MODIFIED="1611652623961">
<hook URI="游戏同步_files/png_7509590402783503160.png" SIZE="0.7482818" NAME="ExternalObject"/>
</node>
<node TEXT=" 针对要发送的明文信息进行哈希，先发Hash" ID="ID_328608457" CREATED="1611652488435" MODIFIED="1611652510004"/>
<node TEXT="收到其它客户端的Hash再发自己明文" ID="ID_1733407263" CREATED="1611652512826" MODIFIED="1611652543739"/>
<node TEXT=" 对比明文与Hash的一致性" ID="ID_1550721890" CREATED="1611652544478" MODIFIED="1611652560836"/>
</node>
<node TEXT="缺点" ID="ID_159708532" CREATED="1611652713497" MODIFIED="1611652716345">
<node TEXT=" 带来了带宽以及性能的浪费" ID="ID_377001952" CREATED="1611652716584" MODIFIED="1611652735480"/>
<node TEXT=" 网络条件好的客户端会时刻受到网络差的客户端的影响" ID="ID_28855722" CREATED="1611652740455" MODIFIED="1611652741369"/>
</node>
</node>
<node TEXT=" 异步的Lockstep" POSITION="right" ID="ID_1829499463" CREATED="1611652753935" MODIFIED="1611652754973">
<edge COLOR="#7c0000"/>
<node TEXT=" asynchronous Synchronization lockstep" ID="ID_242133006" CREATED="1611652759432" MODIFIED="1611652760462"/>
<node TEXT=" 两个玩家如果相距很远互不影响，就采用本地时钟向前推进（非Lockstep方式同步）" ID="ID_235924005" CREATED="1611652802287" MODIFIED="1611652803463"/>
<node TEXT=" 如果互相靠近并可能影响到对方就变回到严格的LockStep同步，这里并不保证他们的帧序列是完全一致的" ID="ID_3351947" CREATED="1611652817670" MODIFIED="1611652818995"/>
</node>
<node TEXT=" Pipelined Lockstep protocol" POSITION="right" ID="ID_1692586380" CREATED="1611653057348" MODIFIED="1611653060278">
<edge COLOR="#00007c"/>
</node>
<node TEXT="插值同步" FOLDED="true" POSITION="right" ID="ID_854134449" CREATED="1611642307114" MODIFIED="1611648395653">
<edge COLOR="#ff0000"/>
<node TEXT="状态同步" ID="ID_1960947735" CREATED="1611644298199" MODIFIED="1611644304171">
<node TEXT=" 影子跟随算法由普通DR（dead reckoning）算法发展而来" ID="ID_1686315833" CREATED="1611642879121" MODIFIED="1611642880352"/>
<node TEXT=" 核心思想：时钟同步，客户端先行，平滑追赶" ID="ID_1471345701" CREATED="1611645228752" MODIFIED="1611645236842"/>
<node TEXT="客户端收到的同步状态，由于延迟，是慢于服务器的。这没有关系，只要大家在一定误差范围内以相同的速度增加，就完全没有问题" ID="ID_1204539648" CREATED="1611644306336" MODIFIED="1611644392173"/>
</node>
<node TEXT=" 同步策略" ID="ID_218395159" CREATED="1611642891773" MODIFIED="1611642892632">
<node TEXT=" 屏幕上现实的实体（entity）只是不停的追逐它的“影子”（shadow）" ID="ID_306894202" CREATED="1611642900808" MODIFIED="1611642902455"/>
<node TEXT=" 服务器向各客户端发送各个影子的状态改变（坐标，方向，速度，时间）" ID="ID_742182969" CREATED="1611642908672" MODIFIED="1611642909602"/>
<node TEXT=" 各个客户端收到以后按照当前重新插值修正影子状态" ID="ID_596181383" CREATED="1611642916226" MODIFIED="1611642917419"/>
<node TEXT=" 影子状态是跳变的，但实体追赶影子是连续的，故整个过程是平滑的" ID="ID_785734554" CREATED="1611642924713" MODIFIED="1611642926530"/>
<node TEXT=" 状态要同步不能跳过关键状态(类似关键帧)，表现上要追上一个关键状态再到下一关键状态" ID="ID_643760990" CREATED="1611644630721" MODIFIED="1611644733418"/>
</node>
<node TEXT="对比帧间同步" ID="ID_1322368854" CREATED="1611643116688" MODIFIED="1611643148267">
<node TEXT="客户端表现" ID="ID_991525482" CREATED="1611643149280" MODIFIED="1611643162610">
<node TEXT=" 帧间同步：不同客户端每帧显示相同的内容" ID="ID_1450155011" CREATED="1611643162944" MODIFIED="1611643180778"/>
<node TEXT=" 插值同步：不同客户端显示不同步，但是状态同步" ID="ID_1550260897" CREATED="1611643181104" MODIFIED="1611643189554"/>
</node>
<node TEXT="流程" ID="ID_1037595524" CREATED="1611643513703" MODIFIED="1611643519914">
<node TEXT=" 帧间同步：LockStep，TimeWrap算法；网速要求高，复杂度低" ID="ID_329963437" CREATED="1611643551455" MODIFIED="1611643635896"/>
<node TEXT=" 插值同步：常见的Dead Reckoning（或叫导航插值），效果好，但复杂度高" ID="ID_117288812" CREATED="1611643643799" MODIFIED="1611643695751"/>
</node>
<node TEXT="应用" ID="ID_453152878" CREATED="1611643520127" MODIFIED="1611643525394">
<node TEXT=" 帧间同步：多用于局域网游戏，比如红警（需要等待客户端），街霸II的网络版（360）" ID="ID_666838269" CREATED="1611643690676" MODIFIED="1611643700343"/>
<node TEXT="  插值同步：常见于竞速类游戏和 FPS游戏" ID="ID_873259501" CREATED="1611643667143" MODIFIED="1611643707297"/>
</node>
</node>
<node TEXT=" 算法定义" ID="ID_157917013" CREATED="1611643719622" MODIFIED="1611643846225">
<node TEXT=" 时间：单位为帧（FPS=10），开始由服务器告诉向所有客户端，间隔时间同步" ID="ID_930846480" CREATED="1611644089933" MODIFIED="1611644113753"/>
<node TEXT=" 玩家：每个玩家控制自己的实体，并在每帧将状态改变告知服务器" ID="ID_1813069322" CREATED="1611644114772" MODIFIED="1611644131254"/>
<node TEXT=" 状态：状态数据 = 实体ID + 坐标 + 方向 + 速度 + 时间（帧）" ID="ID_778686528" CREATED="1611644140771" MODIFIED="1611644147237"/>
<node TEXT=" 插值：收到新状态包后将根据其运动方向与时间，根据现有时间计算新状态" ID="ID_960885940" CREATED="1611644160611" MODIFIED="1611644161807"/>
<node TEXT=" 跟随：实体不停的追踪自己的影子，追上后与影子保持状态同步" ID="ID_33273404" CREATED="1611644169291" MODIFIED="1611644170143"/>
<node TEXT=" 相位滞后：可选参数，实体与影子保持一定距离同步，相当于保持一定车距，这样在控制者突然停止的时候，不容易因为网络延迟跑过了又被拉回来。" ID="ID_995849829" CREATED="1611644194507" MODIFIED="1611644195503"/>
<node TEXT=" 惯性移动：可选参数，开始移动或者停止或者改变方向都有加速度，这样就不需相位滞后了" ID="ID_1121020643" CREATED="1611644202138" MODIFIED="1611644203317"/>
</node>
<node TEXT=" 缺点" ID="ID_660630743" CREATED="1611644936100" MODIFIED="1611644951990">
<node TEXT=" 无法像“帧间同步”算法那样，每次发送按键给服务器，服务器处理后再反馈结果" ID="ID_460236290" CREATED="1611644952404" MODIFIED="1611645042014"/>
<node TEXT=" 不能像单机游戏那样有复杂的场景互动，有类似格斗游戏的即时的动作判定" ID="ID_447583622" CREATED="1611645100970" MODIFIED="1611645101949"/>
<node TEXT=" 算法编码复杂度比其他同步策略高" ID="ID_1640122422" CREATED="1611645146449" MODIFIED="1611645147663">
<node TEXT=" 服务器需要计算一份影子数据" ID="ID_1572064130" CREATED="1611645153507" MODIFIED="1611645154569"/>
<node TEXT=" 各个客户端需要计算一份影子数据" ID="ID_1691983685" CREATED="1611645155561" MODIFIED="1611645193411"/>
<node TEXT=" 各个客户端还需要计算实体追赶" ID="ID_1390297032" CREATED="1611645193824" MODIFIED="1611645202451"/>
<node TEXT=" 这三种计算都需要在同样的时钟下保持一致" ID="ID_795631148" CREATED="1611645188856" MODIFIED="1611645189997"/>
</node>
</node>
</node>
<node TEXT="状态同步" POSITION="right" ID="ID_1123234716" CREATED="1583396012792" MODIFIED="1611648395654">
<edge COLOR="#0000ff"/>
<node TEXT="核心强调" ID="ID_984007864" CREATED="1611654885508" MODIFIED="1611654898846">
<node TEXT=" 客户端外在表现不同，但内部状态能统一协调" ID="ID_895458369" CREATED="1611654906045" MODIFIED="1611654907246"/>
<node TEXT=" 让所有的用户屏幕上面表现出完全不同的表象是完全没有问题的。" ID="ID_6612125" CREATED="1611654927908" MODIFIED="1611654929276"/>
<node TEXT=" 把这些完全不同表象完全融合在一个统一的逻辑中也是完全没有问题的" ID="ID_332640068" CREATED="1611654934741" MODIFIED="1611654935771"/>
</node>
<node TEXT=" 同步流程" ID="ID_590938201" CREATED="1583485521737" MODIFIED="1583485541051">
<node TEXT=" 1. 客户端上传操作到服务器" ID="ID_883730171" CREATED="1583485553977" MODIFIED="1583485561650"/>
<node TEXT="2. 服务器收到后计算游戏行为的结果（如技能逻辑、战斗计算等）" ID="ID_1391484587" CREATED="1583485562777" MODIFIED="1583485578380"/>
<node TEXT="3. 服务器以广播的方式下发游戏中各种状态" ID="ID_594302923" CREATED="1583485586160" MODIFIED="1583485601546"/>
<node TEXT="4. 客户端收到状态后更新本地状态（如动作状态、Buff状态、位置等）" ID="ID_389158532" CREATED="1583485602264" MODIFIED="1583485604915"/>
</node>
<node TEXT=" 状态同步其实是一种不严谨的同步" ID="ID_582747860" CREATED="1583486106001" MODIFIED="1583486120256">
<node TEXT=" 不同玩家屏幕上的一致性的表现并不是重要指标" ID="ID_1777147562" CREATED="1583486140879" MODIFIED="1583486142856"/>
<node TEXT=" 只要每次操作的结果相同即可" ID="ID_1517729446" CREATED="1583486149160" MODIFIED="1583486151553"/>
<node TEXT=" 所以状态同步对网络延迟的要求并不高" ID="ID_1014597491" CREATED="1583486157583" MODIFIED="1583486158690"/>
<node TEXT=" RPG游戏中200~300ms的延迟对用户来说是可以接受的" ID="ID_223276552" CREATED="1583486165376" MODIFIED="1583486170802"/>
<node TEXT=" RTS（即时战略）游戏中50ms的延迟却会很受伤" ID="ID_158951335" CREATED="1583486171175" MODIFIED="1583486172472"/>
</node>
<node TEXT="状态同步的客户端本地计算" ID="ID_1895191624" CREATED="1583486193415" MODIFIED="1583486246825">
<node TEXT=" 给游戏玩家更好的体验，减少同步的数据量" ID="ID_1766691650" CREATED="1583486254519" MODIFIED="1583486256018"/>
<node TEXT=" 减少服务器同步的频率以及数据量" ID="ID_612596280" CREATED="1583486227377" MODIFIED="1583486243738"/>
</node>
<node TEXT="优点" ID="ID_1932631757" CREATED="1583406201492" MODIFIED="1583406203260">
<node TEXT="安全性高" ID="ID_20362771" CREATED="1583406203555" MODIFIED="1583406207668"/>
<node TEXT="网张要求宽松，抖动丢包适应性强。&#xa;即便出现了200、300的输入延迟再恢复正常，玩家其实也感受不到不太舒服的地方" ID="ID_438971349" CREATED="1583406207890" MODIFIED="1583406333645"/>
<node TEXT="断线重回快" ID="ID_691252640" CREATED="1583406230956" MODIFIED="1583406237494"/>
<node TEXT="游戏逻辑性能优化有优势" ID="ID_1172529814" CREATED="1583406245507" MODIFIED="1583406258508"/>
</node>
<node TEXT="缺点" ID="ID_1288270920" CREATED="1583406184667" MODIFIED="1583406199660">
<node TEXT="开发效率低" ID="ID_1744399649" CREATED="1583406261084" MODIFIED="1583406271500"/>
<node TEXT="打击感或精确性差" ID="ID_85293215" CREATED="1583406271690" MODIFIED="1583406283303"/>
<node TEXT="网络流量随游戏复杂度增加" ID="ID_413529837" CREATED="1583406283562" MODIFIED="1583406298212"/>
</node>
<node TEXT="客户端预测与回滚" ID="ID_711386853" CREATED="1612336735668" MODIFIED="1612336750641">
<node TEXT=" 预测" ID="ID_1590706730" CREATED="1612336785086" MODIFIED="1612336818520">
<node TEXT="客户端立即对用户输入进行本地响应，不需要什么特别的算法" ID="ID_154576329" CREATED="1612336810821" MODIFIED="1612336908607"/>
<node TEXT=" 预测后的客户端与服务器的同步处理有很多值得优化的地方" ID="ID_1763330546" CREATED="1612336855061" MODIFIED="1612336899733"/>
<node TEXT=" 如果玩家本地的预测结果与服务器几乎一致，那么我们认为预测是成功且有效的，玩家不会受到任何影响，可以继续操作" ID="ID_783588906" CREATED="1612336988699" MODIFIED="1612336990548"/>
<node TEXT=" 采用了客户端预测逻辑来保证本地玩家能够有流畅的手感" ID="ID_1230878001" CREATED="1612343684427" MODIFIED="1612343690133"/>
<node TEXT=" 为了让客户端提高预测准确率（保证客户端与服务器上的代码逻辑一致），可以让客户端与服务器执行同一套代码" ID="ID_1948574706" CREATED="1612343717123" MODIFIED="1612343734676"/>
</node>
<node TEXT=" 预测失败" ID="ID_959126077" CREATED="1612336995381" MODIFIED="1612337004161">
<node TEXT=" 预测后的客户端结果与服务器不一致" ID="ID_535000807" CREATED="1612337013371" MODIFIED="1612337032436"/>
</node>
<node TEXT=" TimeWarp算法" ID="ID_996656122" CREATED="1612340687505" MODIFIED="1612340688440">
<node TEXT="概念" ID="ID_1099515194" CREATED="1612341976577" MODIFIED="1612341980372">
<node TEXT=" 当一个对象收到了一个过去某个时刻应该执行的事件时，他应该回滚到那个时刻的状态，并且回滚前面所有的行为与状态（包括取消之前行为所产生的事件）" ID="ID_1951023272" CREATED="1612341874777" MODIFIED="1612341876723"/>
<node TEXT="有Timewarp而不直接拉回之前的正确位置，因为客户端有后续基于这些的指令，会让服务器后续的校验与纠正变得复杂且奇怪" ID="ID_1523023708" CREATED="1612342003873" MODIFIED="1612342147330"/>
</node>
<node TEXT="大致实现" ID="ID_1039066881" CREATED="1612341984497" MODIFIED="1612341996386">
<node TEXT=" 把玩家本地预执行的指令都记录好时间戳并存放到一个MOVE BUFFER列表里（类似一个滑动窗口）" ID="ID_99108255" CREATED="1612341894634" MODIFIED="1612341895661"/>
<node TEXT=" 如果服务器的计算结果与你本地预测相同，可以回复你一个ACKMOVE" ID="ID_1053836403" CREATED="1612341905265" MODIFIED="1612341907212"/>
<node TEXT=" 当你收到ACKMOVE的时候，你可以把MOVE BUFFER里面的数据从表里面移除" ID="ID_1082306712" CREATED="1612341947921" MODIFIED="1612341949074"/>
<node TEXT=" 如果服务器发现你的某个移动位置有问题时，会把该指令的时间戳以及正确的位置打包发给你" ID="ID_1899045646" CREATED="1612341936897" MODIFIED="1612341938031"/>
<node TEXT=" 当你收到错误纠正信息时就需要本地回滚到服务器指定的位置同时把错误时刻后面MOVE BUFFER里面的指令重新执行一遍" ID="ID_331439480" CREATED="1612341964473" MODIFIED="1612341965398"/>
</node>
<node TEXT="" ID="ID_919099119" CREATED="1612342160971" MODIFIED="1612342164463">
<hook URI="游戏同步_files/png_2691425529782541561.png" SIZE="0.6834829" NAME="ExternalObject"/>
</node>
</node>
</node>
<node TEXT=" 事件锁定与时钟同步" ID="ID_1885479443" CREATED="1612342605712" MODIFIED="1612342606942">
<node TEXT="概念" ID="ID_1742360864" CREATED="1612342626111" MODIFIED="1612342628618">
<node TEXT=" 事件锁定是基于事件队列严格按序执行的，客户端只管发消息然后等待服务器的响应即可，其他时候本地正常模拟，不需要等待" ID="ID_952277680" CREATED="1612342629095" MODIFIED="1612342630259"/>
<node TEXT=" 事件锁定的本质就是通过RPC产生事件从而进行同步（也就是排除属性同步的状态同步）" ID="ID_1436622946" CREATED="1612342643274" MODIFIED="1612342644770"/>
</node>
<node TEXT=" 需要尽可能的保持客户端与服务器的时钟同步" ID="ID_481486284" CREATED="1612342933879" MODIFIED="1612342935070">
<node TEXT=" 事件中经常会含有时间相关的信息（比如在X秒进行开火）" ID="ID_1104018353" CREATED="1612342944310" MODIFIED="1612342949735"/>
<node TEXT=" 服务器需要对客户端的不合法操作进行纠正" ID="ID_338351613" CREATED="1612342955846" MODIFIED="1612342956977"/>
<node TEXT=" 实现时钟同步最常见且广泛的方式就是网络时间协议（Network Time Protocol，简称NTP）" ID="ID_585594395" CREATED="1612342983838" MODIFIED="1612342985348"/>
</node>
</node>
<node TEXT="插值技术" ID="ID_1224210343" CREATED="1612343264640" MODIFIED="1612343272177">
<node TEXT=" 内插值（ interpolation ）" ID="ID_832324060" CREATED="1612343296007" MODIFIED="1612343301330">
<node TEXT=" 通过已知的、离散的数据点，在范围内推求新数据点的方法（重建连续的数据信息）" ID="ID_970416371" CREATED="1612343329672" MODIFIED="1612343332051"/>
<node TEXT=" 常见于各种信号处理和图像处理" ID="ID_1653875570" CREATED="1612343345096" MODIFIED="1612343346728"/>
<node TEXT=" 根据已知的离散点在一定时间内按照一定算法去模拟在点间的移动路径" ID="ID_366213561" CREATED="1612343356222" MODIFIED="1612343357604"/>
</node>
<node TEXT=" 外插值（extrapolation）" ID="ID_1305060027" CREATED="1612343307055" MODIFIED="1612343313288">
<node TEXT="概念" ID="ID_1866887861" CREATED="1612343457085" MODIFIED="1612343459087">
<node TEXT=" 从已知数据的离散集合中构建超出原始范围的新数据的方法" ID="ID_700538196" CREATED="1612343427422" MODIFIED="1612343428425"/>
<node TEXT=" 根据过去和现在的发展趋势来推断未来，属于统计学上的概念" ID="ID_1357078491" CREATED="1612343440127" MODIFIED="1612343441490"/>
<node TEXT=" 与外插值还有一个相似的概念称为导航推测" ID="ID_354433853" CREATED="1612343451950" MODIFIED="1612343484547"/>
</node>
<node TEXT=" 导航推测" ID="ID_407343867" CREATED="1612343471301" MODIFIED="1612343472632">
<node TEXT=" DeadReckoning（简称DR）" ID="ID_1153106877" CREATED="1612343485999" MODIFIED="1612343489286"/>
<node TEXT=" DR是一种利用现在物体位置及速度推定未来位置方向的航海技术，属于应用技术方向的概念" ID="ID_1636295790" CREATED="1612343500343" MODIFIED="1612343501282"/>
<node TEXT=" DR的概念更贴近游戏领域，即给定一个点以及当前的方向等信息，推测其之后的移动路径，外推的算法也有很多种" ID="ID_1092678203" CREATED="1612343509117" MODIFIED="1612343510484"/>
</node>
</node>
</node>
<node TEXT=" 延迟补偿" ID="ID_1597493773" CREATED="1612343615515" MODIFIED="1612343616596">
<node TEXT="概念" ID="ID_1205375456" CREATED="1612664274229" MODIFIED="1612664277205">
<node TEXT=" 所谓延迟补偿，就是弥补客户端到服务器同步延迟的一项技术" ID="ID_1095403319" CREATED="1612664277950" MODIFIED="1612664365376"/>
<node TEXT=" 考虑到本地玩家的时间总是领先服务器，玩家开枪的时间到服务器执行时就一定会被延迟" ID="ID_1528369407" CREATED="1612343814107" MODIFIED="1612343815545"/>
<node TEXT=" 该技术的核心是服务器在指定时刻对玩家角色进行位置的回滚与计算处理" ID="ID_877717065" CREATED="1612664386453" MODIFIED="1612664387967"/>
</node>
<node TEXT="流程" ID="ID_496384802" CREATED="1612664452163" MODIFIED="1612664457759">
<node TEXT=" 当客户端玩家开枪时，这个操作同步会在Xms后到达服务器，服务器这时候计算命中就已经出现了延迟" ID="ID_1551348768" CREATED="1612664458116" MODIFIED="1612664467104"/>
<node TEXT=" 为了得到更准确的结果，服务器会在定时记录所有玩家的位置" ID="ID_752528894" CREATED="1612664481346" MODIFIED="1612664482533"/>
<node TEXT=" 当收到一个客户端开枪事件后，服务器会立刻把所有玩家回退到Xms前的位置并计算是否命中" ID="ID_815541224" CREATED="1612664509332" MODIFIED="1612664518093"/>
<node TEXT=" 计算后服务器立刻还原其位置" ID="ID_799133017" CREATED="1612664528644" MODIFIED="1612664534133"/>
</node>
<node TEXT=" ACT中采用延迟补偿会影响玩家体验。如果该情况发生在FPS里面，就不会有很大的问题，因为A根本不知道B什么时候瞄准的A" ID="ID_478371930" CREATED="1612664734065" MODIFIED="1612664996451"/>
</node>
</node>
<node TEXT=" 状态同步和帧同步的区别" FOLDED="true" POSITION="right" ID="ID_1748358468" CREATED="1583397411249" MODIFIED="1611648395655">
<edge COLOR="#00ff00"/>
<node TEXT="战斗核心逻辑" ID="ID_706220484" CREATED="1583397431320" MODIFIED="1583397470969">
<node TEXT=" 战斗逻辑" ID="ID_1487740085" CREATED="1583397485719" MODIFIED="1583397491602">
<node TEXT=" 技能逻辑、普攻、属性、伤害" ID="ID_1572025235" CREATED="1583397492416" MODIFIED="1583397503441"/>
<node TEXT=" 移动、AI、检测、碰撞" ID="ID_600366057" CREATED="1583397503744" MODIFIED="1583397505106"/>
</node>
<node TEXT="状态同步的战斗逻辑在服务端" ID="ID_1009412448" CREATED="1583397441545" MODIFIED="1583397449921"/>
<node TEXT="帧同步的战斗逻辑在客户端" ID="ID_1553590500" CREATED="1583397446792" MODIFIED="1583401280074">
<node TEXT=" 需要有相同的随机种子，确保多个客户端计算结果一致" ID="ID_1776081966" CREATED="1583401280248" MODIFIED="1583401301177"/>
<node TEXT=" 浮点数计算无法保证一致性，需要转换为定点数" ID="ID_794659046" CREATED="1583402090868" MODIFIED="1583402095252"/>
</node>
</node>
<node TEXT=" 客户端和服务端通信" ID="ID_659347401" CREATED="1583397645070" MODIFIED="1583397646391">
<node TEXT=" 状态同步" ID="ID_1324189980" CREATED="1583397782646" MODIFIED="1583397783855">
<node TEXT="客户端更像是一个服务端数据的表现层" ID="ID_46360254" CREATED="1583397651063" MODIFIED="1583397781695"/>
<node TEXT=" 在属性发生改变的时候，服务端实时告诉客户端" ID="ID_1696537623" CREATED="1583397681903" MODIFIED="1583397708759"/>
<node TEXT="客户端只作属性展示，不作修改" ID="ID_1343993302" CREATED="1583397709735" MODIFIED="1583397745558"/>
</node>
<node TEXT="帧同步" ID="ID_852605246" CREATED="1583397794525" MODIFIED="1583397802310">
<node TEXT=" 服务端只转发操作，不做任何逻辑处理。或者客户端直接通过P2P技术发送" ID="ID_1537417579" CREATED="1583397809212" MODIFIED="1583486508303"/>
<node TEXT=" 客户端A释放了一个技能x，传递给服务端，服务端转发给BCD" ID="ID_573228148" CREATED="1583397843957" MODIFIED="1583397898446"/>
<node TEXT=" 指令是不能丢失的，否则客户端计算的结果不一致" ID="ID_932246769" CREATED="1583400622741" MODIFIED="1583400646165"/>
</node>
</node>
<node TEXT="流量" ID="ID_218242887" CREATED="1583397904292" MODIFIED="1583397906645">
<node TEXT=" 状态同步比帧同步流量消耗大" ID="ID_147854413" CREATED="1583397919748" MODIFIED="1583397921588"/>
<node TEXT="  状态同步下，每次改变都要同步一次全部属性，这个消耗是巨大的。而帧同步不需要同步属性" ID="ID_1337997007" CREATED="1583397931876" MODIFIED="1583398046020"/>
<node TEXT="状态同步下，释放一个技能，服务端需要通知客户端很多条消息。而帧同步就只需要转发一次操作就行了" ID="ID_1070910406" CREATED="1583397977740" MODIFIED="1583398090012"/>
</node>
<node TEXT="回放与观战" ID="ID_1031901017" CREATED="1583398103434" MODIFIED="1583398109174">
<node TEXT=" 帧同步的回放&amp;观战比状态同步好做得多" ID="ID_1254143578" CREATED="1583398166977" MODIFIED="1583398168196"/>
<node TEXT="帧同步只需要保存每局所有人的操作就好了" ID="ID_235161526" CREATED="1583398176001" MODIFIED="1583398180819"/>
<node TEXT=" 状态同步的回放&amp;观战，需要有一个回放&amp;观战服务器" ID="ID_1681357101" CREATED="1583398188921" MODIFIED="1583398189986"/>
<node TEXT=" 回放&amp;观战服务器" ID="ID_533901166" CREATED="1583398566584" MODIFIED="1583398568104">
<node TEXT=" 战斗服务器在给客户端发送消息的同时，还需要把这些消息发给放&amp;观战服务器" ID="ID_1988970468" CREATED="1583398583757" MODIFIED="1583398589656"/>
<node TEXT=" 其他客户端请求回放或者观战，则回放&amp;观战服务器把储存起来的消息按时间发给客户端" ID="ID_217510394" CREATED="1583398607917" MODIFIED="1583398608968"/>
</node>
</node>
<node TEXT="安全性" ID="ID_81499828" CREATED="1583398613021" MODIFIED="1583398615888">
<node TEXT=" 状态同步的安全性比帧同步高很多，状态同步的所有逻辑和数值都是在服务端的" ID="ID_1424656686" CREATED="1583398705085" MODIFIED="1583398711503"/>
<node TEXT=" 帧同步所有数据全部在客户端，客户端易被破解。" ID="ID_797077808" CREATED="1583398753316" MODIFIED="1583398835189"/>
<node TEXT="帧同步moba类游戏的全图挂，吃鸡游戏的透视挂，都是没办法防止的" ID="ID_1734666486" CREATED="1583398836115" MODIFIED="1583398845733"/>
<node TEXT="帧同步被篡改数据可以通过服务器比对同局其他人的战斗结果来预防" ID="ID_474354284" CREATED="1583398846091" MODIFIED="1583398889053"/>
<node TEXT="帧同步需要在服务器同步逻辑校验防止作弊" ID="ID_1365443071" CREATED="1583486613462" MODIFIED="1583486634048"/>
</node>
<node TEXT=" 状态同步服务器压力比较大，因为要做更多运算" ID="ID_1323088238" CREATED="1583398910234" MODIFIED="1583398914404"/>
<node TEXT=" 开发效率" ID="ID_760655125" CREATED="1583398915250" MODIFIED="1583398920788">
<node TEXT=" 状态同步的游戏占主流，状态同步开发起来比较难，同一个功能至少需要一个客户端和服务端共同完成" ID="ID_1070711212" CREATED="1583399468237" MODIFIED="1583399501104"/>
<node TEXT=" 帧同步服务器开发难度低，同一套方案可以给很多不同类型的游戏使用，反正都是转发操作" ID="ID_366710254" CREATED="1583399482566" MODIFIED="1583399484143"/>
</node>
<node TEXT=" 断线重连" ID="ID_693475588" CREATED="1583399556269" MODIFIED="1583399558224">
<node TEXT=" 状态同步的断线重连很好做" ID="ID_1030847783" CREATED="1583399750308" MODIFIED="1583399751254">
<node TEXT=" 把整个场景和人物全部重新生成一遍" ID="ID_533524695" CREATED="1583399759324" MODIFIED="1583399760173"/>
<node TEXT=" 各种数值根据服务端提供加到人物身上" ID="ID_90306124" CREATED="1583399767579" MODIFIED="1583399768548"/>
</node>
<node TEXT=" 帧同步的断线重连就比较麻烦" ID="ID_1968591696" CREATED="1583399778259" MODIFIED="1583399779879">
<node TEXT="  客户端在战场开始的第10秒短线了，第15秒连回来了，就需要服务端把第10秒到第15秒之间5秒内的所有消息一次性发给客户端，然后客户端加速整个游戏的核心逻辑运行速度（例如加速成10倍），直到追上现有进度" ID="ID_1020616326" CREATED="1583399798692" MODIFIED="1583399799599"/>
</node>
</node>
</node>
</node>
</map>
