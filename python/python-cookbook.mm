<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="python-cookbook" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1589287902976" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle" zoom="0.909">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3.0 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0.0 cm" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.8999999999999995 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="105" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="数据结构和算法" FOLDED="true" POSITION="right" ID="ID_1777517453" CREATED="1589287909020" MODIFIED="1589287920566">
<edge COLOR="#7c007c"/>
<node TEXT="解压可迭代对象赋值给多个变量" ID="ID_43205833" CREATED="1589287920868" MODIFIED="1589287956057">
<node TEXT="这种形式的星号表达式，py2不支持" ID="ID_1512795304" CREATED="1589288078996" MODIFIED="1589288098012"/>
<node ID="ID_1066468708" CREATED="1589288040315" MODIFIED="1589288052062"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">record = (<font color="#a5c261">'Dave'</font><font color="#cc7832">, </font><font color="#a5c261">'dave@example.com'</font><font color="#cc7832">, </font><font color="#a5c261">'773-555-1212'</font><font color="#cc7832">, </font><font color="#a5c261">'847-555-1212'</font>)<br/>name<font color="#cc7832">, </font>email<font color="#cc7832">, </font>*phone_numbers = record<br/><font color="#808080"># phone_numbers -> ['773-555-1212', '847-555-1212']</font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 保留最后 N 个元素" ID="ID_1954289696" CREATED="1589288110859" MODIFIED="1589288112453">
<node TEXT="deque定长队列" ID="ID_596156076" CREATED="1589288121250" MODIFIED="1589289393885"/>
<node ID="ID_903467210" CREATED="1589288218238" MODIFIED="1589288218238"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>collections<br/>q = collections.deque(<span style="color: #aa4926"><font color="#aa4926">maxlen</font></span>=<span style="color: #6897bb"><font color="#6897bb">3</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>i <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">range</font></span>(<span style="color: #6897bb"><font color="#6897bb">10</font></span>):<br/>    q.append(i)<br/><span style="color: #808080"><font color="#808080"># q -> [7, 8, 9]</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 查找最大或最小的 N 个元素" ID="ID_765638783" CREATED="1589288678172" MODIFIED="1589288679374">
<node TEXT="列表" ID="ID_1986954102" CREATED="1589288704189" MODIFIED="1589288706111">
<node ID="ID_341199791" CREATED="1589288693137" MODIFIED="1589288693137"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>heapq<br/>nums = [<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">8</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">23</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">7</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>-<span style="color: #6897bb"><font color="#6897bb">4</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">18</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">23</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">42</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">37</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">print</font></span>(heapq.nlargest(<span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>nums))  <span style="color: #808080"><font color="#808080"># Prints [42, 37, 23]<br/></font></span><span style="color: #cc7832"><font color="#cc7832">print</font></span>(heapq.nsmallest(<span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>nums))  <span style="color: #808080"><font color="#808080"># Prints [-4, 1, 2]</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="复杂结构" ID="ID_835957490" CREATED="1589288708709" MODIFIED="1589289300010">
<node ID="ID_560905579" CREATED="1589288770138" MODIFIED="1589288782766"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>heapq<br/>portfolio = [<br/>    {<span style="color: #a5c261"><font color="#a5c261">'name'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'IBM'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'shares'</font></span>: <span style="color: #6897bb"><font color="#6897bb">100</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'price'</font></span>: <span style="color: #6897bb"><font color="#6897bb">91.1</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'name'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'AAPL'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'shares'</font></span>: <span style="color: #6897bb"><font color="#6897bb">50</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'price'</font></span>: <span style="color: #6897bb"><font color="#6897bb">543.22</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'name'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'FB'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'shares'</font></span>: <span style="color: #6897bb"><font color="#6897bb">200</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'price'</font></span>: <span style="color: #6897bb"><font color="#6897bb">21.09</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'name'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'HPQ'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'shares'</font></span>: <span style="color: #6897bb"><font color="#6897bb">35</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'price'</font></span>: <span style="color: #6897bb"><font color="#6897bb">31.75</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'name'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'YHOO'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'shares'</font></span>: <span style="color: #6897bb"><font color="#6897bb">45</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'price'</font></span>: <span style="color: #6897bb"><font color="#6897bb">16.35</font></span>}<span style="color: #cc7832"><font color="#cc7832">,</font></span><br/>]<br/>cheap = heapq.nsmallest(<span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>portfolio<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>s: s[<span style="color: #a5c261"><font color="#a5c261">'price'</font></span>])<br/>expensive = heapq.nlargest(<span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>portfolio<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>s: s[<span style="color: #a5c261"><font color="#a5c261">'price'</font></span>])</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="堆" ID="ID_1336012773" CREATED="1589288805238" MODIFIED="1589288807886">
<node TEXT="heap[0] 永远是最小的元素" ID="ID_678932863" CREATED="1589288808508" MODIFIED="1589288823508"/>
<node TEXT=" 将列表转化为堆, 通过heapq.heappop()得到最小元素" ID="ID_1921267936" CREATED="1589289081809" MODIFIED="1589289089858"/>
<node ID="ID_1657620557" CREATED="1589289114558" MODIFIED="1589289114558"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>heapq<br/>nums = [<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">8</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">23</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">7</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>-<span style="color: #6897bb"><font color="#6897bb">4</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">18</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">23</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">42</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">37</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span>]<br/>n = <span style="color: #8888c6"><font color="#8888c6">len</font></span>(nums)<br/>heapq.heapify(nums)<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>_ <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">range</font></span>(n):<br/>    <span style="color: #cc7832"><font color="#cc7832">print </font></span>(heapq.heappop(nums))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="如果N=1，min() 或 max() 更合适；如N接近元素个数，先排序再切片更合适" ID="ID_214938731" CREATED="1589289130916" MODIFIED="1589289214809"/>
</node>
<node TEXT="实现一个优先级队列" ID="ID_793552483" CREATED="1589289615261" MODIFIED="1589289624365">
<node ID="ID_443179598" CREATED="1589289942855" MODIFIED="1589289942855"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>heapq<br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>PriorityQueue:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._queue = []<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._index = <span style="color: #6897bb"><font color="#6897bb">0<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">push</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>item<span style="color: #cc7832"><font color="#cc7832">, </font></span>priority):<br/>        heapq.heappush(<span style="color: #94558d"><font color="#94558d">self</font></span>._queue<span style="color: #cc7832"><font color="#cc7832">, </font></span>(-priority<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>._index<span style="color: #cc7832"><font color="#cc7832">, </font></span>item))<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._index += <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">pop</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>heapq.heappop(<span style="color: #94558d"><font color="#94558d">self</font></span>._queue)[-<span style="color: #6897bb"><font color="#6897bb">1</font></span>]</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="字典的运算" ID="ID_1916881868" CREATED="1589290234894" MODIFIED="1589290239016">
<node TEXT="思路" ID="ID_1754423190" CREATED="1589290675283" MODIFIED="1589290683620">
<node TEXT=" 在一个字典上执行普通的数学运算，函数仅作用于键，而不是值" ID="ID_1823423569" CREATED="1589290534420" MODIFIED="1589290557957"/>
<node TEXT="使用 zip() 函数先将键和值反转过来，注意的是 zip() 函数创建的是一个只能访问一次的迭代器" ID="ID_143031338" CREATED="1589290640508" MODIFIED="1589290671092"/>
</node>
<node ID="ID_1055372789" CREATED="1589290799902" MODIFIED="1589290799902"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">prices = {<br/>    <span style="color: #a5c261"><font color="#a5c261">'ACME'</font></span>: <span style="color: #6897bb"><font color="#6897bb">45.23</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'AAPL'</font></span>: <span style="color: #6897bb"><font color="#6897bb">612.78</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'IBM'</font></span>: <span style="color: #6897bb"><font color="#6897bb">205.55</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'HPQ'</font></span>: <span style="color: #6897bb"><font color="#6897bb">37.20</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'FB'</font></span>: <span style="color: #6897bb"><font color="#6897bb">10.75<br/></font></span>}</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="最大值、最小值" ID="ID_1543507505" CREATED="1589290239230" MODIFIED="1589290329039">
<node ID="ID_1185286825" CREATED="1589291000237" MODIFIED="1589291000237"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">min_price_key = <span style="color: #8888c6"><font color="#8888c6">min</font></span>(prices<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>k: prices[k])<br/>min_price_value = prices[min_price_key]<br/>min_price = <span style="color: #8888c6"><font color="#8888c6">min</font></span>(<span style="color: #8888c6"><font color="#8888c6">zip</font></span>(prices.values()<span style="color: #cc7832"><font color="#cc7832">, </font></span>prices.keys()))<br/><span style="color: #808080"><font color="#808080"># min_price is (10.75, 'FB')<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span></font>max_price_key = <span style="color: #8888c6"><font color="#8888c6">max</font></span>(prices<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>k: prices[k])<br/>max_price_value = prices[max_price_key]<br/>max_price = <span style="color: #8888c6"><font color="#8888c6">max</font></span>(<span style="color: #8888c6"><font color="#8888c6">zip</font></span>(prices.values()<span style="color: #cc7832"><font color="#cc7832">, </font></span>prices.keys()))<br/><span style="color: #808080"><font color="#808080"># max_price is (612.78, 'AAPL')</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="排列（ zip() 加 sorted() ）" ID="ID_99063129" CREATED="1589290245030" MODIFIED="1589290412886">
<node ID="ID_1444579543" CREATED="1589290490497" MODIFIED="1589290490497"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">prices_sorted = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(<span style="color: #8888c6"><font color="#8888c6">zip</font></span>(prices.values()<span style="color: #cc7832"><font color="#cc7832">, </font></span>prices.keys()))<br/><span style="color: #808080"><font color="#808080"># prices_sorted is [(10.75, 'FB'), (37.2, 'HPQ'), (45.23, 'ACME'),<br/></font></span><font color="#808080"><span style="color: #808080">#                   (205.55, 'IBM'), (612.78, 'AAPL')]</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 两个字典中寻找相同的键、相同的值" ID="ID_399674441" CREATED="1589444742038" MODIFIED="1589444756515">
<node TEXT=" py3 视图对象" ID="ID_1745137912" CREATED="1589444854666" MODIFIED="1589445024339">
<node TEXT="字典的 keys() 或者 items() 方法 返回一个视图对象" ID="ID_983938743" CREATED="1589444785466" MODIFIED="1589444853829"/>
<node TEXT="视图对象支持集合操，而不用先将它们转换成一个 set" ID="ID_582103844" CREATED="1589444812338" MODIFIED="1589444845235"/>
<node TEXT=" values()不能保证所有的值互不相同，需先转为set" ID="ID_1157396807" CREATED="1589445261489" MODIFIED="1589445284730"/>
</node>
<node ID="ID_39636330" CREATED="1589445204058" MODIFIED="1589445204058"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">a = {<br/>    <span style="color: #6a8759"><font color="#6a8759">'x'</font></span>: <span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #6a8759"><font color="#6a8759">'y'</font></span>: <span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #6a8759"><font color="#6a8759">'z'</font></span>: <span style="color: #6897bb"><font color="#6897bb">3<br/></font></span>}<br/>b = {<br/>    <span style="color: #6a8759"><font color="#6a8759">'w'</font></span>: <span style="color: #6897bb"><font color="#6897bb">10</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #6a8759"><font color="#6a8759">'x'</font></span>: <span style="color: #6897bb"><font color="#6897bb">11</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #6a8759"><font color="#6a8759">'y'</font></span>: <span style="color: #6897bb"><font color="#6897bb">2<br/></font></span>}<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(a.keys() & b.keys())<br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">合集</font></span><span style="color: #808080"><font color="#808080"> { 'x', 'y' }<br/></font></span><span style="color: #8888c6"><font color="#8888c6">print</font></span>(a.keys() - b.keys())<br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">差集</font></span><span style="color: #808080"><font color="#808080"> { 'z' }</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 序列中出现次数最多的元素" ID="ID_1215717059" CREATED="1589454708016" MODIFIED="1589454709562">
<node TEXT=" collections.Counter.most_common" ID="ID_306798563" CREATED="1589454729759" MODIFIED="1589454742280"/>
<node TEXT=" 出现频率最高的3个单词" ID="ID_1452172178" CREATED="1589455438658" MODIFIED="1589455439771">
<node ID="ID_1034316605" CREATED="1589454903517" MODIFIED="1589455437709"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>collections <span style="color: #cc7832"><font color="#cc7832">import </font></span>Counter<br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">出现频率最高的</font></span><span style="color: #808080"><font color="#808080">3</font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">个单词<br/></font></span>words = [<br/>    <span style="color: #a5c261"><font color="#a5c261">'look'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'into'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'my'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'look'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'into'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'my'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'the'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'the'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'the'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'not'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'around'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'the'</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">"don't"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'look'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'around'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'the'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'eyes'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'look'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'into'</font></span><span style="color: #cc7832"><font color="#cc7832">,</font></span>]<br/>word_counts = Counter(words)<br/><span style="color: #cc7832"><font color="#cc7832">print</font></span>(word_counts.most_common(<span style="color: #6897bb"><font color="#6897bb">3</font></span>))<br/><span style="color: #808080"><font color="#808080"># [('eyes', 7), ('the', 5), ('look', 4)]</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="Counter.update计数" ID="ID_1790007035" CREATED="1589455445997" MODIFIED="1589455501045">
<node ID="ID_4644422" CREATED="1589455432414" MODIFIED="1589455432414"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">c = Counter(<span style="color: #a5c261"><font color="#a5c261">"abcd"</font></span>)<br/><span style="color: #808080"><font color="#808080"># Counter({'a': 1, 'c': 1, 'b': 1, 'd': 1})<br/></font></span>c.update(<span style="color: #a5c261"><font color="#a5c261">"abcd"</font></span>)<br/><span style="color: #808080"><font color="#808080"># Counter({'a': 2, 'c': 2, 'b': 2, 'd': 2})</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" Counter数学运算操作" ID="ID_1712024246" CREATED="1589455491114" MODIFIED="1589455502027">
<node ID="ID_1735556541" CREATED="1589455571965" MODIFIED="1589455571965"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">a = Counter(<span style="color: #a5c261"><font color="#a5c261">"abcdabcd"</font></span>)<br/>b = Counter(<span style="color: #a5c261"><font color="#a5c261">"abc"</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">print</font></span>(a-b)<br/><span style="color: #808080"><font color="#808080"># Counter({'d': 2, 'a': 1, 'c': 1, 'b': 1})</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="根据某个或某几个字典字段来排序字典列表" ID="ID_1643910934" CREATED="1589455785167" MODIFIED="1589455795561">
<node ID="ID_1994810488" CREATED="1589456199901" MODIFIED="1589456199901"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>operator <span style="color: #cc7832"><font color="#cc7832">import </font></span>itemgetter<br/>rows = [<br/>    {<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Brian'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'lname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Jones'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'uid'</font></span>: <span style="color: #6897bb"><font color="#6897bb">1003</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'David'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'lname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Beazley'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'uid'</font></span>: <span style="color: #6897bb"><font color="#6897bb">1002</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'John'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'lname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Cleese'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'uid'</font></span>: <span style="color: #6897bb"><font color="#6897bb">1001</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>{<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Big'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'lname'</font></span>: <span style="color: #a5c261"><font color="#a5c261">'Jones'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">'uid'</font></span>: <span style="color: #6897bb"><font color="#6897bb">1004</font></span>}<br/>]<br/><span style="color: #808080"><font color="#808080"># --- </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">单个字段<br/></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">根据</font></span><span style="color: #808080"><font color="#808080"> fname </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">排序<br/></font></span>rows_by_fname = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(rows<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=itemgetter(<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>))<br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">根据</font></span><span style="color: #808080"><font color="#808080"> uid </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">排序<br/></font></span>rows_by_uid = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(rows<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=itemgetter(<span style="color: #a5c261"><font color="#a5c261">'uid'</font></span>))<br/><br/><span style="color: #808080"><font color="#808080"># --- </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">多个字段<br/></font></span>rows_by_lfname = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(rows<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=itemgetter(<span style="color: #a5c261"><font color="#a5c261">'lname'</font></span><span style="color: #cc7832"><font color="#cc7832">,</font></span><span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>))</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="lambda" ID="ID_301857626" CREATED="1589456263788" MODIFIED="1589456268214">
<node TEXT=" itemgetter() 也可以用 lambda 表达式代替" ID="ID_287400049" CREATED="1589456203381" MODIFIED="1589456217543"/>
<node TEXT=" 使用 itemgetter() 方式会运行的稍微快点" ID="ID_1740935735" CREATED="1589456286276" MODIFIED="1589456287677"/>
<node ID="ID_139837678" CREATED="1589456258817" MODIFIED="1589456258817"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">rows_by_fname = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(rows<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>r: r[<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>])<br/>rows_by_lfname = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(rows<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>r: (r[<span style="color: #a5c261"><font color="#a5c261">'lname'</font></span>]<span style="color: #cc7832"><font color="#cc7832">, </font></span>r[<span style="color: #a5c261"><font color="#a5c261">'fname'</font></span>]))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="itemgetter 也同样适用于 min() 和 max() 等函数" ID="ID_944375346" CREATED="1589456302780" MODIFIED="1589456313822"/>
</node>
<node TEXT="排序不支持原生比较的对象" ID="ID_286656588" CREATED="1589457069599" MODIFIED="1589457081640">
<node ID="ID_82421078" CREATED="1589457327155" MODIFIED="1589457327155"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>User:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>user_id):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.user_id = user_id<br/>users = [User(<span style="color: #6897bb"><font color="#6897bb">5</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>User(<span style="color: #6897bb"><font color="#6897bb">3</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>User(<span style="color: #6897bb"><font color="#6897bb">9</font></span>)]<br/><br/>user_list = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(users<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>user: user.user_id)<br/><br/><span style="color: #cc7832"><font color="#cc7832">from </font></span>operator <span style="color: #cc7832"><font color="#cc7832">import </font></span>attrgetter<br/>user_list = <span style="color: #8888c6"><font color="#8888c6">sorted</font></span>(users<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">key</font></span>=attrgetter(<span style="color: #a5c261"><font color="#a5c261">"user_id"</font></span>))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="字符串和文本" FOLDED="true" POSITION="right" ID="ID_1817580706" CREATED="1589871679768" MODIFIED="1589871687365">
<edge COLOR="#007c7c"/>
<node TEXT=" 字符串开头或结尾匹配" ID="ID_641321443" CREATED="1589871813915" MODIFIED="1589871815229">
<node TEXT="开头" ID="ID_374051177" CREATED="1589871882987" MODIFIED="1589871888149">
<node TEXT=" str.startswith(&apos;http:&apos;)" ID="ID_1251321340" CREATED="1589871843530" MODIFIED="1589871941460"/>
<node TEXT=" name.startswith((&apos;http:&apos;, &apos;https:&apos;, &apos;ftp:&apos;)" ID="ID_944041025" CREATED="1589871919123" MODIFIED="1589871920268"/>
</node>
<node TEXT="结尾" ID="ID_695613709" CREATED="1589871888378" MODIFIED="1589871890636">
<node TEXT=" name.endswith(&apos;.py&apos;)" ID="ID_275789173" CREATED="1589871899778" MODIFIED="1589871902388"/>
<node TEXT=" name.endswith((&apos;.c&apos;, &apos;.h&apos;)" ID="ID_737428945" CREATED="1589871907992" MODIFIED="1589871908973"/>
</node>
</node>
<node TEXT="字符串搜索和替换" ID="ID_238950575" CREATED="1589880250082" MODIFIED="1589880454532">
<node TEXT=" sub() 函数参数" ID="ID_1056749778" CREATED="1589880509065" MODIFIED="1589880605296">
<node TEXT=" 一：被匹配的模式" ID="ID_1739602611" CREATED="1589880515521" MODIFIED="1589880602198"/>
<node TEXT=" 二：替换模式" ID="ID_616690783" CREATED="1589880520040" MODIFIED="1589880596227"/>
<node TEXT="三：被更替的文本" ID="ID_780409227" CREATED="1589880563792" MODIFIED="1589880589134"/>
</node>
<node TEXT=" 11/27/2012 的日期字符串改成 2012-11-27" ID="ID_744658163" CREATED="1589880454875" MODIFIED="1589880467471">
<node TEXT="组号" ID="ID_673547001" CREATED="1589880824647" MODIFIED="1589880836204">
<node TEXT=" 反斜杠数字比如 \3 指向前面模式的捕获组号" ID="ID_582996573" CREATED="1589880542401" MODIFIED="1589880544132"/>
<node ID="ID_599958782" CREATED="1589880487345" MODIFIED="1589880487345"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">text = <span style="color: #a5c261"><font color="#a5c261">'Today is 11/27/2012. PyCon starts 3/13/2013.'<br/></font></span>r = re.sub(<span style="color: #a5c261"><font color="#a5c261">r'(\d+)/(\d+)/(\d+)'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">r'\3-\1-\2'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>text)<br/><span style="color: #808080"><font color="#808080"># Today is 2012-11-27. PyCon starts 2013-3-13.</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="命名分组" ID="ID_1742576782" CREATED="1589880840008" MODIFIED="1589880845977">
<node ID="ID_820427650" CREATED="1589880996862" MODIFIED="1589881130918"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        text&nbsp;=&nbsp;<font color="#ce9178">'Today&nbsp;is&nbsp;11/27/2012.&nbsp;PyCon&nbsp;starts&nbsp;3/13/2013.'</font>
      </div>
      <div>
        re.sub(<font color="#569cd6">r</font><font color="#d16969">'</font><font color="#ce9178">(</font><font color="#569cd6">?P&lt;month&gt;</font><font color="#d16969">\d</font><font color="#d7ba7d">+</font><font color="#ce9178">)</font><font color="#d16969">/</font><font color="#ce9178">(</font><font color="#569cd6">?P&lt;day&gt;</font><font color="#d16969">\d</font><font color="#d7ba7d">+</font><font color="#ce9178">)</font><font color="#d16969">/</font><font color="#ce9178">(</font><font color="#569cd6">?P&lt;year&gt;</font><font color="#d16969">\d</font><font color="#d7ba7d">+</font><font color="#ce9178">)</font><font color="#d16969">'</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">r</font><font color="#d16969">'</font><font color="#d7ba7d">\g</font><font color="#d16969">&lt;year&gt;-</font><font color="#d7ba7d">\g</font><font color="#d16969">&lt;month&gt;-</font><font color="#d7ba7d">\g</font><font color="#d16969">&lt;day&gt;'</font>,&nbsp;text)
      </div>
      <div>
        <font color="#6a9955">#&nbsp;Today&nbsp;is&nbsp;2012-11-27.&nbsp;PyCon&nbsp;starts&nbsp;2013-3-13.</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="复杂替换可用回调函数" ID="ID_1493271488" CREATED="1589881310126" MODIFIED="1589881334155">
<node ID="ID_306768918" CREATED="1589881441595" MODIFIED="1589881441595"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>calendar <span style="color: #cc7832"><font color="#cc7832">import </font></span>month_abbr<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">change_date</font></span>(m):<br/>    mon_name = month_abbr[<span style="color: #8888c6"><font color="#8888c6">int</font></span>(m.group(<span style="color: #6897bb"><font color="#6897bb">1</font></span>))]<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #a5c261"><font color="#a5c261">'{} {} {}'</font></span>.format(m.group(<span style="color: #6897bb"><font color="#6897bb">2</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>mon_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>m.group(<span style="color: #6897bb"><font color="#6897bb">3</font></span>))<br/>text = <span style="color: #a5c261"><font color="#a5c261">'Today is 11/27/2012. PyCon starts 3/13/2013.'<br/></font></span>datepat = re.compile(<span style="color: #a5c261"><font color="#a5c261">r'(\d+)/(\d+)/(\d+)'</font></span>)<br/>datepat.sub(change_date<span style="color: #cc7832"><font color="#cc7832">, </font></span>text)<br/><span style="color: #808080"><font color="#808080"># Today is 27 Nov 2012. PyCon starts 13 Mar 2013.</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="需要知道发生了多少次更替" ID="ID_1334560964" CREATED="1589881745156" MODIFIED="1589881766703">
<node TEXT=" re.subn()" ID="ID_1552299811" CREATED="1589881777217" MODIFIED="1589881778349"/>
<node ID="ID_1847780850" CREATED="1589881998908" MODIFIED="1589881998908"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">c = re.compile(<span style="color: #a5c261"><font color="#a5c261">r'#c[a-zA-Z0-9]{6}'</font></span>)<br/>text = <span style="color: #a5c261"><font color="#a5c261">'#cFFFFFasdf, #c245ebdAAAA'<br/></font></span>newtext<span style="color: #cc7832"><font color="#cc7832">, </font></span>n = c.subn(<span style="color: #a5c261"><font color="#a5c261">''</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>text)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="多行匹配模式" ID="ID_435903794" CREATED="1589886281607" MODIFIED="1589886287932">
<node TEXT=" re.DOTALL 标记参数" ID="ID_1133835767" CREATED="1589886431685" MODIFIED="1589886432870"/>
<node TEXT="comment = re.compile(r&apos;/\*(.*?)\*/&apos;, re.DOTALL)&#xa;comment.findall(text2)" ID="ID_219486813" CREATED="1589886400206" MODIFIED="1589886409081"/>
</node>
</node>
<node TEXT="数字日期和时间" FOLDED="true" POSITION="right" ID="ID_667428489" CREATED="1589891078995" MODIFIED="1590032478350">
<edge COLOR="#7c7c00"/>
<node TEXT="round() 版本之坑" ID="ID_1623661408" CREATED="1590041486491" MODIFIED="1590051640407">
<node TEXT=" round(value, ndigits)" ID="ID_45826629" CREATED="1590032494041" MODIFIED="1590032495314"/>
<node TEXT="python2" ID="ID_650732001" CREATED="1590041490793" MODIFIED="1590041493963">
<node TEXT="四舍五入， 距离两端一样远，则保留到离0远的一边" ID="ID_1528928923" CREATED="1590032479762" MODIFIED="1590041656219"/>
<node TEXT="round(0.5)会近似到1，而round(-0.5)会近似到-1" ID="ID_1206921719" CREATED="1590046590776" MODIFIED="1590046685594"/>
<node TEXT="py2 可用 numpy.around 使用类似py3的round" ID="ID_1153425394" CREATED="1590046612351" MODIFIED="1590046675809"/>
<node ID="ID_1719043663" CREATED="1590032833290" MODIFIED="1590032833290"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">x = <span style="color: #6897bb"><font color="#6897bb">1.23456<br/></font></span>x2 = <span style="color: #8888c6"><font color="#8888c6">round</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span>)<br/>x3 = <span style="color: #8888c6"><font color="#8888c6">round</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">3</font></span>)<br/><span style="color: #808080"><font color="#808080"># 1.23, 1.235</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="python3" ID="ID_1973874064" CREATED="1590041494200" MODIFIED="1590041498130">
<node TEXT="四舍六入五成双 ， 如果距离两边一样远，会保留到偶数的一边" ID="ID_1979076345" CREATED="1590041517720" MODIFIED="1590041667145"/>
<node TEXT=" round(0.5)和round(-0.5)都会保留到0，而round(1.5)会保留到2" ID="ID_1217432089" CREATED="1590041624751" MODIFIED="1590041625952"/>
</node>
<node TEXT="浮点数四舍五入 直接 +0.5 取整即可" ID="ID_1459774470" CREATED="1590051561340" MODIFIED="1590051595631"/>
</node>
<node TEXT=" 精确的浮点数运算" ID="ID_706485340" CREATED="1590051603058" MODIFIED="1590051623008">
<node TEXT="decimal 支持十进制浮点运算，比原生的浮点数计算慢很多" ID="ID_555302033" CREATED="1590051701627" MODIFIED="1590053612173"/>
<node TEXT=" decimal 模块主要用在涉及到金融的领域" ID="ID_834583733" CREATED="1590053642892" MODIFIED="1590053644141"/>
<node ID="ID_944867041" CREATED="1590052628031" MODIFIED="1590052628031"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>decimal <span style="color: #cc7832"><font color="#cc7832">import </font></span>Decimal<br/>a = Decimal(<span style="color: #a5c261"><font color="#a5c261">'4.2'</font></span>)<br/>b = Decimal(<span style="color: #a5c261"><font color="#a5c261">'2.1'</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">assert </font></span>a + b == Decimal(<span style="color: #a5c261"><font color="#a5c261">'6.3'</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="控制运算的精度" ID="ID_1923201954" CREATED="1590053368181" MODIFIED="1590053382318">
<node ID="ID_1644604317" CREATED="1590053538929" MODIFIED="1590053538929"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>decimal <span style="color: #cc7832"><font color="#cc7832">import </font></span>Decimal<span style="color: #cc7832"><font color="#cc7832">, </font></span>localcontext<br/>a = Decimal(<span style="color: #a5c261"><font color="#a5c261">'1.3'</font></span>)<br/>b = Decimal(<span style="color: #a5c261"><font color="#a5c261">'1.7'</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">print</font></span>(a / b)<br/><span style="color: #808080"><font color="#808080"># 0.7647058823529411764705882353<br/></font></span><font color="#808080"><span style="color: #808080"># </span></font><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">默认保留</font></span><span style="color: #808080"><font color="#808080">28</font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">位小数点<br/></font></span><span style="color: #cc7832"><font color="#cc7832">with </font></span>localcontext() <span style="color: #cc7832"><font color="#cc7832">as </font></span>ctx:<br/>    ctx.prec = <span style="color: #6897bb"><font color="#6897bb">3<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">print</font></span>(a / b)  <span style="color: #808080"><font color="#808080"># 0.765</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="数字的格式化输出" ID="ID_1026083599" CREATED="1590058058804" MODIFIED="1590058070452">
<node TEXT="保留两位有效小数" ID="ID_1064617901" CREATED="1590058133290" MODIFIED="1590058141386">
<node TEXT=" format(1234.56789, &apos;0.2f&apos;)" ID="ID_1964204250" CREATED="1590058150089" MODIFIED="1590058167590"/>
<node TEXT=" 结果值会根据 round() 函数同样的规则" ID="ID_881784525" CREATED="1590058438984" MODIFIED="1590058440345"/>
</node>
<node TEXT="右对齐，10个字符，1位小数" ID="ID_1168662009" CREATED="1590058203611" MODIFIED="1590058219730">
<node TEXT=" format(1234.56789, &apos;&gt;10.1f&apos;)" ID="ID_809283712" CREATED="1590058225329" MODIFIED="1590058242954"/>
<node TEXT=" &apos;    1234.6&apos;" ID="ID_542542829" CREATED="1590058232754" MODIFIED="1590058234273"/>
</node>
<node TEXT="左对齐" ID="ID_825952997" CREATED="1590058254625" MODIFIED="1590058261434">
<node TEXT=" &lt;" ID="ID_38934728" CREATED="1590058261698" MODIFIED="1590058265659"/>
</node>
<node TEXT="居中" ID="ID_1537668760" CREATED="1590058280994" MODIFIED="1590058284164">
<node TEXT="^" ID="ID_1373042933" CREATED="1590058284409" MODIFIED="1590058286049"/>
</node>
<node TEXT="千分位分隔符" ID="ID_1305567981" CREATED="1590058287995" MODIFIED="1590058318570">
<node TEXT="formt(1234.456789, &quot;,&quot;)" ID="ID_719177853" CREATED="1590058318753" MODIFIED="1590058337601"/>
<node TEXT="1,234.56789" ID="ID_734314121" CREATED="1590058337921" MODIFIED="1590058369446"/>
</node>
</node>
<node TEXT=" 二 八 十六进制整数" ID="ID_233645939" CREATED="1590058554967" MODIFIED="1590058558601">
<node TEXT=" 整数转换为二进制" ID="ID_1168920009" CREATED="1590058601823" MODIFIED="1590058603265">
<node ID="ID_1945401154" CREATED="1590058872678" MODIFIED="1590058872678"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #8888c6"><font color="#8888c6">bin</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span>)  <span style="color: #808080"><font color="#808080"># '0b10011010010'<br/></font></span><span style="color: #8888c6"><font color="#8888c6">format</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'b'</font></span>)  <span style="color: #808080"><font color="#808080"># '10011010010'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 整数转换为八进制" ID="ID_269887197" CREATED="1590058605383" MODIFIED="1590058614029">
<node ID="ID_1602173105" CREATED="1590058876514" MODIFIED="1590058876514"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #8888c6"><font color="#8888c6">oct</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span>)  <span style="color: #808080"><font color="#808080"># '0o2322'<br/></font></span><span style="color: #8888c6"><font color="#8888c6">format</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'o'</font></span>)  <span style="color: #808080"><font color="#808080"># '2322'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 整数转换为十六进制" ID="ID_1916442526" CREATED="1590058606655" MODIFIED="1590058616805">
<node ID="ID_1056936409" CREATED="1590058879843" MODIFIED="1590058879843"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #8888c6"><font color="#8888c6">hex</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span>)  <span style="color: #808080"><font color="#808080"># '0x4d2'<br/></font></span><span style="color: #8888c6"><font color="#8888c6">format</font></span>(<span style="color: #6897bb"><font color="#6897bb">1234</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'x'</font></span>)  <span style="color: #808080"><font color="#808080"># '4d2'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="转十进制" ID="ID_728155341" CREATED="1590058817768" MODIFIED="1590058832528">
<node TEXT="int(&apos;4d2&apos;, 16)" ID="ID_1214596276" CREATED="1590058832792" MODIFIED="1590058852856"/>
<node TEXT=" int(&apos;10011010010&apos;, 2)" ID="ID_914501789" CREATED="1590058857118" MODIFIED="1590058858352"/>
</node>
</node>
<node TEXT="分数运算" ID="ID_1105523368" CREATED="1590059039093" MODIFIED="1590059044345">
<node ID="ID_1755171660" CREATED="1590059180882" MODIFIED="1590059180882"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>fractions <span style="color: #cc7832"><font color="#cc7832">import </font></span>Fraction<br/>a = Fraction(<span style="color: #6897bb"><font color="#6897bb">5</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span>)<br/>b = Fraction(<span style="color: #6897bb"><font color="#6897bb">7</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">16</font></span>)<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(a + b)  <span style="color: #808080"><font color="#808080"># 27/16<br/></font></span><span style="color: #8888c6"><font color="#8888c6">print</font></span>(a * b)  <span style="color: #808080"><font color="#808080"># 35/64<br/></font></span><span style="color: #8888c6"><font color="#8888c6">print</font></span>((a*b).numerator)  <span style="color: #808080"><font color="#808080"># 35<br/></font></span><span style="color: #8888c6"><font color="#8888c6">print</font></span>((a*b).denominator)  <span style="color: #808080"><font color="#808080"># 64</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="随机选择" ID="ID_14588304" CREATED="1590059287684" MODIFIED="1590059292710">
<node TEXT="选一个" ID="ID_73296761" CREATED="1590059292852" MODIFIED="1590059306659">
<node TEXT="random.choice" ID="ID_262255461" CREATED="1590059295632" MODIFIED="1590059302551"/>
</node>
<node TEXT="选n个" ID="ID_147877229" CREATED="1590059306828" MODIFIED="1590059311960">
<node TEXT="random.sample" ID="ID_346174404" CREATED="1590059312132" MODIFIED="1590059318869"/>
</node>
<node TEXT="打乱列表" ID="ID_1529614676" CREATED="1590059320492" MODIFIED="1590059330542">
<node TEXT="ramdom.shuffle(ls)" ID="ID_1087476164" CREATED="1590059330885" MODIFIED="1590059340872"/>
</node>
<node TEXT="生成随机整数" ID="ID_513370131" CREATED="1590059362060" MODIFIED="1590059371269">
<node TEXT="random.randint(0, 10)" ID="ID_146015347" CREATED="1590059371406" MODIFIED="1590059382894"/>
</node>
</node>
<node TEXT="计算上一个周五的日期" ID="ID_1881570659" CREATED="1590116738773" MODIFIED="1590116739747">
<node ID="ID_1247208560" CREATED="1590117646798" MODIFIED="1590117646798"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>datetime <span style="color: #cc7832"><font color="#cc7832">import </font></span>datetime<span style="color: #cc7832"><font color="#cc7832">, </font></span>timedelta<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">get_previous_by_day</font></span>(nday<span style="color: #cc7832"><font color="#cc7832">, </font></span>start_date=<span style="color: #cc7832"><font color="#cc7832">None</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">if </font></span>start_date <span style="color: #cc7832"><font color="#cc7832">is None</font></span>:<br/>        start_date = datetime.today()<br/>    day_num = start_date.weekday()<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(day_num)<br/>    day_num_target = nday - <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font>days_ago = (<span style="color: #6897bb"><font color="#6897bb">7 </font></span>+ day_num - day_num_target) % <span style="color: #6897bb"><font color="#6897bb">7<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">if </font></span>days_ago == <span style="color: #6897bb"><font color="#6897bb">0</font></span>:<br/>        days_ago = <span style="color: #6897bb"><font color="#6897bb">7<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font>target_date = start_date - timedelta(<span style="color: #aa4926"><font color="#aa4926">days</font></span>=days_ago)<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>target_date<br/><br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(get_previous_by_day(<span style="color: #6897bb"><font color="#6897bb">5</font></span>))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="迭代器与生成器" FOLDED="true" POSITION="right" ID="ID_699899754" CREATED="1590117764238" MODIFIED="1590117771295">
<edge COLOR="#ff0000"/>
<node TEXT=" 实现迭代器协议" ID="ID_253518395" CREATED="1590117771638" MODIFIED="1590132256083">
<node TEXT=" 在一个对象上实现迭代最简单的方式是使用一个生成器函数" ID="ID_173608055" CREATED="1590132259961" MODIFIED="1590132629460"/>
<node TEXT=" 以深度优先方式遍历树形节点的生成器" ID="ID_522170662" CREATED="1590132632276" MODIFIED="1590132633916">
<node ID="ID_367317009" CREATED="1590132776426" MODIFIED="1590132776426"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Node:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._value = value<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._children = []<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">add_child</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>node):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>._children.append(node)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__iter__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">iter</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>._children)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">depth_first</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">yield </font></span><span style="color: #94558d"><font color="#94558d">self<br/></font></span><font color="#94558d"><span style="color: #94558d">        </span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>c <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">yield from </font></span>c.depth_first()</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="返向迭代" ID="ID_999172315" CREATED="1590132963258" MODIFIED="1590132970655">
<node TEXT="类实现 __reversed__() 方法" ID="ID_1485757842" CREATED="1590132989392" MODIFIED="1590133015873"/>
<node ID="ID_365665294" CREATED="1590133202576" MODIFIED="1590133202576"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Countdown:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>start):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.start = start<br/><br/>    <span style="color: #808080"><font color="#808080"># Forward iterator<br/></font></span><font color="#808080"><span style="color: #808080">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__iter__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        n = <span style="color: #94558d"><font color="#94558d">self</font></span>.start<br/>        <span style="color: #cc7832"><font color="#cc7832">while </font></span>n > <span style="color: #6897bb"><font color="#6897bb">0</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">yield </font></span>n<br/>            n -= <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span><span style="color: #6897bb">    </span></font><span style="color: #808080"><font color="#808080"># Reverse iterator<br/></font></span><font color="#808080"><span style="color: #808080">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__reversed__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        n = <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">        </span></font><span style="color: #cc7832"><font color="#cc7832">while </font></span>n = <span style="color: #94558d"><font color="#94558d">self</font></span>.start:<br/>            <span style="color: #cc7832"><font color="#cc7832">yield </font></span>n<br/>            n += <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>rr <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">reversed</font></span>(Countdown(<span style="color: #6897bb"><font color="#6897bb">30</font></span>)):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(rr)<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>rr <span style="color: #cc7832"><font color="#cc7832">in </font></span>Countdown(<span style="color: #6897bb"><font color="#6897bb">30</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(rr)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 迭代器切片" ID="ID_1577796090" CREATED="1590132970842" MODIFIED="1590133578111">
<node TEXT=" 迭代器和生成器不能使用标准的切片操作" ID="ID_931324793" CREATED="1590133610204" MODIFIED="1590133613612"/>
<node TEXT=" itertools.islice() 通过遍历并丢弃直到切片开始索引位置的所有元素" ID="ID_1208443009" CREATED="1590133590275" MODIFIED="1590133750117"/>
<node TEXT=" islice() 会消耗掉传入的迭代器中的数据。 必须考虑到迭代器是不可逆的这个事实" ID="ID_74202304" CREATED="1590133761946" MODIFIED="1590133764366"/>
<node ID="ID_1799472468" CREATED="1590133914160" MODIFIED="1590133914160"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>itertools<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">count</font></span>(n):<br/>    <span style="color: #cc7832"><font color="#cc7832">while True</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">yield </font></span>n<br/>        n += <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span></font>c = count(<span style="color: #6897bb"><font color="#6897bb">1</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>x <span style="color: #cc7832"><font color="#cc7832">in </font></span>itertools.islice(c<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">10</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">20</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(x)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="跳过可迭代对象的开始部分" ID="ID_309840354" CREATED="1590134245239" MODIFIED="1590134246562">
<node TEXT="明确知道丢失位置" ID="ID_116415958" CREATED="1590134250560" MODIFIED="1590134269660">
<node TEXT="迭代器切片 itertools.islice" ID="ID_1797839297" CREATED="1590134270167" MODIFIED="1590134288056"/>
</node>
<node TEXT=" itertools.dropwhile()" ID="ID_322933199" CREATED="1590134289239" MODIFIED="1590134366280">
<node TEXT=" 返回一个迭代器对象，丢弃原有序列中直到函数返回Flase之前的所有元素，然后返回后面所有元素" ID="ID_1025451429" CREATED="1590134389774" MODIFIED="1590134392351"/>
<node ID="ID_903536656" CREATED="1590134907504" MODIFIED="1590134907504"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>itertools <span style="color: #cc7832"><font color="#cc7832">import </font></span>dropwhile<br/><span style="color: #cc7832"><font color="#cc7832">with </font></span><span style="color: #8888c6"><font color="#8888c6">open</font></span>(<span style="color: #6a8759"><font color="#6a8759">'/etc/passwd'</font></span>) <span style="color: #cc7832"><font color="#cc7832">as </font></span>f:<br/>    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">跳过开始部分的注释行<br/></font></span><font color="#808080" face="Arial"><span style="color: #808080; font-family: Arial">    </span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>line <span style="color: #cc7832"><font color="#cc7832">in </font></span>dropwhile(<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>line: <span style="color: #cc7832"><font color="#cc7832">not </font></span>line.startswith(<span style="color: #6a8759"><font color="#6a8759">'#'</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>f):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(line<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">end</font></span>=<span style="color: #6a8759"><font color="#6a8759">''</font></span>)<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="排列组合" ID="ID_1115470673" CREATED="1590135928659" MODIFIED="1590135932269">
<node TEXT=" &quot;组合&quot;  不会讲究物件的次序" ID="ID_1199086959" CREATED="1590135932627" MODIFIED="1590135946261"/>
<node TEXT=" 次序重要就叫排列，排列是有序的组合" ID="ID_246789820" CREATED="1590135964107" MODIFIED="1590135976628"/>
<node TEXT=" 排列" ID="ID_1950875507" CREATED="1590136025170" MODIFIED="1590136026316">
<node TEXT="类型" ID="ID_185717005" CREATED="1590136117026" MODIFIED="1590136119763">
<node TEXT=" 可重复" ID="ID_393512045" CREATED="1590136029355" MODIFIED="1590136035011">
<node TEXT="元素可重复出现，位置不同" ID="ID_970091299" CREATED="1590136040650" MODIFIED="1590136074460"/>
</node>
<node TEXT=" 不可重复" ID="ID_179598542" CREATED="1590136035658" MODIFIED="1590136036379">
<node TEXT="元素不可重复出现，一元素占一个位置" ID="ID_1681768683" CREATED="1590136084898" MODIFIED="1590136109507"/>
</node>
</node>
<node TEXT="计算" ID="ID_902222792" CREATED="1590136123010" MODIFIED="1590136125971">
<node TEXT=" i个元素n个位置" ID="ID_34961582" CREATED="1590136211240" MODIFIED="1590136213188"/>
<node TEXT=" 重复排列" ID="ID_1134707179" CREATED="1590136127747" MODIFIED="1590136130034">
<node TEXT=" i^n" ID="ID_1341346768" CREATED="1590136149994" MODIFIED="1590136210314"/>
</node>
<node TEXT="不可重复排列" ID="ID_1005711805" CREATED="1590136189922" MODIFIED="1590136199235">
<node TEXT="i! / (i − n)!" ID="ID_691917150" CREATED="1590136199481" MODIFIED="1590136286954"/>
</node>
</node>
</node>
<node TEXT="组合" ID="ID_163113183" CREATED="1590136354663" MODIFIED="1590136359442">
<node TEXT="类型" ID="ID_1889837110" CREATED="1590137152875" MODIFIED="1590137154652">
<node TEXT=" 可重复" ID="ID_1633267691" CREATED="1590137133363" MODIFIED="1590137134565">
<node TEXT=" 口袋里的硬币 (5,5,5,10,10)" ID="ID_159464467" CREATED="1590137144419" MODIFIED="1590137145812"/>
</node>
<node TEXT=" 不可重复" ID="ID_1113661235" CREATED="1590137138795" MODIFIED="1590137139676">
<node TEXT=" 彩票号码 (2,14,15,27,30,33)" ID="ID_1958818803" CREATED="1590137150556" MODIFIED="1590137151661"/>
</node>
</node>
<node TEXT=" 计算" ID="ID_437594731" CREATED="1590137158131" MODIFIED="1590137187133">
<node TEXT=" 重复组合" ID="ID_1255422385" CREATED="1590138005869" MODIFIED="1590138009423">
<node TEXT="(n + i - 1)! / (n! * (i -1)!)" ID="ID_277310389" CREATED="1590138163270" MODIFIED="1590138196982"/>
</node>
<node TEXT=" 不重复组合" ID="ID_1799209046" CREATED="1590138010334" MODIFIED="1590138026391">
<node TEXT="i! / (n! * (i - n)!)" ID="ID_1467986064" CREATED="1590138055989" MODIFIED="1590138093575"/>
</node>
</node>
</node>
</node>
<node TEXT="可迭代对象的排列组合" ID="ID_1072316226" CREATED="1590135624613" MODIFIED="1590135637095">
<node TEXT=" 所有元素排列" ID="ID_911964099" CREATED="1590135804549" MODIFIED="1590135813712">
<node ID="ID_1646567919" CREATED="1590135649418" MODIFIED="1590135649418"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>itertools <span style="color: #cc7832"><font color="#cc7832">import </font></span>permutations<br/>items = [<span style="color: #6a8759"><font color="#6a8759">'a'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'b'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'c'</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>p <span style="color: #cc7832"><font color="#cc7832">in </font></span>permutations(items):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(p)<br/><br/><span style="color: #808080"><font color="#808080"># ('a', 'b', 'c')<br/></font></span><font color="#808080"><span style="color: #808080"># ('a', 'c', 'b')<br/></span><span style="color: #808080"># ('b', 'a', 'c')<br/></span><span style="color: #808080"># ('b', 'c', 'a')<br/></span><span style="color: #808080"># ('c', 'a', 'b')<br/></span><span style="color: #808080"># ('c', 'b', 'a')</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="指定元素个数排列" ID="ID_1538703705" CREATED="1590135814324" MODIFIED="1590135830848">
<node TEXT=" permutations(items, 2)" ID="ID_1593943024" CREATED="1590135841053" MODIFIED="1590135842973"/>
</node>
<node TEXT="组合，顺序不重要" ID="ID_1850332275" CREATED="1590138317973" MODIFIED="1590144239425">
<node TEXT=" itertools.combinations()" ID="ID_1505472114" CREATED="1590138329709" MODIFIED="1590138330589"/>
<node ID="ID_548233169" CREATED="1590138830007" MODIFIED="1590138830007"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>itertools <span style="color: #cc7832"><font color="#cc7832">import </font></span>combinations<br/><br/>items = [<span style="color: #6a8759"><font color="#6a8759">'a'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'b'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'c'</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>i <span style="color: #cc7832"><font color="#cc7832">in </font></span>combinations(items<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">3</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(i)<br/><span style="color: #808080"><font color="#808080"># ('a', 'b', 'c')<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>j <span style="color: #cc7832"><font color="#cc7832">in </font></span>combinations(items<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(j)<br/><span style="color: #808080"><font color="#808080"># ('a', 'b')<br/></font></span><font color="#808080"><span style="color: #808080"># ('a', 'c')<br/></span><span style="color: #808080"># ('b', 'c')<br/></span><span style="color: #808080"><br/></span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>k <span style="color: #cc7832"><font color="#cc7832">in </font></span>combinations(items<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">1</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(k)<br/><span style="color: #808080"><font color="#808080"># ('a',)<br/></font></span><font color="#808080"><span style="color: #808080"># ('b',)<br/></span><span style="color: #808080"># ('c',)</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="可重复元素组合" ID="ID_591842634" CREATED="1590144260094" MODIFIED="1590144273334">
<node TEXT=" itertools.combinations_with_replacement()" ID="ID_109008688" CREATED="1590144280494" MODIFIED="1590144281465"/>
</node>
</node>
<node TEXT="同时迭代多个序列" ID="ID_1359675301" CREATED="1590144386588" MODIFIED="1590144443254">
<node TEXT=" 为了同时迭代多个序列，使用 zip() 函数" ID="ID_1931383617" CREATED="1590144450637" MODIFIED="1590144451862"/>
<node ID="ID_771973272" CREATED="1590144520854" MODIFIED="1590144520854"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">xpts = [<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">5</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">10</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">7</font></span>]<br/>ypts = [<span style="color: #6897bb"><font color="#6897bb">101</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">78</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">37</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">15</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">62</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">99</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">zip</font></span>(xpts<span style="color: #cc7832"><font color="#cc7832">, </font></span>ypts):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 展开嵌套的序列" ID="ID_679891651" CREATED="1590157524280" MODIFIED="1590157526043">
<node TEXT=" 将一个多层嵌套的序列展开成一个单层列表" ID="ID_1712909561" CREATED="1590157529655" MODIFIED="1590157530537"/>
<node TEXT="yield from 在生成器中调用其他生成器作为子例程的时候非常有用，如果你不使用它的话，那么就必须写额外的 for 循环了" ID="ID_468817678" CREATED="1590157794875" MODIFIED="1590157815590"/>
<node ID="ID_509691914" CREATED="1590157855751" MODIFIED="1590157855751"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>collections.abc <span style="color: #cc7832"><font color="#cc7832">import </font></span>Iterable<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">flatten</font></span>(items<span style="color: #cc7832"><font color="#cc7832">, </font></span>ignore_types=(<span style="color: #8888c6"><font color="#8888c6">str</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">bytes</font></span>)):<br/>    <span style="color: #cc7832"><font color="#cc7832">for </font></span>x <span style="color: #cc7832"><font color="#cc7832">in </font></span>items:<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>Iterable) <span style="color: #cc7832"><font color="#cc7832">and not </font></span><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>ignore_types):<br/>            <span style="color: #cc7832"><font color="#cc7832">yield from </font></span>flatten(x)<br/>            <span style="color: #808080"><font color="#808080"># for i in flatten(x):<br/></font></span><font color="#808080"><span style="color: #808080">            #     yield i<br/></span><span style="color: #808080">        </span></font><span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">yield </font></span>x<br/><br/>items = [<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>[<span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>[<span style="color: #6897bb"><font color="#6897bb">5</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">6</font></span>]<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">7</font></span>]<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">8</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>x <span style="color: #cc7832"><font color="#cc7832">in </font></span>flatten(items):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(x)<br/><span style="color: #808080"><font color="#808080"># 1 2 3 4 5 6 7 8</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 顺序迭代合并后的排序迭代对象" ID="ID_664409589" CREATED="1590157873024" MODIFIED="1590157874178">
<node TEXT=" heapq.merge" ID="ID_707526023" CREATED="1590157965991" MODIFIED="1590157990473">
<node TEXT=" 可迭代特性意味着它不会立马读取所有序列" ID="ID_479978834" CREATED="1590157992479" MODIFIED="1590157993857"/>
<node TEXT=" 可以在非常长的序列中使用它，而不会有太大的开销" ID="ID_716812299" CREATED="1590157981095" MODIFIED="1590157982281"/>
<node TEXT=" heapq.merge() 需要所有输入序列必须是排过序的" ID="ID_284492880" CREATED="1590158024543" MODIFIED="1590158025608"/>
<node TEXT=" 它并不会预先读取所有数据到堆栈中或者预先排序，也不会对输入做任何的排序检测" ID="ID_1221796912" CREATED="1590158050454" MODIFIED="1590158051663"/>
</node>
<node ID="ID_112256825" CREATED="1590157956963" MODIFIED="1590157956963"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>heapq<br/>a = [<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">10</font></span>]<br/>b = [<span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">5</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">6</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">9</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">11</font></span>]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>c <span style="color: #cc7832"><font color="#cc7832">in </font></span>heapq.merge(a<span style="color: #cc7832"><font color="#cc7832">, </font></span>b):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(c)<br/><span style="color: #808080"><font color="#808080"># 1 2 4 5 6 9 10 11</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 迭代器代替while无限循环" ID="ID_486610451" CREATED="1590158096199" MODIFIED="1590158097167">
<node TEXT=" 常见的IO操作程序" ID="ID_1999037377" CREATED="1590158145989" MODIFIED="1590158146919">
<node ID="ID_1090095283" CREATED="1590158160643" MODIFIED="1590158160643"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">CHUNKSIZE = <span style="color: #6897bb"><font color="#6897bb">8192<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">reader</font></span>(s):<br/>    <span style="color: #cc7832"><font color="#cc7832">while True</font></span>:<br/>        data = s.recv(CHUNKSIZE)<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>data == <span style="color: #a5c261"><font color="#a5c261">b''</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">break<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font>process_data(data)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" iter() 来代替while True" ID="ID_534340062" CREATED="1590158186453" MODIFIED="1590158198575">
<node TEXT=" iter 函数一个鲜为人知的特性是它接受一个可选的 callable 对象和一个标记(结尾)值作为输入参数" ID="ID_1690902003" CREATED="1590158242068" MODIFIED="1590158243630"/>
<node TEXT=" 创建一个迭代器， 这个迭代器会不断调用 callable 对象直到返回值和标记值相等为止" ID="ID_1013201685" CREATED="1590158260236" MODIFIED="1590158261525"/>
<node ID="ID_337805607" CREATED="1590158744916" MODIFIED="1590158744916"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">CHUNKSIZE = <span style="color: #6897bb"><font color="#6897bb">8192<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">reader2</font></span>(s):<br/>    <span style="color: #cc7832"><font color="#cc7832">for </font></span><span style="color: #72737a"><font color="#72737a">chunk </font></span><span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">iter</font></span>(<span style="color: #cc7832"><font color="#cc7832">lambda</font></span>: s.recv(CHUNKSIZE)<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">sentinel</font></span>=<span style="color: #a5c261"><font color="#a5c261">b''</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font><span style="color: #808080"><font color="#808080"># process_data(data)</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="文本与IO" FOLDED="true" POSITION="right" ID="ID_766774027" CREATED="1590408344639" MODIFIED="1590408353965">
<edge COLOR="#0000ff"/>
<node TEXT="获取系统编码" ID="ID_500128278" CREATED="1590408366995" MODIFIED="1590408402972">
<node ID="ID_507626864" CREATED="1590408370452" MODIFIED="1590408370452"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>sys<br/><span style="color: #cc7832"><font color="#cc7832">print </font></span>sys.getdefaultencoding()<br/><span style="color: #808080"><font color="#808080"># ascii</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="序列化python对象" ID="ID_1344153286" CREATED="1590408354490" MODIFIED="1590409304886">
<node TEXT=" pickle 模块" ID="ID_359247771" CREATED="1590409317900" MODIFIED="1590409318925">
<node ID="ID_97800933" CREATED="1590409617852" MODIFIED="1590409617852"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      千万不要对不信任的数据使用pickle.load()。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1751603960" CREATED="1590409617852" MODIFIED="1590409617852"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      pickle在加载时有一个副作用就是它会自动加载相应模块并构造实例对象
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1986619707" CREATED="1590409498623" MODIFIED="1590409498623"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>pickle<br/>data = {<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span>}<br/><span style="color: #808080"><font color="#808080">#  </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">将一个对象转储为一个字符串<br/></font></span>b = pickle.dumps(data)<br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">从字节流中恢复一个对象<br/></font></span>d = pickle.loads(b)<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="函数" FOLDED="true" POSITION="right" ID="ID_447855974" CREATED="1590409990049" MODIFIED="1590409992480">
<edge COLOR="#00ff00"/>
<node TEXT=" 参数强制使用关键字参数传递" FOLDED="true" ID="ID_1606066911" CREATED="1590410156488" MODIFIED="1590410157209">
<node TEXT=" 放在 单个*参数 或 某个*参数 后面" ID="ID_1113053918" CREATED="1590410194198" MODIFIED="1590498332671"/>
<node TEXT=" def minimum(*values, clip=None):" ID="ID_508994347" CREATED="1590410256414" MODIFIED="1590410258223"/>
<node TEXT=" def recv(maxsize, *, block):" ID="ID_1799457607" CREATED="1590410229055" MODIFIED="1590410230207"/>
</node>
<node TEXT=" 函数参数注解" FOLDED="true" ID="ID_1607789635" CREATED="1590494404232" MODIFIED="1590494407164">
<node TEXT=" 通常使用类或者字符串给函数添加注解" ID="ID_1547848760" CREATED="1590494798621" MODIFIED="1590494810775"/>
<node TEXT=" def add(x:int, y:int) -&gt; int" ID="ID_672425395" CREATED="1590494415740" MODIFIED="1590494416934"/>
<node TEXT=" 只存储在函数的 __annotations__ 属性" ID="ID_1618271589" CREATED="1590494824341" MODIFIED="1590494825758"/>
<node TEXT="调用help(add)可查看" ID="ID_1580726152" CREATED="1590494538183" MODIFIED="1590494838616"/>
</node>
<node TEXT=" 返回多个值的函数" FOLDED="true" ID="ID_734436785" CREATED="1590494865221" MODIFIED="1590494868322">
<node TEXT=" 函数直接return一个元组" ID="ID_1428205291" CREATED="1590494889725" MODIFIED="1590494891550"/>
<node ID="ID_1898892903" CREATED="1590495033661" MODIFIED="1590495033661"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">f</font></span>():<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">3<br/></font></span>a<span style="color: #cc7832"><font color="#cc7832">, </font></span>b<span style="color: #cc7832"><font color="#cc7832">, </font></span>c = f()<br/>d = f()</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" f()看上去返回了多个值，实际上是先创建了一个元组然后返回的" ID="ID_569816755" CREATED="1590495054629" MODIFIED="1590495058355"/>
</node>
<node TEXT="定义有默认参数的函数" FOLDED="true" ID="ID_1465327864" CREATED="1590495089788" MODIFIED="1590495090726">
<node TEXT=" 默认参数的值仅仅在函数定义的时候赋值一次" ID="ID_735606801" CREATED="1590495140741" MODIFIED="1590495141646"/>
<node TEXT=" 默认参数的值应该是不可变的对象" ID="ID_1876089844" CREATED="1590495152308" MODIFIED="1590495153446"/>
<node TEXT=" 否则，当默认值在其他地方被修改后将会遇到各种麻烦" ID="ID_1487069559" CREATED="1590495348468" MODIFIED="1590495365003"/>
</node>
<node TEXT=" 匿名函数捕获变量值" ID="ID_1168191194" CREATED="1590495602229" MODIFIED="1590495603191">
<node TEXT="运行时绑定值" ID="ID_982882886" CREATED="1590495826917" MODIFIED="1590495852847">
<node ID="ID_6070648" CREATED="1590495696650" MODIFIED="1590495696650"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">x = <span style="color: #6897bb"><font color="#6897bb">10<br/></font></span>a = <span style="color: #cc7832"><font color="#cc7832">lambda </font></span>y: x + y<br/>x = <span style="color: #6897bb"><font color="#6897bb">20<br/></font></span>b = <span style="color: #cc7832"><font color="#cc7832">lambda </font></span>y: x + y<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(a(<span style="color: #6897bb"><font color="#6897bb">10</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>b(<span style="color: #6897bb"><font color="#6897bb">10</font></span>))<br/><span style="color: #808080"><font color="#808080"># 30 30</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" lambda表达式中的x是一个自由变量， 在运行时绑定值，而不是定义时就绑定，这跟函数的默认值参数定义是不同的" ID="ID_537819944" CREATED="1590495715308" MODIFIED="1590495724288"/>
</node>
<node TEXT="定义时绑定值" ID="ID_948680574" CREATED="1590495838341" MODIFIED="1590495848183">
<node ID="ID_655211486" CREATED="1590495812661" MODIFIED="1590495812661"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">x = <span style="color: #6897bb"><font color="#6897bb">10<br/></font></span>a = <span style="color: #cc7832"><font color="#cc7832">lambda </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>x=x: x + y<br/>x = <span style="color: #6897bb"><font color="#6897bb">20<br/></font></span>b = <span style="color: #cc7832"><font color="#cc7832">lambda </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>x=x: x + y<br/><span style="color: #cc7832"><font color="#cc7832">print </font></span>a(<span style="color: #6897bb"><font color="#6897bb">10</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span>b(<span style="color: #6897bb"><font color="#6897bb">10</font></span>)<br/><span style="color: #808080"><font color="#808080"># 20 30</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 想让某个匿名函数在定义时就捕获到值，可以将那个参数值定义成默认参数即可" ID="ID_259193343" CREATED="1590495750101" MODIFIED="1590495751758"/>
</node>
<node TEXT=" 在一个循环或列表推导中创建一个lambda表达式列表" ID="ID_1037196012" CREATED="1590495945159" MODIFIED="1590495968278">
<node ID="ID_875353933" CREATED="1590496088994" MODIFIED="1590496088994"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">funcs = [<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>x<span style="color: #cc7832"><font color="#cc7832">, </font></span>n=n: x+n <span style="color: #cc7832"><font color="#cc7832">for </font></span>n <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">range</font></span>(<span style="color: #6897bb"><font color="#6897bb">5</font></span>)]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>f <span style="color: #cc7832"><font color="#cc7832">in </font></span>funcs:<br/>    <span style="color: #cc7832"><font color="#cc7832">print</font></span>(f(<span style="color: #6897bb"><font color="#6897bb">0</font></span>))<br/><span style="color: #808080"><font color="#808080"># 0 1 2 3 4</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1096193532" CREATED="1590496105531" MODIFIED="1590496105531"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt">funcs = [<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>x: x+n <span style="color: #cc7832"><font color="#cc7832">for </font></span>n <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">range</font></span>(<span style="color: #6897bb"><font color="#6897bb">5</font></span>)]<br/><span style="color: #cc7832"><font color="#cc7832">for </font></span>f <span style="color: #cc7832"><font color="#cc7832">in </font></span>funcs:<br/>    <span style="color: #cc7832"><font color="#cc7832">print</font></span>(f(<span style="color: #6897bb"><font color="#6897bb">0</font></span>))<br/><span style="color: #808080"><font color="#808080"># 4 4 4 4 4</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 将单方法的类转换为函数" ID="ID_1467066817" CREATED="1590496542015" MODIFIED="1590496543129">
<node TEXT="用闭包简化一个除 __init__() 方法外的单方法类" ID="ID_631444054" CREATED="1590496556344" MODIFIED="1590496637307"/>
<node TEXT=" 闭包关键特点就是它会记住自己被定义时的环境" ID="ID_1634187016" CREATED="1590496664856" MODIFIED="1590496665890"/>
<node TEXT=" 需要给某个函数增加额外的状态信息的问题，都可以考虑使用闭包" ID="ID_13175775" CREATED="1590496694208" MODIFIED="1590496697153"/>
<node TEXT=" 相对函数转换成一个类，闭包通常是一种更加简洁和优雅的方案" ID="ID_1602230208" CREATED="1590496708217" MODIFIED="1590496738069"/>
<node ID="ID_152156706" CREATED="1590496794770" MODIFIED="1590496798653"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><font color="#cc7832">def </font><font color="#ffc66d">urltemplate</font>(template):<br/>    <font color="#cc7832">def </font><font color="#ffc66d">opener</font>(**kwargs):<br/>        <font color="#cc7832">return </font>urlopen(template.format_map(kwargs))<br/>    <font color="#cc7832">return </font>opener<br/><br/><font color="#808080"># Example use<br/></font>yahoo = urltemplate(<font color="#a5c261">'http://finance.yahoo.com/d/quotes.csv?s={names}&f={fields}'</font>)<br/><font color="#cc7832">for </font>line <font color="#cc7832">in </font>yahoo(<font color="#aa4926">names</font>=<font color="#a5c261">'IBM,AAPL,FB'</font><font color="#cc7832">, </font><font color="#aa4926">fields</font>=<font color="#a5c261">'sl1c1v'</font>):<br/>    <font color="#cc7832">print</font>(line.decode(<font color="#a5c261">'utf-8'</font>))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="类与对象" FOLDED="true" POSITION="right" ID="ID_1764084987" CREATED="1590498927227" MODIFIED="1590498928605">
<edge COLOR="#ff00ff"/>
<node TEXT=" 创建大量对象时节省内存方法" FOLDED="true" ID="ID_1309007028" CREATED="1590499341650" MODIFIED="1590499342684">
<node TEXT=" 给类添加 __slots__ 属性来极大的减少实例所占的内存" ID="ID_1407017296" CREATED="1590499350409" MODIFIED="1590499351758"/>
<node TEXT="定义 __slots__ 后，实例通过一个很小的固定大小的数组来构建，而不是为每个实例定义一个字典" ID="ID_1169652322" CREATED="1590499370554" MODIFIED="1590499388900"/>
<node TEXT=" 使用slots一个不好的地方就是我们不能再给实例添加新的属性了，只能使用在 __slots__ 中定义的那些属性名" ID="ID_1286442916" CREATED="1590499520657" MODIFIED="1590499522035"/>
</node>
<node TEXT=" 利用Mixins扩展类功能" FOLDED="true" ID="ID_317325649" CREATED="1590666299376" MODIFIED="1590666300649">
<node TEXT="只允许设置一次key" ID="ID_464864273" CREATED="1592999126315" MODIFIED="1592999140946">
<node ID="ID_653313453" CREATED="1590667136819" MODIFIED="1590667136819"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>SetOnceMappingMixin:<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">只允许设置一次</font></span><span style="color: #629755; font-style: italic"><font color="#629755"> key"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #b200b2"><font color="#b200b2">__slots__ </font></span>= ()<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__setitem__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>key <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">raise </font></span><span style="color: #8888c6"><font color="#8888c6">KeyError</font></span>(<span style="color: #8888c6"><font color="#8888c6">str</font></span>(key) + <span style="color: #6a8759"><font color="#6a8759">' already set'</font></span>)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__setitem__</font></span>(key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/><br/><span style="color: #cc7832"><font color="#cc7832">from </font></span>collections <span style="color: #cc7832"><font color="#cc7832">import </font></span>defaultdict<br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>SetOnceDefaultDict(SetOnceMappingMixin<span style="color: #cc7832"><font color="#cc7832">, </font></span>defaultdict):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span></font>d = SetOnceDefaultDict(<span style="color: #8888c6"><font color="#8888c6">list</font></span>)<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(d[<span style="color: #6a8759"><font color="#6a8759">'a'</font></span>])  <span style="color: #808080"><font color="#808080"># []<br/></font></span>d[<span style="color: #6a8759"><font color="#6a8759">'x'</font></span>].append(<span style="color: #6897bb"><font color="#6897bb">2</font></span>)<br/>d[<span style="color: #6a8759"><font color="#6a8759">'x'</font></span>] = <span style="color: #6897bb"><font color="#6897bb">23  </font></span><span style="color: #808080"><font color="#808080"># KeyError: 'x already set'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 添加日志" ID="ID_237089764" CREATED="1590667331299" MODIFIED="1590667332821">
<node TEXT="Mixins" ID="ID_1033725931" CREATED="1590667336731" MODIFIED="1590667347694">
<node ID="ID_711279953" CREATED="1590667446573" MODIFIED="1590667446573"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>LoggedMappingMixin:<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">添加日志记录以获取</font></span><span style="color: #629755; font-style: italic"><font color="#629755">/</font></span><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">设置</font></span><span style="color: #629755; font-style: italic"><font color="#629755">/</font></span><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">删除操作以进行调试。</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">混入类都没有实例变量，因为直接实例化混入类没有任何意义<br/></font></span><font color="#808080" face="Arial"><span style="color: #808080; font-family: Arial">    </span></font><span style="color: #b200b2"><font color="#b200b2">__slots__ </font></span>= ()<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__getitem__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>key):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Getting ' </font></span>+ <span style="color: #8888c6"><font color="#8888c6">str</font></span>(key))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__getitem__</font></span>(key)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__setitem__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Setting {} = {!r}'</font></span>.format(key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__setitem__</font></span>(key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__delitem__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>key):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Deleting ' </font></span>+ <span style="color: #8888c6"><font color="#8888c6">str</font></span>(key))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__delitem__</font></span>(key)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>LoggedDict(LoggedMappingMixin<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">dict</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span></font>d = LoggedDict()<br/>d[<span style="color: #6a8759"><font color="#6a8759">'x'</font></span>] = <span style="color: #6897bb"><font color="#6897bb">23</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="类装饰器混入类" ID="ID_691117561" CREATED="1590667225204" MODIFIED="1590667252658">
<node TEXT=" 不再需要使用多重继承" ID="ID_1926961182" CREATED="1590667252939" MODIFIED="1590667275662"/>
<node ID="ID_279813821" CREATED="1590667471420" MODIFIED="1590667471420"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">LoggedMapping</font></span>(cls):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">第二种方式：使用类装饰器</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i>cls_getitem = cls.<span style="color: #b200b2"><font color="#b200b2">__getitem__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">    </span></font>cls_setitem = cls.<span style="color: #b200b2"><font color="#b200b2">__setitem__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">    </span></font>cls_delitem = cls.<span style="color: #b200b2"><font color="#b200b2">__delitem__<br/></font></span><font color="#b200b2"><span style="color: #b200b2"><br/></span><span style="color: #b200b2">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__getitem__</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Getting ' </font></span>+ <span style="color: #8888c6"><font color="#8888c6">str</font></span>(key))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>cls_getitem(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__setitem__</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Setting {} = {!r}'</font></span>.format(key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>cls_setitem(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__delitem__</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Deleting ' </font></span>+ <span style="color: #8888c6"><font color="#8888c6">str</font></span>(key))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>cls_delitem(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key)<br/><br/>    cls.<span style="color: #b200b2"><font color="#b200b2">__getitem__ </font></span>= __getitem__<br/>    cls.<span style="color: #b200b2"><font color="#b200b2">__setitem__ </font></span>= __setitem__<br/>    cls.<span style="color: #b200b2"><font color="#b200b2">__delitem__ </font></span>= __delitem__<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>cls<br/><br/><br/><span style="color: #bbb529"><font color="#bbb529">@LoggedMapping<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>LoggedDict(<span style="color: #8888c6"><font color="#8888c6">dict</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT=" 实现访问者模式" ID="ID_1503742833" CREATED="1590668315008" MODIFIED="1590668330776"/>
</node>
<node TEXT="元编程" POSITION="right" ID="ID_802104211" CREATED="1590669371588" MODIFIED="1590669381990">
<edge COLOR="#00ffff"/>
<node TEXT="装饰器保留原始函数的元信息" FOLDED="true" ID="ID_148598394" CREATED="1590669592219" MODIFIED="1590670044986">
<node TEXT="所谓元信息" ID="ID_165176172" CREATED="1590670114033" MODIFIED="1590670121889">
<node TEXT=" .__name__" ID="ID_1977628575" CREATED="1590670125663" MODIFIED="1590670129457"/>
<node TEXT=" .__doc__" ID="ID_1341494064" CREATED="1590670129976" MODIFIED="1590670133744"/>
<node TEXT=" .__annotations__" ID="ID_779604761" CREATED="1590670137020" MODIFIED="1590670137953"/>
</node>
<node TEXT=" 使用 @wraps(func) 注解" ID="ID_1447203094" CREATED="1590669707626" MODIFIED="1590669708884"/>
<node TEXT=" @wraps的__wrapped__ 属性" ID="ID_628722742" CREATED="1590670177080" MODIFIED="1590670190736">
<node TEXT=" 解除一个装饰器" ID="ID_1317296314" CREATED="1592378940724" MODIFIED="1592378942301">
<node TEXT=" 直接访问被包装函数" ID="ID_131396214" CREATED="1590670201519" MODIFIED="1590670202512"/>
<node ID="ID_1413707623" CREATED="1590670314512" MODIFIED="1590670314512"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@somedecorator<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">add</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y):<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>x + y<br/><br/>orig_add = add.__wrapped__</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="暴露被包装函数签名" ID="ID_1772590225" CREATED="1590670346735" MODIFIED="1590670382872">
<node ID="ID_147896546" CREATED="1590670329509" MODIFIED="1590670329509"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>inspect <span style="color: #cc7832"><font color="#cc7832">import </font></span>signature<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(signature(countdown))</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 如果有多个包装器，那么访问 __wrapped__ 属性的行为是不可预知的，应该避免这样做" ID="ID_450659652" CREATED="1590670407206" MODIFIED="1590670408911"/>
<node TEXT=" 并不是所有的装饰器都使用了 @wraps，@staticmethod 和 @classmethod 把原始函数存储在属性 __func__ 中" ID="ID_1867579041" CREATED="1592378825076" MODIFIED="1592378847198"/>
</node>
</node>
<node TEXT="定义一个带参数的装饰器" FOLDED="true" ID="ID_1797902022" CREATED="1590670261230" MODIFIED="1590670465231">
<node TEXT="无参数装饰器 - 两层函数" ID="ID_471395568" CREATED="1590670884004" MODIFIED="1592379408922">
<node ID="ID_767405664" CREATED="1590671036839" MODIFIED="1590671036839"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@decorator<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(<span style="color: #72737a"><font color="#72737a">a</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">b</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">等同下面<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(<span style="color: #72737a"><font color="#72737a">a</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">b</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span>func = decorator(func)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 带参数装饰器 - 三层函数" ID="ID_1539001285" CREATED="1590670966452" MODIFIED="1592379411650">
<node TEXT="x,y,z参数定制返回的函数，用于包装func" ID="ID_1920203680" CREATED="1590671056588" MODIFIED="1590671087636"/>
<node ID="ID_1273447964" CREATED="1590671014020" MODIFIED="1590671014020"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@decorator</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>z)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(<span style="color: #72737a"><font color="#72737a">a</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">b</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">等同下面<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(<span style="color: #72737a"><font color="#72737a">a</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">b</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span>func = decorator(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>z)(func)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node ID="ID_369909154" CREATED="1590670828708" MODIFIED="1590670828708"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>functools <span style="color: #cc7832"><font color="#cc7832">import </font></span>wraps<br/><span style="color: #cc7832"><font color="#cc7832">import </font></span>logging<br/><br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">logged</font></span>(level<span style="color: #cc7832"><font color="#cc7832">, </font></span>name=<span style="color: #cc7832"><font color="#cc7832">None, </font></span>message=<span style="color: #cc7832"><font color="#cc7832">None</font></span>):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">向函数添加日志记录</font></span><span style="color: #629755; font-style: italic"><font color="#629755">, </font></span><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">自定级别</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">decorate</font></span>(func):<br/>        logname = name <span style="color: #cc7832"><font color="#cc7832">if </font></span>name <span style="color: #cc7832"><font color="#cc7832">else </font></span>func.<span style="color: #b200b2"><font color="#b200b2">__module__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">        </span></font>log = logging.getLogger(logname)<br/>        logmsg = message <span style="color: #cc7832"><font color="#cc7832">if </font></span>message <span style="color: #cc7832"><font color="#cc7832">else </font></span>func.<span style="color: #b200b2"><font color="#b200b2">__name__<br/></font></span><font color="#b200b2"><span style="color: #b200b2"><br/></span><span style="color: #b200b2">        </span></font><span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>        <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>            log.log(level<span style="color: #cc7832"><font color="#cc7832">, </font></span>logmsg)<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span>func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>decorate<br/><br/><span style="color: #808080"><font color="#808080"># Example use<br/></font></span><span style="color: #bbb529"><font color="#bbb529">@logged</font></span>(logging.DEBUG)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">add</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y):<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>x + y<br/><br/><span style="color: #bbb529"><font color="#bbb529">@logged</font></span>(logging.CRITICAL<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'example'</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">spam</font></span>():<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Spam!'</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 最外层的函数 logged() 接受参数并将它们作用在内部的装饰器函数上面" ID="ID_1139827232" CREATED="1590670843068" MODIFIED="1590670844246"/>
<node TEXT=" 内层的函数 decorate() 接受一个函数作为参数，然后在函数上面放置一个包装器" ID="ID_1936688748" CREATED="1590670854068" MODIFIED="1590670864670"/>
<node TEXT=" 这里的关键点是包装器是可以使用传递给 logged() 的参数的" ID="ID_1896047480" CREATED="1590670865284" MODIFIED="1590670866320"/>
</node>
<node TEXT=" 可自定义属性的装饰器" FOLDED="true" ID="ID_1353892343" CREATED="1591105271929" MODIFIED="1591105273038">
<node TEXT="给被装饰的函数附加属性" ID="ID_1117695791" CREATED="1592380517031" MODIFIED="1592380540553">
<node TEXT="用于附加属性的装饰器" ID="ID_458478548" CREATED="1592379844896" MODIFIED="1592380624264">
<node ID="ID_1035013916" CREATED="1592379978030" MODIFIED="1592380777508"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>functools <span style="color: #cc7832"><font color="#cc7832">import </font></span>partial<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">attach_wrapper</font></span>(obj<span style="color: #cc7832"><font color="#cc7832">, </font></span>func=<span style="color: #cc7832"><font color="#cc7832">None</font></span>):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: 宋体,monospace"><font color="#629755" face="宋体,monospace">将函数附加为</font></span><span style="color: #629755; font-style: italic"><font color="#629755">obj</font></span><span style="color: #629755; font-style: italic; font-family: 宋体,monospace"><font color="#629755" face="宋体,monospace">的属性</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #cc7832"><font color="#cc7832">if </font></span>func <span style="color: #cc7832"><font color="#cc7832">is None</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>partial(attach_wrapper<span style="color: #cc7832"><font color="#cc7832">, </font></span>obj)<br/>    <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(obj<span style="color: #cc7832"><font color="#cc7832">, </font></span>func.<span style="color: #b200b2"><font color="#b200b2">__name__</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>func)<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>func<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="被附加属性的装饰器" ID="ID_238880414" CREATED="1592380609160" MODIFIED="1592380650730">
<node ID="ID_1117003146" CREATED="1592380817182" MODIFIED="1592380817182"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">decorator</font></span>(func):<br/>    <span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">_wrap</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/><br/>    <span style="color: #bbb529"><font color="#bbb529">@attach_wrapper</font></span>(_wrap)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">f1</font></span>():<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"@f1"</font></span>)<br/><br/>    <span style="color: #bbb529"><font color="#bbb529">@attach_wrapper</font></span>(_wrap)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">f2</font></span>():<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"@f2"</font></span>)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>_wrap<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="被符加属性的函数" ID="ID_541548336" CREATED="1592380636552" MODIFIED="1592380647234">
<node ID="ID_147177929" CREATED="1592380669660" MODIFIED="1592380669660"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@decorator<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">f</font></span>():<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"@f"</font></span>)<br/><br/>f()  <span style="color: #808080"><font color="#808080"># @f<br/></font></span>f.f1()  <span style="color: #808080"><font color="#808080"># @f1<br/></font></span>f.f2()  <span style="color: #808080"><font color="#808080"># @f2</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 运行时控制装饰器行为" ID="ID_1828514399" CREATED="1591105289460" MODIFIED="1591105290494">
<node TEXT=" 使用 nonlocal 来修改内部变量" ID="ID_652990811" CREATED="1591609447029" MODIFIED="1591609449017"/>
<node ID="ID_36915667" CREATED="1592381524243" MODIFIED="1592381524243"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>logging<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">logged</font></span>(level<span style="color: #cc7832"><font color="#cc7832">, </font></span>name=<span style="color: #cc7832"><font color="#cc7832">None, </font></span>message=<span style="color: #cc7832"><font color="#cc7832">None</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">decorate</font></span>(func):<br/>        logname = name <span style="color: #cc7832"><font color="#cc7832">if </font></span>name <span style="color: #cc7832"><font color="#cc7832">else </font></span>func.<span style="color: #b200b2"><font color="#b200b2">__module__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">        </span></font>log = logging.getLogger(logname)<br/>        logmsg = message <span style="color: #cc7832"><font color="#cc7832">if </font></span>message <span style="color: #cc7832"><font color="#cc7832">else </font></span>func.<span style="color: #b200b2"><font color="#b200b2">__name__<br/></font></span><font color="#b200b2"><span style="color: #b200b2"><br/></span><span style="color: #b200b2">        </span></font><span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>        <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>            log.log(level<span style="color: #cc7832"><font color="#cc7832">, </font></span>logmsg)<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span>func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/><br/>        <span style="color: #bbb529"><font color="#bbb529">@attach_wrapper</font></span>(wrapper)<br/>        <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">set_level</font></span>(newlevel):<br/>            <span style="color: #cc7832"><font color="#cc7832">nonlocal </font></span>level<br/>            level = newlevel<br/><br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>decorate</pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_308117149" CREATED="1592381538915" MODIFIED="1592381538915"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@logged</font></span>(logging.INFO<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'example'</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">spam</font></span>(): <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">只显示</font></span><span style="color: #808080"><font color="#808080">WARNING</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">以上的信息<br/></font></span>logging.basicConfig(<span style="color: #aa4926"><font color="#aa4926">level</font></span>=logging.WARNING)<br/>spam()  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">无输出<br/></font></span>spam.set_level(logging.WARNING)<br/>spam()  <span style="color: #808080"><font color="#808080"># WARNING:example:spam<br/></font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="带可先参数的装饰器" FOLDED="true" ID="ID_808540673" CREATED="1591689835091" MODIFIED="1591689851613">
<node TEXT="对于装饰器实现两种调用方式" ID="ID_688592711" CREATED="1591694502776" MODIFIED="1592381654915">
<node TEXT="不传参数使用 @decorator" ID="ID_1359821943" CREATED="1592381665352" MODIFIED="1592381709816"/>
<node TEXT="可选参数使用 @decorator(x,y,z)" ID="ID_902337507" CREATED="1592381665352" MODIFIED="1592381712408"/>
</node>
<node ID="ID_552867980" CREATED="1592383104911" MODIFIED="1592383104911"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">logged</font></span>(func=<span style="color: #cc7832"><font color="#cc7832">None, </font></span>*<span style="color: #cc7832"><font color="#cc7832">, </font></span>level=logging.DEBUG<span style="color: #cc7832"><font color="#cc7832">, </font></span>name=<span style="color: #cc7832"><font color="#cc7832">None, </font></span>message=<span style="color: #cc7832"><font color="#cc7832">None</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">if </font></span>func <span style="color: #cc7832"><font color="#cc7832">is None</font></span>:<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">带参数的情况，返回一个还需要接收</font></span><span style="color: #808080"><font color="#808080">func</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">参数的函数<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">从而产生三层函数包装的效果<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span>partial(logged<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">level</font></span>=level<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">name</font></span>=name<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">message</font></span>=message)<br/>    ...<br/><br/>    <span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        log.log(level<span style="color: #cc7832"><font color="#cc7832">, </font></span>logmsg)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper<br/><br/><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">普通两层函数包装的装饰器<br/></font></span><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">即</font></span><span style="color: #808080"><font color="#808080">logged </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">第一个参数可接收</font></span><span style="color: #808080"><font color="#808080"> add </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">函数<br/></font></span><span style="color: #bbb529"><font color="#bbb529">@logged<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">add</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y):<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>x + y<br/><span style="color: #bbb529"><font color="#bbb529">@logged</font></span>(<span style="color: #aa4926"><font color="#aa4926">level</font></span>=logging.CRITICAL<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">name</font></span>=<span style="color: #6a8759"><font color="#6a8759">'example'</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">spam</font></span>():<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Spam!'</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 利用装饰器强制函数上的类型检查" FOLDED="true" ID="ID_1235251090" CREATED="1592383608149" MODIFIED="1592383609406">
<node ID="ID_595454749" CREATED="1592386734798" MODIFIED="1592386734798"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">type_assert</font></span>(*ty_args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**ty_kwargs):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">decorate</font></span>(func):<br/>        sig = signature(func)  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">获取可调用对象的签名信息<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">将入参与类型进行映射</font></span><span style="color: #808080"><font color="#808080">, </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">会忽略未指定类型的参数<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font>bound_types = sig.bind_partial(*ty_args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**ty_kwargs).arguments<br/>        <span style="color: #808080"><font color="#808080"># bound_types -> OrderedDict([('x', int), ('y', (int,)), ('z', int)])<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span><span style="color: #808080">        </span></font><span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>        <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>            bound_values = sig.bind(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>            <span style="color: #808080"><font color="#808080"># bound_values.arguments -> OrderedDict([('x', 1), ('y', 2), ('z', 3)])<br/></font></span><font color="#808080"><span style="color: #808080">            </span></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value <span style="color: #cc7832"><font color="#cc7832">in </font></span>bound_values.arguments.items():<br/>                <span style="color: #cc7832"><font color="#cc7832">if </font></span>name <span style="color: #cc7832"><font color="#cc7832">not in </font></span>bound_types:<br/>                    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">跳过不要求检查的<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">                    </span></font><span style="color: #cc7832"><font color="#cc7832">continue<br/></font></span><font color="#cc7832"><span style="color: #cc7832">                if not </span></font><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(value<span style="color: #cc7832"><font color="#cc7832">, </font></span>bound_types[name]):<br/>                    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">执行类型检查<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">                    </span></font><span style="color: #cc7832"><font color="#cc7832">raise </font></span><span style="color: #8888c6"><font color="#8888c6">TypeError</font></span>(<span style="color: #6a8759"><font color="#6a8759">f'Argument </font></span><span style="color: #cc7832"><font color="#cc7832">{</font></span>name<span style="color: #cc7832"><font color="#cc7832">}</font></span><span style="color: #6a8759"><font color="#6a8759"> must be </font></span><span style="color: #cc7832"><font color="#cc7832">{</font></span>bound_types[name]<span style="color: #cc7832"><font color="#cc7832">}</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span>)<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span>func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>decorate</pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_499251226" CREATED="1592386198802" MODIFIED="1592386198802"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@type_assert</font></span>(<span style="color: #8888c6"><font color="#8888c6">int</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>(<span style="color: #8888c6"><font color="#8888c6">int</font></span><span style="color: #cc7832"><font color="#cc7832">,</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">z</font></span>=<span style="color: #8888c6"><font color="#8888c6">int</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">spam</font></span>(x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>z=<span style="color: #6897bb"><font color="#6897bb">42</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"spam"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>x<span style="color: #cc7832"><font color="#cc7832">, </font></span>y<span style="color: #cc7832"><font color="#cc7832">, </font></span>z)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="描述器" FOLDED="true" ID="ID_670477643" CREATED="1592394160775" MODIFIED="1592394165149">
<node TEXT="概念" ID="ID_866052599" CREATED="1592394197327" MODIFIED="1592394201226">
<node TEXT=" 描述器是一个强大而通用的协议" ID="ID_1754516241" CREATED="1592395095041" MODIFIED="1592395097194"/>
<node TEXT=" 一个描述器是一个包含 “绑定行为” 的对象" ID="ID_1001424694" CREATED="1592394642206" MODIFIED="1592394643456"/>
<node TEXT=" 对描述器属性的访问被描述器协议中定义的方法覆盖" ID="ID_649623342" CREATED="1592394659428" MODIFIED="1592394679758"/>
<node TEXT="一个对象实例定义了__get__、__set__、__delete__其中一个，可被称为描述器" ID="ID_847917693" CREATED="1592394689692" MODIFIED="1592557933251"/>
<node TEXT="描述器是特征属性、方法静态方法、类方法和 super() 背后的实现机制" ID="ID_906297107" CREATED="1592395115632" MODIFIED="1592395122130"/>
</node>
<node TEXT="描述器" ID="ID_1153903944" CREATED="1592559833940" MODIFIED="1592559839430">
<node ID="ID_1737958713" CREATED="1592570806619" MODIFIED="1592570806619"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>M:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>x=<span style="color: #6897bb"><font color="#6897bb">1</font></span>):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.x = x<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__get__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance<span style="color: #cc7832"><font color="#cc7832">, </font></span>owner_cls):<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.x<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__set__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance<span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.x = value<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__del__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.x = <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span><span style="color: #6897bb"><br/></span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">调用描述器的类<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>A:<br/>    x = M()  <span style="color: #808080"><font color="#808080"># x</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">就是一个描述器</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="非数据描述器" ID="ID_1628855916" CREATED="1592395181521" MODIFIED="1592395958407">
<node TEXT="__get__" ID="ID_859387395" CREATED="1592394166424" MODIFIED="1592394170057">
<node TEXT="访问时触发， 如 a.x" ID="ID_294122569" CREATED="1592559156640" MODIFIED="1592559278202"/>
</node>
</node>
<node TEXT=" 数据描述器" ID="ID_1359176561" CREATED="1592395180002" MODIFIED="1592395181298">
<node TEXT="__set__" ID="ID_165634519" CREATED="1592394170489" MODIFIED="1592394174819">
<node TEXT="修改时触发 , 如 a.x = 2" ID="ID_1256229049" CREATED="1592559165113" MODIFIED="1592559672432"/>
</node>
<node TEXT=" __delete__" ID="ID_783866504" CREATED="1592394175039" MODIFIED="1592394285368"/>
</node>
</node>
<node TEXT=" 属性访问的行为" ID="ID_775691861" CREATED="1592394835252" MODIFIED="1592394838741">
<node TEXT=" 属性访问的默认行为是从一个对象的字典中获取、设置或删除属性" ID="ID_665457910" CREATED="1592394844378" MODIFIED="1592394845477"/>
<node TEXT=" 访问a.x, a.x 的查找顺序" ID="ID_1912222788" CREATED="1592394866042" MODIFIED="1593332622616">
<node TEXT="  a.__dict__[&apos;x&apos;]" ID="ID_7458470" CREATED="1592394882595" MODIFIED="1592394883717"/>
<node TEXT=" type(a).__dict__[&apos;x&apos;]" ID="ID_579410086" CREATED="1592394890306" MODIFIED="1592394891501"/>
<node TEXT=" type(a) 的基类的__dict__[&apos;x&apos;]" ID="ID_463302647" CREATED="1592394930755" MODIFIED="1592395014828"/>
<node TEXT="如果找到描述器，则调用描述器方法" ID="ID_450332141" CREATED="1592395019472" MODIFIED="1592397425562"/>
</node>
<node TEXT="为什么会调用描述器" ID="ID_1985963165" CREATED="1592565499262" MODIFIED="1593332684895">
<node TEXT=" 由object.__getattribute__()方法控制访问行为" ID="ID_1709447777" CREATED="1592565522474" MODIFIED="1593332698830"/>
<node ID="ID_78839436" CREATED="1592565550741" MODIFIED="1592565550741"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__getattribute__</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"Emulate type_getattro() in Objects/typeobject.c"<br/></i></font></span><font color="#629755"><i><span style="color: #629755; font-style: italic">    </span></i></font>v = <span style="color: #8888c6"><font color="#8888c6">object</font></span>.<span style="color: #b200b2"><font color="#b200b2">__getattribute__</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>key)<br/>    <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #8888c6"><font color="#8888c6">hasattr</font></span>(v<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'__get__'</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>v.<span style="color: #b200b2"><font color="#b200b2">__get__</font></span>(<span style="color: #cc7832"><font color="#cc7832">None, </font></span>self)<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>v</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 重写__getattribute__" ID="ID_554006336" CREATED="1592565599361" MODIFIED="1592565623876">
<node TEXT=" 会改变描述器的行为" ID="ID_837820110" CREATED="1592565624305" MODIFIED="1592565630940"/>
<node TEXT=" 甚至将描述器这一功能关闭" ID="ID_1193686889" CREATED="1592565631122" MODIFIED="1592565632787"/>
</node>
</node>
</node>
<node TEXT="实例方法、静态方法、类方法的描述器原理" ID="ID_1311031272" CREATED="1592566095391" MODIFIED="1592566131563">
<node TEXT="调用实例方法f1" ID="ID_1949446679" CREATED="1592566398712" MODIFIED="1592566515396">
<node TEXT="A.f1()" ID="ID_1453688813" CREATED="1592566456895" MODIFIED="1592566552736"/>
<node TEXT=" A.__dict__[&quot;f1&quot;].__get__(a,  A)()" ID="ID_912412946" CREATED="1592566467743" MODIFIED="1592566609514"/>
</node>
<node TEXT="调用类方法f2" ID="ID_99328532" CREATED="1592566407087" MODIFIED="1592566517532">
<node TEXT="A.f2()" ID="ID_741842321" CREATED="1592566557087" MODIFIED="1592566562072"/>
<node TEXT="A.__dict__[&quot;f2&quot;].__get__(None, B)()" ID="ID_549651035" CREATED="1592566562294" MODIFIED="1592566606507"/>
</node>
<node TEXT="调用静态方法f3" ID="ID_178908889" CREATED="1592566412582" MODIFIED="1592566520414">
<node TEXT="A.f3()" ID="ID_461455017" CREATED="1592566614637" MODIFIED="1592566619145"/>
<node TEXT="A.__dict__[&quot;f3&quot;].__get__(None, B)()" ID="ID_36029010" CREATED="1592566619334" MODIFIED="1592566643809"/>
</node>
</node>
<node TEXT="用途" ID="ID_1689026651" CREATED="1592566929222" MODIFIED="1592566933256">
<node TEXT=" 缓存" ID="ID_1390032518" CREATED="1592566941589" MODIFIED="1592566943119">
<node TEXT="__get__ 返回缓存值" ID="ID_38802879" CREATED="1592566966661" MODIFIED="1592566980288"/>
</node>
<node TEXT=" 当访问属性、赋值属性、删除属性，出现冗余操作" ID="ID_458471022" CREATED="1592566985557" MODIFIED="1592567019552"/>
</node>
</node>
<node TEXT="将装饰器定义为类" FOLDED="true" ID="ID_736393522" CREATED="1592386801203" MODIFIED="1592387462258">
<node TEXT=" types.MethodType" ID="ID_704094596" CREATED="1592906018311" MODIFIED="1592906019748">
<node TEXT="创建对象实例方法" ID="ID_1107496790" CREATED="1592905464425" MODIFIED="1592906192897">
<node TEXT="错误示范" ID="ID_30613734" CREATED="1592905995904" MODIFIED="1592906202473">
<node ID="ID_1721020819" CREATED="1592906346597" MODIFIED="1592906346597"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(obj):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'I am called from'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>obj)<br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>A:<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span>a=A()<br/>a.func=func<br/>a.func()<br/><span style="color: #808080"><font color="#808080"># TypeError: func() missing 1 required positional argument: 'obj'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="只是将方法附加在对象上，没有self参数" ID="ID_680845363" CREATED="1592906202777" MODIFIED="1592909549235"/>
</node>
<node ID="ID_1793993676" CREATED="1592909665839" MODIFIED="1592909665839"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(obj):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'I am called from'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>obj)<br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>A:<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832">import </span></font>types<br/>a = A()<br/>a.func = types.MethodType(func<span style="color: #cc7832"><font color="#cc7832">, </font></span>a)<br/><span style="color: #808080"><font color="#808080"># types.MethodType(func, a, A)  # for py2<br/></font></span>a.func()</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="检查某个对象是否为方法" ID="ID_792387223" CREATED="1592906020257" MODIFIED="1592906124498">
<node TEXT=" isinstance(A().method, types.MethodType)" ID="ID_615130635" CREATED="1592906061943" MODIFIED="1592906064585"/>
</node>
</node>
<node TEXT="类实现装饰器，返回可调用实例" ID="ID_432816946" CREATED="1592387498479" MODIFIED="1592387527763">
<node TEXT="定义" ID="ID_1227843190" CREATED="1593333475261" MODIFIED="1593333478682">
<node ID="ID_920785580" CREATED="1593333470225" MODIFIED="1593333470225"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Profiled:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>func):<br/>        wraps(func)(<span style="color: #94558d"><font color="#94558d">self</font></span>)  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">注入</font></span><span style="color: #808080"><font color="#808080">__wrapped__</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">属性<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #94558d"><font color="#94558d">self</font></span>.ncalls = <span style="color: #6897bb"><font color="#6897bb">0<br/></font></span><font color="#6897bb"><span style="color: #6897bb"><br/></span><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.ncalls += <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">        </span></font><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"before func running"</font></span>)<br/>        func_ret = <span style="color: #94558d"><font color="#94558d">self</font></span>.__wrapped__(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"after func running"</font></span>)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>func_ret<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__get__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance<span style="color: #cc7832"><font color="#cc7832">, </font></span>owner_cls):<br/>        <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""<br/></i></font></span><font color="#629755"><i><span style="color: #629755; font-style: italic">        </span></i></font><i><span style="color: #629755; font-style: italic; font-family: 宋体,monospace"><font color="#629755" face="宋体,monospace">函数方法的调用会调用描述器</font></span><span style="color: #629755; font-style: italic"><font color="#629755"><br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">        """<br/></span><span style="color: #629755; font-style: italic">        </span></font></i><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"get"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance<span style="color: #cc7832"><font color="#cc7832">, </font></span>owner_cls)<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>instance <span style="color: #cc7832"><font color="#cc7832">is None</font></span>:<br/>            <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">在类上面来访问</font></span><span style="color: #808080"><font color="#808080">__get__</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">的情况<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">            </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">返回</font></span><span style="color: #808080"><font color="#808080"> Profiled </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">实例本身<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">            </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">self<br/></font></span><font color="#94558d"><span style="color: #94558d">        </span></font><span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">实例对象访问时有</font></span><span style="color: #808080"><font color="#808080">instance<br/></font></span><font color="#808080"><span style="color: #808080">            # </span></font><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">手动创建一个绑定方法，绑定描述器本身与拥有描述器的对象<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">            </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span>types.MethodType(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>instance)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 使用" ID="ID_471761534" CREATED="1593333473518" MODIFIED="1593333485647">
<node ID="ID_674078615" CREATED="1593333510987" MODIFIED="1593333510987"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@Profiled<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">add</font></span>(<span style="color: #72737a"><font color="#72737a">x</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">y</font></span>):<br/>    <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"add running"</font></span>)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam:<br/>    <span style="color: #bbb529"><font color="#bbb529">@Profiled<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">bar</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>x): <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span></font>add(<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span>)<br/><span style="color: #808080"><font color="#808080"># before func running<br/></font></span><font color="#808080"><span style="color: #808080"># add running<br/></span><span style="color: #808080"># after func running</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="为类和静态方法提供装饰器" FOLDED="true" ID="ID_840201183" CREATED="1592911794142" MODIFIED="1592911810516">
<node TEXT="确保装饰器在 @classmethod 或 @staticmethod 之前" ID="ID_1317224237" CREATED="1592911891511" MODIFIED="1592911923764"/>
<node ID="ID_1393716123" CREATED="1592912033840" MODIFIED="1592912033840"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam:<br/>    <span style="color: #bbb529"><font color="#bbb529">@classmethod<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    @timethis<br/></span><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">class_method</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>n):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>n)<br/>        <span style="color: #cc7832"><font color="#cc7832">while </font></span>n > <span style="color: #6897bb"><font color="#6897bb">0</font></span>:<br/>            n -= <span style="color: #6897bb"><font color="#6897bb">1</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="为包装函数增加参数" FOLDED="true" ID="ID_1074474054" CREATED="1592912064494" MODIFIED="1592912075144">
<node ID="ID_1285281722" CREATED="1593345088697" MODIFIED="1593345088697"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">attach_kwargs</font></span>(**at_kwargs):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper_func</font></span>(func):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"wrapper_func"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>inspect.signature(func).parameters)<br/>        <span style="color: #cc7832"><font color="#cc7832">for </font></span>k <span style="color: #cc7832"><font color="#cc7832">in </font></span>at_kwargs.keys():<br/>            <span style="color: #808080"><font color="#808080"># if k in inspect.getargspec(func).args:  # py2<br/></font></span><font color="#808080"><span style="color: #808080">            </span></font><span style="color: #cc7832"><font color="#cc7832">if </font></span>k <span style="color: #cc7832"><font color="#cc7832">in </font></span>inspect.signature(func).parameters:  <span style="color: #808080"><font color="#808080"># py3<br/></font></span><font color="#808080"><span style="color: #808080">                </span></font><span style="color: #cc7832"><font color="#cc7832">raise </font></span><span style="color: #8888c6"><font color="#8888c6">TypeError</font></span>(<span style="color: #6a8759"><font color="#6a8759">f'attach_kwargs: </font></span><span style="color: #cc7832"><font color="#cc7832">{</font></span>k<span style="color: #cc7832"><font color="#cc7832">}</font></span><span style="color: #6a8759"><font color="#6a8759"> argument already defined'</font></span>)<br/><br/>        <span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(func)<br/>        <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">wrapper</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>            new_kwargs = {**at_kwargs<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs}<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span>func(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**new_kwargs)<br/><br/>        sig = inspect.signature(func)<br/>        sig_params = <span style="color: #8888c6"><font color="#8888c6">list</font></span>(sig.parameters.values())<br/><br/>        kws = <span style="color: #cc7832"><font color="#cc7832">None<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        if </span></font>sig_params[-<span style="color: #6897bb"><font color="#6897bb">1</font></span>].name == <span style="color: #6a8759"><font color="#6a8759">"kwargs"</font></span>:<br/>            kws = sig_params.pop()<br/><br/>        <span style="color: #cc7832"><font color="#cc7832">for </font></span>k<span style="color: #cc7832"><font color="#cc7832">, </font></span>v <span style="color: #cc7832"><font color="#cc7832">in </font></span>at_kwargs.items():<br/>            <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(wrapper<span style="color: #cc7832"><font color="#cc7832">, </font></span>k<span style="color: #cc7832"><font color="#cc7832">, </font></span>v)  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">注入的关键字参数 化为 被包装函数的属性<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">            </span></font>sig_params.append(inspect.Parameter(k<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">                                                </span></font>inspect.Parameter.KEYWORD_ONLY<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">                                                </span></font><span style="color: #aa4926"><font color="#aa4926">default</font></span>=v))<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>kws <span style="color: #cc7832"><font color="#cc7832">is not None</font></span>:<br/>            sig_params.append(kws)<br/><br/>        old_at_kw = <span style="color: #8888c6"><font color="#8888c6">getattr</font></span>(func<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">"__attach_kw__"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>{})<br/>        all_at_kw = {**old_at_kw<span style="color: #cc7832"><font color="#cc7832">, </font></span>**at_kwargs}<br/>        <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(wrapper<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">"__attach_kw__"</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>all_at_kw)<br/><br/>        wrapper.__signature__ = sig.replace(<span style="color: #aa4926"><font color="#aa4926">parameters</font></span>=sig_params)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>wrapper_func</pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1456475261" CREATED="1593345105282" MODIFIED="1593345105282"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@attach_kwargs</font></span>(<span style="color: #aa4926"><font color="#aa4926">i</font></span>=<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">j</font></span>=<span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">k</font></span>=<span style="color: #6897bb"><font color="#6897bb">3</font></span>)<br/><span style="color: #bbb529"><font color="#bbb529">@attach_kwargs</font></span>(<span style="color: #aa4926"><font color="#aa4926">x</font></span>=<span style="color: #6897bb"><font color="#6897bb">6</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">y</font></span>=<span style="color: #6897bb"><font color="#6897bb">7</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">z</font></span>=<span style="color: #6897bb"><font color="#6897bb">8</font></span>)<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">a</font></span>(<span style="color: #72737a"><font color="#72737a">n</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">**kwargs</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span><span style="color: #cc7832"><br/></span></font>a(<span style="color: #6897bb"><font color="#6897bb">434</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">tt</font></span>=<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">i</font></span>=<span style="color: #6897bb"><font color="#6897bb">11</font></span>)  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #a8c023; font-style: italic"><font color="#a8c023"><i>TODO tt</i></font></span><i><span style="color: #a8c023; font-style: italic; font-family: 宋体,monospace"><font color="#a8c023" face="宋体,monospace">参数怎么检查才能不通过<br/></font></span></i>params = inspect.signature(a).parameters<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(params)<br/><span style="color: #808080"><font color="#808080"># OrderedDict([('n', <parameter n="n"/>), ('x', <parameter x="6"/>), ...])<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用装饰器扩充类的功能" FOLDED="true" ID="ID_345295826" CREATED="1592916412003" MODIFIED="1592916425589">
<node TEXT=" 想通过反省或者重写类定义的某部分来修改它的行为，但是你又不希望使用继承或元类的方式" ID="ID_1200672743" CREATED="1592916456772" MODIFIED="1592916458024"/>
<node TEXT=" 相对继承运行速度更快， 不依赖 super() 函数" ID="ID_257753176" CREATED="1592917044195" MODIFIED="1592917076788"/>
<node ID="ID_387766546" CREATED="1592917005436" MODIFIED="1592917005436"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">log_getattribute</font></span>(cls):<br/>    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">获取原始类实现的方法<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font>orig_getattribute = cls.<span style="color: #b200b2"><font color="#b200b2">__getattribute__<br/></font></span><font color="#b200b2"><span style="color: #b200b2"><br/></span><span style="color: #b200b2">    </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">重新定义<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">new_getattribute</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>name):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'getting:'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>orig_getattribute(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>name)<br/><br/>    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">附加到类，并返回<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font>cls.<span style="color: #b200b2"><font color="#b200b2">__getattribute__ </font></span>= new_getattribute<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>cls<br/></pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1790984893" CREATED="1592917153103" MODIFIED="1592917153103"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #bbb529"><font color="#bbb529">@log_getattribute<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>A:<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>x):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.x = x<br/><br/>a = A(<span style="color: #6897bb"><font color="#6897bb">11</font></span>)<br/>a.x  <span style="color: #808080"><font color="#808080"># getting: x</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="什么是元类" FOLDED="true" ID="ID_761532502" CREATED="1592308132205" MODIFIED="1592308136510">
<node TEXT="概念" ID="ID_1070521411" CREATED="1592308275180" MODIFIED="1592308280111">
<node TEXT="创建类的类，用于控制类的创建行为" ID="ID_1790340287" CREATED="1592308136708" MODIFIED="1592308709573"/>
<node TEXT=" 先定义metaclass，就可以创建类，最后创建实例" ID="ID_799094420" CREATED="1592308730410" MODIFIED="1592308731869"/>
<node TEXT="命名一般以MetaClass结尾" ID="ID_907966006" CREATED="1592308147965" MODIFIED="1592308175207"/>
<node TEXT=" 动态语言和静态语言最大的不同，就是函数和类的定义，不是编译时定义的，而是运行时动态创建的" ID="ID_1012500223" CREATED="1592308295852" MODIFIED="1592308299768"/>
</node>
<node TEXT="type函数" ID="ID_1441120985" CREATED="1592308318204" MODIFIED="1592308332613">
<node TEXT="查看对象的类型" ID="ID_1604099146" CREATED="1592308320908" MODIFIED="1592308342509">
<node TEXT="assert type(&quot;aa&quot;) == str" ID="ID_1679963825" CREATED="1592308464555" MODIFIED="1592308516366"/>
</node>
<node TEXT="创建新的对象" ID="ID_1327821833" CREATED="1592308342901" MODIFIED="1592308347720">
<node ID="ID_1784770413" CREATED="1592308462939" MODIFIED="1592308462939"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">创建</font></span><span style="color: #808080"><font color="#808080">Hello class, </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">实例方法</font></span><span style="color: #808080"><font color="#808080">hello<br/></font></span>Hello = <span style="color: #8888c6"><font color="#8888c6">type</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Hello'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>(<span style="color: #8888c6"><font color="#8888c6">object</font></span><span style="color: #cc7832"><font color="#cc7832">,</font></span>)<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">dict</font></span>(<span style="color: #aa4926"><font color="#aa4926">hello</font></span>=<span style="color: #cc7832"><font color="#cc7832">lambda </font></span>self: <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">"H"</font></span>)))<br/>Hello().hello()<br/></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="参数" ID="ID_903722686" CREATED="1592308539684" MODIFIED="1592308543054">
<node TEXT="3个位置参数" ID="ID_1327159816" CREATED="1592308543388" MODIFIED="1592308561394">
<node TEXT=" 类的名称" ID="ID_1731426504" CREATED="1592308585475" MODIFIED="1592308586771"/>
<node TEXT=" 继承的父类的元组" ID="ID_1345281562" CREATED="1592308599131" MODIFIED="1592308605148"/>
<node TEXT=" 类的方法名称与函数绑定的字典" ID="ID_791205280" CREATED="1592308610395" MODIFIED="1592308620461"/>
</node>
<node TEXT="这些参数与继承type的MetaClass下的__init__、__new__等方法的参数是一致的" ID="ID_692000674" CREATED="1592308636455" MODIFIED="1592308679589"/>
</node>
</node>
</node>
</node>
<node TEXT="使用元类控制实例的创建" FOLDED="true" ID="ID_471537452" CREATED="1591693148722" MODIFIED="1591693222015">
<node TEXT="禁止类创建实例" ID="ID_1394740632" CREATED="1591693222948" MODIFIED="1591693239821">
<node TEXT=" 只能调用这个类的静态方法或类方法" ID="ID_353126536" CREATED="1591693351698" MODIFIED="1591693413107"/>
<node ID="ID_1677373634" CREATED="1591693305651" MODIFIED="1591693305651"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>NoInstances(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #cc7832"><font color="#cc7832">raise </font></span><span style="color: #8888c6"><font color="#8888c6">TypeError</font></span>(<span style="color: #6a8759"><font color="#6a8759">"Can't instantiate directly"</font></span>)<br/><br/><span style="color: #808080"><font color="#808080"># Example<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=NoInstances):<br/>    <span style="color: #bbb529"><font color="#bbb529">@staticmethod<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">grok</font></span>(<span style="color: #72737a"><font color="#72737a">x</font></span>):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Spam.grok'</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="元类实现单例" ID="ID_1390073128" CREATED="1591694232432" MODIFIED="1591694246457">
<node ID="ID_785369873" CREATED="1591694289419" MODIFIED="1591694289419"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Singleton(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.__instance = <span style="color: #cc7832"><font color="#cc7832">None<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.__instance <span style="color: #cc7832"><font color="#cc7832">is None</font></span>:<br/>            <span style="color: #94558d"><font color="#94558d">self</font></span>.__instance = <span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.__instance<br/>        <span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.__instance<br/><br/><span style="color: #808080"><font color="#808080"># Example<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=Singleton):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Creating Spam'</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="创建缓存实例" ID="ID_154186552" CREATED="1591694408562" MODIFIED="1591694420594">
<node ID="ID_466564893" CREATED="1591694463666" MODIFIED="1591694463666"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">import </font></span>weakref<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Cached(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.__cache = weakref.WeakValueDictionary()<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>args <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.__cache:<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>.__cache[args]<br/>        <span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            obj = <span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(*args)<br/>            <span style="color: #94558d"><font color="#94558d">self</font></span>.__cache[args] = obj<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span>obj<br/><br/><span style="color: #808080"><font color="#808080"># Example<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=Cached):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name):<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">'Creating Spam({!r})'</font></span>.format(name))<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.name = name<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 定义有可选参数的元类py3" FOLDED="true" ID="ID_272763588" CREATED="1591694495265" MODIFIED="1592296547322">
<node TEXT="效果" ID="ID_624657286" CREATED="1592296582677" MODIFIED="1592296587882">
<node ID="ID_1976192550" CREATED="1592296626096" MODIFIED="1592296626096"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Spam(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=MyMeta<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">debug</font></span>=<span style="color: #8888c6"><font color="#8888c6">True</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">synchronize</font></span>=<span style="color: #8888c6"><font color="#8888c6">True</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="强制关键字参数" ID="ID_1232750170" CREATED="1592296636468" MODIFIED="1592296666953">
<node TEXT=" 在 __prepare__() , __new__() 和 __init__() 方法中 都使用强制关键字参数" ID="ID_232504332" CREATED="1592296667780" MODIFIED="1592296670110"/>
<node ID="ID_1865923620" CREATED="1592297114083" MODIFIED="1592297114083"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>MyMeta(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #bbb529"><font color="#bbb529">@classmethod<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__prepare__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>*<span style="color: #cc7832"><font color="#cc7832">, </font></span>debug=<span style="color: #cc7832"><font color="#cc7832">False, </font></span>synchronize=<span style="color: #cc7832"><font color="#cc7832">False</font></span>):<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">可选覆写，只有当这些额外的参数可能会影响到类命名空间的创建时你才需要去定义<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">所有类定义开始执行前首先被调用，用来创建类命名空间<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">返回一个字典或其他映射对象<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__prepare__</font></span>(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>ns<span style="color: #cc7832"><font color="#cc7832">, </font></span>*<span style="color: #cc7832"><font color="#cc7832">, </font></span>debug=<span style="color: #cc7832"><font color="#cc7832">False, </font></span>synchronize=<span style="color: #cc7832"><font color="#cc7832">False</font></span>):<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">必须覆写<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>ns)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>ns<span style="color: #cc7832"><font color="#cc7832">, </font></span>*<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">debug=False</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #72737a"><font color="#72737a">synchronize=False</font></span>):<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">必须覆写<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>ns)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" *args和**kwargs的强制参数签名" ID="ID_1488498045" CREATED="1592297138970" MODIFIED="1592383916986" VGAP_QUANTITY="6.8999999999999995 pt">
<node TEXT="创建强掉参数签名" ID="ID_299486516" CREATED="1592298183328" MODIFIED="1592298194346">
<node ID="ID_1801351851" CREATED="1592298209654" MODIFIED="1592298209654"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>inspect <span style="color: #cc7832"><font color="#cc7832">import </font></span>Signature<span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter<br/><span style="color: #808080"><font color="#808080"># Make a signature for a func(x, y=42, *, z=None)<br/></font></span>parms = [Parameter(<span style="color: #6a8759"><font color="#6a8759">'x'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter.POSITIONAL_OR_KEYWORD)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font>Parameter(<span style="color: #6a8759"><font color="#6a8759">'y'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter.POSITIONAL_OR_KEYWORD<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">default</font></span>=<span style="color: #6897bb"><font color="#6897bb">42</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font>Parameter(<span style="color: #6a8759"><font color="#6a8759">'z'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter.KEYWORD_ONLY<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">default</font></span>=<span style="color: #cc7832"><font color="#cc7832">None</font></span>)]<br/>sig = Signature(parms)<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(sig)  <span style="color: #808080"><font color="#808080"># (x, y=42, *, z=None)</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 检查传递进来的参数" ID="ID_1620107470" CREATED="1592297804729" MODIFIED="1592297810725">
<node TEXT="绑定参数签名" ID="ID_211921414" CREATED="1592298675800" MODIFIED="1592298690345">
<node TEXT="func(*args, **kwargs) 变为 func(x, y=42, *, z=None)" ID="ID_1181879378" CREATED="1592298694671" MODIFIED="1592305103276"/>
<node ID="ID_771586480" CREATED="1592298315391" MODIFIED="1592298315391"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">func</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>    bound_values = sig.bind(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>    <span style="color: #cc7832"><font color="#cc7832">for </font></span>arg_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>arg_value <span style="color: #cc7832"><font color="#cc7832">in </font></span>bound_values.arguments.items():<br/>        <span style="color: #8888c6"><font color="#8888c6">print</font></span>(arg_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>arg_value)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="报错" ID="ID_483864554" CREATED="1592298378576" MODIFIED="1592298386732">
<node ID="ID_871705708" CREATED="1592305241361" MODIFIED="1592305241361"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt">func(<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6897bb"><font color="#6897bb">4</font></span>)<br/><span style="color: #808080"><font color="#808080"># TypeError: too many positional arguments<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span></font>func(<span style="color: #aa4926"><font color="#aa4926">y</font></span>=<span style="color: #6897bb"><font color="#6897bb">2</font></span>)<br/><span style="color: #808080"><font color="#808080"># TypeError: missing a required argument: 'x'<br/></font></span><font color="#808080"><span style="color: #808080"><br/></span></font>func(<span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">y</font></span>=<span style="color: #6897bb"><font color="#6897bb">2</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">x</font></span>=<span style="color: #6897bb"><font color="#6897bb">3</font></span>)<br/><span style="color: #808080"><font color="#808080"># TypeError: multiple values for argument 'x'</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="自定义签名存储在__signture__属性中" ID="ID_382284492" CREATED="1592305548669" MODIFIED="1592383916986">
<node TEXT=" 将签名存储在特定的属性 __signature__ 中，在使用 inspect 模块执行内省的代码就能发现签名并将它作为调用约定" ID="ID_981760841" CREATED="1592305898021" MODIFIED="1592305906901"/>
<node ID="ID_121352765" CREATED="1592305982258" MODIFIED="1592305982258"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>inspect <span style="color: #cc7832"><font color="#cc7832">import </font></span>Signature<span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter<span style="color: #cc7832"><font color="#cc7832">, </font></span>signature<br/><br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">make_sig</font></span>(*names):<br/>    parms = [Parameter(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter.POSITIONAL_OR_KEYWORD)<br/>             <span style="color: #cc7832"><font color="#cc7832">for </font></span>name <span style="color: #cc7832"><font color="#cc7832">in </font></span>names]<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>Signature(parms)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Structure:<br/>    __signature__ = make_sig()<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        bound_values = <span style="color: #94558d"><font color="#94558d">self</font></span>.__signature__.bind(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value <span style="color: #cc7832"><font color="#cc7832">in </font></span>bound_values.arguments.items():<br/>            <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Point(Structure):<br/>    __signature__ = make_sig(<span style="color: #6a8759"><font color="#6a8759">'x'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'y'</font></span>)<br/><br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(signature(Point))  <span style="color: #808080"><font color="#808080"># (x, y)</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 签名对象" ID="ID_1691805334" CREATED="1592305934771" MODIFIED="1592305936366">
<node ID="ID_590983582" CREATED="1592306208764" MODIFIED="1592306208764"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>inspect <span style="color: #cc7832"><font color="#cc7832">import </font></span>Signature<span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter<span style="color: #cc7832"><font color="#cc7832">, </font></span>signature<br/><br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">make_sig</font></span>(*names):<br/>    parms = [Parameter(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>Parameter.POSITIONAL_OR_KEYWORD) <span style="color: #cc7832"><font color="#cc7832">for </font></span>name <span style="color: #cc7832"><font color="#cc7832">in </font></span>names]<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>Signature(parms)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>StructureMeta(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict):<br/>        clsdict[<span style="color: #6a8759"><font color="#6a8759">'__signature__'</font></span>] = make_sig(*clsdict.get(<span style="color: #6a8759"><font color="#6a8759">'_fields'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>[]))<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict)<br/><br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Structure(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=StructureMeta):<br/>    _fields = []<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        bound_values = <span style="color: #94558d"><font color="#94558d">self</font></span>.__signature__.bind(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value <span style="color: #cc7832"><font color="#cc7832">in </font></span>bound_values.arguments.items():<br/>            <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>Stock(Structure):<br/>    _fields = [<span style="color: #6a8759"><font color="#6a8759">'name'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'shares'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'price'</font></span>]<br/><br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(signature(Stock))  <span style="color: #808080"><font color="#808080"># (name, shares, price)<br/></font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="在类上强制使用编程规约" ID="ID_902225197" CREATED="1592306232787" MODIFIED="1592306245220">
<node TEXT=" metaclass" ID="ID_1745940025" CREATED="1592307303574" MODIFIED="1592308899556">
<node TEXT="定义metaclass" ID="ID_751171927" CREATED="1592308915483" MODIFIED="1592308938967">
<node TEXT=" 一个基本元类通常是继承自 type 并重定义它的 __new__() 方法 或者是 __init__() 方法" ID="ID_41791870" CREATED="1592307317223" MODIFIED="1592307318651"/>
<node TEXT="metaClass会被子类继承" ID="ID_1579776241" CREATED="1592308843596" MODIFIED="1592308856813"/>
<node ID="ID_66698890" CREATED="1592307604836" MODIFIED="1592308832393"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>MyMeta(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict):<br/>        <span style="color: #808080"><font color="#808080"># clsname </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">是定义的类的名称<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># bases </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">是基类组成的元组<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #808080"><font color="#808080"># clsdict </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">类的方法名称与函数绑定的字典<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict):<br/>        <span style="color: #8888c6"><font color="#8888c6">super</font></span>().<span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(clsname<span style="color: #cc7832"><font color="#cc7832">, </font></span>bases<span style="color: #cc7832"><font color="#cc7832">, </font></span>clsdict)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用metaclass" ID="ID_1822997020" CREATED="1592308931299" MODIFIED="1592308936036">
<node ID="ID_554582596" CREATED="1592308967422" MODIFIED="1592308967422"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Root(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=MyMeta):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass<br/></font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" Python解释器在创建Root时，会通过MyMeta.__new__()来创建" ID="ID_1402295633" CREATED="1592309004139" MODIFIED="1592309036343"/>
</node>
</node>
<node TEXT=" 检测重载方法" ID="ID_1979086298" CREATED="1592308889403" MODIFIED="1592308890654">
<node ID="ID_1328894739" CREATED="1592309832605" MODIFIED="1592309832605"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>MatchMethodMetaClass(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>cls_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>cls_parents<span style="color: #cc7832"><font color="#cc7832">, </font></span>cls_attrs):<br/>        <span style="color: #8888c6"><font color="#8888c6">super</font></span>(MatchMethodMetaClass<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>).<span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(cls_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>cls_parents<span style="color: #cc7832"><font color="#cc7832">, </font></span>cls_attrs)<br/>        sup = <span style="color: #8888c6"><font color="#8888c6">super</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #94558d"><font color="#94558d">self</font></span>)<br/>        <span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value <span style="color: #cc7832"><font color="#cc7832">in </font></span>cls_attrs.items():<br/>            <span style="color: #cc7832"><font color="#cc7832">if </font></span>name.startswith(<span style="color: #6a8759"><font color="#6a8759">'_'</font></span>) <span style="color: #cc7832"><font color="#cc7832">or not </font></span><span style="color: #8888c6"><font color="#8888c6">callable</font></span>(value):<br/>                <span style="color: #cc7832"><font color="#cc7832">continue<br/></font></span><font color="#cc7832"><span style="color: #cc7832">            </span></font>prev_dfn = <span style="color: #8888c6"><font color="#8888c6">getattr</font></span>(sup<span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, None</font></span>)<br/>            <span style="color: #cc7832"><font color="#cc7832">if </font></span>prev_dfn:<br/>                <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">覆写了父类方法的情况<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">                </span></font><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #6a8759"><font color="#6a8759">f"reload method: </font></span><span style="color: #cc7832"><font color="#cc7832">{</font></span>name<span style="color: #cc7832"><font color="#cc7832">}</font></span><span style="color: #6a8759"><font color="#6a8759">"</font></span>)</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="避免重复的属性方法" ID="ID_1990242587" CREATED="1592311398296" MODIFIED="1592376116137">
<node TEXT="属性类型检查" ID="ID_654334916" CREATED="1592376122749" MODIFIED="1592376144393">
<node TEXT="setter时检查" ID="ID_1164500967" CREATED="1592377267766" MODIFIED="1592377284672">
<node ID="ID_1099534616" CREATED="1592377296283" MODIFIED="1592377296283"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">typed_property</font></span>(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>expected_type):<br/>    storage_name = <span style="color: #6a8759"><font color="#6a8759">'_' </font></span>+ name<br/><br/>    <span style="color: #bbb529"><font color="#bbb529">@property<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #72737a"><font color="#72737a">prop</font></span>(self):<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">getattr</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>storage_name)<br/><br/>    <span style="color: #bbb529"><font color="#bbb529">@prop.setter<br/></font></span><font color="#bbb529"><span style="color: #bbb529">    </span></font><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">prop</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>value):<br/>        <span style="color: #cc7832"><font color="#cc7832">if not </font></span><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(value<span style="color: #cc7832"><font color="#cc7832">, </font></span>expected_type):<br/>            <span style="color: #cc7832"><font color="#cc7832">raise </font></span><span style="color: #8888c6"><font color="#8888c6">TypeError</font></span>(<span style="color: #6a8759"><font color="#6a8759">'{} must be a {}'</font></span>.format(name<span style="color: #cc7832"><font color="#cc7832">, </font></span>expected_type))<br/>        <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(self<span style="color: #cc7832"><font color="#cc7832">, </font></span>storage_name<span style="color: #cc7832"><font color="#cc7832">, </font></span>value)<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>prop<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="partial简化" ID="ID_1356085959" CREATED="1592377297789" MODIFIED="1592377340912">
<node ID="ID_219046797" CREATED="1592377351921" MODIFIED="1593433863970"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>functools <span style="color: #cc7832"><font color="#cc7832">import </font></span>partial<br/>String = partial(typed_property<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">expected_type</font></span>=<span style="color: #8888c6"><font color="#8888c6">str</font></span>)<br/>Integer = partial(typed_property<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">expected_type</font></span>=<span style="color: #8888c6"><font color="#8888c6">int</font></span>)<br/>StrOrInt = partial(typed_property<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">expected_type</font></span>=(<span style="color: #8888c6"><font color="#8888c6">int</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">str</font></span>))<br/></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="Example" ID="ID_367709977" CREATED="1592377364060" MODIFIED="1592377368759">
<node ID="ID_933939003" CREATED="1592377369603" MODIFIED="1593433874737"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Person:<br/>    <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">取代</font></span><span style="color: #808080"><font color="#808080">property</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">的</font></span><span style="color: #808080"><font color="#808080">getter</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">、</font></span><span style="color: #808080"><font color="#808080">setter</font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">操作<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font>name = String(<span style="color: #6a8759"><font color="#6a8759">'name'</font></span>)<br/>    age = Integer(<span style="color: #6a8759"><font color="#6a8759">'age'</font></span>)<br/>    remark = StrOrInt(<span style="color: #6a8759"><font color="#6a8759">'remark'</font></span>)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__init__</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>age<span style="color: #cc7832"><font color="#cc7832">, </font></span>remark):<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.name = name<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.age = age<br/>        <span style="color: #94558d"><font color="#94558d">self</font></span>.remark = remark</pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="参数类型检查" ID="ID_1778259612" CREATED="1592377466092" MODIFIED="1592377475719"/>
</node>
<node TEXT=" 装饰器实现上下文管理器" ID="ID_475440595" CREATED="1592217797147" MODIFIED="1592217798420">
<node ID="ID_254278657" CREATED="1592217807219" MODIFIED="1592217815351"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>contextlib <span style="color: #cc7832"><font color="#cc7832">import </font></span>contextmanager<br/><span style="color: #bbb529"><font color="#bbb529">@contextmanager<br/></font></span><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">context</font></span>():<br/>    <span style="color: #cc7832"><font color="#cc7832">try</font></span>:<br/>        <span style="color: #808080"><font color="#808080"># yield </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">之前的代码会作为</font></span><span style="color: #808080"><font color="#808080"> __enter__() </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">方法执行<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">        </span></font><span style="color: #cc7832"><font color="#cc7832">yield<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font><span style="color: #808080"><font color="#808080"># yield </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">之后的代码会作为</font></span><span style="color: #808080"><font color="#808080"> __exit__() </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">方法执行<br/></font></span><font color="#808080" face="宋体,monospace"><span style="color: #808080; font-family: 宋体,monospace">    </span></font><span style="color: #cc7832"><font color="#cc7832">finally</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">pass</font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span><span style="color: #cc7832">with </span></font>context():<br/>    <span style="color: #cc7832"><font color="#cc7832">pass</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="多线程、多进程" POSITION="right" ID="ID_575811445" CREATED="1623391736777" MODIFIED="1623391747819">
<edge COLOR="#7c0000"/>
<node TEXT="条件锁" ID="ID_1861406854" CREATED="1623391748035" MODIFIED="1623391753415">
<node TEXT=" Condition被称为条件变量" ID="ID_1795505900" CREATED="1623391770123" MODIFIED="1623391771317">
<node TEXT=" Condition解决的问题不是「互斥」，而是「等待」" ID="ID_1433495388" CREATED="1623399964914" MODIFIED="1623400255992"/>
<node TEXT="锁是条件对象的一部分" ID="ID_652705211" CREATED="1623400096032" MODIFIED="1623400144554">
<node TEXT="锁可作为参数生成条件变量，默认生成一个RLock锁" ID="ID_1366756743" CREATED="1623400145289" MODIFIED="1623400201657"/>
<node TEXT=" 提供与Lock类似的acquire和release方法" ID="ID_1169449751" CREATED="1623391777363" MODIFIED="1623391778085"/>
<node TEXT=" 还提供了wait和notify方法、notify_all方法" ID="ID_1287579347" CREATED="1623391784726" MODIFIED="1623401053706"/>
<node TEXT=" 可利用了锁对象的上下文管理函数 while Condition" ID="ID_1238890099" CREATED="1623400291009" MODIFIED="1623400308185"/>
</node>
<node TEXT="同步处理" ID="ID_1799233712" CREATED="1623400214755" MODIFIED="1623400243770">
<node TEXT="线程版 threading.Condition" ID="ID_1286555365" CREATED="1623399267594" MODIFIED="1623399303235"/>
<node TEXT="进程版 multiprocessing.Condition" ID="ID_1816426853" CREATED="1623399303619" MODIFIED="1623399843696"/>
</node>
</node>
<node TEXT="适用场景" ID="ID_1070213071" CREATED="1623392502274" MODIFIED="1623402625453">
<node TEXT="将锁用于同步某些共享状态的权限" ID="ID_450920951" CREATED="1623402756593" MODIFIED="1623403197054"/>
<node TEXT=" 那些对状态的某些特定改变感兴趣的线程，它们重复调用 wait() 方法，直到看到所期望的改变发生" ID="ID_570928980" CREATED="1623403224324" MODIFIED="1623403225667"/>
<node TEXT="生产者、消费者 模型" ID="ID_450825710" CREATED="1623402627418" MODIFIED="1623402644628"/>
<node TEXT="线程1，处理一流程，缺资源处理不下去了，挂起等待" ID="ID_1062968079" CREATED="1623398627661" MODIFIED="1623398813582"/>
<node TEXT="线程2，提供资源，唤起线程1" ID="ID_801396872" CREATED="1623398799085" MODIFIED="1623398839782"/>
</node>
<node TEXT="方法" ID="ID_833653646" CREATED="1623402649569" MODIFIED="1623402654370">
<node TEXT="调用前要获取锁，否则会报错" ID="ID_249695257" CREATED="1623402894943" MODIFIED="1623402909593"/>
<node TEXT="wait(timeout=None)" ID="ID_1598462013" CREATED="1623402657626" MODIFIED="1623402693139">
<node TEXT=" wait() 方法释放锁(当底层锁是一个RLock时不会自动释放)，然后阻塞" ID="ID_1921416695" CREATED="1623402702792" MODIFIED="1623403022440"/>
<node TEXT=" 唤醒由其它线程调用 notify() 方法或 notify_all() 方法" ID="ID_456562888" CREATED="1623402709601" MODIFIED="1623402735513"/>
<node TEXT=" 一旦被唤醒， wait() 方法重新获取锁并返回" ID="ID_717563117" CREATED="1623402736425" MODIFIED="1623402745132"/>
</node>
<node TEXT="notify(n=1)" ID="ID_1532902474" CREATED="1623402768441" MODIFIED="1623402808241">
<node TEXT="唤醒wait中的线程，默认为1个" ID="ID_1789338472" CREATED="1623402819783" MODIFIED="1623402851505"/>
<node TEXT="如果该条件变量没有wait的线程，就没有作用" ID="ID_1787825647" CREATED="1623402868624" MODIFIED="1623402890834"/>
</node>
<node TEXT=" notify_all()" ID="ID_1882153078" CREATED="1623402947615" MODIFIED="1623402948693">
<node TEXT="唤醒所有wait中的线程" ID="ID_1182512865" CREATED="1623403084350" MODIFIED="1623403095191"/>
</node>
<node TEXT="wait_for(predicatefunc, timeout=None)" ID="ID_1673661118" CREATED="1623403098006" MODIFIED="1623403121847"/>
</node>
<node TEXT="消费者例子" ID="ID_229853044" CREATED="1623398853165" MODIFIED="1623398866440">
<node TEXT="消费者" ID="ID_590269630" CREATED="1623398868653" MODIFIED="1623398887826">
<node ID="ID_1797788829" CREATED="1623398894706" MODIFIED="1623398894706"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">consumer</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>cv<span style="color: #cc7832"><font color="#cc7832">, </font></span>cv2<span style="color: #cc7832"><font color="#cc7832">, </font></span>resource<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)</i></font></span>:<br/>    logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">消费者线程启动</font></span><span style="color: #6a8759"><font color="#6a8759"> ...'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font><span style="color: #cc7832"><font color="#cc7832">while True</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">with </font></span>cv:  <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: 宋体,monospace"><font color="#808080" face="宋体,monospace">这里上下文管理</font></span><span style="color: #808080"><font color="#808080"> acquire release<br/></font></span><font color="#808080"><span style="color: #808080">            </span></font><span style="color: #cc7832"><font color="#cc7832">if </font></span>resource:<br/>                res = resource.pop<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6897bb"><font color="#6897bb">0</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                </span></i></font>logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">f'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">消费者消费了资源</font></span><span style="color: #6a8759"><font color="#6a8759">: </font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>{</i></font></span>res<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>}</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">            </span></i></font><span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>                <span style="color: #cc7832"><font color="#cc7832">with </font></span>cv2:<br/>                    logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">f'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">消费者消费了个寂寞</font></span><span style="color: #6a8759"><font color="#6a8759">, </font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">通知生产者</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                    </span></i></font>cv2.notify<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic"><br/></span><span style="color: #9876aa; font-style: italic">                </span></i></font>logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">消费者等待</font></span><span style="color: #6a8759"><font color="#6a8759"> ...'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                </span></i></font>cv.wait<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">            </span></i></font>time.sleep<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span></pre>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT=" 生产者" ID="ID_881751686" CREATED="1623398896757" MODIFIED="1623398913645">
<node ID="ID_620509622" CREATED="1623399812288" MODIFIED="1623399812288"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">producer</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>cv<span style="color: #cc7832"><font color="#cc7832">, </font></span>cv2<span style="color: #cc7832"><font color="#cc7832">, </font></span>resource<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)</i></font></span>:<br/>    logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">生产者线程开始</font></span><span style="color: #6a8759"><font color="#6a8759"> ...'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>i = <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">    </span></font><span style="color: #cc7832"><font color="#cc7832">while True</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">with </font></span>cv:<br/>            <span style="color: #cc7832"><font color="#cc7832">if not </font></span>resource:<br/>                logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">生产者生产资源</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                </span></i></font>resource.append<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>i<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                </span></i></font>i += <span style="color: #6897bb"><font color="#6897bb">1<br/></font></span><font color="#6897bb"><span style="color: #6897bb">                </span></font>logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">生产者通知所有等待中的消费者</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">                </span></i></font>cv.notify_all<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">            </span></i></font><span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>                logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">生产者这一轮不生产资源</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic"><br/></span><span style="color: #9876aa; font-style: italic">        </span></i></font><span style="color: #cc7832"><font color="#cc7832">with </font></span>cv2:<br/>            logging.debug<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #6a8759; font-family: 宋体,monospace"><font color="#6a8759" face="宋体,monospace">生产者等待下一轮生产</font></span><span style="color: #6a8759"><font color="#6a8759">'</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">            </span></i></font>cv2.wait<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span></pre>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT="1个生产者、2个消费者" ID="ID_1981106539" CREATED="1623398934339" MODIFIED="1623398961996">
<node TEXT=" logging.basicConfig(format=&apos;(%(threadName)-9s) %(message)s&apos;)" ID="ID_1317966043" CREATED="1623399015756" MODIFIED="1623399046592"/>
<node ID="ID_759447716" CREATED="1623398968077" MODIFIED="1623398968077"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">main</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()</i></font></span>:<br/>    cv = threading.Condition<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>cv2 = threading.Condition<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>resource = <span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>[]<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>cs1 = threading.Thread<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #aa4926"><font color="#aa4926">name</font></span>=<span style="color: #6a8759"><font color="#6a8759">'consumer1'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">target</font></span>=consumer<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">args</font></span>=<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>cv<span style="color: #cc7832"><font color="#cc7832">, </font></span>cv2<span style="color: #cc7832"><font color="#cc7832">, </font></span>resource<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>))<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>cs2 = threading.Thread<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #aa4926"><font color="#aa4926">name</font></span>=<span style="color: #6a8759"><font color="#6a8759">'consumer2'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">target</font></span>=consumer<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">args</font></span>=<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>cv<span style="color: #cc7832"><font color="#cc7832">, </font></span>cv2<span style="color: #cc7832"><font color="#cc7832">, </font></span>resource<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>))<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">    </span></i></font>pd = threading.Thread<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #aa4926"><font color="#aa4926">name</font></span>=<span style="color: #6a8759"><font color="#6a8759">'producer'</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">target</font></span>=producer<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #aa4926"><font color="#aa4926">args</font></span>=<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span>cv<span style="color: #cc7832"><font color="#cc7832">, </font></span>cv2<span style="color: #cc7832"><font color="#cc7832">, </font></span>resource<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>))<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic"><br/></span><span style="color: #9876aa; font-style: italic">    </span></i></font><span style="color: #cc7832"><font color="#cc7832">for </font></span>i <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>[</i></font></span>cs1<span style="color: #cc7832"><font color="#cc7832">, </font></span>cs2<span style="color: #cc7832"><font color="#cc7832">, </font></span>pd<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>]</i></font></span>:<br/>        i.start<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>()<br/></i></font></span><font color="#9876aa"><i><span style="color: #9876aa; font-style: italic">        </span></i></font>time.sleep<span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>(</i></font></span><span style="color: #6897bb"><font color="#6897bb">1</font></span><span style="color: #9876aa; font-style: italic"><font color="#9876aa"><i>)<br/></i></font></span></pre>
  </body>
</html>

</richcontent>
</node>
<node TEXT="2个消费者线程，1个生产者线程" ID="ID_1874130788" CREATED="1623398990955" MODIFIED="1623399078357"/>
<node TEXT="cv" ID="ID_1878162799" CREATED="1623399179651" MODIFIED="1623399184452">
<node TEXT=" 消费者先启动，因为没有资源，wait挂起" ID="ID_688859049" CREATED="1623399078563" MODIFIED="1623399165541"/>
<node TEXT="生产者后启动，生产资源，唤醒wait中的消费者" ID="ID_189878442" CREATED="1623399125707" MODIFIED="1623399160700"/>
</node>
<node TEXT="cv2" ID="ID_1451449139" CREATED="1623399189578" MODIFIED="1623399191502">
<node TEXT="生产者生产完资源了，wait挂起" ID="ID_1405776586" CREATED="1623399191962" MODIFIED="1623399205836"/>
<node TEXT="消费者消费不了资源，唤醒wait中的生产者" ID="ID_1038309439" CREATED="1623399206082" MODIFIED="1623399242084"/>
</node>
</node>
</node>
</node>
</node>
</node>
</map>
