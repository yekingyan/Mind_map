<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="python 热重载" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1572255159418" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle" zoom="1.077">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3.0 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0.0 cm" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.8999999999999995 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="103" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="reload函数" POSITION="right" ID="ID_1638791812" CREATED="1572255642419" MODIFIED="1572256233126">
<edge COLOR="#7c007c"/>
<node TEXT=" reload接收的参数必须是已经导入的模块" ID="ID_698908988" CREATED="1572525604898" MODIFIED="1572525607347"/>
<node TEXT="py2" ID="ID_852618540" CREATED="1572256233284" MODIFIED="1572256235779">
<node TEXT="reload(module)" ID="ID_1413676264" CREATED="1572256238539" MODIFIED="1572256244443"/>
</node>
<node TEXT="py3" ID="ID_1917562269" CREATED="1572256235921" MODIFIED="1572256237275">
<node TEXT="from imp import reload&#xa;reload(module)" ID="ID_442823694" CREATED="1572256246794" MODIFIED="1572256255547"/>
</node>
</node>
<node TEXT="不可变性" POSITION="right" ID="ID_660181620" CREATED="1572256710598" MODIFIED="1572256720647">
<edge COLOR="#ff0000"/>
<node TEXT=" 在Web程序中，保持旧的请求仍然按照旧有的代码执行是比较重要的" ID="ID_95078069" CREATED="1572256731247" MODIFIED="1572256732431"/>
<node TEXT=" 而reload过程中的不可变性很好的提供了这一功能" ID="ID_317133282" CREATED="1572256736262" MODIFIED="1572256737951"/>
</node>
<node TEXT="类与实例" POSITION="right" ID="ID_1247301771" CREATED="1572256765829" MODIFIED="1572256770599">
<edge COLOR="#0000ff"/>
<node TEXT=" 如果一个类的实例已经被创建，那么重新加载定义类的模块不会影响实例的定义" ID="ID_1648043474" CREATED="1572256770783" MODIFIED="1572256771775"/>
<node TEXT=" 旧的实例继续使用旧的类定义。派生类（子类）也是如此" ID="ID_1897680393" CREATED="1572256772005" MODIFIED="1572256786582"/>
</node>
<node TEXT="内存回收" POSITION="right" ID="ID_1531616469" CREATED="1572256799181" MODIFIED="1572256802670">
<edge COLOR="#00ff00"/>
<node TEXT=" reload这一操作并不会影响GC的正常进行" ID="ID_1711581927" CREATED="1572256803261" MODIFIED="1572256812126"/>
<node TEXT=" 对象仍然需要等待引用计数为零时才会被回收" ID="ID_102209966" CREATED="1572256816860" MODIFIED="1572256817958"/>
</node>
<node TEXT="导入问题" POSITION="right" ID="ID_1037657681" CREATED="1572256688063" MODIFIED="1572256693329">
<edge COLOR="#7c7c00"/>
<node TEXT="from ... import ..." ID="ID_842367347" CREATED="1572525424206" MODIFIED="1572525439497">
<node TEXT=" 如果一个模块使用from index.config import logger这种形式导入其他模块中的对象，给index.config调用reload()不会变更logger对象" ID="ID_527799207" CREATED="1572525440394" MODIFIED="1572525441468"/>
<node TEXT=" reload不支持from plugins improt plugin的方式重载模块" ID="ID_1118429234" CREATED="1572525670593" MODIFIED="1572525672204"/>
<node TEXT=" 解决方法" ID="ID_425775393" CREATED="1572525454618" MODIFIED="1572525461340">
<node TEXT="一" ID="ID_1627124423" CREATED="1572525487834" MODIFIED="1572525489340">
<node TEXT=" 重新执行from语句" ID="ID_1191761551" CREATED="1572525471914" MODIFIED="1572525473532"/>
<node TEXT=" reload(eval(&quot;plugins.plugin&quot;))" ID="ID_1726030181" CREATED="1572525650713" MODIFIED="1572525652499"/>
</node>
<node TEXT="二" ID="ID_197458979" CREATED="1572525492331" MODIFIED="1572525493604">
<node TEXT=" 使用 import和限定名称(module.name)来代替" ID="ID_485252334" CREATED="1572525484234" MODIFIED="1572525486171"/>
<node TEXT=" import plugins.plugin" ID="ID_1629207721" CREATED="1572525683553" MODIFIED="1572525684882"/>
</node>
</node>
</node>
</node>
<node TEXT="reload" POSITION="right" ID="ID_218487870" CREATED="1588939106963" MODIFIED="1588939112605">
<edge COLOR="#ff00ff"/>
<node TEXT=" 更新普通函数" ID="ID_814053260" CREATED="1588939120563" MODIFIED="1588939121708">
<node ID="ID_892762909" CREATED="1588941375168" MODIFIED="1588941375168"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">both_instance_of</font></span>(first<span style="color: #cc7832"><font color="#cc7832">, </font></span>second<span style="color: #cc7832"><font color="#cc7832">, </font></span>klass):<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(first<span style="color: #cc7832"><font color="#cc7832">, </font></span>klass) <span style="color: #cc7832"><font color="#cc7832">and </font></span><span style="color: #8888c6"><font color="#8888c6">isinstance</font></span>(second<span style="color: #cc7832"><font color="#cc7832">, </font></span>klass)<br/><br/><br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">update_function_no_warp</font></span>(old_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">热更新 普通函数</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #cc7832"><font color="#cc7832">if not </font></span>both_instance_of(old_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>types.FunctionType):<br/>        <span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    if </span></font><span style="color: #8888c6"><font color="#8888c6">len</font></span>(old_func.<span style="color: #b200b2"><font color="#b200b2">__code__</font></span>.co_freevars) != <span style="color: #8888c6"><font color="#8888c6">len</font></span>(new_func.<span style="color: #b200b2"><font color="#b200b2">__code__</font></span>.co_freevars):<br/>        <span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>old_func.<span style="color: #b200b2"><font color="#b200b2">__code__ </font></span>= new_func.<span style="color: #b200b2"><font color="#b200b2">__code__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">    </span></font>old_func.<span style="color: #b200b2"><font color="#b200b2">__defaults__ </font></span>= new_func.<span style="color: #b200b2"><font color="#b200b2">__defaults__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">    </span></font>old_func.<span style="color: #b200b2"><font color="#b200b2">__doc__ </font></span>= new_func.<span style="color: #b200b2"><font color="#b200b2">__doc__<br/></font></span><font color="#b200b2"><span style="color: #b200b2">    </span></font>old_func.<span style="color: #b200b2"><font color="#b200b2">__dict__ </font></span>= new_func.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span></pre>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT=" 更新decorator修饰的函数" ID="ID_1372665060" CREATED="1588939233930" MODIFIED="1588939235252">
<node ID="ID_1279336933" CREATED="1588941384593" MODIFIED="1588942958506"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">update_function</font></span>(old_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func):<br/>    <span style="color: #629755; font-style: italic"><font color="#629755"><i>"""</i></font></span><i><span style="color: #629755; font-style: italic; font-family: Arial"><font color="#629755" face="Arial">热更新 带装饰器函数</font></span><span style="color: #629755; font-style: italic"><font color="#629755">"""<br/></font></span><font color="#629755"><span style="color: #629755; font-style: italic">    </span></font></i><span style="color: #cc7832"><font color="#cc7832">if not </font></span>both_instance_of(old_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>types.FunctionType):<br/>        <span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    if </span></font><span style="color: #8888c6"><font color="#8888c6">len</font></span>(old_func.<span style="color: #b200b2"><font color="#b200b2">__code__</font></span>.co_freevars) != <span style="color: #8888c6"><font color="#8888c6">len</font></span>(new_func.<span style="color: #b200b2"><font color="#b200b2">__code__</font></span>.co_freevars):<br/>        <span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>update_function_no_warp(old_func<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func)<br/>    <span style="color: #cc7832"><font color="#cc7832">if not </font></span>old_func.<span style="color: #b200b2"><font color="#b200b2">__closure__ </font></span><span style="color: #cc7832"><font color="#cc7832">or not </font></span>new_func.<span style="color: #b200b2"><font color="#b200b2">__closure__</font></span>:<br/>        <span style="color: #cc7832"><font color="#cc7832">return<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    for </span></font>old_cell<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_cell <span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #8888c6"><font color="#8888c6">zip</font></span>(old_func.<span style="color: #b200b2"><font color="#b200b2">__closure__</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>new_func.<span style="color: #b200b2"><font color="#b200b2">__closure__</font></span>):<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">被</font></span><span style="color: #808080"><font color="#808080">decorator</font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">修饰的函数可以通过最终返回函数的</font></span><span style="color: #808080"><font color="#808080">free variable</font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">找到<br/></font></span><font color="#808080" face="Arial"><span style="color: #808080; font-family: Arial">        </span></font><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">可以递归更新函数的</font></span><span style="color: #808080"><font color="#808080">closure<br/></font></span><font color="#808080"><span style="color: #808080">        </span></font><span style="color: #cc7832"><font color="#cc7832">if not </font></span>both_instance_of(old_cell.cell_contents<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_cell.cell_contents<span style="color: #cc7832"><font color="#cc7832">, </font></span>types.FunctionType):<br/>            <span style="color: #cc7832"><font color="#cc7832">continue<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font>update_function(old_cell.cell_contents<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_cell.cell_contents)</pre>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT="更新类" ID="ID_919250100" CREATED="1588942916948" MODIFIED="1588942925974">
<node ID="ID_818196265" CREATED="1588942934724" MODIFIED="1588942934724"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">update_class</font></span>(old_class<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_class):<br/>    <span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr <span style="color: #cc7832"><font color="#cc7832">in </font></span>new_class.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>.items():<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>name <span style="color: #cc7832"><font color="#cc7832">not in </font></span>old_class.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>:<br/>            <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(old_class<span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr)<br/>        <span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            old_attr = old_class.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>[name]<br/>            <span style="color: #cc7832"><font color="#cc7832">if </font></span>both_instance_of(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>types.FunctionType):<br/>                update_function(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr)<br/>            <span style="color: #cc7832"><font color="#cc7832">elif </font></span>both_instance_of(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">staticmethod</font></span>):<br/>                update_function(old_attr.<span style="color: #b200b2"><font color="#b200b2">__func__</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr.<span style="color: #b200b2"><font color="#b200b2">__func__</font></span>)<br/>            <span style="color: #cc7832"><font color="#cc7832">elif </font></span>both_instance_of(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">classmethod</font></span>):<br/>                update_function(old_attr.<span style="color: #b200b2"><font color="#b200b2">__func__</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr.<span style="color: #b200b2"><font color="#b200b2">__func__</font></span>)<br/>            <span style="color: #cc7832"><font color="#cc7832">elif </font></span>both_instance_of(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">property</font></span>):<br/>                update_function(old_attr.fdel<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr.fdel)<br/>                update_function(old_attr.fget<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr.fget)<br/>                update_function(old_attr.fset<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr.fset)<br/>            <span style="color: #cc7832"><font color="#cc7832">elif </font></span>both_instance_of(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>                update_class(old_attr<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_attr)</pre>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT="更新模块" ID="ID_1789697771" CREATED="1588942967565" MODIFIED="1588942972366">
<node ID="ID_1528659281" CREATED="1588943244361" MODIFIED="1588943244361"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Consolas; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">update_module</font></span>(old_module<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_module):<br/>    <span style="color: #cc7832"><font color="#cc7832">for </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val <span style="color: #cc7832"><font color="#cc7832">in </font></span>new_module.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>.iteritems():<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>name <span style="color: #cc7832"><font color="#cc7832">not in </font></span>old_module.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>:<br/>            <span style="color: #8888c6"><font color="#8888c6">setattr</font></span>(old_module<span style="color: #cc7832"><font color="#cc7832">, </font></span>name<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val)<br/>        <span style="color: #cc7832"><font color="#cc7832">else</font></span>:<br/>            old_val = old_module.<span style="color: #b200b2"><font color="#b200b2">__dict__</font></span>[name]<br/>            <span style="color: #cc7832"><font color="#cc7832">if </font></span>both_instance_of(old_val<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val<span style="color: #cc7832"><font color="#cc7832">, </font></span>types.FunctionType):<br/>                update_function(old_val<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val)<br/>            <span style="color: #cc7832"><font color="#cc7832">elif </font></span>both_instance_of(old_val<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>                update_class(old_val<span style="color: #cc7832"><font color="#cc7832">, </font></span>new_val)<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #8888c6"><font color="#8888c6">hasattr</font></span>(old_module<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #6a8759"><font color="#6a8759">'on_reload'</font></span>):<br/>        <span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: Arial"><font color="#808080" face="Arial">定义勾子<br/></font></span><font color="#808080" face="Arial"><span style="color: #808080; font-family: Arial">        </span></font>old_module.on_reload()</pre>
  </body>
</html>

</richcontent>
</node>
</node>
</node>
</node>
</map>
