<map version="freeplane 1.9.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="GO" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1628918789717" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ID="ID_959417874" ICON_SIZE="12 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0 cm" VGAP_QUANTITY="6.9 pt">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#000000" WIDTH="2" TRANSPARENCY="200" DASH="" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_959417874" STARTARROW="NONE" ENDARROW="DEFAULT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.9 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.selection" BACKGROUND_COLOR="#4e85f8" STYLE="bubble" BORDER_COLOR_LIKE_EDGE="false" BORDER_COLOR="#4e85f8"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.9 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.9 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.9 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.9 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="132" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="基础" POSITION="right" ID="ID_1832377290" CREATED="1629020031414" MODIFIED="1629020038287">
<edge COLOR="#00ff00"/>
<node TEXT="变量" FOLDED="true" ID="ID_1909686014" CREATED="1628920886522" MODIFIED="1629020056823">
<node TEXT="变量定义" ID="ID_1842249332" CREATED="1628923186736" MODIFIED="1628923205705">
<node TEXT=" 格式" ID="ID_373240849" CREATED="1628920977345" MODIFIED="1628920978154">
<node TEXT=" var 变量名 变量类型" ID="ID_104689603" CREATED="1628920971680" MODIFIED="1628920972863"/>
<node ID="ID_1961642686" CREATED="1628920989697" MODIFIED="1630560382312"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">name</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">age</font>&nbsp;<font color="#4ec9b0">int</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="带初始值的变量声明" ID="ID_666507253" CREATED="1628922272184" MODIFIED="1628922290313">
<node ID="ID_1407929221" CREATED="1628922427478" MODIFIED="1630560452702"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">a</font>,&nbsp;<font color="#9cdcfe">b</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;=&nbsp;<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">4</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;asdf&quot;<br/></font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 类型推导" ID="ID_1593840198" CREATED="1628922379991" MODIFIED="1628922380872">
<node TEXT=" 编译器会根据等号右边的值来推导变量的类型" ID="ID_1692573052" CREATED="1628922387030" MODIFIED="1628922397617"/>
<node TEXT=" &#x9;var a, b, c, d = 1, 2, true, &quot;as&quot;" ID="ID_114725777" CREATED="1628922556252" MODIFIED="1628922557382"/>
</node>
<node TEXT=" 批量声明" ID="ID_180599159" CREATED="1628922702969" MODIFIED="1628922819275">
<node TEXT=" 用括号可以省略用一堆var关键字" ID="ID_1401254197" CREATED="1628923096073" MODIFIED="1628923116719"/>
<node ID="ID_797749474" CREATED="1628922819904" MODIFIED="1628923037887"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">var</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a1</font>&nbsp;=&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a2</font>&nbsp;=&nbsp;<font color="#b5cea8">2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a3</font>&nbsp;=&nbsp;<font color="#b5cea8">3</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a4</font>&nbsp;=&nbsp;<font color="#b5cea8">4</font>
      </div>
      <div>
        )
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 短变量声明" ID="ID_833705285" CREATED="1628922607850" MODIFIED="1628922608598">
<node TEXT=" 在函数内部，可用 := 方式声明并初始化变量" ID="ID_1443512744" CREATED="1628922614347" MODIFIED="1628922629905"/>
<node TEXT="a, b, c, d := 1, 2, true, &quot;as&quot;" ID="ID_647025152" CREATED="1628922556252" MODIFIED="1628922643829"/>
<node TEXT="不能用于定义包内部变量" ID="ID_445515297" CREATED="1628922765169" MODIFIED="1628922786497"/>
</node>
<node TEXT="匿名变量" ID="ID_829252940" CREATED="1628922688363" MODIFIED="1628922702715">
<node TEXT=" 在使用多重赋值时，如果想要忽略某个值" ID="ID_436008113" CREATED="1628922714018" MODIFIED="1628922715026"/>
<node TEXT=" 匿名变量用一个下划线_表示" ID="ID_1771866905" CREATED="1628922715954" MODIFIED="1628922722227"/>
<node TEXT=" x, _ := foo()" ID="ID_1708351528" CREATED="1628922727288" MODIFIED="1628922728154"/>
</node>
</node>
<node TEXT="内建变量类型" ID="ID_64770975" CREATED="1628923215431" MODIFIED="1628923223673">
<node TEXT="布尔 bool" ID="ID_944009342" CREATED="1628923990436" MODIFIED="1628923997732"/>
<node TEXT="字符串 string" ID="ID_206192687" CREATED="1628923997907" MODIFIED="1628924003780"/>
<node TEXT="整数" ID="ID_1621480066" CREATED="1628924004019" MODIFIED="1628924007957">
<node TEXT="int 32 或 64 位" ID="ID_1747878055" CREATED="1628924008130" MODIFIED="1628934249627" VGAP_QUANTITY="6.9 pt"/>
<node TEXT="uint 无符号整数" ID="ID_1509434832" CREATED="1628934199184" MODIFIED="1628934211619"/>
<node TEXT="int8" ID="ID_220366000" CREATED="1628924011274" MODIFIED="1628924013724"/>
<node TEXT="int16" ID="ID_1809971267" CREATED="1628924013876" MODIFIED="1628924037595"/>
<node TEXT="int32" ID="ID_27649502" CREATED="1628924016890" MODIFIED="1628924035300"/>
<node TEXT="int 64" ID="ID_228122837" CREATED="1628924020060" MODIFIED="1628924025980"/>
<node TEXT=" uintptr" ID="ID_1703582450" CREATED="1628924026178" MODIFIED="1628934207925">
<node TEXT=" 以存储指针的 uint32 或 uint64 整数" ID="ID_971032882" CREATED="1628934263485" MODIFIED="1628934264573"/>
</node>
</node>
<node TEXT="浮点数" ID="ID_1791303105" CREATED="1628935301625" MODIFIED="1628935306419">
<node TEXT="float32" ID="ID_835189111" CREATED="1628935306969" MODIFIED="1628935310923"/>
<node TEXT="float64" ID="ID_581103727" CREATED="1628935312840" MODIFIED="1628935317266"/>
<node TEXT="complex64" ID="ID_864507909" CREATED="1628935317617" MODIFIED="1628935321635"/>
<node TEXT="complex128" ID="ID_1408440496" CREATED="1628935321920" MODIFIED="1628935326778"/>
</node>
<node TEXT=" rune" ID="ID_1927266229" CREATED="1628935086672" MODIFIED="1628935087518">
<node TEXT=" int32的别名，几乎在所有方面等同于int32" ID="ID_283656682" CREATED="1630560916138" MODIFIED="1630560920209"/>
<node TEXT="rune用来区分字符值和整数值,用于取代char" ID="ID_193726880" CREATED="1630560925642" MODIFIED="1630560942562"/>
<node TEXT=" rune代表一个utf-8字符" ID="ID_1727818904" CREATED="1630560992779" MODIFIED="1630560993985"/>
</node>
<node TEXT="byte" ID="ID_1369437163" CREATED="1628935262681" MODIFIED="1628935264788">
<node TEXT="uint8" ID="ID_803607857" CREATED="1630560977210" MODIFIED="1630560982981"/>
<node TEXT=" 代表ASCII的一个字符" ID="ID_1812793263" CREATED="1630560972346" MODIFIED="1630560975977"/>
</node>
</node>
<node TEXT=" 类型转换" ID="ID_627388818" CREATED="1629012751034" MODIFIED="1629012752009">
<node TEXT=" Go语言中只有强制类型转换，没有隐式类型转换" ID="ID_877506155" CREATED="1629012757730" MODIFIED="1629012758659"/>
<node ID="ID_179441525" CREATED="1629012896016" MODIFIED="1630561163773"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">sqrtDemo</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">a</font>,&nbsp;<font color="#9cdcfe">b</font>&nbsp;=&nbsp;<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">4</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">c</font>&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;math.Sqrt()接收的参数是float64类型，需要强制转换</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">c</font>&nbsp;=&nbsp;<font color="#dcdcaa">int</font>(math.<font color="#dcdcaa">Sqrt</font>(<font color="#dcdcaa">float64</font>(a*a&nbsp;+&nbsp;b*b)))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(c)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="iota" ID="ID_737841678" CREATED="1629014342435" MODIFIED="1629014369637">
<node TEXT=" 常量计数器，只能在常量的表达式中使用" ID="ID_1944484835" CREATED="1629014365115" MODIFIED="1629014366452"/>
<node TEXT=" iota在const关键字出现时将被重置为0" ID="ID_930973275" CREATED="1629014378539" MODIFIED="1629014379723"/>
<node TEXT="枚举" ID="ID_1850923540" CREATED="1629014395587" MODIFIED="1629014399916">
<node TEXT="     const (&#xa;            n1 = iota //0&#xa;            n2        //1&#xa;            n3        //2&#xa;            n4        //3&#xa;        )" ID="ID_477829579" CREATED="1629014472635" MODIFIED="1629014473679"/>
</node>
<node TEXT="跳值" ID="ID_1808241958" CREATED="1629014400118" MODIFIED="1629014404212">
<node TEXT="    const (&#xa;            n1 = iota //0&#xa;            n2        //1&#xa;            _&#xa;            n4        //3&#xa;        )" ID="ID_16707468" CREATED="1629014455891" MODIFIED="1629014467438"/>
</node>
<node TEXT="插队" ID="ID_1059764113" CREATED="1629014404555" MODIFIED="1629014409476">
<node TEXT="     const (&#xa;            n1 = iota //0&#xa;            n2        //1&#xa;            _&#xa;            n4        //3&#xa;        )" ID="ID_1777224690" CREATED="1629014482098" MODIFIED="1629014484991"/>
</node>
</node>
</node>
<node TEXT="常量与枚举" FOLDED="true" ID="ID_1476397110" CREATED="1629012979580" MODIFIED="1629020052871">
<node TEXT="常量" ID="ID_389783380" CREATED="1629012989843" MODIFIED="1629013032307">
<node TEXT="类似变量声明，只是把var换成了const" ID="ID_155051790" CREATED="1629013032488" MODIFIED="1629013054961"/>
<node TEXT=" 常量在定义的时候必须赋值" ID="ID_1720466943" CREATED="1629013042008" MODIFIED="1629013043232"/>
<node TEXT=" const pi = 3.1415" ID="ID_1026978967" CREATED="1629013064655" MODIFIED="1629013065734"/>
<node TEXT=" 多个常量" ID="ID_1343629704" CREATED="1629013111725" MODIFIED="1629013112591">
<node TEXT="const (&#xa;    pi = 3.1415&#xa;    e = 2.7182&#xa;)" ID="ID_57385389" CREATED="1629013069215" MODIFIED="1629013087291"/>
<node TEXT=" 如果省略了值则表示和上面一行的值相同" ID="ID_726526313" CREATED="1629013132373" MODIFIED="1629013133265">
<node TEXT=" const (&#xa;        n1 = 100&#xa;        n2&#xa;        n3&#xa;)" ID="ID_45683736" CREATED="1629013139109" MODIFIED="1629013157205"/>
<node TEXT=" 常量n1、n2、n3的值都是100" ID="ID_844350034" CREATED="1629013144676" MODIFIED="1629013145524"/>
</node>
</node>
</node>
<node TEXT="枚举" ID="ID_1720976332" CREATED="1629013308996" MODIFIED="1629013314127">
<node ID="ID_1945015404" CREATED="1629014102860" MODIFIED="1629014106414"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">const</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">cpp</font>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">java</font>&nbsp;&nbsp;&nbsp;=&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">py</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<font color="#b5cea8">2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">goland</font>&nbsp;=&nbsp;<font color="#b5cea8">3</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(cpp,&nbsp;java,&nbsp;py,&nbsp;goland)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_385324902" CREATED="1629014146515" MODIFIED="1629014149819"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">const</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">cpp</font>&nbsp;=&nbsp;<font color="#569cd6">iota</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;py
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goland
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(cpp,&nbsp;java,&nbsp;py,&nbsp;goland
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="条件语句" FOLDED="true" ID="ID_883953949" CREATED="1629014544226" MODIFIED="1629020041915">
<node TEXT="if" ID="ID_596099788" CREATED="1629014723523" MODIFIED="1629014728404">
<node ID="ID_205641217" CREATED="1629014729171" MODIFIED="1630561589347"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">bounded</font>(v&nbsp;<font color="#4ec9b0">int</font>)&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;v&nbsp;&gt;&nbsp;<font color="#b5cea8">100</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;<font color="#c586c0">if</font>&nbsp;v&nbsp;&lt;&nbsp;<font color="#b5cea8">0</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;v
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="文件读写" ID="ID_882044960" CREATED="1629015015042" MODIFIED="1629015028362">
<node ID="ID_1572305060" CREATED="1629015058751" MODIFIED="1629015065054"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">contents</font>,&nbsp;<font color="#9cdcfe">err</font>&nbsp;:=&nbsp;ioutil.<font color="#dcdcaa">ReadFile</font>(<font color="#ce9178">&quot;a.txt&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;err&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(contents)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_638982606" CREATED="1629015066104" MODIFIED="1629015163848"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">contents</font>,&nbsp;<font color="#9cdcfe">err</font>&nbsp;:=&nbsp;ioutil.<font color="#dcdcaa">ReadFile</font>(<font color="#ce9178">&quot;a.txt&quot;</font>);&nbsp;err&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(contents)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="switch" ID="ID_1789195508" CREATED="1629015278573" MODIFIED="1629015282582">
<node ID="ID_801950196" CREATED="1629015813291" MODIFIED="1630561784038"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">grade</font>(score&nbsp;<font color="#4ec9b0">int</font>)&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;:=&nbsp;<font color="#ce9178">&quot;&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">switch</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;score&nbsp;&lt;&nbsp;<font color="#b5cea8">60</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;E&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;score&nbsp;&lt;&nbsp;<font color="#b5cea8">70</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;D&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;score&nbsp;&lt;&nbsp;<font color="#b5cea8">80</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;C&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;score&nbsp;&lt;&nbsp;<font color="#b5cea8">90</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;B&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;score&nbsp;&lt;=&nbsp;<font color="#b5cea8">1000</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">g</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;A&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">panic</font>(fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;Wrong&nbsp;score&nbsp;</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;score))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;g
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="默认自动break" ID="ID_1785047110" CREATED="1629015892826" MODIFIED="1629015902212"/>
</node>
<node TEXT="select" ID="ID_1444305463" CREATED="1629015914159" MODIFIED="1629015917029">
<node TEXT=" select 语句类似于 switch 语句，但是select会随机执行一个可运行的case" ID="ID_288242607" CREATED="1629016104126" MODIFIED="1629016105020"/>
<node TEXT=" 如果没有case可运行，它将阻塞，直到有case可运行" ID="ID_1558667365" CREATED="1629016105560" MODIFIED="1629016110552"/>
</node>
</node>
<node TEXT="循环" FOLDED="true" ID="ID_677290575" CREATED="1629016439250" MODIFIED="1629020039730">
<node TEXT=" for init; condition; post { }" ID="ID_578367159" CREATED="1629019228959" MODIFIED="1629019229825"/>
<node TEXT=" for condition { }" ID="ID_1193566014" CREATED="1629019230064" MODIFIED="1629019237681">
<node TEXT="代替其它语言中的 while (condition) {}" ID="ID_1881827182" CREATED="1629019238432" MODIFIED="1629019285384"/>
</node>
<node TEXT="for {}" ID="ID_1575468144" CREATED="1629019263255" MODIFIED="1629019268369">
<node TEXT="代替其它语言中的 while (True) {}" ID="ID_1321838924" CREATED="1629019238432" MODIFIED="1629019292232"/>
</node>
</node>
<node TEXT="函数" FOLDED="true" ID="ID_1476459273" CREATED="1629020067054" MODIFIED="1629020068934">
<node ID="ID_332905089" CREATED="1629021238985" MODIFIED="1629021241909"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">test</font>(x,&nbsp;y&nbsp;<font color="#4ec9b0">int</font>,&nbsp;s&nbsp;<font color="#4ec9b0">string</font>)&nbsp;(<font color="#4ec9b0">int</font>,&nbsp;<font color="#4ec9b0">string</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;类型相同的相邻参数，参数类型可合并。&nbsp;多返回值必须用括号。</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">n</font>&nbsp;:=&nbsp;x&nbsp;+&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;n,&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(s,&nbsp;n)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="参数" ID="ID_926383450" CREATED="1629021639299" MODIFIED="1629021640782">
<node TEXT="参数的传递类型" ID="ID_741787021" CREATED="1629021338783" MODIFIED="1629021349849">
<node TEXT="Go语言只有值传递一种方法，不同python" ID="ID_366066971" CREATED="1629200415604" MODIFIED="1629200435584"/>
<node TEXT="Go是值传递，传参时和复制一份，即在调用过程中不会影响到实际参数" ID="ID_957276912" CREATED="1629021361232" MODIFIED="1629200515004"/>
<node TEXT=" map、slice、chan、interface这些类型本身没有数据，内部的指针指向数据，因此看着像引用传递，实则值传递的是指针本身" ID="ID_1243209857" CREATED="1629021399838" MODIFIED="1629200744944"/>
<node TEXT="可以通过指针传递，实现类型引用传递的效果" ID="ID_988889531" CREATED="1629200559224" MODIFIED="1629200579940"/>
</node>
<node TEXT=" 不定参数传值" ID="ID_57100222" CREATED="1629021557348" MODIFIED="1629021558578">
<node TEXT=" 可变参数本质上就是 slice。只能有一个，且必须是最后一个" ID="ID_394145976" CREATED="1629021414382" MODIFIED="1629021415924"/>
<node TEXT="同类型的不定参数" ID="ID_1284196002" CREATED="1629021350015" MODIFIED="1629021571310">
<node TEXT="0或多个" ID="ID_1846366409" CREATED="1629021431158" MODIFIED="1629021435135">
<node TEXT="   func myfunc(args ...int) {}" ID="ID_1761196779" CREATED="1629021445942" MODIFIED="1629021450846"/>
</node>
<node TEXT="1个或多个" ID="ID_33582942" CREATED="1629021435302" MODIFIED="1629021441583">
<node TEXT="   func add(a int, args…int) int {}" ID="ID_1657265659" CREATED="1629021456894" MODIFIED="1629021458959"/>
</node>
</node>
<node TEXT=" 任意类型的不定参数" ID="ID_376210002" CREATED="1629021507478" MODIFIED="1629021508818">
<node TEXT=" 用interface{}传递任意类型数据是Go语言的惯例用法，而且interface{}是类型安全的" ID="ID_509492940" CREATED="1629021594580" MODIFIED="1629021595564"/>
<node TEXT=" func myfunc(args ...interface{}) {}" ID="ID_763660843" CREATED="1629021599189" MODIFIED="1629021602737"/>
</node>
</node>
</node>
<node TEXT="返回值" ID="ID_1186896832" CREATED="1629021633852" MODIFIED="1629021637439">
<node TEXT=" &quot;_&quot;标识符，用来忽略函数的某个返回值" ID="ID_827999024" CREATED="1629022715517" MODIFIED="1629022716803"/>
<node TEXT=" 返回值可以被命名" ID="ID_580171896" CREATED="1629022015020" MODIFIED="1629022018653">
<node TEXT=" 可以作为文档使用" ID="ID_1474733760" CREATED="1629022028267" MODIFIED="1629022029085">
<node ID="ID_871641072" CREATED="1629022187362" MODIFIED="1629022190716"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">add</font>(a,&nbsp;b&nbsp;<font color="#4ec9b0">int</font>)&nbsp;(c&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;a&nbsp;+&nbsp;b
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" “裸”返回" ID="ID_170008831" CREATED="1629022037707" MODIFIED="1629022070644">
<node TEXT=" 返回各个返回变量的当前值" ID="ID_191119093" CREATED="1629022071020" MODIFIED="1629022071950"/>
<node TEXT=" 不应当用在长函数中，可读性很差" ID="ID_358109732" CREATED="1629022092708" MODIFIED="1629022112614"/>
<node ID="ID_1241485429" CREATED="1629022271179" MODIFIED="1629022274476"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">add</font>(a,&nbsp;b&nbsp;<font color="#4ec9b0">int</font>)&nbsp;(c&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">c</font>&nbsp;=&nbsp;a&nbsp;+&nbsp;b
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="匿名函数" ID="ID_12483839" CREATED="1629022735468" MODIFIED="1629022745774">
<node TEXT=" 匿名函数的优越性在于可以直接使用函数内的变量，不必申明" ID="ID_487730167" CREATED="1629022783255" MODIFIED="1629022784292"/>
<node ID="ID_271356537" CREATED="1629022850860" MODIFIED="1629022853651"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">getSqrt</font>&nbsp;:=&nbsp;<font color="#569cd6">func</font>(a&nbsp;<font color="#4ec9b0">float64</font>)&nbsp;<font color="#4ec9b0">float64</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;math.<font color="#dcdcaa">Sqrt</font>(a)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#dcdcaa">getSqrt</font>(<font color="#b5cea8">4</font>))
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="闭包、递归" ID="ID_405185536" CREATED="1629022907876" MODIFIED="1629022914085"/>
<node TEXT="延迟调用defer" ID="ID_1332425316" CREATED="1629022914260" MODIFIED="1629022925998"/>
<node TEXT="异常处理" ID="ID_29351738" CREATED="1629022926179" MODIFIED="1629022931559"/>
<node TEXT="单元测试" ID="ID_158267463" CREATED="1629022931860" MODIFIED="1629022949110"/>
<node TEXT="压力测试" ID="ID_1167542673" CREATED="1629022938292" MODIFIED="1629022944245"/>
</node>
<node TEXT="指针" FOLDED="true" ID="ID_1412613336" CREATED="1629021197186" MODIFIED="1630562437955" VGAP_QUANTITY="6.9 pt">
<node TEXT="对比C/C++，Go语言中的指针不能进行偏移和运算，是安全指针" ID="ID_140595120" CREATED="1629023039148" MODIFIED="1629023085502"/>
<node TEXT="指针类型" ID="ID_620259989" CREATED="1630562461700" MODIFIED="1630562468739">
<node TEXT="  Go语言中的值类型（int、float、bool、string、array、struct）都有对应的指针类型，如：*int、*int64、*string等" ID="ID_1100950967" CREATED="1629023159675" MODIFIED="1629023160741"/>
</node>
<node TEXT=" 变量取指针地址" ID="ID_26801572" CREATED="1629023069676" MODIFIED="1630562447411">
<node TEXT=" 每个变量在运行时都拥有一个地址，这个地址代表变量在内存中的位置" ID="ID_1369146634" CREATED="1629023140435" MODIFIED="1629023141340"/>
<node TEXT="取地址操作符&amp;，&amp;a取a变量的内存地址，返回指针变量" ID="ID_1891245478" CREATED="1629023592302" MODIFIED="1629023810459"/>
</node>
<node TEXT=" 指针取值" ID="ID_1087170809" CREATED="1629023131427" MODIFIED="1629023133484">
<node TEXT=" 对指针变量进行取值（*）操作，可以获得指针变量指向的原变量的值" ID="ID_86609666" CREATED="1629023874931" MODIFIED="1629023876741"/>
<node TEXT=" 取值操作符*，*b取b指针变量代表的值" ID="ID_1651522141" CREATED="1629023651045" MODIFIED="1629023749758"/>
<node ID="ID_562171480" CREATED="1629023384413" MODIFIED="1629023388244"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//指针取值</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>&nbsp;:=&nbsp;<font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">b</font>&nbsp;:=&nbsp;&amp;a&nbsp;<font color="#6a9955">//&nbsp;取变量a的地址，将指针保存到b中</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;type&nbsp;of&nbsp;b:</font><font color="#9cdcfe">%T</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;b)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;type&nbsp;of&nbsp;b:*int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">c</font>&nbsp;:=&nbsp;*b&nbsp;<font color="#6a9955">//&nbsp;指针取值（根据指针去内存取值）</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;type&nbsp;of&nbsp;c:</font><font color="#9cdcfe">%T</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;c)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;type&nbsp;of&nbsp;c:int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;value&nbsp;of&nbsp;c:</font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;c)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;value&nbsp;of&nbsp;c:10</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="空指针" ID="ID_1817084682" CREATED="1629023887829" MODIFIED="1629023893262">
<node TEXT=" 当一个指针被定义后没有分配到任何变量时，它的值为 nil" ID="ID_1133354164" CREATED="1629023899563" MODIFIED="1629023900802"/>
<node TEXT=" 空指针的判断" ID="ID_1356986311" CREATED="1629023901348" MODIFIED="1629023924270">
<node ID="ID_587313360" CREATED="1629023967451" MODIFIED="1629023970676"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">p</font>&nbsp;*<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(p)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;p的值是</font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;p)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;&lt;nil&gt;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;p&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;非空&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;空值&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="指针传值" ID="ID_381375015" CREATED="1629097005098" MODIFIED="1629097039941">
<node TEXT="实现类型引用传递的效果" ID="ID_1908350599" CREATED="1629200603743" MODIFIED="1629200616433"/>
<node ID="ID_783063091" CREATED="1629097108658" MODIFIED="1629097114632"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">modify1</font>(x&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">x</font>&nbsp;=&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">modify2</font>(x&nbsp;*<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;*<font color="#9cdcfe">x</font>&nbsp;=&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>&nbsp;:=&nbsp;<font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">modify1</font>(a)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(a)&nbsp;<font color="#6a9955">//&nbsp;10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">modify2</font>(&amp;a)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(a)&nbsp;<font color="#6a9955">//&nbsp;100</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="new make" ID="ID_1856453625" CREATED="1629097513737" MODIFIED="1629097519731">
<node TEXT="new" ID="ID_931659127" CREATED="1629024087051" MODIFIED="1629024089661">
<node TEXT=" new用于类型的内存分配，并且内存对应的值为类型零值，返回的是指向类型的指针" ID="ID_10937307" CREATED="1629097623824" MODIFIED="1629097627850"/>
<node TEXT=" var a *int，只是声明指针变量，没有相对应的内存空间，不能直接赋值，new会赋予指针变量内存空间" ID="ID_1421963523" CREATED="1629097286435" MODIFIED="1629097367309"/>
<node ID="ID_1397893464" CREATED="1629097443522" MODIFIED="1629097447160"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">a</font>&nbsp;*<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>&nbsp;=&nbsp;<font color="#dcdcaa">new</font>(<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(*a)&nbsp;<font color="#6a9955">//&nbsp;0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;*<font color="#9cdcfe">a</font>&nbsp;=&nbsp;<font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(*a)&nbsp;<font color="#6a9955">//&nbsp;10</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="make" ID="ID_947297474" CREATED="1629024089779" MODIFIED="1629024091268">
<node TEXT=" make也是用于内存分配的，区别于new，它只用于slice、map以及chan的内存创建" ID="ID_1279417144" CREATED="1629097483497" MODIFIED="1629097484341"/>
<node TEXT=" 返回的类型就是这三个类型本身，而不是他们的指针类型，因为这三种类型就是引用类型，所以就没有必要返回他们的指针了" ID="ID_69651521" CREATED="1629097492265" MODIFIED="1629097493172"/>
<node ID="ID_1441865926" CREATED="1629097578808" MODIFIED="1629097581835"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">b</font>&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">b</font>&nbsp;=&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>,&nbsp;<font color="#b5cea8">10</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;b[<font color="#ce9178">&quot;测试&quot;</font>]&nbsp;=&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(b)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="不同类型的零值" FOLDED="true" ID="ID_910072624" CREATED="1645430714222" MODIFIED="1645430721412">
<node TEXT=" 对于值类型，返回类型初始值" ID="ID_1592982727" CREATED="1645430788479" MODIFIED="1645430819323">
<node TEXT=" 布尔类型为 false, 数值类型为 0，字符串为 &quot;&quot;" ID="ID_1342243718" CREATED="1645430839015" MODIFIED="1645430840643"/>
<node TEXT=" 数组和结构会递归初始化，取决于元素或字段" ID="ID_238696846" CREATED="1645430860463" MODIFIED="1645430872369"/>
</node>
<node TEXT="对于引用类型： 均为 nil" ID="ID_1283220902" CREATED="1645430819510" MODIFIED="1645430829281">
<node TEXT=" 包括指针 pointer，函数 function，接口 interface，切片 slice，管道 channel，映射 map" ID="ID_55952149" CREATED="1645430880390" MODIFIED="1645430881368"/>
</node>
<node ID="ID_849786277" CREATED="1645432481512" MODIFIED="1645432485402"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">a</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// 0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">ap</font>&nbsp;*<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(a, ap)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">c</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">cp</font>&nbsp;*<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(c == <font color="#569cd6">nil</font>) <font color="#6a9955">// true</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="函数返回值还是指针？" FOLDED="true" ID="ID_1858850936" CREATED="1645514613257" MODIFIED="1645514628737">
<node TEXT="结论" ID="ID_1085881918" CREATED="1645515075629" MODIFIED="1645515079026">
<node TEXT=" 通常情况下我们最好还是return value" ID="ID_390255492" CREATED="1645515083620" MODIFIED="1645515085674"/>
<node TEXT=" 生命时间短的struct return pointer是不推荐的" ID="ID_302006896" CREATED="1645515090852" MODIFIED="1645515092003"/>
<node TEXT=" 大size的struct推荐使用pointer返回(大于3000个Int类型数据)" ID="ID_1122808265" CREATED="1645515097205" MODIFIED="1645516261585"/>
<node TEXT="返回的是一个资源(特别是包含状态的资源或需要修改数据)需要返回指针" ID="ID_294582941" CREATED="1645515842967" MODIFIED="1645516106352"/>
<node TEXT=" 当结构类型包含 sync.Mutex 或者同步这种字段时，必须使用指针以避免成员拷贝" ID="ID_1533297158" CREATED="1645516068918" MODIFIED="1645516070291"/>
<node TEXT=" 内置的 new 和 make，map，slice 等引用传递本身就分配在堆上就必然走 gc，返回更多是语义上的区别(想不想被修改)" ID="ID_1776702920" CREATED="1645516500500" MODIFIED="1645516618043"/>
<node TEXT="返回指针。重构时更方便，调用方不用修改。判断nil更方便" ID="ID_448297179" CREATED="1645516729028" MODIFIED="1645516814886"/>
<node TEXT=" 如果你不知道该不该使用指针，使用指针！" ID="ID_649718172" CREATED="1645516113989" MODIFIED="1645516114708"/>
</node>
<node TEXT="比较" ID="ID_1761703120" CREATED="1645515105620" MODIFIED="1645515129599">
<node TEXT="return指针" ID="ID_1253632960" CREATED="1645515313019" MODIFIED="1645515318397">
<node TEXT=" 如果设计成指针返回会存在逃逸，并将变量分配在堆上" ID="ID_367892626" CREATED="1645515906398" MODIFIED="1645515921842"/>
<node TEXT=" 在堆上分配内存，设置值，将指针写入堆栈以返回struct给调用者" ID="ID_597118544" CREATED="1645515335618" MODIFIED="1645515394101"/>
<node TEXT=" Go运行时中有大量时间花费在处理线程和锁以及垃圾收集上" ID="ID_262022446" CREATED="1645515481369" MODIFIED="1645515482241"/>
<node TEXT=" 返回指针的底层函数很快,但分配指针所带来的包袱是一个巨大的开销" ID="ID_904884783" CREATED="1645515489561" MODIFIED="1645515490477"/>
</node>
<node TEXT="return 值" ID="ID_1583329013" CREATED="1645515318644" MODIFIED="1645515323622">
<node TEXT=" 在栈上分配内存的。栈是廉价的(不走gc)，堆是昂贵的" ID="ID_354621105" CREATED="1645515665513" MODIFIED="1645516292416"/>
<node TEXT=" 存在着一次结构体的内存拷贝操作" ID="ID_1026796752" CREATED="1645515573969" MODIFIED="1645516313832"/>
<node TEXT=" 没有堆内存分配,但必须将整个结构复制到堆栈以将其返回给调用者" ID="ID_753674644" CREATED="1645515415307" MODIFIED="1645515416384"/>
</node>
</node>
</node>
<node TEXT=" 单引号、双引号和反引号" FOLDED="true" ID="ID_1570687403" CREATED="1645672076201" MODIFIED="1645672086726">
<node TEXT=" 单引号" ID="ID_279433037" CREATED="1645672088689" MODIFIED="1645672096490">
<node TEXT=" 表示byte类型或rune类型，对应 uint8和int32类型" ID="ID_58853393" CREATED="1645672120026" MODIFIED="1645672121310"/>
<node TEXT=" 默认是 rune 类型，用来表示Unicode的code point" ID="ID_734154630" CREATED="1645672126763" MODIFIED="1645672155339"/>
<node TEXT=" byte用来强调数据是raw data，而不是数字" ID="ID_1746307383" CREATED="1645672135698" MODIFIED="1645672136730"/>
</node>
<node TEXT=" 双引号" ID="ID_263519125" CREATED="1645672096851" MODIFIED="1645672102663">
<node TEXT=" 字符串类型，实际上是字符数组" ID="ID_1658682779" CREATED="1645672174561" MODIFIED="1645672177796"/>
<node TEXT=" 支持转义，但不能用来引用多行" ID="ID_1547148649" CREATED="1645672344544" MODIFIED="1645672345698"/>
<node TEXT=" 可以用索引号访问某字节" ID="ID_1128048144" CREATED="1645672190658" MODIFIED="1645672192233"/>
<node TEXT=" 可以用len()函数来获取字符串所占的字节长度" ID="ID_314368581" CREATED="1645672199090" MODIFIED="1645672199761"/>
</node>
<node TEXT=" 反引号" ID="ID_490754720" CREATED="1645672102883" MODIFIED="1645672104545">
<node TEXT=" 表示字符串字面量， 支持多行，不支持转义" ID="ID_1075848991" CREATED="1645672212241" MODIFIED="1645672370578"/>
<node TEXT=" 转义字符只展示，不起作用，如换行符" ID="ID_1764973610" CREATED="1645672230489" MODIFIED="1645672251637"/>
</node>
</node>
<node TEXT="结构体匿名成员" FOLDED="true" ID="ID_1307709018" CREATED="1645795131603" MODIFIED="1645795155775">
<node TEXT=" 只声明一个成员对应的数据类型而不指名成员的名字；这类成员就叫匿名成员" ID="ID_611116146" CREATED="1645796399189" MODIFIED="1645796401080"/>
<node TEXT="有简短形式的语法糖读取，但定义需要清晰的结构" ID="ID_1281060249" CREATED="1645796101769" MODIFIED="1645796504555"/>
<node TEXT=" 匿名成员的名字就是自己的类型名字" ID="ID_917470285" CREATED="1645796443067" MODIFIED="1645796450285"/>
<node TEXT=" 匿名成员的包外可见性由其类型名隐式决定(大小写)" ID="ID_350970007" CREATED="1645796451235" MODIFIED="1645796466412"/>
<node TEXT=" 匿名成员并不要求是结构体类型，定义匿名类型主要是为了获取它的方法集，来组合出有复杂行为的对象" ID="ID_65606859" CREATED="1645796236264" MODIFIED="1645796384080"/>
<node ID="ID_1249193552" CREATED="1645795614137" MODIFIED="1645795617085"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Point</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;X, Y <font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Circle</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Point
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Radius <font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Wheel</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Circle
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Spokes <font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">w</font>&nbsp;:= Wheel{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Circle: Circle{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point: Point{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X: <font color="#b5cea8">1</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y: <font color="#b5cea8">2</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Radius: <font color="#b5cea8">10</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Spokes: <font color="#b5cea8">20</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 两种方式访问嵌套结构体的匿名成员字段</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(w.X, w.Y, w.Radius)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(w.Point.X, w.Point.Y, w.Circle.Radius)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="结构体标签" FOLDED="true" ID="ID_1672605223" CREATED="1645794721424" MODIFIED="1645794731437">
<node TEXT="json" ID="ID_1389324858" CREATED="1645794735093" MODIFIED="1645794737378">
<node TEXT=" 该字段不进行序列化" ID="ID_1113180027" CREATED="1645794750366" MODIFIED="1645794751309">
<node TEXT="  ID   int     `json:&quot;-&quot;`" ID="ID_1551645585" CREATED="1645794765909" MODIFIED="1645794766958"/>
</node>
<node TEXT=" 如果为类型零值或空值，序列化时忽略该字段" ID="ID_1061368106" CREATED="1645794774965" MODIFIED="1645794775998">
<node TEXT="  Name string  `json:name,omitempty`" ID="ID_701325883" CREATED="1645794782437" MODIFIED="1645796719623"/>
</node>
</node>
<node TEXT="bson" ID="ID_790513474" CREATED="1645794788044" MODIFIED="1645794792816">
<node TEXT="匿名成员的字段保存在最外层" ID="ID_235972639" CREATED="1645795706663" MODIFIED="1645795747338">
<node TEXT="bson inline，消除嵌套结构体的层级关系，将其转为一个层级" ID="ID_1279936140" CREATED="1645795861349" MODIFIED="1645796582792"/>
<node ID="ID_1605267473" CREATED="1645795847188" MODIFIED="1645795850545"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Point</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;X <font color="#4ec9b0">int</font>&nbsp;<font color="#ce9178">`bson:&quot;x&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Y <font color="#4ec9b0">int</font>&nbsp;<font color="#ce9178">`bson:&quot;y&quot;`</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Circle</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Point <font color="#ce9178">`bson:&quot;,inline&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Radius <font color="#4ec9b0">int</font>&nbsp;<font color="#ce9178">`bson:&quot;radius&quot;`</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
</node>
<node TEXT=" 数据结构" POSITION="right" ID="ID_1194875663" CREATED="1629020064285" MODIFIED="1629200963789">
<edge COLOR="#ff00ff"/>
<node TEXT="数组Array" FOLDED="true" ID="ID_852323551" CREATED="1629200964035" MODIFIED="1629204639838">
<node TEXT="概念" ID="ID_728081884" CREATED="1629201184009" MODIFIED="1629201186212">
<node TEXT=" 数组是同一种数据类型的固定长度的序列" ID="ID_279548233" CREATED="1629201026546" MODIFIED="1629201029396"/>
<node TEXT=" 支持 &quot;==&quot;、&quot;!=&quot; 操作符，因为内存总是被初始化过的" ID="ID_1466766587" CREATED="1629201231751" MODIFIED="1629201232665"/>
<node TEXT=" 指针数组 [n]*T，数组指针 *[n]T" ID="ID_1237527966" CREATED="1629201240934" MODIFIED="1629201242679"/>
<node TEXT=" 长度还决定类型，一般不直接用数组，用切片" ID="ID_1105360166" CREATED="1629204575154" MODIFIED="1629204605516"/>
</node>
<node TEXT="定义数组" ID="ID_1990651137" CREATED="1629201029570" MODIFIED="1629201134403">
<node TEXT=" var a [len]int，比如：var a [5]int" ID="ID_1861693185" CREATED="1629201036666" MODIFIED="1629201048316"/>
<node TEXT=" 数组长度必须是常量，且是类型的组成部分" ID="ID_1345410514" CREATED="1629201062010" MODIFIED="1629201063213"/>
<node TEXT="  数组长度一旦定义，长度不能变" ID="ID_128757351" CREATED="1629201069274" MODIFIED="1629201075303"/>
<node TEXT="一维数组" ID="ID_1637131695" CREATED="1629202067734" MODIFIED="1629202071880">
<node ID="ID_1973793018" CREATED="1629201586763" MODIFIED="1629202044951"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">arr1</font>&nbsp;[<font color="#b5cea8">5</font>]<font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;var定义可以不带{}</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr2</font>&nbsp;:=&nbsp;[<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>}&nbsp;<font color="#6a9955">//&nbsp;没有指定的初始值为0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;通过初始化值确定数组长度</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr3</font>&nbsp;:=&nbsp;[...]<font color="#4ec9b0">int</font>{<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">4</font>,&nbsp;<font color="#b5cea8">6</font>,&nbsp;<font color="#b5cea8">8</font>,&nbsp;<font color="#b5cea8">9</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr1,&nbsp;arr2,&nbsp;arr3)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="多维数组" ID="ID_1323173711" CREATED="1629202074757" MODIFIED="1629202079759">
<node ID="ID_1721424830" CREATED="1629202203591" MODIFIED="1629202207700"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>&nbsp;:=&nbsp;[<font color="#b5cea8">2</font>][<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>{{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>},&nbsp;{<font color="#b5cea8">4</font>,&nbsp;<font color="#b5cea8">5</font>,&nbsp;<font color="#b5cea8">6</font>}}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;第&nbsp;2&nbsp;纬度不能用&nbsp;&quot;...&quot;。</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">b</font>&nbsp;:=&nbsp;[...][<font color="#b5cea8">2</font>]<font color="#4ec9b0">int</font>{{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">1</font>},&nbsp;{<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">2</font>},&nbsp;{<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">3</font>}}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">c</font>&nbsp;[<font color="#b5cea8">2</font>][<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">//&nbsp;[[0&nbsp;0&nbsp;0]&nbsp;[0&nbsp;0&nbsp;0]]</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(a,&nbsp;b,&nbsp;c)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="访问" ID="ID_1212093868" CREATED="1629201143009" MODIFIED="1629201145610">
<node TEXT=" 数组可以通过下标进行访问" ID="ID_1241025124" CREATED="1629201136608" MODIFIED="1629201151883"/>
<node TEXT=" 下标是从0开始，最后一个元素下标是：len-1" ID="ID_57030303" CREATED="1629201152071" MODIFIED="1629201153466"/>
<node TEXT="获取长度" ID="ID_1008209323" CREATED="1629203517777" MODIFIED="1629203522828">
<node TEXT="len(arr)" ID="ID_1256476511" CREATED="1629203523026" MODIFIED="1629203529348"/>
<node TEXT="cap(arr)" ID="ID_1625084786" CREATED="1629203529505" MODIFIED="1629203534212"/>
</node>
</node>
<node TEXT="遍历" ID="ID_1371323436" CREATED="1629203506002" MODIFIED="1629203513254">
<node TEXT="一维数组" ID="ID_1404577259" CREATED="1629203144701" MODIFIED="1629203148438">
<node ID="ID_1226930136" CREATED="1629203148726" MODIFIED="1629203184861"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr</font>&nbsp;:=&nbsp;[<font color="#b5cea8">4</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">4</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#dcdcaa">len</font>(arr);&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr[i])
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1851365562" CREATED="1629203235692" MODIFIED="1629203298658"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr</font>&nbsp;:=&nbsp;[<font color="#b5cea8">4</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">4</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;arr&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr[i])
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">v</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;arr&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i,&nbsp;v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="二维数组" ID="ID_620233149" CREATED="1629203241515" MODIFIED="1629203246318">
<node ID="ID_789178040" CREATED="1629203431851" MODIFIED="1629203445066"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr</font>&nbsp;:=&nbsp;[...][<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>{{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>},&nbsp;{<font color="#b5cea8">7</font>,&nbsp;<font color="#b5cea8">8</font>,&nbsp;<font color="#b5cea8">9</font>}}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">k1</font>,&nbsp;<font color="#9cdcfe">v1</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;arr&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">k2</font>,&nbsp;<font color="#9cdcfe">v2</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;v1&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;(</font><font color="#9cdcfe">%d</font><font color="#ce9178">,</font><font color="#9cdcfe">%d</font><font color="#ce9178">)=</font><font color="#9cdcfe">%d</font><font color="#ce9178">&nbsp;&quot;</font>,&nbsp;k1,&nbsp;k2,&nbsp;v2)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 数组是值类型" ID="ID_319212239" CREATED="1629201198703" MODIFIED="1629201206073">
<node TEXT="值类型传参传副本" ID="ID_985803195" CREATED="1629204155365" MODIFIED="1629204171519">
<node TEXT=" 赋值和传参会复制整个数组，而不是指针" ID="ID_1923230244" CREATED="1629201206671" MODIFIED="1629201213244"/>
<node TEXT=" 参数改变只改变副本的值，不会改变本身的值" ID="ID_141941013" CREATED="1629201220432" MODIFIED="1629204007407"/>
<node TEXT="有性能问题，通常会建议使用 slice，或数组指针" ID="ID_1954429880" CREATED="1629202234606" MODIFIED="1629202247104"/>
</node>
<node TEXT="长度决定数组类型" ID="ID_125534925" CREATED="1629203730416" MODIFIED="1629203746021">
<node TEXT=" 长度是数组类型的一部分" ID="ID_604988705" CREATED="1629201110010" MODIFIED="1629201110829"/>
<node TEXT=" var a[5] int和var a[10]int是不同的类型" ID="ID_822616779" CREATED="1629201114921" MODIFIED="1629201115672"/>
<node ID="ID_1893321613" CREATED="1629203929624" MODIFIED="1629203935679"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">printArray</font>(arr&nbsp;[<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">v</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;arr&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i,&nbsp;v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr1</font>&nbsp;:=&nbsp;[<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr2</font>&nbsp;:=&nbsp;[<font color="#b5cea8">2</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">printArray</font>(arr1)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;[2]int&nbsp;与&nbsp;[3]int&nbsp;不是同一类型，报错</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">printArray</font>(arr2)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="切片Slice" FOLDED="true" ID="ID_33494095" CREATED="1629200979867" MODIFIED="1629204622511">
<node TEXT="概念" ID="ID_1464293703" CREATED="1629206877120" MODIFIED="1629206882315">
<node TEXT=" 切片是数组的一个引用，因此切片是引用类型。但自身是结构体，值拷贝传递" ID="ID_1976646289" CREATED="1629206892265" MODIFIED="1629206893430"/>
<node TEXT="切片是数组的view，对切片也能切片，对应是同一个数组" ID="ID_1140463657" CREATED="1629210392758" MODIFIED="1629210440953"/>
<node TEXT=" 切片的长度可以改变，因此，切片是一个可变的数组" ID="ID_892943934" CREATED="1629206898136" MODIFIED="1629206898963"/>
<node TEXT=" cap可以求出slice最大扩张容量，不能超出数组限制" ID="ID_716133694" CREATED="1629206926687" MODIFIED="1629206928114"/>
</node>
<node TEXT="切片的定义" ID="ID_171763853" CREATED="1629206984704" MODIFIED="1629206992498">
<node TEXT="var声明" ID="ID_1309724769" CREATED="1629209953722" MODIFIED="1629209995701">
<node TEXT=" var 变量名 []类型" ID="ID_1528873368" CREATED="1629206996240" MODIFIED="1629206998854"/>
<node TEXT=" 比如 var str []string，var arr []int" ID="ID_615169674" CREATED="1629207005447" MODIFIED="1629209920311"/>
</node>
<node TEXT="短变量声明" ID="ID_954081506" CREATED="1629209961314" MODIFIED="1629210002994">
<node TEXT="s2 := []int{}" ID="ID_1610447777" CREATED="1629210005178" MODIFIED="1629210053795"/>
<node TEXT=" s2 := []int{1, 2, 3}" ID="ID_740113478" CREATED="1629210284520" MODIFIED="1629210287749"/>
</node>
<node TEXT="make" ID="ID_1081554921" CREATED="1629210024305" MODIFIED="1629210028315">
<node TEXT="预先分配一个比较大的数组，减少扩容操作" ID="ID_281162693" CREATED="1629380111301" MODIFIED="1629380166586"/>
<node TEXT="make([]int, len=0, cap=len)" ID="ID_1927295945" CREATED="1629380057256" MODIFIED="1629380090481"/>
<node TEXT="只指定长度" ID="ID_334677261" CREATED="1631000499011" MODIFIED="1631000514920">
<node TEXT="s3 := make([]int, 2)" ID="ID_1579650201" CREATED="1629210028657" MODIFIED="1629381937338"/>
<node TEXT="len为2，则[0 0]" ID="ID_1284776314" CREATED="1629381937947" MODIFIED="1629381963386"/>
<node TEXT="cap默认为2" ID="ID_602728817" CREATED="1629381967097" MODIFIED="1629381984318"/>
</node>
<node TEXT=" 同时指定长度和容量" ID="ID_1192931680" CREATED="1631000287228" MODIFIED="1631000288439">
<node TEXT="s3 := make([]int, 5, 10)" ID="ID_980498560" CREATED="1629210028657" MODIFIED="1631000273976"/>
<node TEXT=" 创建时底层会分配一个数组，数组的长度即容量" ID="ID_1300810884" CREATED="1631000299844" MODIFIED="1631000301652"/>
<node TEXT=" 该Slice长度为5，使用下标s3[0] ~ 3[4]来操作" ID="ID_878593676" CREATED="1631000353804" MODIFIED="1631000374215"/>
<node TEXT=" capacity为10，表示后续向slice添加新的元素时可以不必重新分配内存，直接使用预留内存即可" ID="ID_428306256" CREATED="1631000387643" MODIFIED="1631000389644"/>
<node TEXT="" ID="ID_909674978" CREATED="1631000315457" MODIFIED="1631000318467">
<hook URI="Go_files/png_594384728693995220.png" SIZE="0.80034024" NAME="ExternalObject"/>
</node>
</node>
</node>
<node TEXT="从数组切片" ID="ID_1398581162" CREATED="1629210321654" MODIFIED="1629210329872">
<node TEXT=" s4 := [...]int{1, 2}" ID="ID_480193800" CREATED="1629210349375" MODIFIED="1629210369296"/>
</node>
</node>
<node TEXT="数组切片" ID="ID_1865270699" CREATED="1629211849331" MODIFIED="1629211855781">
<node TEXT=" s = s[low : high : max]" ID="ID_1181655357" CREATED="1629211870267" MODIFIED="1629211879186"/>
<node TEXT=" go的切片是对旧对象一部分的引用，py产生新对象" ID="ID_1311641941" CREATED="1629380804460" MODIFIED="1629380850149"/>
<node TEXT=" 不仅是切片，字符串、数组的切片也是一样的，通常会共用内存" ID="ID_1834663693" CREATED="1629381122716" MODIFIED="1629381123952"/>
<node TEXT="切片当前长度 len = high - low" ID="ID_1404508195" CREATED="1629381071284" MODIFIED="1629381086917"/>
<node TEXT="第三个参数max" ID="ID_1108670979" CREATED="1629212033962" MODIFIED="1629381014127">
<node TEXT=" max 为切片保留的原切片的最大下标（不含 max）" ID="ID_1444144673" CREATED="1629211899723" MODIFIED="1629211903542"/>
<node TEXT="cap = max - low" ID="ID_76232288" CREATED="1629381031836" MODIFIED="1629381038645"/>
<node TEXT=" 没有指定切片的容量，新切片的容量则从low开始直至array的结束" ID="ID_1895942359" CREATED="1631001159020" MODIFIED="1631001190655"/>
</node>
</node>
<node TEXT="操作切片" ID="ID_711469316" CREATED="1629212708918" MODIFIED="1629212715680">
<node TEXT="添加元素" ID="ID_604129897" CREATED="1629212715902" MODIFIED="1629212718712">
<node TEXT="s1 = append(slice []Type, elems ...Type)" ID="ID_410478149" CREATED="1629382188301" MODIFIED="1629382243460"/>
<node TEXT=" 向 slice 尾部添加数据，返回新的 slice 对象" ID="ID_264830405" CREATED="1629380192831" MODIFIED="1629380194147"/>
<node TEXT="如果超出cap，通常以 2 倍容量重新分配底层数组" ID="ID_1415755950" CREATED="1629381736923" MODIFIED="1629381766553"/>
<node ID="ID_379131844" CREATED="1629381690964" MODIFIED="1629382289399"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;:=&nbsp;[]<font color="#4ec9b0">int</font>{}&nbsp;<font color="#6a9955">//&nbsp;s1&nbsp;==&nbsp;nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s1,&nbsp;<font color="#b5cea8">123</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s1,&nbsp;<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 切片拷贝" ID="ID_1109366587" CREATED="1629382295331" MODIFIED="1629382355208">
<node TEXT=" n = copy(dst, src)" ID="ID_687468641" CREATED="1629436558503" MODIFIED="1629436755192"/>
<node TEXT=" 将源切片的数据逐个拷贝到目的切片指向的数组中" ID="ID_1470167401" CREATED="1631001048964" MODIFIED="1631001050808"/>
<node TEXT=" 拷贝数量取两个切片长度的最小值，并作为返回值" ID="ID_1582173061" CREATED="1631001056731" MODIFIED="1631001065207"/>
<node TEXT=" 例如长度为10的切片拷贝到长度为5的切片时，将会拷贝5个元素， copy过程中不会发生扩容" ID="ID_68989380" CREATED="1631001084413" MODIFIED="1631001100311"/>
<node TEXT=" 两个 slice 可指向同一底层数组，允许元素区间重叠" ID="ID_1677395110" CREATED="1629436818320" MODIFIED="1629436819732"/>
</node>
<node TEXT="删除元素" ID="ID_560142182" CREATED="1629437319269" MODIFIED="1629437598183">
<node TEXT="按索引删" ID="ID_271790399" CREATED="1629437500587" MODIFIED="1629437510663">
<node ID="ID_958719662" CREATED="1629437358659" MODIFIED="1629437467529"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;:=&nbsp;[]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;删索引为1的元素</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s1[:<font color="#b5cea8">1</font>],&nbsp;s1[<font color="#b5cea8">2</font>:]...)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="删头" ID="ID_633317752" CREATED="1629437515282" MODIFIED="1629437524014">
<node TEXT="s1 = s1[1:]" ID="ID_1782788854" CREATED="1629437530282" MODIFIED="1629437540629"/>
</node>
<node TEXT="删尾" ID="ID_533720474" CREATED="1629437524738" MODIFIED="1629437528494">
<node TEXT="s1 = s1[:len(s1)-1]" ID="ID_606033528" CREATED="1629437566706" MODIFIED="1629437580549"/>
</node>
</node>
</node>
<node TEXT="底层实现" ID="ID_1344666589" CREATED="1629211240591" MODIFIED="1631001470669">
<node TEXT="" ID="ID_1711052917" CREATED="1629212573393" MODIFIED="1629212576688">
<hook URI="Go_files/png_8027817074227369760.png" SIZE="0.6229705" NAME="ExternalObject"/>
</node>
<node ID="ID_528570370" CREATED="1631000097196" MODIFIED="1631000102547"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">slice</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;array&nbsp;unsafe.Pointer
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;&nbsp;&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;cap&nbsp;&nbsp;&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="ptr" ID="ID_1518257941" CREATED="1629212330232" MODIFIED="1629212333746">
<node TEXT="当前切片第一个元素在数组中的索引" ID="ID_1368519466" CREATED="1629211249047" MODIFIED="1629212339717"/>
<node TEXT=" array指针指向底层数组" ID="ID_208521569" CREATED="1631000159821" MODIFIED="1631000161343"/>
</node>
<node TEXT="len" ID="ID_923071090" CREATED="1629212324328" MODIFIED="1629212326866">
<node TEXT="当前切片的长度" ID="ID_1724327589" CREATED="1629211286143" MODIFIED="1629212351153"/>
<node TEXT="[n]取值，n不能大于len-1" ID="ID_1101483244" CREATED="1629212501472" MODIFIED="1629212527385"/>
</node>
<node TEXT=" cap" ID="ID_806733560" CREATED="1629211310439" MODIFIED="1629211338381">
<node TEXT=" cap 当前切片的容量" ID="ID_1032920338" CREATED="1629211356902" MODIFIED="1629211360531"/>
<node TEXT=" cap 总是大于等于 len 的" ID="ID_1930436206" CREATED="1629212320441" MODIFIED="1629212321488"/>
<node TEXT="reslice可以向后扩展，可向后超出len，但不能超cap" ID="ID_1982165911" CREATED="1629212614806" MODIFIED="1629212670962"/>
</node>
</node>
<node TEXT="切片扩容" ID="ID_1064535916" CREATED="1631000730869" MODIFIED="1631000741568">
<node TEXT=" 扩容操作只关心容量，会把原Slice数据拷贝到新Slice" ID="ID_186998951" CREATED="1631000758836" MODIFIED="1631000759987"/>
<node TEXT="扩容规则" ID="ID_1465965601" CREATED="1631000765044" MODIFIED="1631000775703">
<node TEXT="原Slice容量小于1024，则新Slice容量将扩大2倍" ID="ID_154853478" CREATED="1631000783172" MODIFIED="1631000812670"/>
<node TEXT="原Slice容量大于1024，则新Slice容量将扩大1.25倍" ID="ID_1437479876" CREATED="1631000784805" MODIFIED="1631000828603"/>
</node>
<node TEXT="append的流程" ID="ID_81287283" CREATED="1631000861436" MODIFIED="1631000881959">
<node TEXT=" Slice容量够用" ID="ID_580488179" CREATED="1631000887348" MODIFIED="1631000903533">
<node TEXT=" 则将新元素追加进去，Slice.len++，返回原Slice" ID="ID_1229302977" CREATED="1631000898068" MODIFIED="1631000899758"/>
</node>
<node TEXT=" 原Slice容量不够用" ID="ID_1955456536" CREATED="1631000918539" MODIFIED="1631000920398">
<node TEXT=" 则将Slice先扩容，扩容后得到新Slice" ID="ID_1592581697" CREATED="1631000927276" MODIFIED="1631000928609"/>
<node TEXT=" 将新元素追加进新Slice，Slice.len++，返回新的Slice" ID="ID_1157690972" CREATED="1631000932571" MODIFIED="1631000933899"/>
</node>
</node>
</node>
<node TEXT=" 参数传递切片和切片指针有什么区别" ID="ID_1698779149" CREATED="1644906728979" MODIFIED="1644906729975">
<node TEXT="切片是一个结构体，go参数传递是值传递" ID="ID_1710150538" CREATED="1644907106057" MODIFIED="1644909764583"/>
<node TEXT="切片与切片指针，内部指向的都是同一个数组" ID="ID_390455356" CREATED="1644909764773" MODIFIED="1644909782392"/>
<node TEXT="切片的值拷贝对象" ID="ID_791056961" CREATED="1644909783573" MODIFIED="1644910372389">
<node TEXT=" 修改了内部数组，也会影响原切片" ID="ID_829906079" CREATED="1644910373026" MODIFIED="1644910374724"/>
<node TEXT="如果这个修改变更了内部数组的内存地址，如copy、重分配、append触发扩容，那不会影响原切片" ID="ID_1847190018" CREATED="1644910375280" MODIFIED="1644910436581"/>
</node>
<node TEXT=" 指针传递" ID="ID_1030661001" CREATED="1644910498551" MODIFIED="1644910499524">
<node TEXT="用于修改切片长度len、容量cap、底层数组" ID="ID_57560305" CREATED="1644910502504" MODIFIED="1644910647179"/>
<node TEXT="如果想修改切片，最好传切片指针" ID="ID_1864036517" CREATED="1644910563455" MODIFIED="1644910585219"/>
</node>
</node>
<node TEXT="  range遍历切片的注意点" ID="ID_3875895" CREATED="1644914868732" MODIFIED="1644914874270">
<node TEXT=" 使用range遍历切片时会先拷贝一份，然后在遍历拷贝数据" ID="ID_1777839217" CREATED="1644914882193" MODIFIED="1644914883317"/>
<node TEXT=" 修改原切片内的数据，需要通过切片索引来操作" ID="ID_1071025273" CREATED="1644914883953" MODIFIED="1644914909204"/>
<node ID="ID_1302871412" CREATED="1644915052025" MODIFIED="1644915055875"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u</font>&nbsp;:= []user{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#ce9178">&quot;a&quot;</font>, <font color="#b5cea8">23</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#ce9178">&quot;b&quot;</font>, <font color="#b5cea8">19</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;u {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 这是v是一个值拷贝，</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 不会影响原始数据</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">v.age</font>&nbsp;= <font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(u)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>, <font color="#9cdcfe">_</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;u {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 通过切片索引修改元素</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u[i].<font color="#9cdcfe">age</font>&nbsp;= <font color="#b5cea8">20</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(u)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="for range的赋值变量问题" ID="ID_1791958977" CREATED="1644917121335" MODIFIED="1644917135875">
<node TEXT="for k, v := range 的k、v变量只声明过一次，因些循环过程中的内存地址是一样的，不能直接用&amp;v取地址" ID="ID_1487159943" CREATED="1644917136855" MODIFIED="1644917266120"/>
<node ID="ID_1746715364" CREATED="1644917292022" MODIFIED="1644917295079"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u</font>&nbsp;:= []user{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#ce9178">&quot;a&quot;</font>, <font color="#b5cea8">23</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#ce9178">&quot;b&quot;</font>, <font color="#b5cea8">19</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n1</font>&nbsp;:= <font color="#dcdcaa">make</font>([]*user, <font color="#b5cea8">0</font>, <font color="#dcdcaa">len</font>(u))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n2</font>&nbsp;:= <font color="#dcdcaa">make</font>([]*user, <font color="#b5cea8">0</font>, <font color="#dcdcaa">len</font>(u))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n3</font>&nbsp;:= <font color="#dcdcaa">make</font>([]*user, <font color="#b5cea8">0</font>, <font color="#dcdcaa">len</font>(u))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;u {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// v只声明了一次，v的地址是不变的</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 因此n中的元素都是指向最后一个元素的地址</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n1</font>&nbsp;= <font color="#dcdcaa">append</font>(n1, &amp;v)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 中间变量o，每次都会重新声明</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o</font>&nbsp;:= v
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n2</font>&nbsp;= <font color="#dcdcaa">append</font>(n2, &amp;o)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 直接取内存地址</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">n3</font>&nbsp;= <font color="#dcdcaa">append</font>(n3, &amp;u[i])
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(n1, n2, n3)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;&nbsp;[][]*user{n1, n2, n3} {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">vv</font>&nbsp;&nbsp;:= <font color="#c586c0">range</font>&nbsp;v {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i, *vv)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="函数内部修改参数对应的原数组" FOLDED="true" ID="ID_549238092" CREATED="1629204178221" MODIFIED="1629204270632">
<node TEXT="数组指针" ID="ID_1169441019" CREATED="1629209073291" MODIFIED="1629209078836">
<node ID="ID_1188653479" CREATED="1629204429364" MODIFIED="1629209055032"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;c<font color="#dcdcaa">Array</font>(arr&nbsp;*[<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;arr[<font color="#b5cea8">0</font>]&nbsp;=&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr1</font>&nbsp;:=&nbsp;[<font color="#b5cea8">3</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;c<font color="#dcdcaa">Array</font>(&amp;arr1)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr1)&nbsp;<font color="#6a9955">//&nbsp;arr[0]&nbsp;==&nbsp;100</font>
      </div>
      <br/>
      

      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="slice" ID="ID_1268624958" CREATED="1629209079068" MODIFIED="1629209081965">
<node ID="ID_410281553" CREATED="1629204429364" MODIFIED="1629209032814"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">cArray</font>(arr&nbsp;[]<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;arr[<font color="#b5cea8">0</font>]&nbsp;=&nbsp;<font color="#b5cea8">100</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr1</font>&nbsp;:=&nbsp;[...]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">4</font>,&nbsp;<font color="#b5cea8">5</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">cArray</font>(arr1[:])
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr1)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;[100&nbsp;2&nbsp;3&nbsp;4&nbsp;5]</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="Map" FOLDED="true" ID="ID_1994306435" CREATED="1629437771753" MODIFIED="1629437774492">
<node TEXT="定义" ID="ID_1271941844" CREATED="1629438218791" MODIFIED="1629438223385">
<node TEXT=" map[KeyType]ValueType" ID="ID_446622445" CREATED="1629438223886" MODIFIED="1629438228358">
<node TEXT="  KeyType:表示键的类型" ID="ID_1347334192" CREATED="1629438243815" MODIFIED="1629438244988"/>
<node TEXT=" ValueType:表示键对应的值的类型" ID="ID_325020012" CREATED="1629438250046" MODIFIED="1629438251084"/>
<node TEXT="短变量" ID="ID_140448328" CREATED="1629458699537" MODIFIED="1629458707260">
<node ID="ID_1176974100" CREATED="1629456419247" MODIFIED="1629456422349"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">userInfo</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">string</font>{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;username&quot;</font>:&nbsp;<font color="#ce9178">&quot;pprof.cn&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;password&quot;</font>:&nbsp;<font color="#ce9178">&quot;123456&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="userInfo == empty map" ID="ID_278295516" CREATED="1629458763330" MODIFIED="1629458774069"/>
</node>
<node TEXT="var" ID="ID_861045797" CREATED="1629458707584" MODIFIED="1629458717452">
<node TEXT="var d map[string]int" ID="ID_760910802" CREATED="1629458721186" MODIFIED="1629458733109"/>
<node TEXT="d == nil" ID="ID_172926311" CREATED="1629458757130" MODIFIED="1629458761722"/>
</node>
</node>
<node TEXT="  make(map[KeyType]ValueType, [cap])" ID="ID_1155653991" CREATED="1629456312935" MODIFIED="1629456313831">
<node TEXT="d1 := make(map[string]int)" ID="ID_1334500626" CREATED="1629456341551" MODIFIED="1629458452704"/>
<node TEXT="d2 := make(map[string]int, 8)" ID="ID_42740614" CREATED="1629456341551" MODIFIED="1629458467342"/>
</node>
<node TEXT="作为map的key类型" ID="ID_1765034035" CREATED="1629459521310" MODIFIED="1629459540393">
<node TEXT="可哈希，即可以比较相等" ID="ID_978178570" CREATED="1629459541046" MODIFIED="1629459581818"/>
<node TEXT="除了slice, map, function的内建类型都可以作为key" ID="ID_488392772" CREATED="1629459451942" MODIFIED="1629459595890"/>
<node TEXT="自定义类型的Struct类型不含上述字段可作为key" ID="ID_564853074" CREATED="1629459599045" MODIFIED="1629459634794"/>
</node>
</node>
<node TEXT="操作" ID="ID_947318064" CREATED="1629456473494" MODIFIED="1629456476986">
<node TEXT=" map的遍历" ID="ID_1206113375" CREATED="1629456797860" MODIFIED="1629456808715">
<node TEXT=" 使用for range遍历map" ID="ID_482709533" CREATED="1629456856908" MODIFIED="1629456857968"/>
<node ID="ID_582940329" CREATED="1629456960442" MODIFIED="1629456975260"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;a&quot;</font>:&nbsp;<font color="#b5cea8">1</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;b&quot;</font>:&nbsp;<font color="#b5cea8">2</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">k</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;d&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(k)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">k</font>,&nbsp;<font color="#9cdcfe">v</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;d&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(k,&nbsp;v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="新增键值对" ID="ID_523576461" CREATED="1629456477516" MODIFIED="1629456496438">
<node ID="ID_595353319" CREATED="1629456598379" MODIFIED="1629456609328"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>]&nbsp;=&nbsp;<font color="#b5cea8">1</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="键是否存在" ID="ID_107502952" CREATED="1629456496605" MODIFIED="1629456507367">
<node TEXT="  value, ok := map[key]" ID="ID_1221258717" CREATED="1629456652388" MODIFIED="1629456653395">
<node ID="ID_80469093" CREATED="1629456791595" MODIFIED="1629459315169"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">v</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>];&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;a:&quot;</font>,&nbsp;v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;v&nbsp;==&nbsp;&quot;&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;no&nbsp;key&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="v = d[k] 如果k不存在，则v为d的默认类型" ID="ID_1218544584" CREATED="1629458917176" MODIFIED="1629458948979"/>
</node>
</node>
<node TEXT="删除" ID="ID_1718175738" CREATED="1629457014034" MODIFIED="1629457022839">
<node TEXT=" delete(map, key)" ID="ID_267406508" CREATED="1629457035922" MODIFIED="1629457036795">
<node ID="ID_91300648" CREATED="1629457053845" MODIFIED="1629457053845"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      map:表示要删除键值对的map
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_443522103" CREATED="1629457053845" MODIFIED="1629457053845"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      key:表示要删除的键值对的键
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node ID="ID_1609691200" CREATED="1629457175338" MODIFIED="1629457178209"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;a&quot;</font>:&nbsp;<font color="#b5cea8">1</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;b&quot;</font>:&nbsp;<font color="#b5cea8">2</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">_</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">delete</font>(d,&nbsp;<font color="#ce9178">&quot;a&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="嵌套" ID="ID_82273049" CREATED="1629458269426" MODIFIED="1629458274821">
<node TEXT="切片中的元素为map类型" ID="ID_1518100230" CREATED="1629457570904" MODIFIED="1629457584505">
<node ID="ID_232830704" CREATED="1629458070900" MODIFIED="1629458079432"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;:=&nbsp;[]<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s,&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;s[<font color="#b5cea8">0</font>][<font color="#ce9178">&quot;a&quot;</font>]&nbsp;=&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="map的值为切片类型" ID="ID_569927396" CREATED="1629457585126" MODIFIED="1629457595168">
<node ID="ID_245994543" CREATED="1629458216123" MODIFIED="1629458218462"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>][]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>]&nbsp;=&nbsp;[]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>,&nbsp;<font color="#b5cea8">2</font>,&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(d)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="map的值为map类型" ID="ID_280591369" CREATED="1629458287091" MODIFIED="1629458295662">
<node ID="ID_213404719" CREATED="1629458383564" MODIFIED="1629458395292"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">d</font>&nbsp;:=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>]&nbsp;=&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;d[<font color="#ce9178">&quot;a&quot;</font>][<font color="#ce9178">&quot;1&quot;</font>]&nbsp;=&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(d)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" Map主要的数据结构" ID="ID_1903331893" CREATED="1637216597982" MODIFIED="1637216789941">
<node TEXT="哈希查找表（Hash table）" ID="ID_1890186814" CREATED="1637216611717" MODIFIED="1643251397777">
<node TEXT=" Go Map使用哈希表作为底层实现，并且使用链表解决哈希冲突" ID="ID_986534233" CREATED="1631001491413" MODIFIED="1643250837021"/>
<node TEXT=" 哈希查找表最差是 O(N)，平均查找效率是 O(1)" ID="ID_888147018" CREATED="1637216834267" MODIFIED="1637216850291"/>
<node TEXT=" 遍历哈希查找表，返回的 key 序列，一般乱序" ID="ID_762872507" CREATED="1637216890756" MODIFIED="1637216905148"/>
<node TEXT=" 桶bucket" ID="ID_1128119904" CREATED="1637216666532" MODIFIED="1637216672288">
<node TEXT=" 哈希查找表用一个哈希函数将 key 分配到不同的桶（bucket，也就是数组的不同 index）" ID="ID_1537106452" CREATED="1637216678989" MODIFIED="1637216680150"/>
<node TEXT=" 开销主要在哈希函数的计算以及数组的常数访问时间" ID="ID_805183028" CREATED="1637216689684" MODIFIED="1637216690805"/>
</node>
<node TEXT=" 哈希查找“碰撞”" ID="ID_210323225" CREATED="1637216704924" MODIFIED="1637216712559">
<node TEXT=" 不同的 key 被哈希到了同一个 bucket" ID="ID_1875002728" CREATED="1637216720931" MODIFIED="1637216722005"/>
<node TEXT="解决方法" ID="ID_198834914" CREATED="1637216727114" MODIFIED="1637216730791">
<node TEXT=" 链表法" ID="ID_1811949856" CREATED="1637216735204" MODIFIED="1637216736429">
<node TEXT=" 将一个 bucket 实现成一个链表" ID="ID_539040323" CREATED="1637216750596" MODIFIED="1637216751588"/>
<node TEXT=" 落在同一个 bucket 中的 key 都会插入这个链表" ID="ID_1139632025" CREATED="1637216756972" MODIFIED="1637216757762"/>
</node>
<node TEXT=" 开放地址法" ID="ID_1432914533" CREATED="1637216736635" MODIFIED="1637216741475">
<node TEXT=" 碰撞发生后，通过一定的规律，在数组的后面挑选“空位”，用来放置新的 key" ID="ID_1353211414" CREATED="1637216770844" MODIFIED="1637216773783"/>
</node>
</node>
</node>
</node>
<node ID="ID_126681678" CREATED="1637216616422" MODIFIED="1637216616422"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      搜索树（Search tree）
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" 搜索树法一般采用自平衡搜索树，包括：AVL 树，红黑树" ID="ID_1294280480" CREATED="1637216816163" MODIFIED="1637216817186"/>
<node TEXT=" 自平衡搜索树法的最差搜索效率是 O(logN)" ID="ID_176419766" CREATED="1637216823483" MODIFIED="1637216824331"/>
<node TEXT=" 遍历自平衡搜索树，返回的 key 序列，一般会按照从小到大的顺序" ID="ID_64626302" CREATED="1637216870579" MODIFIED="1637216888272"/>
</node>
</node>
<node TEXT="map 可以边遍历边删除吗" ID="ID_1487242303" CREATED="1637216943955" MODIFIED="1637218235250">
<node TEXT=" map 并不是一个线程安全的数据结构" ID="ID_229222201" CREATED="1637219456762" MODIFIED="1637219458006"/>
<node TEXT=" 多个协程同时读写一个 map 是未定义的行为，如果被检测到，会直接 panic" ID="ID_1514231177" CREATED="1637219464171" MODIFIED="1637221064950"/>
<node TEXT=" 在查找、赋值、遍历、删除的过程中都会检测写标志，一旦发现写标志置位（等于1），则直接 panic" ID="ID_1368769323" CREATED="1637225531747" MODIFIED="1637225533513"/>
<node TEXT=" 同一个协程内边遍历边删除，并不会检测到同时读写，但容易出问题" ID="ID_63119386" CREATED="1637221079407" MODIFIED="1637221173193"/>
<node TEXT="解决方法" ID="ID_1662365605" CREATED="1637221224631" MODIFIED="1637221229264">
<node TEXT=" 读写锁sync.RWMutex" ID="ID_1716315559" CREATED="1637221236295" MODIFIED="1637221239721">
<node TEXT="读之前调用 RLock() 函数，读完之后调用 RUnlock() 函数解锁" ID="ID_1363118630" CREATED="1637221194135" MODIFIED="1637221216809"/>
<node TEXT="写之前调用 Lock() 函数，写完之后，调用 Unlock() 解锁" ID="ID_1700603214" CREATED="1637221204815" MODIFIED="1637221222556"/>
</node>
<node TEXT="sync.Map" ID="ID_787090309" CREATED="1637221243470" MODIFIED="1637221247625">
<node TEXT=" sync.Map 是线程安全的 map，也可以使用" ID="ID_886689404" CREATED="1637221252527" MODIFIED="1637221253431"/>
</node>
</node>
</node>
<node TEXT=" 可以对 map 的元素取地址吗" ID="ID_811791226" CREATED="1637221325871" MODIFIED="1637221330848">
<node TEXT=" 无法对 map 的 key 或 value 进行取址" ID="ID_508635312" CREATED="1637221331415" MODIFIED="1637221333044"/>
<node TEXT="用&amp;取地址会panic， 用unsafe.Pointer取到是当前的" ID="ID_1301432007" CREATED="1637221403080" MODIFIED="1637221447368"/>
<node TEXT=" 扩容会使key 和 value 的地址发生改变" ID="ID_1418155998" CREATED="1637221355911" MODIFIED="1637221398041"/>
</node>
<node TEXT="如何比较两个map相等" ID="ID_62016869" CREATED="1637225421937" MODIFIED="1637225432238">
<node TEXT=" 遍历map 的每个元素，比较元素是否都是深度相等" ID="ID_30250549" CREATED="1637225445801" MODIFIED="1637225446987"/>
<node TEXT=" 直接将使用 map1 == map2 是错误的。这种写法只能比较 map 是否为 nil" ID="ID_1914138111" CREATED="1637225454360" MODIFIED="1637225455536"/>
</node>
<node TEXT="map是线程安全的吗" ID="ID_1310357050" CREATED="1643252926263" MODIFIED="1643252934146">
<node TEXT=" map 不是线程安全的" ID="ID_77142930" CREATED="1643266503596" MODIFIED="1643266504503"/>
<node TEXT=" 写标志位检测" ID="ID_1215663771" CREATED="1643266519183" MODIFIED="1643266528619">
<node TEXT="在增删改查、遍历、过程中都会检测写标志，一旦发现为1，则直接 panic" ID="ID_400405365" CREATED="1643266591069" MODIFIED="1643266768912"/>
<node TEXT=" 赋值和删除函数在检测完写标志，先设置为1，再进行操作" ID="ID_496372437" CREATED="1643266657349" MODIFIED="1643266700087"/>
</node>
</node>
<node TEXT=" map 的扩容过程是怎样的" ID="ID_59706640" CREATED="1637225681222" MODIFIED="1637225686984">
<node TEXT=" Go 语言采用一个 bucket 里最多装载 8 个 key" ID="ID_1587237606" CREATED="1637225726600" MODIFIED="1637225732044"/>
<node TEXT=" 装载因子" ID="ID_61081432" CREATED="1637225748841" MODIFIED="1637225749630">
<node TEXT=" loadFactor := count / (2^B)" ID="ID_877212425" CREATED="1637225753399" MODIFIED="1637225754514"/>
<node TEXT=" count 就是 map 的元素个数，2^B 表示 bucket 数量" ID="ID_907365657" CREATED="1637225760728" MODIFIED="1637225761962"/>
</node>
<node TEXT=" 触发 map 扩容的时机" ID="ID_1944379327" CREATED="1637225771297" MODIFIED="1637226034821" VGAP_QUANTITY="6.9 pt">
<node TEXT=" 在向 map 插入新 key 的时候，会进行条件检测" ID="ID_1967763459" CREATED="1637225782265" MODIFIED="1637225783593"/>
<node TEXT=" 1.装载因子超过阈值，源码里定义的阈值是 6.5" ID="ID_63275206" CREATED="1637225789121" MODIFIED="1637226033635">
<node TEXT=" 每个 bucket 有 8 个空位，在没有溢出，且所有的桶都装满了的情况下，装载因子算出来的结果是 8" ID="ID_987216545" CREATED="1637226068720" MODIFIED="1637226069605"/>
<node TEXT="装载因子超大，每个bucket装的越多，查找效率和插入效率就会变得越慢" ID="ID_1064893123" CREATED="1637226070285" MODIFIED="1637226123155"/>
</node>
<node TEXT=" 2.overflow 的 bucket 数量过多" ID="ID_1480094145" CREATED="1637225798809" MODIFIED="1637226036829">
<node TEXT=" 当 B 小于 15，也就是 bucket 总数 2^B 小于 2^15 时， 如果 overflow 的 bucket 数量超过 2^B" ID="ID_711006817" CREATED="1637225812896" MODIFIED="1637225838945"/>
<node TEXT=" 当 B &gt;= 15，也就是 bucket 总数 2^B 大于等于 2^15，如果 overflow 的 bucket 数量超过 2^15" ID="ID_1501247915" CREATED="1637225830095" MODIFIED="1637225830984"/>
</node>
<node TEXT="  Go map 的扩容采取了一种称为“渐进式”地方式，原有的 key 并不会一次性搬迁完毕，每次最多只会搬迁 2 个 bucket" ID="ID_724047248" CREATED="1637226821490" MODIFIED="1637226822732"/>
<node TEXT=" 对于条件 2，从老的 buckets 搬迁到新的 buckets，由于 bucktes 数量不变，因此可以按序号来搬，比如原来在 0 号 bucktes，到新的地方后，仍然放在 0 号 buckets" ID="ID_714860979" CREATED="1637226893310" MODIFIED="1637226895523"/>
<node TEXT=" 对于条件 1，就没这么简单了。要重新计算 key 的哈希，才能决定它到底落在哪个 bucket" ID="ID_1549843198" CREATED="1637226911477" MODIFIED="1637226912766"/>
</node>
</node>
<node TEXT="map的遍历过程" ID="ID_923233934" CREATED="1643267249681" MODIFIED="1643267258194">
<node TEXT="扩容完成的map" ID="ID_217826047" CREATED="1643267264495" MODIFIED="1643267395058">
<node TEXT=" 遍历所有的 bucket 以及它后面挂的 overflow bucket，然后挨个遍历 bucket 中的所有 cell" ID="ID_657140097" CREATED="1643267285343" MODIFIED="1643267286358"/>
<node TEXT=" 每个 bucket 中包含 8 个 cell，从有 key 的 cell 中取出 key 和 value" ID="ID_1574879515" CREATED="1643267292608" MODIFIED="1643267293438"/>
</node>
<node TEXT="扩容中的map" ID="ID_774235887" CREATED="1643267270871" MODIFIED="1643267371754">
<node TEXT="扩容不是原子操作" ID="ID_376601702" CREATED="1643267403359" MODIFIED="1643267429616">
<node TEXT=" 扩容过程不是一个原子的操作，它每次最多只搬运 2 个 bucket" ID="ID_54498366" CREATED="1643267308327" MODIFIED="1643267309487"/>
<node TEXT=" 如果触发了扩容操作，那么在很长时间里，map 的状态都是处于一个中间态" ID="ID_668272216" CREATED="1643267310352" MODIFIED="1643267333746"/>
<node TEXT="扩容中的map 有些 bucket 已经搬迁到新家，而有些 bucket 还待在老地方" ID="ID_892219995" CREATED="1643267343945" MODIFIED="1643267352161"/>
</node>
<node TEXT=" 2 倍扩容时，老 bucket 会分裂到 2 个新 bucket 中去" ID="ID_301444805" CREATED="1643267582925" MODIFIED="1643267584079"/>
<node TEXT="遍历操作，会按照 bucket 的序号顺序进行，碰到老 bucket 未搬迁的情况时，要在老 bucket 中找到将来要搬迁到新 bucket 来的 key" ID="ID_1516017432" CREATED="1643267565125" MODIFIED="1643267686512"/>
</node>
</node>
<node TEXT="map 中的 key 为什么是无序的" ID="ID_1287801834" CREATED="1643267628023" MODIFIED="1643267637156">
<node TEXT=" 在遍历 map 时，每次都是从一个随机值序号的 bucket 开始遍历" ID="ID_1277860588" CREATED="1643267735198" MODIFIED="1643267752873"/>
<node TEXT=" 并且是从这个 bucket 的一个随机序号的 cell 开始遍历出key value" ID="ID_1799922322" CREATED="1643267759022" MODIFIED="1643267778248"/>
<node TEXT=" 主要是避免给新手程序员带来误解" ID="ID_1453540049" CREATED="1643267812084" MODIFIED="1643267820687"/>
</node>
<node TEXT=" float 类型可以作为 map 的 key 吗" ID="ID_1267423341" CREATED="1643267829308" MODIFIED="1643267834882">
<node TEXT="只要是可比较的类型都可以作为 key" ID="ID_1246045706" CREATED="1643267855258" MODIFIED="1643270689116"/>
<node TEXT="可比较类型的共同特征是支持 == 和 != 操作符" ID="ID_1846253019" CREATED="1643267891587" MODIFIED="1643267917225"/>
<node TEXT=" 除开 slice，map，functions 这几种类型，其他类型都是 OK 的" ID="ID_700153769" CREATED="1643267867468" MODIFIED="1643267868218"/>
<node TEXT=" 布尔值、数字、字符串、指针、通道、接口类型、结构体、只包含上述类型的数组" ID="ID_463122174" CREATED="1643267877492" MODIFIED="1643267878480"/>
<node TEXT=" 如果是结构体，只有 hash 后的值相等以及字面值相等，才被认为是相同的 key" ID="ID_1948209982" CREATED="1643270657269" MODIFIED="1643270658424"/>
<node TEXT=" 当用 float64 作为 key 的时候，先要将其转成 unit64 类型，再插入 key 中" ID="ID_1312467831" CREATED="1643267988548" MODIFIED="1643267989539"/>
</node>
</node>
<node TEXT="字符串" FOLDED="true" ID="ID_233347491" CREATED="1629460082989" MODIFIED="1629460088906">
<node TEXT="概念" ID="ID_34243393" CREATED="1629461238057" MODIFIED="1629461240188">
<node TEXT=" 字符串底层是一个byte数组，可以和[]byte类型相互转换" ID="ID_472671892" CREATED="1629461168475" MODIFIED="1629461173759"/>
<node TEXT=" 字符串是由byte字节组成，所以字符串的长度是byte字节的长度" ID="ID_490685776" CREATED="1629461193657" MODIFIED="1629461196910"/>
<node TEXT=" rune类型用来表示utf8字符，一个rune字符由一个或多个byte组成" ID="ID_1870119893" CREATED="1629461204714" MODIFIED="1629461206227"/>
</node>
<node TEXT="两种类型" ID="ID_1860182840" CREATED="1629461053106" MODIFIED="1629461058638">
<node TEXT="unit8" ID="ID_1820008626" CREATED="1629461058778" MODIFIED="1629461065989">
<node TEXT=" 或者叫 byte 型" ID="ID_89574340" CREATED="1629461076986" MODIFIED="1629461078187"/>
<node TEXT="代表了ASCII码的一个字符" ID="ID_1491187738" CREATED="1629461079306" MODIFIED="1629461092137"/>
</node>
<node TEXT="rune" ID="ID_992884974" CREATED="1629461066234" MODIFIED="1629461067981">
<node TEXT=" 代表一个 UTF-8字符" ID="ID_1420357446" CREATED="1629461097586" MODIFIED="1629461098362"/>
</node>
</node>
<node TEXT="修改字符串" ID="ID_1758977713" CREATED="1629461257079" MODIFIED="1629461261101">
<node TEXT=" 要修改字符串，需要先将其转换成[]rune或[]byte，完成后再转换为string" ID="ID_337185827" CREATED="1629461267937" MODIFIED="1629461269037"/>
<node TEXT=" 无论哪种转换，都会重新分配内存，并复制字节数组" ID="ID_641525255" CREATED="1629461278234" MODIFIED="1629461280873"/>
<node ID="ID_485852428" CREATED="1629461424482" MODIFIED="1629461429175"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s1</font>&nbsp;:=&nbsp;<font color="#ce9178">&quot;hello&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">byteS1</font>&nbsp;:=&nbsp;[]<font color="#dcdcaa">byte</font>(s1)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;byteS1[<font color="#b5cea8">0</font>]&nbsp;=&nbsp;<font color="#ce9178">'H'</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#dcdcaa">string</font>(byteS1))
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s2</font>&nbsp;:=&nbsp;<font color="#ce9178">&quot;你好&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">runeS2</font>&nbsp;:=&nbsp;[]<font color="#dcdcaa">rune</font>(s2)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;runeS2[<font color="#b5cea8">0</font>]&nbsp;=&nbsp;<font color="#ce9178">'您'</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#dcdcaa">string</font>(runeS2))
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="字符串拼接" ID="ID_739159402" CREATED="1644650280828" MODIFIED="1644650287406">
<node TEXT=" &quot;+&quot;直接拼接" ID="ID_127975394" CREATED="1644652674373" MODIFIED="1644652688529">
<node TEXT=" 耗时最多，内存消耗最大的操作" ID="ID_276063036" CREATED="1644653698863" MODIFIED="1644653700065"/>
<node ID="ID_1806415663" CREATED="1644652993978" MODIFIED="1644652997505"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s</font>&nbsp;:= <font color="#ce9178">&quot;0&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">1</font>; i &lt; <font color="#b5cea8">10</font>; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">si</font>&nbsp;:= fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>, i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s += si
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="fmt.Sprint" ID="ID_389400445" CREATED="1644653183393" MODIFIED="1644653192390">
<node TEXT=" fmt.Sprintf 通常是用来格式化字符串的，一般不会用来拼接字符串" ID="ID_562550952" CREATED="1644839669659" MODIFIED="1644839670917"/>
<node ID="ID_187069598" CREATED="1644653394576" MODIFIED="1644653398080"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ls</font>&nbsp;:= []<font color="#4ec9b0">string</font>{<font color="#ce9178">&quot;a&quot;</font>, <font color="#ce9178">&quot;b&quot;</font>, <font color="#ce9178">&quot;c&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;= fmt.<font color="#dcdcaa">Sprint</font>(ls)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" strings.Join" ID="ID_1031110879" CREATED="1644653593585" MODIFIED="1644653595499">
<node TEXT=" 耗时小，而内存的分配次数也少" ID="ID_1300202275" CREATED="1644653728015" MODIFIED="1644653737592"/>
<node TEXT=" 底层就是使用的strings.Builder来处理数据" ID="ID_1305635112" CREATED="1644653827870" MODIFIED="1644653829080"/>
<node ID="ID_1773099474" CREATED="1644653633070" MODIFIED="1644653637192"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ls</font>&nbsp;:= []<font color="#4ec9b0">string</font>{<font color="#ce9178">&quot;a&quot;</font>, <font color="#ce9178">&quot;b&quot;</font>, <font color="#ce9178">&quot;c&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;= strings.<font color="#dcdcaa">Join</font>(ls, <font color="#ce9178">&quot;&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" bytes.Buffer" ID="ID_1378401142" CREATED="1644653930605" MODIFIED="1644653931658">
<node TEXT=" 在Go 1.10以前，使用buffer是一个较为高效的选择" ID="ID_448649289" CREATED="1644653943685" MODIFIED="1644653948900"/>
<node TEXT=" 使用var b bytes.Buffer 存放最终拼接好的字符串，一定程度上避免上面 string 每进行一次拼接操作就重新申请新的内存空间存放中间字符串的问题" ID="ID_1592027760" CREATED="1644653972782" MODIFIED="1644653976148"/>
<node TEXT=" 存在一个[]byte -&gt; string类型转换和内存拷贝的问题" ID="ID_820281375" CREATED="1644653982421" MODIFIED="1644653983217"/>
<node ID="ID_1140193029" CREATED="1644654202862" MODIFIED="1644654206435"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ls</font>&nbsp;:= []<font color="#4ec9b0">string</font>{<font color="#ce9178">&quot;a&quot;</font>, <font color="#ce9178">&quot;b&quot;</font>, <font color="#ce9178">&quot;c&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">bf</font>&nbsp;bytes.Buffer
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;ls {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bf.<font color="#dcdcaa">WriteString</font>(v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;= bf.<font color="#dcdcaa">String</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" strings.Builder" ID="ID_159770487" CREATED="1644653999893" MODIFIED="1644654000857">
<node TEXT=" 解决bytes.Buffer.String()存在的[]byte -&gt; string类型转换和内存拷贝问题" ID="ID_1427803891" CREATED="1644654020021" MODIFIED="1644654020960"/>
<node ID="ID_121543541" CREATED="1644654261828" MODIFIED="1644812527578"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ls</font>&nbsp;:= []<font color="#4ec9b0">string</font>{<font color="#ce9178">&quot;a&quot;</font>, <font color="#ce9178">&quot;b&quot;</font>, <font color="#ce9178">&quot;c&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">bf</font>&nbsp;strings.Builder
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;ls {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bf.<font color="#dcdcaa">WriteString</font>(v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;= bf.<font color="#dcdcaa">String</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="预分配内存[]byte" ID="ID_864870169" CREATED="1644839337270" MODIFIED="1644839359811">
<node TEXT=" 预分配内存，make第三个参数cap" ID="ID_1687269349" CREATED="1644839550954" MODIFIED="1644839758859"/>
<node TEXT="拼接的过程中，不需要进行字符串的拷贝，也不需要分配新的内存" ID="ID_1774246430" CREATED="1644839594057" MODIFIED="1644839604559"/>
<node ID="ID_1702077208" CREATED="1644839511452" MODIFIED="1644839515929"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ll</font>&nbsp;:= []<font color="#4ec9b0">string</font>{<font color="#ce9178">&quot;a&quot;</font>, <font color="#ce9178">&quot;b&quot;</font>, <font color="#ce9178">&quot;c&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">buf</font>&nbsp;:= <font color="#dcdcaa">make</font>([]<font color="#4ec9b0">byte</font>, <font color="#b5cea8">0</font>, <font color="#dcdcaa">len</font>(ll))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;ll {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">buf</font>&nbsp;= <font color="#dcdcaa">append</font>(buf, v...)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">s</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;= <font color="#dcdcaa">string</font>(buf)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 效率排序" ID="ID_691796751" CREATED="1644653881646" MODIFIED="1644653885289">
<node TEXT=" preByteConcat，性能最好，且内存消耗最小。因易用性不如strings.Builder" ID="ID_1149101831" CREATED="1644835822055" MODIFIED="1644839636280"/>
<node TEXT=" strings.Builder ≈ strings.Join &gt; strings.Buffer &gt; &quot;+&quot; &gt; fmt" ID="ID_1343351254" CREATED="1644653889837" MODIFIED="1644653891725"/>
<node TEXT=" 拼接的字符串比较小或数量不多，用&quot;+&quot;、 join 反而更好" ID="ID_862756210" CREATED="1644817021054" MODIFIED="1644817074387"/>
<node TEXT="string.Builder、strings.Buffer、[]byte 的内存是以倍数申请的，比&quot;+&quot;、&quot;fmt&quot;有更少申请内存次数与内存拷贝" ID="ID_81209666" CREATED="1644839798498" MODIFIED="1644839920478"/>
</node>
</node>
</node>
</node>
<node TEXT="面向对象" FOLDED="true" POSITION="right" ID="ID_1346992798" CREATED="1629461552809" MODIFIED="1629613067787">
<edge COLOR="#007c00"/>
<node TEXT="struct" ID="ID_766506046" CREATED="1629461718746" MODIFIED="1629461726899">
<node TEXT="go没有class，只有struct结构体" ID="ID_139897149" CREATED="1629461729561" MODIFIED="1629465931686"/>
<node TEXT="仅支持封装，不支持继承和多态" ID="ID_66158437" CREATED="1629461655147" MODIFIED="1629461672428"/>
<node ID="ID_464064755" CREATED="1629462956360" MODIFIED="1630983736978"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">treeNode</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;left,&nbsp;right&nbsp;*treeNode
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root</font>&nbsp;:=&nbsp;treeNode{value:&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.left</font>&nbsp;=&nbsp;&amp;treeNode{}&nbsp;&nbsp;<font color="#6a9955">//&nbsp;指向地址</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.right</font>&nbsp;=&nbsp;&amp;treeNode{<font color="#b5cea8">5</font>,&nbsp;<font color="#569cd6">nil</font>,&nbsp;<font color="#569cd6">nil</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.left.right</font>&nbsp;=&nbsp;<font color="#dcdcaa">new</font>(treeNode)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;new返回地址</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;left是指针，也可以用.right，而不像c++用-&gt;right</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(root)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 两个不同的struct的实例能不能比较" FOLDED="true" ID="ID_308316394" CREATED="1645431951344" MODIFIED="1645431955372">
<node TEXT=" 可比较的类型" ID="ID_1311706090" CREATED="1645433318365" MODIFIED="1645433334393">
<node TEXT="基础类型" ID="ID_1179336904" CREATED="1645433651032" MODIFIED="1645433767317">
<node TEXT=" Integer，Floating-point，String，Boolean，Complex(复数型)" ID="ID_1267504319" CREATED="1645433351233" MODIFIED="1645433352073"/>
<node TEXT="比较的是值是否相等，类型不同不能比较" ID="ID_387080804" CREATED="1645433657775" MODIFIED="1645441686533"/>
</node>
<node TEXT=" 复合类型" ID="ID_494724416" CREATED="1645433783350" MODIFIED="1645433784252">
<node TEXT="只有每个元素(成员)可比较，而且类型和值都相等时，两个复合元素才相等。有可以比较元素则报错" ID="ID_1405676209" CREATED="1645440584169" MODIFIED="1645443167458"/>
<node TEXT=" 数组和结构体，这种类型的比较是逐字段比较的" ID="ID_637334166" CREATED="1645433792736" MODIFIED="1645433793943"/>
<node TEXT="struct如果包含不可比较类型，用==、!= 直接比较会报错" ID="ID_1013113675" CREATED="1645433377369" MODIFIED="1645433460315"/>
<node TEXT="Array的长度是类型的一部分，长度相同再比较里面的元素" ID="ID_324623442" CREATED="1645440437297" MODIFIED="1645440465636"/>
</node>
<node TEXT="引用类型" ID="ID_837238226" CREATED="1645434073241" MODIFIED="1645434085051">
<node TEXT=" Pointer，Channel" ID="ID_1118708308" CREATED="1645433800629" MODIFIED="1645444313372"/>
<node TEXT=" 判断的是这两个引用类型存储的是不是同一个变量" ID="ID_1479188830" CREATED="1645434101553" MODIFIED="1645434102572"/>
<node TEXT=" 指针类型就按指针地址比较" ID="ID_1450044560" CREATED="1645433730422" MODIFIED="1645433731394"/>
<node ID="ID_619710680" CREATED="1645441321588" MODIFIED="1645441327460"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">c</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">cp</font>&nbsp;*<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">// nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(c == <font color="#569cd6">nil</font>, cp == <font color="#569cd6">nil</font>) <font color="#6a9955">// true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// c == cp // 类型不同不能比较</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">c1</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">c2</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 引用类型 比较的是地址</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(c1 == c2) <font color="#6a9955">// false</font>
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="接口类型  Interface" ID="ID_792288441" CREATED="1645444301835" MODIFIED="1645444324141">
<node TEXT="比较类型与值" ID="ID_1374635097" CREATED="1645446086937" MODIFIED="1645446097243">
<node TEXT=" 接口要确定一个变量需要两个基础属性：Type and Value" ID="ID_1273996858" CREATED="1645444531443" MODIFIED="1645444532589"/>
<node TEXT=" 接口只有动态类型和动态值都相同时，两个变量才相同" ID="ID_1557768018" CREATED="1645441662226" MODIFIED="1645441701024"/>
<node ID="ID_581296379" CREATED="1645446000618" MODIFIED="1645446003844"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">p</font>&nbsp;*<font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">// (T=*int, V=nil)</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;<font color="#569cd6">interface</font>{} <font color="#6a9955">// (T=nil, V=nil)</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(p == <font color="#569cd6">nil</font>) <font color="#6a9955">// true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i == <font color="#569cd6">nil</font>) <font color="#6a9955">// true</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">i</font>&nbsp;= p
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i == <font color="#569cd6">nil</font>) <font color="#6a9955">// (T=*int, V=nil) == (T=nil, V=nil) -&gt; false</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="不要从函数返回的空错误变量" ID="ID_1295857467" CREATED="1645445809917" MODIFIED="1645445822460">
<node TEXT=" 如果接口中已存储任何具体值，那么接口将不会是 nil" ID="ID_59364953" CREATED="1645445980475" MODIFIED="1645445981749"/>
<node ID="ID_1057977467" CREATED="1645445696604" MODIFIED="1645445776697"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">Foo</font>() <font color="#4ec9b0">error</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">err</font>&nbsp;*MyError = <font color="#569cd6">nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;err
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">err1</font>&nbsp;<font color="#4ec9b0">error</font>&nbsp;= <font color="#dcdcaa">Foo</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err1) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">// &lt;nil&gt;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err1 == <font color="#569cd6">nil</font>) <font color="#6a9955">// false</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">err2</font>&nbsp;<font color="#4ec9b0">error</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err2 == <font color="#569cd6">nil</font>) <font color="#6a9955">// true</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">err3</font>&nbsp;*MyError = &amp;MyError{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(err3 == <font color="#569cd6">nil</font>) <font color="#6a9955">// false</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="不可比较的类型" ID="ID_18150612" CREATED="1645433328002" MODIFIED="1645433332132">
<node TEXT=" Slice，Map，Function" ID="ID_64837357" CREATED="1645433365530" MODIFIED="1645433366494"/>
<node TEXT="Slice、Map、Function只能与nil比较，不然报错" ID="ID_1204578016" CREATED="1645440742703" MODIFIED="1645441178392"/>
</node>
<node TEXT="借助reflect.DeepEqual 函数 来对两个变量进行比较" ID="ID_1995025168" CREATED="1645432822220" MODIFIED="1645433246568">
<node TEXT=" reflect.DeepEqual函数可以用来比较两个任意类型的变量" ID="ID_1767772351" CREATED="1645441798817" MODIFIED="1645441799957"/>
<node TEXT="实现对slice和map的特殊比较" ID="ID_390317708" CREATED="1645441770858" MODIFIED="1645441805122">
<node ID="ID_805310713" CREATED="1645441499347" MODIFIED="1645441597291"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s1</font>&nbsp;:= []<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>, <font color="#b5cea8">2</font>, <font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s2</font>&nbsp;:= []<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>, <font color="#b5cea8">2</font>, <font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// s1 == s2 // raise, 切片只能与nil比较</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">eq</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;= reflect.<font color="#dcdcaa">DeepEqual</font>(s1, s2)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(eq) <font color="#6a9955">// true</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">m1</font>&nbsp;:= <font color="#569cd6">map</font>[<font color="#4ec9b0">int</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>: <font color="#b5cea8">1</font>, <font color="#b5cea8">2</font>: <font color="#b5cea8">2</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">m2</font>&nbsp;:= <font color="#569cd6">map</font>[<font color="#4ec9b0">int</font>]<font color="#4ec9b0">int</font>{<font color="#b5cea8">1</font>: <font color="#b5cea8">1</font>, <font color="#b5cea8">2</font>: <font color="#b5cea8">2</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">eq</font>&nbsp;= reflect.<font color="#dcdcaa">DeepEqual</font>(m1, m2)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(eq) <font color="#6a9955">// true</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="结构体比较" ID="ID_589828193" CREATED="1645442418821" MODIFIED="1645442425361">
<node ID="ID_841590646" CREATED="1645442426189" MODIFIED="1645442429411"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">User</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID <font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u1</font>&nbsp;:= User{ID: <font color="#ce9178">&quot;1&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u2</font>&nbsp;:= User{ID: <font color="#ce9178">&quot;1&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;u1 == u2:&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflect.<font color="#dcdcaa">DeepEqual</font>(u1, u2), <font color="#6a9955">// true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;u1 == u2) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">// true</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">User2</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID &nbsp;&nbsp;&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Child []<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u3</font>&nbsp;:= User2{ID: <font color="#ce9178">&quot;1&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">u4</font>&nbsp;:= User2{ID: <font color="#ce9178">&quot;1&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;u3 == u4:&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflect.<font color="#dcdcaa">DeepEqual</font>(u3, u4)) <font color="#6a9955">// true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// u3 == u4 // 内有不可比较的类型，报错</font>
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="切片中的结构体" ID="ID_1370417880" CREATED="1629462966503" MODIFIED="1629462990529">
<node TEXT="可以省略前面的treeNode类型" ID="ID_634329317" CREATED="1629462991223" MODIFIED="1629463994569"/>
<node ID="ID_1878377276" CREATED="1629463957181" MODIFIED="1629463960769"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;:=&nbsp;[]treeNode{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{value:&nbsp;<font color="#b5cea8">3</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{value:&nbsp;<font color="#b5cea8">4</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="创建结构体的工厂函数" ID="ID_678748798" CREATED="1629464048900" MODIFIED="1629465951100">
<node ID="ID_121792353" CREATED="1629462956360" MODIFIED="1630983775921"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">treeNode</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;left,&nbsp;right&nbsp;*treeNode
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">createNode</font>(value&nbsp;<font color="#4ec9b0">int</font>)&nbsp;*treeNode&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;返回的是局部变量的地址，给外部用</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;在c++中是会挂的，因为局部变量创建在栈上。</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;&nbsp;&nbsp;函数退出，局部变量立即销毁</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;&nbsp;&nbsp;在堆上分配，需要手动释放，因此有gc机制</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;在go中，不关心这个，要返回就创建在堆上，否则就是在栈上</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;&amp;treeNode{value:&nbsp;value}
      </div>
      <div>
        }
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root</font>&nbsp;:=&nbsp;treeNode{value:&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.left</font>&nbsp;=&nbsp;<font color="#dcdcaa">createNode</font>(<font color="#b5cea8">3</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(root,&nbsp;root.left)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="结构体的方法" FOLDED="true" ID="ID_1542388005" CREATED="1629465944634" MODIFIED="1629465959717">
<node ID="ID_1328708268" CREATED="1629466560953" MODIFIED="1629466645994"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">treeNode</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;left,&nbsp;right&nbsp;*treeNode
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(node&nbsp;treeNode)&nbsp;<font color="#dcdcaa">getValue</font>()&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;方法跟普通func没什么区别，区别只在调用形式上</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(node.value)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;node.value
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(node&nbsp;*treeNode)&nbsp;<font color="#dcdcaa">setValue</font>(value&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;go的所有参数传递都是值传递，修改要传指针</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">node.value</font>&nbsp;=&nbsp;value
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root</font>&nbsp;:=&nbsp;treeNode{value:&nbsp;<font color="#b5cea8">3</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">getValue</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">setValue</font>(<font color="#b5cea8">5</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">getValue</font>()
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="只有使用指针才能在方法中修改结构体的内容" ID="ID_1152741942" CREATED="1629466666554" MODIFIED="1629466693299"/>
<node TEXT="一般结构比较大可考虑指针接收者，减少拷贝" ID="ID_1963654593" CREATED="1629466998745" MODIFIED="1629467032685"/>
<node TEXT="一致性：如有指针接收者，最好是指针接收者" ID="ID_1855459625" CREATED="1629467054146" MODIFIED="1629467070036"/>
<node TEXT="值接收者是go特有的，谁能想到node.set的set方法修改的是复制node" ID="ID_1053459831" CREATED="1629467088307" MODIFIED="1629467171484"/>
<node TEXT="nil指针也可以调用方法" ID="ID_1117756103" CREATED="1629466693481" MODIFIED="1629466703052"/>
</node>
<node TEXT="封装" FOLDED="true" ID="ID_155242399" CREATED="1629467230873" MODIFIED="1629467234429">
<node TEXT="包" ID="ID_577036932" CREATED="1629467316705" MODIFIED="1629467318244">
<node TEXT="概念" ID="ID_1712796887" CREATED="1631004045340" MODIFIED="1631004047471">
<node TEXT=" Go语言使用包来组织源代码的，并实现命名空间的管理" ID="ID_59067075" CREATED="1631004053765" MODIFIED="1631004054937"/>
<node TEXT=" 任何一个Go语言程序必须属于一个包" ID="ID_712038701" CREATED="1631004063244" MODIFIED="1631004071175"/>
<node TEXT=" 每个go程序的开头要写上package &lt;pkg_name&gt;" ID="ID_1324475854" CREATED="1631004076918" MODIFIED="1631004079006"/>
</node>
<node TEXT="包的定义" ID="ID_1823972599" CREATED="1631004092171" MODIFIED="1631004122518">
<node TEXT=" 同一个目录下的同级的所有go文件应该属于一个包" ID="ID_929664550" CREATED="1631004129764" MODIFIED="1631004131036"/>
<node TEXT=" 包的名称可以跟目录不同名，不过建议同名" ID="ID_262887168" CREATED="1631004131692" MODIFIED="1631004136859"/>
<node TEXT=" 每个 Go 应用程序都包含一个名为 main 的包" ID="ID_130422968" CREATED="1630996613500" MODIFIED="1630996615078">
<node TEXT="有且只有一个main函数， 必须属于main包" ID="ID_1119176160" CREATED="1631004137451" MODIFIED="1631004289486"/>
<node TEXT=" main函数是Go语言程序的入口函数" ID="ID_1538033471" CREATED="1631004168203" MODIFIED="1631004303858"/>
<node TEXT=" 没有或者多于一个main函数，编译时都会报错" ID="ID_6242601" CREATED="1631004178155" MODIFIED="1631004313956"/>
</node>
<node TEXT="为结构体定义的方法要放在同一个包内，可以在不同的文件下" ID="ID_1127001902" CREATED="1629467362858" MODIFIED="1630984050269"/>
</node>
<node TEXT="包中标识符" ID="ID_494703588" CREATED="1631004226506" MODIFIED="1631004386371">
<node TEXT=" 标识符(比如结构体、变量、常量、函数等)" ID="ID_545863218" CREATED="1631004454847" MODIFIED="1631004457117"/>
<node TEXT="public" ID="ID_624976745" CREATED="1629467264043" MODIFIED="1629467267811">
<node TEXT="首字母大写" ID="ID_628664560" CREATED="1629467251635" MODIFIED="1629467263788"/>
<node TEXT="给另一个包引用标识符" ID="ID_1308279933" CREATED="1631004417832" MODIFIED="1631004484730"/>
</node>
<node TEXT="private" ID="ID_1523568228" CREATED="1629467267985" MODIFIED="1629467271363">
<node TEXT="首字母小写" ID="ID_770866626" CREATED="1629467251635" MODIFIED="1629467278548"/>
<node TEXT=" 只能限制在包内引用" ID="ID_833886053" CREATED="1631004444008" MODIFIED="1631004444973"/>
</node>
</node>
</node>
<node TEXT="扩展已有类型" ID="ID_833537938" CREATED="1629527701269" MODIFIED="1629527711113">
<node TEXT="扩充系统类型或别人的类型，没有继承的说法" ID="ID_461814466" CREATED="1629527542546" MODIFIED="1629527731568"/>
<node TEXT="使用组合" ID="ID_1149615390" CREATED="1629527569270" MODIFIED="1629527573369">
<node TEXT="最常用的做法" ID="ID_60238785" CREATED="1629533950554" MODIFIED="1629533956830"/>
<node ID="ID_667816555" CREATED="1629528714207" MODIFIED="1629528720419"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">//&nbsp;这里通过组合的形式，组合出myTreeNode</font>
      </div>
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">myTreeNode</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;*tree.Node
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">//&nbsp;在tree.Node只有前序遍历,&nbsp;myTreeNode扩展后序遍历</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;(myNode&nbsp;*myTreeNode)&nbsp;<font color="#dcdcaa">postOrder</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;myNode&nbsp;==&nbsp;<font color="#569cd6">nil</font>&nbsp;||&nbsp;myNode.node&nbsp;==&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">left</font>&nbsp;:=&nbsp;myTreeNode{myNode.node.Left}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">right</font>&nbsp;:=&nbsp;myTreeNode{myNode.node.Right}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;left.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;right.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;myNode.node.<font color="#dcdcaa">GetValue</font>()
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root</font>&nbsp;:=&nbsp;myTreeNode{&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">3</font>}}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.node.Left</font>&nbsp;=&nbsp;&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">1</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.node.Right</font>&nbsp;=&nbsp;&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">2</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用别名" ID="ID_893190875" CREATED="1629527565238" MODIFIED="1629532972909">
<node TEXT="最简单的做法，但由别名改成组合后，修改多" ID="ID_356181124" CREATED="1629533922266" MODIFIED="1629534005700"/>
<node ID="ID_747423685" CREATED="1629532329837" MODIFIED="1629532339637"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">package</font>&nbsp;queue
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Queue</font>&nbsp;[]<font color="#4ec9b0">int</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(q&nbsp;*Queue)&nbsp;<font color="#dcdcaa">Push</font>(i&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;*<font color="#9cdcfe">q</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(*q,&nbsp;i)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(q&nbsp;*Queue)&nbsp;<font color="#dcdcaa">Pop</font>()&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">head</font>&nbsp;:=&nbsp;(*q)[<font color="#b5cea8">0</font>]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;*<font color="#9cdcfe">q</font>&nbsp;=&nbsp;(*q)[<font color="#b5cea8">1</font>:]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;head
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1008403160" CREATED="1629532346556" MODIFIED="1629532373275"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">//&nbsp;learngo/queue/entry.main</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">q</font>&nbsp;:=&nbsp;queue.Queue{<font color="#b5cea8">1</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;q.<font color="#dcdcaa">Push</font>(<font color="#b5cea8">2</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(q)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;q.<font color="#dcdcaa">Pop</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(q)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用内嵌" ID="ID_516365614" CREATED="1629532973114" MODIFIED="1629532978598">
<node TEXT="有对组合的语法糖，省下一些代码" ID="ID_312111163" CREATED="1629534041633" MODIFIED="1629534089027"/>
<node ID="ID_1544040912" CREATED="1629533893737" MODIFIED="1629533898768"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">myTreeNode</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;*tree.Node&nbsp;<font color="#6a9955">//&nbsp;Embeddin内嵌，语法糖</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">//&nbsp;在tree.Node只有前序遍历,&nbsp;myTreeNode扩展后序遍历</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;(myNode&nbsp;*myTreeNode)&nbsp;<font color="#dcdcaa">postOrder</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;myNode&nbsp;==&nbsp;<font color="#569cd6">nil</font>&nbsp;||&nbsp;myNode.Node&nbsp;==&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">left</font>&nbsp;:=&nbsp;myTreeNode{myNode.Left}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">right</font>&nbsp;:=&nbsp;myTreeNode{myNode.Right}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;left.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;right.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;myNode.<font color="#dcdcaa">GetValue</font>()
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(myNode&nbsp;*myTreeNode)&nbsp;<font color="#dcdcaa">Traversal</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;MyTreeNode自己定义的Traversal方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;那MyNode.Traversal&nbsp;就不取&nbsp;MyNode.Node.Traversal</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;看起来像是子类覆写基类方法，其实只是个语法糖</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;浅层同名方法&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root</font>&nbsp;:=&nbsp;myTreeNode{&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">3</font>}}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.Left</font>&nbsp;=&nbsp;&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">1</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">root.Right</font>&nbsp;=&nbsp;&amp;tree.Node{Value:&nbsp;<font color="#b5cea8">2</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">postOrder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;root.<font color="#dcdcaa">Traversal</font>()
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="接口" FOLDED="true" ID="ID_699527961" CREATED="1629613102906" MODIFIED="1629613105276">
<node TEXT="通用概念" ID="ID_380786193" CREATED="1629614588819" MODIFIED="1635920444106">
<node TEXT="弱类型语言一般没有接口的概念" ID="ID_322212481" CREATED="1629614627033" MODIFIED="1629614656369"/>
<node TEXT=" 接口（interface）定义了一个对象的行为规范，只定义规范不实现，由具体的对象来实现规范的细节" ID="ID_242555503" CREATED="1629616451043" MODIFIED="1629616452086"/>
<node TEXT=" interface是一组method的集合，只关心行为（方法）不关心属性（数据）" ID="ID_52073914" CREATED="1629616501987" MODIFIED="1629616526147"/>
</node>
<node TEXT="定义" ID="ID_1990928691" CREATED="1629619868299" MODIFIED="1629619871361">
<node TEXT=" 在Go语言中接口（interface）是一种类型，一种抽象的类型。鸭子类型，类可以不实现接口" ID="ID_1241400182" CREATED="1629616470643" MODIFIED="1629616590790"/>
<node TEXT="Go是使用者定义接口，实现接口是隐式的" ID="ID_472290741" CREATED="1629625189788" MODIFIED="1629696828324"/>
<node TEXT=" 只要该类型有接口中的所有方法，就实现了这个接口，无须在该类型上显式声明实现了哪个接口" ID="ID_481849907" CREATED="1629620160828" MODIFIED="1629625722385"/>
<node TEXT=" 接口名：用type定义。一般会在单词后面添加er" ID="ID_844443244" CREATED="1629619924340" MODIFIED="1629619955846"/>
<node TEXT=" 参数列表和返回值列表中的参数变量名可以省略" ID="ID_1329677782" CREATED="1629620104587" MODIFIED="1629620105858"/>
</node>
<node TEXT="用途" ID="ID_988867586" CREATED="1629625640920" MODIFIED="1629625646077">
<node TEXT="只有当有两个或两个以上的具体类型必须以相同的方式进行处理时才需要定义接口" ID="ID_52539215" CREATED="1629625646351" MODIFIED="1635921566677"/>
<node TEXT=" 不要为了接口而写接口，那样只会增加不必要的抽象，导致不必要的运行时损耗" ID="ID_282311221" CREATED="1635921562420" MODIFIED="1635921563430"/>
</node>
<node TEXT="例子 download/retriever" ID="ID_528601037" CREATED="1629694049698" MODIFIED="1629696797237">
<node TEXT="download接收一个参数，是retriever类型。" ID="ID_490516752" CREATED="1629694121368" MODIFIED="1629694228486"/>
<node TEXT=" download使用retriever，是使用者，定义接口" ID="ID_272106182" CREATED="1629694228752" MODIFIED="1629694246487"/>
<node TEXT="retriever是实现者" ID="ID_1957806223" CREATED="1629694057937" MODIFIED="1629694194310"/>
<node TEXT="定义接口" ID="ID_410896452" CREATED="1629694386471" MODIFIED="1635920369463">
<node ID="ID_724843965" CREATED="1629694826365" MODIFIED="1629695456261"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Retriever</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;使用者所定义的接口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;实现者(具体模块)都要实现下面的方法，</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;才能被使用者使用，否则编译不过</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">Get</font>(url&nbsp;<font color="#4ec9b0">string</font>)&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">download</font>(r&nbsp;Retriever)&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;使用者，使用实现者r.Get方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;r.<font color="#dcdcaa">Get</font>(<font color="#ce9178">&quot;https://z.cn&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;r一定要有r.Get方法才算实现接口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;var&nbsp;r&nbsp;Retriever&nbsp;=&nbsp;mock.Retriever{Contents:&nbsp;&quot;asdfasdfasdf&quot;}</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">r</font>&nbsp;Retriever&nbsp;=&nbsp;real.Retriever{}&nbsp;&nbsp;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#dcdcaa">download</font>(r))
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="变量r为接口变量，可以是值(也有指向实现者的指针)，也可以是指针。" ID="ID_1977418567" CREATED="1629716987966" MODIFIED="1629717263510"/>
</node>
<node TEXT="实现接口" ID="ID_440791625" CREATED="1629695569007" MODIFIED="1635920373911">
<node TEXT="mock模块，假的实现" ID="ID_842350790" CREATED="1629695630351" MODIFIED="1629695644194">
<node ID="ID_1788332796" CREATED="1629695586471" MODIFIED="1629695589573"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">package</font>&nbsp;mock
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Retriever</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Contents&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(r&nbsp;Retriever)&nbsp;<font color="#dcdcaa">Get</font>(url&nbsp;<font color="#4ec9b0">string</font>)&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;r.Contents
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="real模块，具体实现" ID="ID_452352545" CREATED="1629695614583" MODIFIED="1629695626827">
<node ID="ID_392505889" CREATED="1629695606561" MODIFIED="1629695609242"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">package</font>&nbsp;real
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">import</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;io/ioutil&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;net/http&quot;</font>
      </div>
      <div>
        )
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Retriever</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(r&nbsp;Retriever)&nbsp;<font color="#dcdcaa">Get</font>(url&nbsp;<font color="#4ec9b0">string</font>)&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">res</font>,&nbsp;<font color="#9cdcfe">err</font>&nbsp;:=&nbsp;http.<font color="#dcdcaa">Get</font>(url)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;err&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;res.Body.<font color="#dcdcaa">Close</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">bytes</font>,&nbsp;<font color="#9cdcfe">_</font>&nbsp;:=&nbsp;ioutil.<font color="#dcdcaa">ReadAll</font>(res.Body)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">string</font>(bytes)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT=" 类型与接口的关系" ID="ID_1050064185" CREATED="1635921074358" MODIFIED="1635921075666">
<node TEXT=" 一个类型可以同时实现多个接口" ID="ID_1698216623" CREATED="1635921085836" MODIFIED="1635921140614">
<node TEXT="接口间彼此独立，不知道对方的实现" ID="ID_1269097934" CREATED="1635921141132" MODIFIED="1635921152728"/>
<node TEXT="比如Mover是接口，Sayer是接口，Dog类型可以实现这两个接口" ID="ID_430867343" CREATED="1635921087765" MODIFIED="1635921182528"/>
</node>
<node TEXT=" 多个类型实现同一接口" ID="ID_1314159179" CREATED="1635921161173" MODIFIED="1635921162177">
<node TEXT=" Mover接口 可以被Dog实现，也可以被Car实现" ID="ID_967553333" CREATED="1635921199197" MODIFIED="1635921230134"/>
</node>
</node>
<node TEXT="判断某个对象是否实现了某个接口" ID="ID_507782191" CREATED="1629694037353" MODIFIED="1635921299003">
<node TEXT=" 类型断言" ID="ID_1419950455" CREATED="1635921406595" MODIFIED="1635921408152">
<node TEXT="x.(T)" ID="ID_463126955" CREATED="1635921408558" MODIFIED="1635921414863"/>
<node TEXT=" x：表示类型为interface{}的变量" ID="ID_376415628" CREATED="1635921914018" MODIFIED="1635921915532"/>
<node TEXT=" T：表示断言x可能是的类型" ID="ID_1428230364" CREATED="1635921922387" MODIFIED="1635921923483"/>
</node>
<node TEXT="switch形式" ID="ID_1117427901" CREATED="1629698316245" MODIFIED="1635921933117">
<node ID="ID_72714348" CREATED="1629698306445" MODIFIED="1629698313231"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">switch</font>&nbsp;<font color="#9cdcfe">v</font>&nbsp;:=&nbsp;r.(type)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;*mock.Retriever:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;case1&quot;</font>,&nbsp;v.Contents)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;real.Retriever:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;case2&quot;</font>,&nbsp;v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="赋值判断形式" ID="ID_655845097" CREATED="1629698324446" MODIFIED="1635921955773">
<node ID="ID_1991468057" CREATED="1629698603767" MODIFIED="1635922009447"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">realR</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;r.(*mock.Retriever);&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(realR)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="表示任何类型" ID="ID_1133025614" CREATED="1629717306864" MODIFIED="1629717326140">
<node TEXT="空接口" ID="ID_1259444129" CREATED="1635921326220" MODIFIED="1635922066252">
<node TEXT="var x interface{}" ID="ID_1673796397" CREATED="1629717326976" MODIFIED="1635921325382"/>
<node TEXT=" 空接口可以存储任意类型值" ID="ID_812886088" CREATED="1635921524029" MODIFIED="1635921525140"/>
</node>
<node TEXT="可添加任何类型对象的切片" ID="ID_533210471" CREATED="1635920883380" MODIFIED="1635920908432">
<node ID="ID_1686878914" CREATED="1629717473606" MODIFIED="1629717477528"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;:=&nbsp;[]<font color="#569cd6">interface</font>{}{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s,&nbsp;<font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;=&nbsp;<font color="#dcdcaa">append</font>(s,&nbsp;<font color="#ce9178">&quot;a&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="接口组合" ID="ID_287918968" CREATED="1629718730362" MODIFIED="1629718738558">
<node ID="ID_56959816" CREATED="1629719244549" MODIFIED="1629719248878"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Retriever</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">Get</font>(url&nbsp;<font color="#4ec9b0">string</font>)&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">RetrieverPoster</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;组合Retriever接口，同时有Get方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Retriever
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">Post</font>(url&nbsp;<font color="#4ec9b0">string</font>,&nbsp;d&nbsp;<font color="#569cd6">map</font>[<font color="#4ec9b0">string</font>]<font color="#4ec9b0">string</font>)&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="系统接口" ID="ID_699105749" CREATED="1629693571545" MODIFIED="1629693576480">
<node TEXT="自定义结构体的打印输出" ID="ID_1921018529" CREATED="1629693714983" MODIFIED="1635926397005">
<node TEXT="实现String方法，即实现Stringer接口" ID="ID_983239094" CREATED="1629719857170" MODIFIED="1629719902934"/>
<node TEXT="fmt打印时，会优先用上层的String方法" ID="ID_1767770831" CREATED="1629719937802" MODIFIED="1629719982077"/>
<node ID="ID_115673459" CREATED="1629719736323" MODIFIED="1629719744213"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">A</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Contents&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(a&nbsp;A)&nbsp;<font color="#dcdcaa">String</font>()&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;&lt;A:&nbsp;</font><font color="#9cdcfe">%s</font><font color="#ce9178">&gt;&quot;</font>,&nbsp;a.Contents)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>&nbsp;:=&nbsp;A{<font color="#ce9178">&quot;asdf&quot;</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(a)&nbsp;&nbsp;<font color="#6a9955">//&nbsp;&lt;A:&nbsp;asdf&gt;</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="io.Reader" ID="ID_1438600104" CREATED="1629693718781" MODIFIED="1629720045830"/>
<node TEXT="io.Writer" ID="ID_1808895118" CREATED="1629720045994" MODIFIED="1629720052165"/>
</node>
<node TEXT="方法中的值接收者与指针接收者的区别" FOLDED="true" ID="ID_234750368" CREATED="1643271784785" MODIFIED="1643271923962">
<node TEXT="方法与函数的区别" ID="ID_695549769" CREATED="1643271945727" MODIFIED="1644405375786" VGAP_QUANTITY="6.9 pt">
<node TEXT=" 方法与函数的区别在于方法有一个接收者" ID="ID_1189330448" CREATED="1643271958304" MODIFIED="1644405375784"/>
<node TEXT=" 给一个函数添加一个接收者，那么它就变成了方法" ID="ID_20254440" CREATED="1643271979520" MODIFIED="1643271980706"/>
<node TEXT=" 方法能给用户自定义的类型添加新的行为" ID="ID_1859454599" CREATED="1643271955175" MODIFIED="1643271957852"/>
<node TEXT=" 接收者可以是值接收者，也可以是指针接收者" ID="ID_1672655184" CREATED="1643271986352" MODIFIED="1643271987337"/>
</node>
<node TEXT="方法中的值接收者与指针接收者的区别" ID="ID_1609194511" CREATED="1643273314650" MODIFIED="1644377161997">
<node TEXT=" 实现了接收者是值类型的方法，相当于隐式实现了接收者是指针类型的方法" ID="ID_1262910250" CREATED="1643272424558" MODIFIED="1643273358031"/>
<node TEXT=" 而实现了接收者是指针类型的方法，则只是实现了接收者是值类型的方法" ID="ID_632976167" CREATED="1643272431997" MODIFIED="1643273327273"/>
</node>
<node TEXT=" 方法中的值调用者与指针调用者的区别" ID="ID_1459369487" CREATED="1644377375627" MODIFIED="1644377387463">
<node TEXT=" 编译器针对方法做了语法糖转换，调用者不管是值类型或指针类型，会转换成方法对应的接收者类型" ID="ID_1074754059" CREATED="1643272324693" MODIFIED="1644377304944"/>
<node TEXT="指针类型调用者" ID="ID_1248756961" CREATED="1643274015788" MODIFIED="1643274111930">
<node TEXT="值接收者" ID="ID_860921191" CREATED="1643274117795" MODIFIED="1643274123190">
<node TEXT=" 指针被解引用为值" ID="ID_1360064863" CREATED="1643274184236" MODIFIED="1643274185358"/>
<node TEXT=" stefno.howOld() 实际上是 (*stefno).howOld()" ID="ID_572503166" CREATED="1643274131158" MODIFIED="1643274132070"/>
</node>
<node TEXT="指针接收者" ID="ID_1722161591" CREATED="1643274134044" MODIFIED="1643274159006">
<node TEXT=" 指针传参，会影响调用者" ID="ID_1727595097" CREATED="1643274196171" MODIFIED="1643274206766"/>
</node>
</node>
<node TEXT="值类型调用者" ID="ID_465767252" CREATED="1643274210556" MODIFIED="1643274220175">
<node TEXT=" 值接收者" ID="ID_413538292" CREATED="1643274229227" MODIFIED="1643274230123">
<node TEXT=" 方法会使用调用者的一个副本，类似于“传值”" ID="ID_1930433096" CREATED="1643274244083" MODIFIED="1643274244903"/>
</node>
<node TEXT=" 指针接收者" ID="ID_605483590" CREATED="1643274263571" MODIFIED="1643274264424">
<node TEXT=" 语法上 T 能直接调 *T 的方法仅仅是 Go 的语法糖" ID="ID_677894432" CREATED="1644408258222" MODIFIED="1644408259600"/>
<node TEXT=" 使用值的引用来调用方法" ID="ID_939699435" CREATED="1643274267906" MODIFIED="1643274268626"/>
<node TEXT=" qcrao.growUp() 实际上是 (&amp;qcrao).growUp()" ID="ID_120621683" CREATED="1643274273811" MODIFIED="1643274274772"/>
<node TEXT="如果只实现了指针接收者，值类型调用修改的方法，会隐式转成指针，修改值类型调用者的数据" ID="ID_420022014" CREATED="1643275168267" MODIFIED="1643281073496"/>
</node>
</node>
<node TEXT=" 不必严格符合接收者的类型" ID="ID_655339551" CREATED="1643272268992" MODIFIED="1643272270380">
<node TEXT="但如果指明变量的接口类型，那么接口的值接收者方法需要显式实现" ID="ID_778823283" CREATED="1643274302442" MODIFIED="1643274684804"/>
<node ID="ID_119945746" CREATED="1643273969053" MODIFIED="1644408850199"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Person</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;age <font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Animal</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">howOld</font>() <font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">growUp</font>()
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(p Person) <font color="#dcdcaa">howOld</font>() <font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;p.age
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(p *Person) <font color="#dcdcaa">growUp</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;p.age += <font color="#b5cea8">1</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// qcrao 是值类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">qcrao</font>&nbsp;:= Person{age: <font color="#b5cea8">18</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 值类型 调用接收者也是值类型的方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(qcrao.<font color="#dcdcaa">howOld</font>()) <font color="#6a9955">// 18</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 值类型 调用接收者是指针类型的方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;qcrao.<font color="#dcdcaa">growUp</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(qcrao.<font color="#dcdcaa">howOld</font>()) <font color="#6a9955">// 19</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// stefno 是指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">stefno</font>&nbsp;:= &amp;Person{age: <font color="#b5cea8">100</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 指针类型 调用接收者是值类型的方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(stefno.<font color="#dcdcaa">howOld</font>()) <font color="#6a9955">// 100</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 指针类型 调用接收者也是指针类型的方法</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;stefno.<font color="#dcdcaa">growUp</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(stefno.<font color="#dcdcaa">howOld</font>()) <font color="#6a9955">// 101</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// ----------------------</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 指针类型的接收者，正常</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// var stefno2 Animal = &amp;Person{age: 100}</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 值类型接收者没有实现growUp()方法, 报错</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 因此没有实现Animal接口，语法糖不对接口生效</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// var stefno3 Animal = Person{age: 100}</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT=" 检测类型是否实现了接口" FOLDED="true" ID="ID_357113701" CREATED="1643274885047" MODIFIED="1644405147776">
<node ID="ID_1260572779" CREATED="1644405314182" MODIFIED="1644405322326"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Person</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;age <font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Animal</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">howOld</font>() <font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">growUp</font>()
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(p Person) <font color="#dcdcaa">howOld</font>() <font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;p.age
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(p *Person) <font color="#dcdcaa">growUp</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;p.age += <font color="#b5cea8">1</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 指针类型的接收者，正常</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">_</font>&nbsp;Animal = (*Person)(<font color="#569cd6">nil</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">stefno2</font>&nbsp;Animal = &amp;Person{age: <font color="#b5cea8">100</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 值类型接收者没有实现growUp()方法, 报错</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 因此没有实现Animal接口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">_</font>&nbsp;Animal = Person{age: <font color="#b5cea8">100</font>}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">stefno3</font>&nbsp;Animal = Person{age: <font color="#b5cea8">100</font>}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 类型转换和断言的区别" FOLDED="true" ID="ID_631806199" CREATED="1644406504273" MODIFIED="1644406505147">
<node TEXT="概念" ID="ID_313883682" CREATED="1644406801830" MODIFIED="1644406803608"/>
<node TEXT="类型转换" ID="ID_1882894227" CREATED="1644406621937" MODIFIED="1644406628659">
<node ID="ID_1220968625" CREATED="1644406789718" MODIFIED="1644406794839"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i1</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;= <font color="#b5cea8">9</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">f1</font>&nbsp;:= <font color="#dcdcaa">float64</font>(i1)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">f2</font>&nbsp;<font color="#4ec9b0">float64</font>&nbsp;= <font color="#b5cea8">10.8</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">i2</font>&nbsp;:= <font color="#dcdcaa">int</font>(f2)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 断言" ID="ID_1275415893" CREATED="1644406816782" MODIFIED="1644406818368">
<node TEXT=" 类型转换、类型断言本质都是把一个类型转换成另外一个类型" ID="ID_1770547282" CREATED="1644406524354" MODIFIED="1644406525443"/>
<node TEXT=" 类型断言是对接口变量进行的操作" ID="ID_1766963968" CREATED="1644406534585" MODIFIED="1644406535654"/>
<node TEXT=" Go 中所有类型都实现了interface{}，因为空接口没有定义任何函数" ID="ID_1840457959" CREATED="1644406834606" MODIFIED="1644406867848"/>
<node TEXT="安全断言" ID="ID_448447782" CREATED="1644407378772" MODIFIED="1644407383493">
<node ID="ID_518263895" CREATED="1644407363810" MODIFIED="1644407367372"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// Person struct的实例, 指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 此时i的类型为interface{}</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;<font color="#569cd6">interface</font>{} = <font color="#dcdcaa">new</font>(Person)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// Animal interface的实例</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 将i类型断言转换为Animal类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s</font>, <font color="#9cdcfe">ok</font>&nbsp;:= i.(Animal)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(s, ok)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 利用 switch 语句判断接口的类型" ID="ID_1036589988" CREATED="1644407414548" MODIFIED="1644407415428">
<node TEXT=" 当命中一个 case 时，就会执行 case 中的语句" ID="ID_1765714699" CREATED="1644407426402" MODIFIED="1644407434150"/>
<node TEXT=" 可能符合多个case，因此 case 的顺序是很重要的" ID="ID_1664831998" CREATED="1644407434459" MODIFIED="1644407460822"/>
<node ID="ID_1462299730" CREATED="1644407596722" MODIFIED="1644408950872"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">judge</font>(v <font color="#569cd6">interface</font>{}) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%p</font><font color="#ce9178">&nbsp;</font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, &amp;v, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">switch</font>&nbsp;<font color="#9cdcfe">v</font>&nbsp;:= v.(type) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;<font color="#569cd6">nil</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;nil type[</font><font color="#9cdcfe">%T</font><font color="#ce9178">] </font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, v, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;Student:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;Student type[</font><font color="#9cdcfe">%T</font><font color="#ce9178">] </font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, v, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;*Student:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;*Student type[</font><font color="#9cdcfe">%T</font><font color="#ce9178">] </font><font color="#9cdcfe">%v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, v, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;unknow</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Student</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Name <font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Age &nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// i 是一个*Student类型, 指针类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// var i interface{} = new(Student)</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// i 也是一个*Student类型, 值为nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;<font color="#569cd6">interface</font>{} = (*Student)(<font color="#569cd6">nil</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// i 是 nil类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// var i interface{}</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">judge</font>(i)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node TEXT="函数式编程" FOLDED="true" POSITION="right" ID="ID_905592660" CREATED="1629720552136" MODIFIED="1629720564034">
<edge COLOR="#7c007c"/>
<node TEXT="概念" ID="ID_1427424060" CREATED="1629721429092" MODIFIED="1629721437385">
<node TEXT="&quot;正统&quot;定义" ID="ID_1959690031" CREATED="1629721447716" MODIFIED="1635939453350">
<node TEXT="不可变性：不能有状态，只有常量和函数" ID="ID_738737608" CREATED="1629721367284" MODIFIED="1629721390796"/>
<node TEXT="函数只能有一个参数" ID="ID_157191510" CREATED="1629721415500" MODIFIED="1629721422176"/>
</node>
<node TEXT="go对函数式编程的支持，体现在闭包上" ID="ID_1330208023" CREATED="1629720564272" MODIFIED="1629720620395"/>
<node TEXT="函数是一等公民：参数，变量，返回值都可以是函数" ID="ID_1439227103" CREATED="1629721147517" MODIFIED="1629721181616"/>
</node>
<node TEXT="累加" ID="ID_1349240619" CREATED="1629722116285" MODIFIED="1629722119087">
<node ID="ID_1602966496" CREATED="1629722016781" MODIFIED="1629722020318"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">adder</font>()&nbsp;<font color="#569cd6">func</font>(i&nbsp;<font color="#4ec9b0">int</font>)&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">sum</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#569cd6">func</font>(i&nbsp;<font color="#4ec9b0">int</font>)&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum&nbsp;+=&nbsp;i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;sum
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">add</font>&nbsp;:=&nbsp;<font color="#dcdcaa">adder</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">1</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">10</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;0+...+</font><font color="#9cdcfe">%d</font><font color="#ce9178">=</font><font color="#9cdcfe">%d</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;i,&nbsp;<font color="#dcdcaa">add</font>(i))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="给函数实现接口" ID="ID_846939497" CREATED="1629722502471" MODIFIED="1629722509141">
<node ID="ID_1855719881" CREATED="1629723568400" MODIFIED="1629723574958"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">intGen</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">fib</font>(n&nbsp;<font color="#4ec9b0">int</font>)&nbsp;intGen&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>,&nbsp;<font color="#9cdcfe">b</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>,&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;+=&nbsp;<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;i&nbsp;&gt;&nbsp;n&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;-<font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">a</font>,&nbsp;<font color="#9cdcfe">b</font>&nbsp;=&nbsp;b,&nbsp;a+b
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(b)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;b
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(g&nbsp;intGen)&nbsp;<font color="#dcdcaa">Read</font>(p&nbsp;[]<font color="#4ec9b0">byte</font>)&nbsp;(n&nbsp;<font color="#4ec9b0">int</font>,&nbsp;err&nbsp;<font color="#4ec9b0">error</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;实现Reader接口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">next</font>&nbsp;:=&nbsp;<font color="#dcdcaa">g</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;next&nbsp;==&nbsp;-<font color="#b5cea8">1</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;函数应该只返回EOF，以示对输入的优雅结束</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;-<font color="#b5cea8">1</font>,&nbsp;io.EOF
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;:=&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%d</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;next)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;strings.<font color="#dcdcaa">NewReader</font>(s).<font color="#dcdcaa">Read</font>(p)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">f</font>&nbsp;:=&nbsp;<font color="#dcdcaa">fib</font>(<font color="#b5cea8">10</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">scanner</font>&nbsp;:=&nbsp;bufio.<font color="#dcdcaa">NewScanner</font>(f)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;scanner.<font color="#dcdcaa">Scan</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(scanner.<font color="#dcdcaa">Text</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="资源管理与出错处理" FOLDED="true" POSITION="right" ID="ID_54672855" CREATED="1629726646261" MODIFIED="1629726656977">
<edge COLOR="#7c7c00"/>
<node TEXT="资源管理" ID="ID_1920692753" CREATED="1629728047835" MODIFIED="1629728056661">
<node TEXT="资源获取与释放" ID="ID_1632710789" CREATED="1635939764005" MODIFIED="1635939775455">
<node TEXT="Open/Close" ID="ID_942670671" CREATED="1629728030755" MODIFIED="1629728037870"/>
<node TEXT="Lock/UnLock" ID="ID_77748533" CREATED="1629728038027" MODIFIED="1629728046974"/>
<node TEXT="PrintHeader/PrintFooter" ID="ID_1392934048" CREATED="1629728125618" MODIFIED="1629728137274"/>
</node>
<node TEXT="defer" ID="ID_779420840" CREATED="1629726624110" MODIFIED="1629726658800">
<node TEXT="确保调用在函数结束时发生" ID="ID_606950470" CREATED="1629726706421" MODIFIED="1629726722274"/>
<node TEXT="参数在defer语句时才计算" ID="ID_277637544" CREATED="1629727806211" MODIFIED="1629727913133"/>
<node TEXT="defer列表后进先出" ID="ID_99722316" CREATED="1629727818509" MODIFIED="1629727831104"/>
<node ID="ID_1207663785" CREATED="1629726934055" MODIFIED="1629727085627"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">deferF</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;多个defer在最上面的最后调用,栈</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#b5cea8">0</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#b5cea8">2</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;defer&nbsp;在return后或panic时调用</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="写文件" ID="ID_190564770" CREATED="1629727542283" MODIFIED="1629727552535">
<node ID="ID_454401665" CREATED="1629727553468" MODIFIED="1629727559127"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">writeContend</font>(s&nbsp;<font color="#4ec9b0">string</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">file</font>,&nbsp;<font color="#9cdcfe">err</font>&nbsp;:=&nbsp;os.<font color="#dcdcaa">Create</font>(<font color="#ce9178">&quot;a.txt&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;err&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;file.<font color="#dcdcaa">Close</font>()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;先写入buffer，最后才写入文件</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">writer</font>&nbsp;:=&nbsp;bufio.<font color="#dcdcaa">NewWriter</font>(file)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;writer.<font color="#dcdcaa">Flush</font>()&nbsp;<font color="#6a9955">//&nbsp;buffer写入文件</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Fprintln</font>(writer,&nbsp;s)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="处理出错" ID="ID_646539999" CREATED="1629780198070" MODIFIED="1629780208294">
<node TEXT="读文件" ID="ID_250982742" CREATED="1629780208637" MODIFIED="1629780234369">
<node ID="ID_913594656" CREATED="1629781102882" MODIFIED="1629781107376"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">file</font>,&nbsp;<font color="#9cdcfe">err</font>&nbsp;:=&nbsp;os.<font color="#dcdcaa">OpenFile</font>(<font color="#ce9178">&quot;ab.txt&quot;</font>,&nbsp;os.O_EXCL|os.O_CREATE,&nbsp;<font color="#b5cea8">0666</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;err&nbsp;!=&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">pathError</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;err.(*os.PathError);&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;捕获路径错误，自行处理</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;Err:&nbsp;</font><font color="#9cdcfe">%s</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;pathError)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;未捕获错误，向上抛出</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;file.<font color="#dcdcaa">Close</font>()
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="自定义错误" ID="ID_1178160675" CREATED="1629781272579" MODIFIED="1629781281536">
<node TEXT="实现builtin.error接口" ID="ID_1017371865" CREATED="1629781338074" MODIFIED="1629781352013"/>
<node ID="ID_1577112433" CREATED="1629781739972" MODIFIED="1629781745104"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">AddrError</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Err&nbsp;&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Addr&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">//使用指针接收器实现该Error()接口</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;(e&nbsp;*AddrError)&nbsp;<font color="#dcdcaa">Error</font>()&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;e&nbsp;==&nbsp;<font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&lt;nil&gt;&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;:=&nbsp;e.Err
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;e.Addr&nbsp;!=&nbsp;<font color="#ce9178">&quot;&quot;</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">s</font>&nbsp;=&nbsp;<font color="#ce9178">&quot;address&nbsp;&quot;</font>&nbsp;+&nbsp;e.Addr&nbsp;+&nbsp;<font color="#ce9178">&quot;:&nbsp;&quot;</font>&nbsp;+&nbsp;s
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;s
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">m</font>()&nbsp;(<font color="#4ec9b0">string</font>,&nbsp;<font color="#4ec9b0">error</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;返回自义错误类型</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>,&nbsp;&amp;AddrError{}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="adde, ok := err.(*AddrError)" ID="ID_424464415" CREATED="1629781826997" MODIFIED="1629781867936"/>
</node>
</node>
</node>
<node TEXT="依赖管理" FOLDED="true" POSITION="right" ID="ID_1410184126" CREATED="1629534144583" MODIFIED="1629613063252">
<edge COLOR="#00007c"/>
<node TEXT="GOPATH" ID="ID_134043116" CREATED="1629534744266" MODIFIED="1629534747740">
<node TEXT="一个环境变量" ID="ID_72302815" CREATED="1629534782962" MODIFIED="1629534797909">
<node TEXT="~/go  (unix, linux)" ID="ID_774709371" CREATED="1629534803850" MODIFIED="1629534822491"/>
<node TEXT=" %USERPROFILE%\go  (windows)" ID="ID_828330993" CREATED="1629534822897" MODIFIED="1629534846227"/>
</node>
<node TEXT=" 所有的依赖都在GOPATH的src目录下找" ID="ID_711153705" CREATED="1629534798153" MODIFIED="1629535092109"/>
<node TEXT="问题" ID="ID_1328481006" CREATED="1629534910720" MODIFIED="1629534916043">
<node TEXT="所有的项目的依赖都放在了同一个目录下" ID="ID_98076177" CREATED="1629534916153" MODIFIED="1629534938996"/>
<node TEXT="依赖的版本冲突" ID="ID_1039075917" CREATED="1629535519374" MODIFIED="1629535538281"/>
</node>
</node>
<node TEXT="GOVENDOR" ID="ID_1846264807" CREATED="1629534748025" MODIFIED="1629534756485">
<node TEXT="每个项目都建一个vendor目录，放第三方依赖" ID="ID_943682880" CREATED="1629535663949" MODIFIED="1629535750090"/>
<node TEXT="项目引用依赖的时间，先在vendor目录找，再到GOPATH下找" ID="ID_1324727398" CREATED="1629535693038" MODIFIED="1629535721348"/>
<node TEXT="管理工具" ID="ID_1496844398" CREATED="1629535776269" MODIFIED="1629535784654">
<node TEXT="glide, dep , go dep" ID="ID_1765868929" CREATED="1629535784845" MODIFIED="1629535794423"/>
</node>
</node>
<node TEXT="go mod" ID="ID_402541467" CREATED="1629534756641" MODIFIED="1629534760620">
<node TEXT="项目下go.mod文件" ID="ID_1865265241" CREATED="1629535897220" MODIFIED="1629535907159"/>
<node TEXT="go env 查看 go mod是否已开启" ID="ID_1167097219" CREATED="1629536407460" MODIFIED="1629536428194"/>
<node TEXT="添加依赖" ID="ID_1899738849" CREATED="1629536700322" MODIFIED="1629536709437">
<node TEXT="方法一：命令行 go get -u go.uber.org/zap" ID="ID_1904317367" CREATED="1629536709578" MODIFIED="1629536744629"/>
<node TEXT="方法二： 代码中直接import &quot;go.uber.org/zap&quot;" ID="ID_929963566" CREATED="1629536725954" MODIFIED="1629536776496"/>
</node>
</node>
</node>
<node TEXT="目录管理" FOLDED="true" POSITION="right" ID="ID_942414936" CREATED="1629538082056" MODIFIED="1629613061518">
<edge COLOR="#7c0000"/>
<node TEXT="一个package下有多个文件，每个文件都可以有一个main函数，但同一个目录下的文件只能有一个main函数" ID="ID_1835481010" CREATED="1629538222197" MODIFIED="1629538267210"/>
<node TEXT="新建子目录，确保一个目录下只能有一个main" ID="ID_1225497589" CREATED="1629538137925" MODIFIED="1629538289498"/>
</node>
<node TEXT="包" FOLDED="true" POSITION="right" ID="ID_987921861" CREATED="1636015566335" MODIFIED="1636015568707">
<edge COLOR="#00ff00"/>
<node TEXT="概念" ID="ID_908723208" CREATED="1636095216939" MODIFIED="1636095218690">
<node TEXT=" 每个程序都由包（通常简称为 pkg）的概念组成" ID="ID_1996890146" CREATED="1636015942900" MODIFIED="1636015944183"/>
<node TEXT=" 可以使用自身的包或者从其它包中导入内容" ID="ID_605941133" CREATED="1636015953157" MODIFIED="1636015954200"/>
<node TEXT=" 如同其它一些编程语言中的类库或命名空间的概念，每个 Go 文件都属于且仅属于一个包" ID="ID_728485648" CREATED="1636015927390" MODIFIED="1636015928594"/>
</node>
<node TEXT=" package与目录的关系" ID="ID_1963969385" CREATED="1636095285723" MODIFIED="1636097756076">
<node TEXT="一个文件夹下只能有一个package，所有源文件必须使用相同的包名" ID="ID_1791070070" CREATED="1636095298594" MODIFIED="1636097651596"/>
<node TEXT=" 同一package下不同文件间可以直接调用" ID="ID_1512191792" CREATED="1636095345816" MODIFIED="1636095346588"/>
<node TEXT=" 如果多个文件夹下有同名package，其实只是彼此无关的package" ID="ID_1098271283" CREATED="1636095313224" MODIFIED="1636095320717"/>
<node TEXT=" 如果需要同时使用不同目录下的同名package，import时需要为每个目录指定package别名" ID="ID_618200726" CREATED="1636095331360" MODIFIED="1636095332485"/>
</node>
<node TEXT=" 包名与目录名的差异" ID="ID_1750142629" CREATED="1636095206263" MODIFIED="1636097738763">
<node TEXT=" import导入的是相对路径，非package名！" ID="ID_396924336" CREATED="1636095209715" MODIFIED="1636095215435"/>
<node TEXT=" 代码中引用包方法/对象/变量时，如调用package A中的a函数，使用A.a而非目录名" ID="ID_1434883725" CREATED="1636095258490" MODIFIED="1636095260526"/>
<node TEXT=" 习惯上将package名和目录名保持一致，如实例中package A尽量在./top/A文件夹下" ID="ID_533474929" CREATED="1636095245971" MODIFIED="1636095246894"/>
</node>
<node TEXT=" init" ID="ID_608441848" CREATED="1636097517386" MODIFIED="1636097518293">
<node TEXT=" 包在程序启动前的初始化入口" ID="ID_840996329" CREATED="1636097522010" MODIFIED="1636097522755"/>
<node TEXT=" 每个源码可以使用 1 个 init() 函数" ID="ID_932624859" CREATED="1636097550489" MODIFIED="1636097551332"/>
<node TEXT=" init() 函数会在程序执行前（main() 函数执行前）被自动调用" ID="ID_119840274" CREATED="1636097556113" MODIFIED="1636097558655"/>
<node TEXT=" 调用顺序为 main() 中引用的包，以深度优先顺序初始化" ID="ID_1907730042" CREATED="1636097563177" MODIFIED="1636097565205"/>
</node>
<node TEXT="在package中或package之间相互引用" ID="ID_641916458" CREATED="1636097012055" MODIFIED="1636097057234">
<node TEXT="import的包名是从 GOPATH 开始计算的路径，使用/进行路径分隔" ID="ID_1160276930" CREATED="1636097382171" MODIFIED="1636097395690"/>
<node TEXT="大写字母开头的变量方法暴露到包外，包内大小写随意" ID="ID_1731812100" CREATED="1636095374048" MODIFIED="1636095378195"/>
<node TEXT="别名导入" ID="ID_1757611147" CREATED="1636097434274" MODIFIED="1636097439294">
<node ID="ID_828733175" CREATED="1636097342883" MODIFIED="1636097350575"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">import</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;crypto/rand&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;mrand <font color="#ce9178">&quot;math/rand&quot;</font>&nbsp;<font color="#6a9955">// 将名称替换为mrand避免冲突</font>
      </div>
      <div>
        )
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="匿名导入" ID="ID_1966779772" CREATED="1636097441995" MODIFIED="1636097462085">
<node TEXT=" 只导入包但不使用包内类型和数值，只触发init()" ID="ID_961489576" CREATED="1636097467547" MODIFIED="1636097504383"/>
<node TEXT=" import (&#xa;    _ &quot;path/to/package&quot;&#xa;)" ID="ID_1816709654" CREATED="1636097481706" MODIFIED="1636097483933"/>
</node>
</node>
</node>
<node TEXT=" 测试" POSITION="right" ID="ID_751138129" CREATED="1629613059142" MODIFIED="1629801279332">
<edge COLOR="#00ffff"/>
<node TEXT="创建测试" ID="ID_737901362" CREATED="1636098218991" MODIFIED="1636098235865">
<node TEXT="测试文件的命名方式: xxx_test.go" ID="ID_761016106" CREATED="1629803796125" MODIFIED="1629803818714"/>
<node TEXT="测试函数以Test开头，testing.T类型入参" ID="ID_755874828" CREATED="1636098239398" MODIFIED="1636098348793"/>
<node TEXT="运行当前目录下所有测试 go test ." ID="ID_1286749907" CREATED="1629803819397" MODIFIED="1629803834982"/>
<node ID="ID_1423609478" CREATED="1636098327255" MODIFIED="1636098331091"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">TestAbc</font>(t *testing.T) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>&nbsp;:= <font color="#dcdcaa">calcTriangle</font>(<font color="#b5cea8">3</font>, <font color="#b5cea8">4</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;r != <font color="#b5cea8">5</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.<font color="#dcdcaa">Errorf</font>(<font color="#ce9178">&quot;err&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="表格驱动测试" ID="ID_401368969" CREATED="1629801799316" MODIFIED="1629801805012">
<node TEXT="分离测试数据与测试逻辑" ID="ID_526019137" CREATED="1629802604620" MODIFIED="1629802618081"/>
<node TEXT="可以部分失败，而不中断测试流程" ID="ID_1425618337" CREATED="1629802649936" MODIFIED="1629802670251"/>
<node ID="ID_743003163" CREATED="1629803900444" MODIFIED="1629803904396"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">TestTriangle</font>(t&nbsp;*testing.T)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">tData</font>&nbsp;:=&nbsp;[]<font color="#569cd6">struct</font>{&nbsp;a,&nbsp;b,&nbsp;c&nbsp;<font color="#4ec9b0">int</font>&nbsp;}{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#b5cea8">3</font>,&nbsp;<font color="#b5cea8">4</font>,&nbsp;<font color="#b5cea8">5</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#b5cea8">5</font>,&nbsp;<font color="#b5cea8">12</font>,&nbsp;<font color="#b5cea8">13</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font color="#b5cea8">3000</font>,&nbsp;<font color="#b5cea8">4000</font>,&nbsp;<font color="#b5cea8">5000</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>,&nbsp;<font color="#9cdcfe">c</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;tData&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">res</font>&nbsp;:=&nbsp;<font color="#dcdcaa">calcTriangle</font>(c.a,&nbsp;c.b)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;res&nbsp;!=&nbsp;c.c&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.<font color="#dcdcaa">Errorf</font>(<font color="#ce9178">&quot;calcTriangle(</font><font color="#9cdcfe">%d</font><font color="#ce9178">,&nbsp;</font><font color="#9cdcfe">%d</font><font color="#ce9178">),&nbsp;got&nbsp;</font><font color="#9cdcfe">%d</font><font color="#ce9178">,&nbsp;expect&nbsp;</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;c.a,&nbsp;c.b,&nbsp;res,&nbsp;c.c)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="测试代码覆盖率" ID="ID_1701996139" CREATED="1629866311076" MODIFIED="1629866326141">
<node TEXT="go test -coverfrofile=c.out" ID="ID_320929371" CREATED="1629866335791" MODIFIED="1629866347089"/>
<node TEXT=" go tool cover -html=c.out" ID="ID_695631351" CREATED="1629866347436" MODIFIED="1629866396919"/>
</node>
<node TEXT="性能测试" FOLDED="true" ID="ID_609682667" CREATED="1629866266863" MODIFIED="1629866275101">
<node TEXT="go test -bench ." ID="ID_1397192917" CREATED="1629866632568" MODIFIED="1629866643557"/>
<node ID="ID_192278312" CREATED="1629866593634" MODIFIED="1629866597568"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">BenchmarkTriangle</font>(b&nbsp;*testing.B)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">calcTriangle</font>(<font color="#b5cea8">3000</font>,&nbsp;<font color="#b5cea8">4000</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="profile" ID="ID_766447834" CREATED="1629866667583" MODIFIED="1629866677251">
<node TEXT="go test -bench . -cpuprofile cpu.out" ID="ID_1081043370" CREATED="1629866862711" MODIFIED="1629867375430"/>
<node TEXT="go tool pprof cpu.out" ID="ID_297093041" CREATED="1629866926895" MODIFIED="1629866936138">
<node TEXT="web" ID="ID_609481630" CREATED="1629867582026" MODIFIED="1629867583615"/>
</node>
</node>
<node TEXT="对较变量值之间的差异化" ID="ID_1454244935" CREATED="1645865344991" MODIFIED="1645865397579">
<node TEXT=" go get -u github.com/google/go-cmp/cmp" ID="ID_1342775225" CREATED="1645865672486" MODIFIED="1645865673823"/>
<node ID="ID_1280884226" CREATED="1645865821829" MODIFIED="1645865845174"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">diff</font>&nbsp;:= cmp.<font color="#dcdcaa">Diff</font>(u1, u2); diff != <font color="#ce9178">&quot;&quot;</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.<font color="#dcdcaa">Errorf</font>(<font color="#ce9178">&quot;user mismatch (-want +got):</font><font color="#d7ba7d">\n</font><font color="#9cdcfe">%s</font><font color="#ce9178">&quot;</font>, diff)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>

</richcontent>
</node>
</node>
</node>
<node TEXT="goroutine" FOLDED="true" POSITION="right" ID="ID_1222899550" CREATED="1629893767546" MODIFIED="1629893772052">
<edge COLOR="#ff0000"/>
<node TEXT="协程 Coroutine" ID="ID_116092602" CREATED="1629895259546" MODIFIED="1629903412868">
<node TEXT=" 子程序是协程的一个特例" ID="ID_229405073" CREATED="1629903413535" MODIFIED="1629903414662"/>
<node TEXT="非抢占式多任务处理，由协程主动交出控制权" ID="ID_1673680481" CREATED="1629895352048" MODIFIED="1629895376478"/>
<node TEXT="编译器、解释器、虚拟机层面的多任务" ID="ID_1314046442" CREATED="1629895376625" MODIFIED="1629895396299"/>
</node>
<node TEXT="go关键字" ID="ID_1429796619" CREATED="1629903397826" MODIFIED="1629903433578">
<node TEXT="函数前面加go调用，即变成协程函数，包括匿名函数" ID="ID_1572902605" CREATED="1629903436105" MODIFIED="1629903487733"/>
<node TEXT="主协程退出，则子协程销毁，main是主协程，因此这里有个sleep" ID="ID_1674610291" CREATED="1629955571536" MODIFIED="1629955623655"/>
<node ID="ID_715938645" CREATED="1629895241002" MODIFIED="1629895244766"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">1000</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(ii&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;go&quot;</font>,&nbsp;ii)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Millisecond)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="协程切换点" ID="ID_626282736" CREATED="1629903525573" MODIFIED="1629903535658">
<node TEXT="自动" ID="ID_1945888555" CREATED="1636353910973" MODIFIED="1636353915735">
<node TEXT="I/O, select" ID="ID_1692310747" CREATED="1629903546503" MODIFIED="1629903562393"/>
<node TEXT="channel" ID="ID_571161304" CREATED="1629904400860" MODIFIED="1629904403464"/>
<node TEXT="等待锁" ID="ID_1554388946" CREATED="1629904403637" MODIFIED="1629904412176"/>
<node TEXT="函数调用(有时)" ID="ID_602271911" CREATED="1629904610545" MODIFIED="1629904618933"/>
</node>
<node TEXT="手动换切上交控制权" ID="ID_384182526" CREATED="1629896572234" MODIFIED="1629904657391">
<node TEXT="runtim.Gosched()" ID="ID_1018208875" CREATED="1629904619121" MODIFIED="1629904627297"/>
<node ID="ID_494077873" CREATED="1629897070561" MODIFIED="1629897095431"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">arr</font>&nbsp;:=&nbsp;[<font color="#b5cea8">10</font>]<font color="#4ec9b0">int</font>{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">10</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(ii&nbsp;<font color="#4ec9b0">int</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arr[ii]++
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.<font color="#dcdcaa">Gosched</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Millisecond)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(arr)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;[615&nbsp;348&nbsp;132&nbsp;336&nbsp;228&nbsp;354&nbsp;1029&nbsp;1038&nbsp;959&nbsp;1010]</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="channel" FOLDED="true" ID="ID_1200567887" CREATED="1629955284033" MODIFIED="1629955288197">
<node TEXT="概念" ID="ID_1840141603" CREATED="1629955835784" MODIFIED="1629955840643">
<node TEXT=" channel是可以让一个goroutine发送特定值到另一个goroutine的通信机制，本质上是一个 MessageQueue" ID="ID_985349708" CREATED="1629955817144" MODIFIED="1636443454148"/>
<node TEXT=" channel在设计上本质就是一个有锁的环形队列，包括发送方队列、接收方队列、互斥锁等结构" ID="ID_1642538658" CREATED="1636357247488" MODIFIED="1636357248531"/>
<node TEXT="channel变量是一等公民，可以作为参数与返回值" ID="ID_1229615946" CREATED="1629978600596" MODIFIED="1629978625631"/>
<node TEXT="理论基础：Communication Sequential Process" ID="ID_1807734064" CREATED="1629979039823" MODIFIED="1629979063939"/>
</node>
<node TEXT="并发机制" ID="ID_1464939797" CREATED="1630329606957" MODIFIED="1630329615365">
<node TEXT=" goroutine 奉行通过通信（channel）来实现共享内存，而不是共享内存来通信" ID="ID_359962125" CREATED="1629955440363" MODIFIED="1636354733784"/>
<node TEXT="传统的并发控制，用Mutex, Cond, WaitGroup，共享内存的形式" ID="ID_1384026135" CREATED="1630329615503" MODIFIED="1630330955366"/>
<node TEXT=" 共享内存在不同的goroutine中容易发生竞态问题。为了保证数据交换的正确性，必须使用互斥量对内存进行加锁，这种做法势必造成性能问题" ID="ID_1134905589" CREATED="1629955777856" MODIFIED="1629955783078"/>
<node TEXT=" 尽量使用 channel实现并发；把 goroutine 当作免费的资源，随便用" ID="ID_1649811645" CREATED="1636354603210" MODIFIED="1636354616510"/>
</node>
<node TEXT="如何选择用channel还是Mutex？" ID="ID_1210566293" CREATED="1636443397132" MODIFIED="1636461063033">
<node TEXT="场景" ID="ID_520163810" CREATED="1636459705420" MODIFIED="1636459708637">
<node TEXT=" channel主要适用goroutine间数据流动的场景" ID="ID_56428835" CREATED="1636460410304" MODIFIED="1636460550692">
<node TEXT=" 传递数据的所有权，即把某个数据发送给其他协程" ID="ID_651020926" CREATED="1636460417207" MODIFIED="1636460418959"/>
<node TEXT=" 分发任务，每个任务都是一个数据" ID="ID_1427053961" CREATED="1636460422584" MODIFIED="1636460426745"/>
<node TEXT=" 交流异步结果，结果是一个数据" ID="ID_141413719" CREATED="1636460430905" MODIFIED="1636460431965"/>
</node>
<node TEXT=" mutex则适用于数据稳定的场景" ID="ID_1471243039" CREATED="1636459697725" MODIFIED="1636459698671">
<node TEXT=" 缓存" ID="ID_1216817873" CREATED="1636460458903" MODIFIED="1636460459792"/>
<node TEXT=" 状态" ID="ID_354306138" CREATED="1636460460240" MODIFIED="1636460470423"/>
</node>
<node TEXT="不要用channel做单纯的互斥操作" ID="ID_275036891" CREATED="1636459938707" MODIFIED="1636460038822"/>
<node TEXT=" 当只需锁定少量共享资源时，使用 Mutex 非常有用" ID="ID_1296535701" CREATED="1636459702942" MODIFIED="1636459704093"/>
</node>
<node TEXT="性能" ID="ID_1851074140" CREATED="1636459715596" MODIFIED="1636459719200">
<node TEXT=" channel与 Mutex 相比，Channel 的使用成本更高，性能更低" ID="ID_701296754" CREATED="1636459726062" MODIFIED="1636459727168"/>
<node TEXT=" channel内部实现包含Mutex，本身属于共享变量" ID="ID_398916962" CREATED="1636459732421" MODIFIED="1636459733291"/>
<node TEXT="channel 内部可能有 条件变量Cond ，用来等待或唤醒满足条件的goroutine" ID="ID_284287704" CREATED="1636459742333" MODIFIED="1636459833880"/>
<node TEXT=" channel 会使得当前的 goroutine 让出 cpu 给另一个 goroutine 获得执行机会，这个上下文的切换周期不低，至少远高于 Mutex 检查竞争状态的成本 ( 后者通常只是一个原子操作 )" ID="ID_1665958607" CREATED="1636459758813" MODIFIED="1636459759799"/>
</node>
<node TEXT="并发选型" ID="ID_817452664" CREATED="1636460630142" MODIFIED="1636460647353">
<node TEXT=" channel" ID="ID_382158335" CREATED="1636460643181" MODIFIED="1636460644007">
<node TEXT=" 关注数据的流动，就可以使用channel解决并发问题" ID="ID_1626703991" CREATED="1636460701343" MODIFIED="1636460704143"/>
<node TEXT=" channel不一定某个并发问题的最优解" ID="ID_603802298" CREATED="1636460717798" MODIFIED="1636460718772"/>
</node>
<node TEXT=" mutex" ID="ID_117824262" CREATED="1636460651559" MODIFIED="1636460653113">
<node TEXT=" 不流动的数据，如果存在并发访问，尝试使用sync.Mutex保护数据" ID="ID_1828009887" CREATED="1636460708933" MODIFIED="1636460710322"/>
</node>
<node TEXT=" channel plus mutex" ID="ID_601790683" CREATED="1636460658056" MODIFIED="1636460658794">
<node TEXT=" 一个大并发问题，可以分解成很多小的并发问题" ID="ID_1278844745" CREATED="1636460671671" MODIFIED="1636460672599"/>
<node TEXT=" 每个小的并发都可以单独选型：channel or mutex" ID="ID_57589366" CREATED="1636460679718" MODIFIED="1636460680458"/>
</node>
</node>
</node>
<node TEXT="定义" ID="ID_1161004244" CREATED="1629955856624" MODIFIED="1629955859139">
<node TEXT="声明 channel" ID="ID_917105492" CREATED="1636355864879" MODIFIED="1636355872659">
<node TEXT=" var 变量 chan 元素类型" ID="ID_1150394471" CREATED="1629955863935" MODIFIED="1629955864963"/>
<node ID="ID_1176969418" CREATED="1629955886375" MODIFIED="1629955891687"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">ch1</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;声明一个传递整型的通道</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">ch2</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;&nbsp;<font color="#6a9955">//&nbsp;声明一个传递布尔型的通道</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">ch3</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;[]<font color="#4ec9b0">int</font>&nbsp;<font color="#6a9955">//&nbsp;声明一个传递int切片的通道</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 声明的通道后需要使用make函数初始化之后才能使用" ID="ID_1730220637" CREATED="1629955918766" MODIFIED="1629955920127"/>
</node>
<node TEXT="初始化 channel" ID="ID_683765339" CREATED="1636355880856" MODIFIED="1636355889789">
<node TEXT=" make(chan 元素类型, [缓冲大小])" ID="ID_343979897" CREATED="1629955935159" MODIFIED="1629955935976"/>
<node TEXT=" 未初始化（为nil）的channel是不可以通信的" ID="ID_314502133" CREATED="1636355939342" MODIFIED="1636355940578"/>
<node TEXT=" 向nil的channel中入队会一直阻塞，导致死锁" ID="ID_336392943" CREATED="1636356085188" MODIFIED="1636356086361"/>
</node>
<node TEXT=" 单向通道" ID="ID_8130953" CREATED="1629979875194" MODIFIED="1629979876500">
<node TEXT="单向发送通道类型" ID="ID_992079504" CREATED="1629979892641" MODIFIED="1629979911608">
<node TEXT=" chan&lt;- int" ID="ID_1193549959" CREATED="1629979982024" MODIFIED="1629979984301"/>
</node>
<node TEXT="单向接收通道类型" ID="ID_631765829" CREATED="1629979897505" MODIFIED="1629979909513">
<node TEXT="&lt;-chan int" ID="ID_68641254" CREATED="1629979980584" MODIFIED="1629979994096"/>
</node>
</node>
<node TEXT=" 无缓冲的通道" ID="ID_1985812983" CREATED="1629979241694" MODIFIED="1629979244898">
<node TEXT=" c := make(chan int)" ID="ID_510541653" CREATED="1629979273638" MODIFIED="1629979284339"/>
<node TEXT="先有接收，才能再有发送" ID="ID_907827125" CREATED="1636356143060" MODIFIED="1636356159550">
<node TEXT=" 无缓冲的通道只有在有人接收值的时候才能发送值" ID="ID_607072287" CREATED="1629979263198" MODIFIED="1629979264283"/>
<node TEXT="通道没有接收方时发送会出错deadlock死锁错误" ID="ID_125932448" CREATED="1629979315661" MODIFIED="1629979348412"/>
</node>
<node TEXT="无缓冲通道也被称为同步通道" ID="ID_338776067" CREATED="1636356194196" MODIFIED="1636356433812">
<node TEXT=" 只有在接收方准备好后，否则发送方会一直阻塞在channel入队处" ID="ID_576081463" CREATED="1636356206683" MODIFIED="1636356397236"/>
<node TEXT=" 使用无缓冲通道进行通信将导致发送和接收的goroutine同步化" ID="ID_1477645044" CREATED="1636356216594" MODIFIED="1636356219288"/>
</node>
<node TEXT=" 无论是有无缓冲的channel在接收不到数据时都会阻塞，直到有数据可以接收" ID="ID_1156004765" CREATED="1636356039245" MODIFIED="1636356040704"/>
</node>
<node TEXT="有缓冲的通道" ID="ID_386968445" CREATED="1629956994226" MODIFIED="1629957005564">
<node TEXT="  c := make(chan int， 6)" ID="ID_182379645" CREATED="1629979507726" MODIFIED="1629979515680"/>
<node TEXT="超过缓冲大小，发送才会阻塞" ID="ID_109826181" CREATED="1629979516717" MODIFIED="1636356409929"/>
<node TEXT=" 无论是有无缓冲的channel在接收不到数据时都会阻塞，直到有数据可以接收" ID="ID_532879642" CREATED="1636356039245" MODIFIED="1636356040704"/>
</node>
</node>
<node TEXT=" 操作" FOLDED="true" ID="ID_457125403" CREATED="1629955948799" MODIFIED="1629955949656">
<node ID="ID_1064608647" CREATED="1629955965340" MODIFIED="1629955965340"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      发送（send）
    </p>
  </body>
</html>
</richcontent>
<node TEXT="正常channle" ID="ID_1457354995" CREATED="1636620843351" MODIFIED="1636620850016">
<node TEXT=" ch := make(chan int)" ID="ID_254291324" CREATED="1629956080989" MODIFIED="1629956081867"/>
<node TEXT=" ch &lt;- 10 // 把10发送到ch中" ID="ID_831371995" CREATED="1629956088757" MODIFIED="1629956089943"/>
</node>
</node>
<node TEXT="写channel 可能出现panic或阻塞的情况" ID="ID_1895932367" CREATED="1636706941789" MODIFIED="1636706983270">
<node TEXT="写正常channle有可能阻塞" ID="ID_1763217735" CREATED="1636620968286" MODIFIED="1636621023182">
<node TEXT="非缓冲channel有数据未被接收时写会阻塞" ID="ID_1115930834" CREATED="1636621023452" MODIFIED="1636621053702"/>
<node TEXT="缓冲channel满了写会阻塞" ID="ID_625717187" CREATED="1636621053931" MODIFIED="1636621077485"/>
</node>
<node TEXT="写nil channnel会阻塞" ID="ID_1746642036" CREATED="1636620858182" MODIFIED="1636620890258"/>
<node TEXT="写 closed channel会引发panic" ID="ID_967677282" CREATED="1636620890909" MODIFIED="1636620911074"/>
</node>
<node ID="ID_1856956236" CREATED="1629955965340" MODIFIED="1629955965340"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      接收(receive）
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" ch := make(chan int)" ID="ID_684934825" CREATED="1629956080989" MODIFIED="1629956081867"/>
<node TEXT=" x := &lt;- ch // 从ch中接收值并赋值给变量x" ID="ID_1539644402" CREATED="1629956098614" MODIFIED="1629978409057"/>
<node TEXT=" &lt;-ch       // 从ch中接收值，忽略结果" ID="ID_109442377" CREATED="1629978409997" MODIFIED="1629978411264"/>
<node TEXT="x, ok := &lt;- ch  // 通道关闭后，ok为False" ID="ID_365632007" CREATED="1629978412087" MODIFIED="1629978463137"/>
<node TEXT="for x: = range c{ // 通道关闭,跳出循环体 }" ID="ID_377517812" CREATED="1629978497463" MODIFIED="1629978536712"/>
</node>
<node TEXT="读channel 可能出现panic或阻塞的情况" ID="ID_1448195140" CREATED="1636706992265" MODIFIED="1636707006388">
<node TEXT=" 读无数据channel会阻塞，无论channel是否有缓冲" ID="ID_204776292" CREATED="1636707105319" MODIFIED="1636707168954"/>
<node TEXT=" 读nil channnel会阻塞" ID="ID_1989007877" CREATED="1636707025217" MODIFIED="1636707035131"/>
<node TEXT="读closed channel不会panic，会读到零值。" ID="ID_98518463" CREATED="1636707053734" MODIFIED="1636707086908"/>
</node>
<node ID="ID_234648043" CREATED="1629955965342" MODIFIED="1629955965342"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      关闭（close）
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" ch := make(chan int)" ID="ID_537080853" CREATED="1629956080989" MODIFIED="1629956081867"/>
<node TEXT="关闭通道不是必须的。" ID="ID_984506356" CREATED="1629956138997" MODIFIED="1629956157872"/>
<node TEXT="永远是发送方关闭通道，接收方可感知" ID="ID_1651377166" CREATED="1629978294097" MODIFIED="1629978328317"/>
<node TEXT=" close(ch)" ID="ID_231109444" CREATED="1629956105701" MODIFIED="1629956106583"/>
<node TEXT=" 关闭后的通道" ID="ID_1020705336" CREATED="1629956195596" MODIFIED="1629956196417">
<node TEXT=" 对一个关闭的通道再发送值就会导致panic" ID="ID_1032499527" CREATED="1629956201197" MODIFIED="1629956202071"/>
<node TEXT=" 对一个关闭的通道进行接收会一直获取值直到通道为空" ID="ID_1065008746" CREATED="1629956214166" MODIFIED="1629956215403"/>
<node TEXT=" 对一个关闭的并且没有值的通道执行接收操作会得到对应类型的零值" ID="ID_1655035820" CREATED="1629956224485" MODIFIED="1629956225167"/>
<node TEXT=" 关闭一个已经关闭的通道会导致panic" ID="ID_1184964602" CREATED="1629956230204" MODIFIED="1629956231687"/>
</node>
</node>
<node TEXT="关闭channel 可能出现panic或阻塞的情况" ID="ID_1288299049" CREATED="1636707176126" MODIFIED="1636707204426">
<node TEXT="关闭channel没有阻塞的情况" ID="ID_65363340" CREATED="1636707253279" MODIFIED="1636707272370"/>
<node TEXT="关闭 nil channel会引起panic" ID="ID_1415018936" CREATED="1636707205487" MODIFIED="1636707222386"/>
<node TEXT="多次关闭channle会引起panic" ID="ID_1526005275" CREATED="1636707222680" MODIFIED="1636707245244"/>
</node>
<node TEXT="如何优雅地关闭channel" ID="ID_88247837" CREATED="1636707354831" MODIFIED="1636707370074">
<node TEXT="当前处境" ID="ID_1255447586" CREATED="1636707652966" MODIFIED="1636707668433">
<node TEXT=" 感知channel的关闭状态不具幂等性" ID="ID_830619833" CREATED="1636707813189" MODIFIED="1636707814213">
<node TEXT="感知channel的关闭状态是会改变channel的" ID="ID_31803871" CREATED="1636707390566" MODIFIED="1636707483682"/>
<node TEXT=" v, ok := &lt;-ch  ok为channel的关闭状态，但获取这个状态却从channel中取出了数据，不具幂等性" ID="ID_704914940" CREATED="1636707491750" MODIFIED="1636707597135"/>
</node>
<node TEXT=" 关闭一个 closed channel 会导致 panic" ID="ID_118608232" CREATED="1636707746870" MODIFIED="1636707748542">
<node TEXT="如果关闭 channel 的一方在不知道 channel 是否处于关闭状态时就去贸然关闭 channel 是很危险的事情" ID="ID_600656470" CREATED="1636707749581" MODIFIED="1636707777985"/>
</node>
<node TEXT=" 向一个 closed channel 发送数据会导致 panic" ID="ID_1229326945" CREATED="1636707871630" MODIFIED="1636707872556">
<node TEXT=" 如果向 channel 发送数据的一方不知道 channel 是否处于关闭状态时就去贸然向 channel 发送数据是很危险的事情" ID="ID_683167682" CREATED="1636707881766" MODIFIED="1636707882960"/>
</node>
</node>
<node TEXT=" 关闭 channel 的原则" ID="ID_835202446" CREATED="1636707649305" MODIFIED="1636707650937">
<node TEXT=" 不要从一个 receiver 侧关闭 channel" ID="ID_96824910" CREATED="1636707914684" MODIFIED="1636707915591"/>
<node TEXT=" 不要在有多个 sender 时，关闭 channel" ID="ID_1577089474" CREATED="1636707924589" MODIFIED="1636707936104"/>
<node TEXT=" 向 channel 发送元素的就是 sender，因此 sender 可以决定何时不发送数据，并且关闭 channel" ID="ID_276111265" CREATED="1636707960519" MODIFIED="1636707961634"/>
<node TEXT=" 但是如果有多个 sender，某个 sender 同样没法确定其他 sender 的情况，这时也不能贸然关闭 channel" ID="ID_947852558" CREATED="1636707971188" MODIFIED="1636707972160"/>
<node TEXT="对于一个 channel，如果最终没有任何 goroutine 引用它，不管 channel 有没有被关闭，最终都会被 gc 回收" ID="ID_979507758" CREATED="1636708635789" MODIFIED="1636708650218"/>
</node>
<node TEXT=" 不那么优雅地关闭 channel 的方法" ID="ID_1609247503" CREATED="1636708066373" MODIFIED="1636708067275">
<node TEXT=" 使用 defer-recover 机制" ID="ID_1124913445" CREATED="1636708101698" MODIFIED="1636708102494">
<node TEXT=" 放心大胆地关闭 channel 或者向 channel 发送数据" ID="ID_1948808092" CREATED="1636708116634" MODIFIED="1636708117632"/>
<node TEXT=" 发生了 panic，有 defer-recover 在兜底" ID="ID_267607282" CREATED="1636708122692" MODIFIED="1636708123483"/>
</node>
<node TEXT=" 使用 sync.Once 来保证只关闭一次" ID="ID_1954320549" CREATED="1636708155739" MODIFIED="1636708162993"/>
</node>
<node TEXT="优雅地关闭 channel 的方法" ID="ID_1697636443" CREATED="1636708241480" MODIFIED="1636708252800">
<node TEXT=" 只有一个 sender 的情况" ID="ID_905581845" CREATED="1636708195450" MODIFIED="1636708196275">
<node TEXT="有可能有一个或多个receiver" ID="ID_1044272191" CREATED="1636708199531" MODIFIED="1636708213615"/>
<node TEXT=" 直接从 sender 端关闭就好了" ID="ID_507935829" CREATED="1636708226170" MODIFIED="1636708228286"/>
</node>
<node TEXT="多个sender的情况" ID="ID_708875373" CREATED="1636708229459" MODIFIED="1636708241207">
<node ID="ID_171670048" CREATED="1636708275831" MODIFIED="1636975157715"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <span data-slate-fragment="JTdCJTIyb2JqZWN0JTIyJTNBJTIyZG9jdW1lbnQlMjIlMkMlMjJkYXRhJTIyJTNBJTdCJTdEJTJDJTIybm9kZXMlMjIlM0ElNUIlN0IlMjJvYmplY3QlMjIlM0ElMjJibG9jayUyMiUyQyUyMnR5cGUlMjIlM0ElMjJwYXJhZ3JhcGglMjIlMkMlMjJpc1ZvaWQlMjIlM0FmYWxzZSUyQyUyMmRhdGElMjIlM0ElN0IlN0QlMkMlMjJub2RlcyUyMiUzQSU1QiU3QiUyMm9iamVjdCUyMiUzQSUyMnRleHQlMjIlMkMlMjJsZWF2ZXMlMjIlM0ElNUIlN0IlMjJvYmplY3QlMjIlM0ElMjJsZWFmJTIyJTJDJTIydGV4dCUyMiUzQSUyMk4lMjAlRTQlQjglQUElMjBzZW5kZXIlRUYlQkMlOEMlRTQlQjglODAlRTQlQjglQUElMjByZWNpdmVyJTIyJTJDJTIybWFya3MlMjIlM0ElNUIlNUQlMkMlMjJzZWxlY3Rpb25zJTIyJTNBJTVCJTVEJTdEJTVEJTJDJTIya2V5JTIyJTNBJTIyZmEzOGQ2ZTg1ZGMwNGE4NTlhNTM5ZTk5NjM0Yjg3NDQlMjIlN0QlNUQlMkMlMjJrZXklMjIlM0ElMjJlNzMzMTMwNGUxNmI0ZWZhOTgzNmU4NWRkYjFjMzU2ZSUyMiU3RCU1RCUyQyUyMmtleSUyMiUzQSUyMjBmODgwNTAzMmFkMDRhM2NhMWFkNzMyMDI1M2FlNTU3JTIyJTdE" style="white-space: pre">N 个 sender，一个 reciver</span>
  </body>
</html>
</richcontent>
<node TEXT=" 增加一个传递关闭信号的 channel" ID="ID_700283132" CREATED="1636708332608" MODIFIED="1636708333738"/>
<node TEXT=" receiver 通过信号 channel 下达关闭数据 channel 指令" ID="ID_95935347" CREATED="1636708342121" MODIFIED="1636708343004"/>
<node TEXT=" senders 监听到关闭信号后，停止接收数据" ID="ID_1943579076" CREATED="1636708348313" MODIFIED="1636708349243"/>
<node ID="ID_1565123375" CREATED="1636709519389" MODIFIED="1636709972955"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;rand.<font color="#dcdcaa">Seed</font>(time.<font color="#dcdcaa">Now</font>().<font color="#dcdcaa">UnixNano</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">const</font>&nbsp;<font color="#9cdcfe">Max</font>&nbsp;= <font color="#b5cea8">100</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">const</font>&nbsp;<font color="#9cdcfe">NumSenders</font>&nbsp;= <font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">dataCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">100</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">stopCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// senders</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; NumSenders; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(j <font color="#4ec9b0">int</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-stopCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;Stopped&quot;</font>, j)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 此时收到stopCh已经关闭了，所以这个goroutine就会立即退出</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当没有goroutine引用dataCh时，dataCh会被gc回收，隐式关闭</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 如果没有收到stopCh关闭，那么这个goroutine就会一直循环发送数据</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;dataCh &lt;- rand.<font color="#dcdcaa">Intn</font>(Max):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// the receiver</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">value</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;dataCh {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;value == Max-<font color="#b5cea8">1</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;关闭stopCh, 此时所有的sender都会收到信号&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">close</font>(stopCh)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(value)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Hour):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" N 个 sender， M 个 receiver" ID="ID_42647369" CREATED="1636708274553" MODIFIED="1636708285230">
<node TEXT="dataCh" ID="ID_1190861970" CREATED="1636976010572" MODIFIED="1636976027026">
<node TEXT="业务数据处理的频道" ID="ID_1117977471" CREATED="1636976027589" MODIFIED="1636976056065"/>
<node TEXT="sender生产数据，receiver接收并处理数据" ID="ID_1008112456" CREATED="1636976061740" MODIFIED="1636976109743"/>
</node>
<node TEXT="goStop 主持人channel" ID="ID_213251536" CREATED="1636724529741" MODIFIED="1636724565817">
<node TEXT="当主持人收到goStop时，关闭StopCh" ID="ID_848083944" CREATED="1636724566164" MODIFIED="1636724684214"/>
<node TEXT="引入主持人是为了只关闭一次StopCh" ID="ID_96952524" CREATED="1636724635971" MODIFIED="1636724704765"/>
<node TEXT="因此goStop为缓存大小为1的channel" ID="ID_1006779874" CREATED="1636724705123" MODIFIED="1636724723069"/>
<node TEXT="当goStop接取信息时，会关闭stopCh" ID="ID_55384455" CREATED="1636724723259" MODIFIED="1636975941092"/>
</node>
<node TEXT="stopCh" ID="ID_25036062" CREATED="1636724466040" MODIFIED="1636724482612">
<node TEXT="当stopCh关闭时，通知所有sender和receiver退出goroutine" ID="ID_699032927" CREATED="1636724483821" MODIFIED="1636724669614"/>
<node TEXT="此时dataCh无goroutine引用，会被gc掉" ID="ID_1899888971" CREATED="1636976129500" MODIFIED="1636976147552"/>
<node TEXT="因为receiver是根据信号退出的，此时dataCh仍会有数据，一般业务逻辑会有处理完再退出，或有特殊处理" ID="ID_1748209816" CREATED="1636976232506" MODIFIED="1636976344686"/>
</node>
<node TEXT="main" FOLDED="true" ID="ID_536865751" CREATED="1636976465440" MODIFIED="1636976467451">
<node ID="ID_592990923" CREATED="1636976583040" MODIFIED="1636976587169"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;rand.<font color="#dcdcaa">Seed</font>(time.<font color="#dcdcaa">Now</font>().<font color="#dcdcaa">UnixNano</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">const</font>&nbsp;<font color="#9cdcfe">Max</font>&nbsp;= <font color="#b5cea8">100</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">const</font>&nbsp;<font color="#9cdcfe">NumReceivers</font>&nbsp;= <font color="#b5cea8">3</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">const</font>&nbsp;<font color="#9cdcfe">NumSenders</font>&nbsp;= <font color="#b5cea8">10</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">dataCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">100</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">stopCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 它必须是一个缓冲的通道,且缓冲大小为1，因为channel只能关闭一次</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当缓冲区满时，发送者将阻塞直到收到stopCh的关闭信号</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">toStop</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>, <font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">stoppedBy</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// moderator</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">stoppedBy</font>&nbsp;= &lt;-toStop
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">close</font>(stopCh)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(stoppedBy, <font color="#ce9178">&quot;率先触发了主持人的关闭信号&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// senders</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">ActSenders</font>(NumSenders, Max, dataCh, toStop, stopCh)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// receivers</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">ActReceivers</font>(NumReceivers, Max, dataCh, toStop, stopCh)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">counterCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">CountUnusedValue</font>(counterCh, dataCh, stopCh)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;-counterCh
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="receiver" FOLDED="true" ID="ID_1771798859" CREATED="1636724538484" MODIFIED="1636976461141">
<node ID="ID_1871276284" CREATED="1636976441810" MODIFIED="1636976449230"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">ActReceivers</font>(NumReceivers <font color="#4ec9b0">int</font>, Max <font color="#4ec9b0">int</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;dataCh <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, toStop <font color="#569cd6">chan</font>&nbsp; <font color="#4ec9b0">string</font>, stopCh <font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{}) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; NumReceivers; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(id <font color="#4ec9b0">string</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-stopCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当收到stopCh信号时，所有的receiver都应该退出</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 此时dataCh可能还有数据，但没有receiver来消费</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;&nbsp;+ id + <font color="#ce9178">&quot; 收到主持人的停止信号，退出&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">value</font>&nbsp;:= &lt;-dataCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;&nbsp;value == Max-<font color="#b5cea8">1</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当value为Max-1时，recetiver发送停止信号到toStop</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 这里有可能有多个receiver同时发送停止信号</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 因此toStop的缓冲区大小为1, 只有一个关闭信号能够被触发</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;toStop &lt;- <font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;+ id:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;&nbsp;+ id + <font color="#ce9178">&quot; - 向主持人发送停止信号&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;recetiver#&quot;</font>+id+<font color="#ce9178">&quot;收到数据：&quot;</font>, value)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(strconv.<font color="#dcdcaa">Itoa</font>(i))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="sender" FOLDED="true" ID="ID_589259004" CREATED="1636976461498" MODIFIED="1636976464173">
<node ID="ID_1261968909" CREATED="1636976492232" MODIFIED="1636976498014"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">ActReceivers</font>(NumReceivers <font color="#4ec9b0">int</font>, Max <font color="#4ec9b0">int</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;dataCh <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, toStop <font color="#569cd6">chan</font>&nbsp; <font color="#4ec9b0">string</font>, stopCh <font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{}) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; NumReceivers; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(id <font color="#4ec9b0">string</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-stopCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当收到stopCh信号时，所有的receiver都应该退出</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 此时dataCh可能还有数据，但没有receiver来消费</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;&nbsp;+ id + <font color="#ce9178">&quot; 收到主持人的停止信号，退出&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">value</font>&nbsp;:= &lt;-dataCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;&nbsp;value == Max-<font color="#b5cea8">1</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 当value为Max-1时，recetiver发送停止信号到toStop</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 这里有可能有多个receiver同时发送停止信号</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 因此toStop的缓冲区大小为1, 只有一个关闭信号能够被触发</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;toStop &lt;- <font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;+ id:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;receiver#&quot;</font>&nbsp;&nbsp;+ id + <font color="#ce9178">&quot; - 向主持人发送停止信号&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;recetiver#&quot;</font>+id+<font color="#ce9178">&quot;收到数据：&quot;</font>, value)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(strconv.<font color="#dcdcaa">Itoa</font>(i))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="unuseCounter" FOLDED="true" ID="ID_1781125212" CREATED="1636976500160" MODIFIED="1636976528996">
<node ID="ID_1547175145" CREATED="1636976543880" MODIFIED="1636976562753"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">CountUnusedValue</font>(counterCh <font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;dataCh <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, stopCh <font color="#569cd6">chan</font>&nbsp; <font color="#569cd6">struct</font>{}) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Hour):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-stopCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;未处理完的数据：&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">value</font>&nbsp;:= &lt;-dataCh:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;未处理完的数据：&quot;</font>, value)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Second):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;timeout&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counterCh &lt;- <font color="#569cd6">struct</font>{}{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node TEXT="channel 在什么情况下会引起资源泄漏" ID="ID_1693038187" CREATED="1636977148163" MODIFIED="1636977164746">
<node TEXT=" Channel 可能会引发 goroutine 泄漏" ID="ID_1894693770" CREATED="1636977173676" MODIFIED="1636977174618"/>
<node TEXT="泄漏的原因是 goroutine 操作 channel 后，一直处于发送或接收阻塞状态" ID="ID_1077346271" CREATED="1636977175125" MODIFIED="1636977214882"/>
<node TEXT="  gouroutine 会一直处于等待队列中，垃圾回收器也不会回收此类资源" ID="ID_92446839" CREATED="1636977224763" MODIFIED="1636977235726"/>
</node>
<node TEXT="应用" ID="ID_1004404434" CREATED="1636977347762" MODIFIED="1636977355262">
<node TEXT=" 任务定时" ID="ID_262214624" CREATED="1636977362948" MODIFIED="1636977364007">
<node TEXT=" 实现超时控制" ID="ID_1396391310" CREATED="1636977382493" MODIFIED="1636977420517">
<node TEXT=" 有时候，需要执行某项操作，但又不想它耗费太长时间" ID="ID_1589743191" CREATED="1636977434347" MODIFIED="1636977435232"/>
<node TEXT=" 等待 100 ms 后，如果 s.stopc 还没有读出数据或者被关闭，就直接结束" ID="ID_817213681" CREATED="1636977480850" MODIFIED="1636977482469"/>
<node ID="ID_920130665" CREATED="1636977464234" MODIFIED="1636977468230"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(<font color="#b5cea8">100</font>&nbsp;* time.Millisecond):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-s.stopc:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#569cd6">false</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 实现定期执行某个任务" ID="ID_1371568467" CREATED="1636977421234" MODIFIED="1636977422307">
<node ID="ID_1362839797" CREATED="1636977525002" MODIFIED="1636977528547"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">worker</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ticker</font>&nbsp;:= time.<font color="#dcdcaa">Tick</font>(<font color="#b5cea8">1</font>&nbsp;* time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-ticker:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 执行定时任务</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;执行 1s 定时任务&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 解耦生产方和消费方" ID="ID_1164428137" CREATED="1636977564577" MODIFIED="1636977565499">
<node TEXT="main" ID="ID_15904473" CREATED="1636980249785" MODIFIED="1636980263332">
<node ID="ID_1613282133" CREATED="1636980263680" MODIFIED="1636980651389"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">dataCh</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 10个生产者，每个生产10个数据</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">wg</font>&nbsp;:= <font color="#dcdcaa">new</font>(sync.WaitGroup)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Add</font>(<font color="#b5cea8">100</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">generators</font>(dataCh, <font color="#b5cea8">10</font>, wg)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 3 个消费者</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">customers</font>(dataCh, <font color="#b5cea8">3</font>, wg)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 直到所有数据消费完毕</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Wait</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;Done&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="生产方" ID="ID_974548806" CREATED="1636980057755" MODIFIED="1636980061438">
<node ID="ID_1892772153" CREATED="1636980232999" MODIFIED="1636980672944"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">generators</font>(dataCh <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, count <font color="#4ec9b0">int</font>, wg *sync.WaitGroup) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; count; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(id <font color="#4ec9b0">int</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp; <font color="#9cdcfe">j</font>&nbsp;:= <font color="#b5cea8">0</font>; j &lt; <font color="#b5cea8">10</font>; j++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">data</font>&nbsp;&nbsp;:= id*<font color="#b5cea8">100</font>&nbsp;+ j
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataCh &lt;- data
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;Generator:&quot;</font>, id, <font color="#ce9178">&quot; data:&quot;</font>, data)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="消费方" ID="ID_742149316" CREATED="1636980061578" MODIFIED="1636980066909">
<node ID="ID_727166053" CREATED="1636980188353" MODIFIED="1636980757728"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">customers</font>(dataCh <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, count <font color="#4ec9b0">int</font>, wg *sync.WaitGroup) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; count; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(id <font color="#4ec9b0">int</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp; <font color="#9cdcfe">data</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;dataCh {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;Worker:&quot;</font>, id, <font color="#ce9178">&quot; data:&quot;</font>, data)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Done</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.<font color="#dcdcaa">Duration</font>(rand.<font color="#dcdcaa">Intn</font>(<font color="#b5cea8">10</font>)) * time.Millisecond)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 控制并发数" ID="ID_1415167732" CREATED="1636977576410" MODIFIED="1636977577260">
<node TEXT=" 某此任务执行过程依赖有限的资源，需要控制并发数" ID="ID_1961759367" CREATED="1636980833963" MODIFIED="1636980895617"/>
<node ID="ID_982492039" CREATED="1636980866899" MODIFIED="1636981669814"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">limit</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">3</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">wg</font>&nbsp;:= &amp;sync.WaitGroup{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Add</font>(<font color="#b5cea8">100</font>)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 100 workers</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; <font color="#b5cea8">100</font>; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>(id <font color="#4ec9b0">int</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;limit &lt;- <font color="#b5cea8">1</font>&nbsp; <font color="#6a9955">// 阻塞，直到有空位</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;Worker:&quot;</font>, id, <font color="#ce9178">&quot; get resource&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-limit <font color="#6a9955">// 释放空位</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Done</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Wait</font>()
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="Select" ID="ID_1187714553" CREATED="1630301900363" MODIFIED="1630301907860">
<node TEXT="概念" ID="ID_1588280791" CREATED="1636535403082" MODIFIED="1636535404988">
<node TEXT=" select 能够让一个Goroutine 同时等待多个 Channel 可读或者可写" ID="ID_285714954" CREATED="1636535371565" MODIFIED="1636535387189"/>
<node TEXT=" 每个case会对应一个通道的通信（接收或发送）过程" ID="ID_174654147" CREATED="1630301988862" MODIFIED="1630301989954"/>
<node TEXT=" select 能在 Channel 上进行非阻塞的收发操作" ID="ID_1250584576" CREATED="1636537864987" MODIFIED="1636537866239"/>
<node TEXT=" 当 select 中的两个 case 同时被触发时，会随机执行其中的一个" ID="ID_1050023298" CREATED="1636537825411" MODIFIED="1636537826811"/>
</node>
<node TEXT="Select与Switch的区别" ID="ID_1121783654" CREATED="1636537746580" MODIFIED="1636537756967">
<node TEXT=" select的使用类似于switch语句，它有一系列case分支和一个默认的分支" ID="ID_1100368547" CREATED="1630301975198" MODIFIED="1630301976203"/>
<node TEXT=" select case 中的表达式必须都是 Channel 的收发操作" ID="ID_713489788" CREATED="1636537763524" MODIFIED="1636537792576"/>
</node>
<node TEXT="Select的阻塞与不阻塞" ID="ID_676343787" CREATED="1636538116308" MODIFIED="1636538133861">
<node TEXT="使用default使select不阻塞当前goroutine" ID="ID_486135155" CREATED="1636538263732" MODIFIED="1636543226642"/>
<node TEXT="如果select下的case都没有操作，此时select会阻塞" ID="ID_1753191137" CREATED="1636538153996" MODIFIED="1636538261722"/>
<node TEXT=" 使用default可感知channel有无内容，实现与x, ok := &lt;-c一样的效果" ID="ID_577887459" CREATED="1636548389850" MODIFIED="1636548435433"/>
</node>
<node TEXT="select中的case同时执行" ID="ID_458469808" CREATED="1636549592432" MODIFIED="1636549666114">
<node TEXT=" select 在遇到多个 &lt;-ch 同时满足可读或者可写条件时会随机选择一个 case 执行其中的代码" ID="ID_561362174" CREATED="1636550424993" MODIFIED="1636550426046"/>
<node TEXT=" 如果两个 case 都是同时满足执行条件的，如果我们按照顺序依次判断，那么后面的条件永远都会得不到执行，而随机的引入就是为了避免饥饿问题的发生" ID="ID_1304531174" CREATED="1636550444434" MODIFIED="1636550447516"/>
</node>
<node TEXT="从多个channel接收" ID="ID_1804296620" CREATED="1630302166958" MODIFIED="1630302184952">
<node TEXT="直到其中一个channel ready" ID="ID_915269076" CREATED="1630325170827" MODIFIED="1630325192353"/>
<node ID="ID_1014502551" CREATED="1630302185598" MODIFIED="1630302192839"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">c1</font>,&nbsp;<font color="#9cdcfe">c2</font>&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">n</font>&nbsp;:=&nbsp;&lt;-c1:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;c1收到数据:&quot;</font>,&nbsp;n)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">n</font>&nbsp;:=&nbsp;&lt;-c2:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;c2收到数据:&quot;</font>,&nbsp;n)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;其它情况&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="如果想一直监听，放进死循环里" ID="ID_1382561899" CREATED="1630325193363" MODIFIED="1630325216698"/>
</node>
<node TEXT="监听写channel" ID="ID_686101506" CREATED="1630325167027" MODIFIED="1630325318504">
<node ID="ID_1772117892" CREATED="1630326900037" MODIFIED="1630326916093"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;&lt;-chan1:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;如果chan1成功读到数据，则进行该case处理语句</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;chan2&nbsp;&lt;-&nbsp;<font color="#b5cea8">1</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;如果成功向chan2写入数据，则进行该case处理语句</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;如果上面都没有成功，则进入default处理流程</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="感知channel有无内容" ID="ID_726088091" CREATED="1636619620065" MODIFIED="1636619657160">
<node TEXT="x, ok := &lt;-ch" ID="ID_898604586" CREATED="1636619665914" MODIFIED="1636619676205"/>
<node TEXT="正常接收，如果channel无内容，此时会阻塞" ID="ID_594393352" CREATED="1636619685665" MODIFIED="1636619720645"/>
<node TEXT="select加入default case，解决channel阻塞问题" ID="ID_490635148" CREATED="1636620082529" MODIFIED="1636620168462"/>
<node ID="ID_175309610" CREATED="1636620052688" MODIFIED="1636620071601"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">GetChanContent</font>(c <font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>) (<font color="#4ec9b0">int</font>, <font color="#4ec9b0">bool</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">v</font>, <font color="#9cdcfe">ok</font>&nbsp;:= &lt;-c:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;v, ok
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">default</font>:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#b5cea8">0</font>, <font color="#569cd6">false</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">5</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;ch &lt;- <font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; <font color="#b5cea8">5</font>; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>, <font color="#9cdcfe">ok</font>&nbsp;:= <font color="#dcdcaa">GetChanContent</font>(ch)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i, r, ok)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="可以从一个关闭的 channel 读出数据吗" ID="ID_1716986997" CREATED="1636354874692" MODIFIED="1636354911134">
<node TEXT="有缓冲的 channel，就算已关闭，也通读出有效数据" ID="ID_1001071453" CREATED="1636354952867" MODIFIED="1636355013018"/>
<node TEXT=" 只有当返回的 ok 为 false 时，读出的数据才是无效的" ID="ID_504081643" CREATED="1636355006532" MODIFIED="1636355007627"/>
<node ID="ID_1334089335" CREATED="1636355214003" MODIFIED="1636619674507"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">5</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;ch &lt;- <font color="#b5cea8">18</font>&nbsp;&nbsp;<font color="#6a9955">// 发送一个元素18</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">close</font>(ch) &nbsp;<font color="#6a9955">// 关闭channel</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">x</font>, <font color="#9cdcfe">ok</font>&nbsp;:= &lt;-ch
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;received: &quot;</font>, x) <font color="#6a9955">// 18</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">x</font>, <font color="#9cdcfe">ok</font>&nbsp;= &lt;-ch &nbsp;&nbsp;&nbsp;<font color="#6a9955">// 0, false</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;!ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;channel closed, data invalid. </font><font color="#9cdcfe">%d</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, x)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="等待任务结束" ID="ID_259612236" CREATED="1629983125968" MODIFIED="1629983133900">
<node TEXT="任务的数据通过一个channel传进来，完成之后再通过一个channel传出去" ID="ID_383391615" CREATED="1629983144272" MODIFIED="1629983194913"/>
<node ID="ID_724448422" CREATED="1629983276215" MODIFIED="1629983280128"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">worker</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;&nbsp;&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;done&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">bool</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">createWorker</font>(id&nbsp;<font color="#4ec9b0">int</font>)&nbsp;worker&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;worker{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;&nbsp;&nbsp;id,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in:&nbsp;&nbsp;&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done:&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">bool</font>),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">doWorker</font>(w)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;w
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">doWorker</font>(w&nbsp;worker)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;w.in&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;从channel接收数据</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;worker</font><font color="#9cdcfe">%d</font><font color="#ce9178">:&nbsp;</font><font color="#9cdcfe">%s</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;w.id,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;{&nbsp;w.done&nbsp;&lt;-&nbsp;<font color="#569cd6">true</font>&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="统计done次数" ID="ID_1476615970" CREATED="1629983401614" MODIFIED="1629983427618">
<node TEXT="每个worker有2个job，要接收2次done" ID="ID_1091908833" CREATED="1629983368464" MODIFIED="1629983395370"/>
<node ID="ID_1385135512" CREATED="1629983280999" MODIFIED="1629983307565"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">chanDemo</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">workers</font>&nbsp;:=&nbsp;[<font color="#b5cea8">10</font>]worker{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">10</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workers[i]&nbsp;=&nbsp;<font color="#dcdcaa">createWorker</font>(i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;workers&nbsp;{&nbsp;<font color="#6a9955">//&nbsp;job1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;=&nbsp;workers[i]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.in&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;a</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;workers&nbsp;{&nbsp;<font color="#6a9955">//&nbsp;job2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;=&nbsp;workers[i]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.in&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;A</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;等待所有的worker完成</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>,&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;workers&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-w.done&nbsp;<font color="#6a9955">//&nbsp;job1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-w.done&nbsp;<font color="#6a9955">//&nbsp;job2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" waitGroup" ID="ID_984797706" CREATED="1629983398087" MODIFIED="1629983438764">
<node ID="ID_1948330217" CREATED="1629983853693" MODIFIED="1629983863592"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">worker</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg&nbsp;*sync.WaitGroup
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">createWorker</font>(id&nbsp;<font color="#4ec9b0">int</font>,&nbsp;wg&nbsp;*sync.WaitGroup)&nbsp;worker&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;worker{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id:&nbsp;id,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in:&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg:&nbsp;wg,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">doWorker</font>(w)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;w
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">doWorker</font>(w&nbsp;worker)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;w.in&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;从channel接收数据</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;worker</font><font color="#9cdcfe">%d</font><font color="#ce9178">:&nbsp;</font><font color="#9cdcfe">%s</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>,&nbsp;w.id,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;{&nbsp;w.wg.<font color="#dcdcaa">Done</font>()&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_273803597" CREATED="1629983864365" MODIFIED="1629983881611"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">chanDemo</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">wg</font>&nbsp;:=&nbsp;sync.WaitGroup{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">workers</font>&nbsp;:=&nbsp;[<font color="#b5cea8">10</font>]worker{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">10</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workers[i]&nbsp;=&nbsp;<font color="#dcdcaa">createWorker</font>(i,&nbsp;&amp;wg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;workers&nbsp;{&nbsp;<font color="#6a9955">//&nbsp;job1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Add</font>(<font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;=&nbsp;workers[i]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.in&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;a</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>,&nbsp;<font color="#9cdcfe">w</font>&nbsp;:=&nbsp;<font color="#c586c0">range</font>&nbsp;workers&nbsp;{&nbsp;<font color="#6a9955">//&nbsp;job2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Add</font>(<font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">w</font>&nbsp;=&nbsp;workers[i]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.in&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;A</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;等待所有的worker完成,&nbsp;20个Add,则需要20个Done</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;wg.<font color="#dcdcaa">Wait</font>()
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="并发控制" POSITION="right" ID="ID_871143590" CREATED="1630331028868" MODIFIED="1630332218555">
<edge COLOR="#0000ff"/>
<node TEXT="-race" ID="ID_257672178" CREATED="1630579384165" MODIFIED="1630579387986">
<node TEXT="查看" ID="ID_1659269973" CREATED="1630579388221" MODIFIED="1630579396502"/>
</node>
<node TEXT="传统同步机制" ID="ID_804414015" CREATED="1630579226176" MODIFIED="1630579233877">
<node TEXT="waitGroup" ID="ID_254800665" CREATED="1630579234214" MODIFIED="1630579237851"/>
<node TEXT="Mutex" ID="ID_439126061" CREATED="1630579238537" MODIFIED="1630579241258">
<node ID="ID_1650868870" CREATED="1630580028643" MODIFIED="1630580040714"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">atomicInt</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;lock&nbsp;&nbsp;sync.Mutex
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(a&nbsp;*atomicInt)&nbsp;<font color="#dcdcaa">increment</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;a.lock.<font color="#dcdcaa">Lock</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;a.lock.<font color="#dcdcaa">Unlock</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;a.value++
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(a&nbsp;*atomicInt)&nbsp;<font color="#dcdcaa">get</font>()&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;a.lock.<font color="#dcdcaa">Lock</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">defer</font>&nbsp;a.lock.<font color="#dcdcaa">Unlock</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">int</font>(a.value)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;atomicInt
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;i.<font color="#dcdcaa">increment</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.<font color="#dcdcaa">increment</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Microsecond)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(i.<font color="#dcdcaa">get</font>())
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="Cond" ID="ID_1404780306" CREATED="1630579241511" MODIFIED="1630579243482"/>
</node>
<node TEXT="服务/任务" FOLDED="true" ID="ID_152890051" CREATED="1630389752253" MODIFIED="1630389759892">
<node TEXT="生成器" ID="ID_374646193" CREATED="1630332218865" MODIFIED="1630332221701">
<node ID="ID_1938822161" CREATED="1630389103338" MODIFIED="1630389108427"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">msgGen</font>()&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m</font>&nbsp;:=&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;msg</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;m
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(&lt;-m)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="一个生成器更抽象来讲， 是一个服务或任务" ID="ID_1016668801" CREATED="1630580944728" MODIFIED="1630580964689"/>
</node>
<node TEXT="同时等待多个服务" FOLDED="true" ID="ID_794178316" CREATED="1630389760123" MODIFIED="1630389771855">
<node TEXT="开多个goroutine" ID="ID_1068583780" CREATED="1630584499081" MODIFIED="1630584663883">
<node TEXT="新增一个channel，用于接收所有服务发过来的信息" ID="ID_611036578" CREATED="1630582889692" MODIFIED="1630582918402"/>
<node TEXT="接收每个服务发来信息的channel都放在goroutine里" ID="ID_1561024591" CREATED="1630586239709" MODIFIED="1630586272640"/>
<node TEXT="适用于不知道需要接收多少个服务时" ID="ID_1343294982" CREATED="1630586273062" MODIFIED="1630586317614"/>
</node>
<node TEXT="select" ID="ID_728762836" CREATED="1630584251994" MODIFIED="1630584255750">
<node ID="ID_129580795" CREATED="1630584354696" MODIFIED="1630584361899"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">msgGen</font>(servername&nbsp;<font color="#4ec9b0">string</font>)&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m</font>&nbsp;:=&nbsp;<font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;&lt;-&nbsp;fmt.<font color="#dcdcaa">Sprintf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%s</font><font color="#ce9178">msg</font><font color="#9cdcfe">%d</font><font color="#ce9178">&quot;</font>,&nbsp;servername,&nbsp;i)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;m
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m1</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server1&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m2</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">msg</font>&nbsp;:=&nbsp;&lt;-m1:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(msg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">msg</font>&nbsp;:=&nbsp;&lt;-m2:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(msg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="对于服务数不确定的情况，select case不好写" ID="ID_1970744780" CREATED="1630586326188" MODIFIED="1630586361127"/>
<node TEXT="用select只需一个goroutine就并发处理服务信息" ID="ID_988677023" CREATED="1630587707052" MODIFIED="1630587753735"/>
</node>
</node>
<node TEXT="非阻塞等待" FOLDED="true" ID="ID_1401102066" CREATED="1630411255566" MODIFIED="1630411265677">
<node TEXT="select加了default，就是一个非阻塞式的等待" ID="ID_1568456966" CREATED="1630592365934" MODIFIED="1630592397858"/>
<node ID="ID_1973177778" CREATED="1630592332501" MODIFIED="1630593739565"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">nonBlockingWait</font>(c&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>)&nbsp;(<font color="#4ec9b0">string</font>,&nbsp;<font color="#4ec9b0">bool</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">m</font>&nbsp;:=&nbsp;&lt;-c:&nbsp;<font color="#6a9955">//&nbsp;select是非阻塞式的</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;m,&nbsp;<font color="#569cd6">true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">default</font>:&nbsp;<font color="#6a9955">//&nbsp;如果阻塞就跑到default了</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>,&nbsp;<font color="#569cd6">false</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m1</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server1&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Microsecond)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m2</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(&lt;-m1)&nbsp;<font color="#6a9955">//&nbsp;接收这个是阻塞的</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">msg</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;<font color="#dcdcaa">nonBlockingWait</font>(m2);&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(msg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;no&nbsp;msg&nbsp;from&nbsp;m2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="超时不等待" FOLDED="true" ID="ID_465256885" CREATED="1630411265868" MODIFIED="1630593856863">
<node ID="ID_522474488" CREATED="1630595192426" MODIFIED="1630596591638"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">timeoutWait</font>(c&nbsp;<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">string</font>,&nbsp;timeout&nbsp;time.Duration)&nbsp;(<font color="#4ec9b0">string</font>,&nbsp;<font color="#4ec9b0">bool</font>)&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;<font color="#9cdcfe">m</font>&nbsp;:=&nbsp;&lt;-c:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;m,&nbsp;<font color="#569cd6">true</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">case</font>&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(timeout):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>,&nbsp;<font color="#569cd6">false</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m2</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">msg</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;<font color="#dcdcaa">timeoutWait</font>(m2,&nbsp;time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(msg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;no&nbsp;msg&nbsp;from&nbsp;m2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="任务中断/退出" FOLDED="true" ID="ID_1198014588" CREATED="1630411269852" MODIFIED="1630411287105">
<node ID="ID_1801983426" CREATED="1630596773405" MODIFIED="1630596783650"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>()&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">m2</font>&nbsp;:=&nbsp;<font color="#dcdcaa">msgGen</font>(<font color="#ce9178">&quot;server2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:=&nbsp;<font color="#b5cea8">0</font>;&nbsp;i&nbsp;&lt;&nbsp;<font color="#b5cea8">5</font>;&nbsp;i++&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#9cdcfe">msg</font>,&nbsp;<font color="#9cdcfe">ok</font>&nbsp;:=&nbsp;<font color="#dcdcaa">timeoutWait</font>(m2,&nbsp;time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#c586c0">if</font>&nbsp;ok&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(msg)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<font color="#c586c0">else</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;最后一次循环，如果进入这里</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;main退出了，协程就销毁了</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#6a9955">//&nbsp;此时还有任务没处理完</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;no&nbsp;msg&nbsp;from&nbsp;m2&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="优雅退出" ID="ID_501282819" CREATED="1630411282693" MODIFIED="1630411296816"/>
<node TEXT="同时select两个channel，如果其中一个channel中途关闭会是什么情况" FOLDED="true" ID="ID_1651557637" CREATED="1645856884175" MODIFIED="1645856940763">
<node TEXT="select 会随机执行不阻塞的case" ID="ID_288105550" CREATED="1645856941392" MODIFIED="1645857139137"/>
<node TEXT="channel关闭了以后，是不阻塞的，如果是无缓冲channel那读出来的值都是零值，执行这个case是没有意义的" ID="ID_1680514573" CREATED="1645857139319" MODIFIED="1645857313497"/>
<node TEXT="跳过关闭channel的case" ID="ID_112044013" CREATED="1645857394837" MODIFIED="1645857442289">
<node TEXT="如果channel读出来的ok为false，则设置为nil" ID="ID_1765786581" CREATED="1645857615396" MODIFIED="1645857639321"/>
<node TEXT="读nil channel 总是阻塞，因此可以跳过这个case" ID="ID_698439220" CREATED="1645857639500" MODIFIED="1645857663310"/>
<node ID="ID_1290241610" CREATED="1645857595289" MODIFIED="1645858115136"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch1</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch2</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">v</font>, <font color="#9cdcfe">ok</font>&nbsp;:= &lt;-ch1:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;&nbsp;!ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch1 closed&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch1</font>&nbsp;&nbsp;= <font color="#569cd6">nil</font>&nbsp;<font color="#6a9955">// nil channel 总是阻塞的</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#c586c0">else</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch1:&quot;</font>, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">v</font>, <font color="#9cdcfe">ok</font>&nbsp;:= &lt;-ch2:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;&nbsp;!ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch2 closed&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch2</font>&nbsp;&nbsp;= <font color="#569cd6">nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#c586c0">else</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch2:&quot;</font>, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; <font color="#b5cea8">10</font>; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch2 &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;i &lt;= <font color="#b5cea8">5</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch1 &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#c586c0">else</font>&nbsp;<font color="#c586c0">if</font>&nbsp;&nbsp;i == <font color="#b5cea8">6</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">close</font>(ch1)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Second * <font color="#b5cea8">3</font>)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT="不要关闭这个channel" ID="ID_251542030" CREATED="1645857668629" MODIFIED="1645857691583">
<node TEXT="是什么样的业务逻辑需要关闭这个channel呢？" ID="ID_701202734" CREATED="1645857692604" MODIFIED="1645857715374"/>
<node TEXT="如果不需要向这个channel发数据，不发就好，没必意关闭" ID="ID_1078818010" CREATED="1645857715747" MODIFIED="1645857746502"/>
<node TEXT="如果是想停止这个goroutine，多加一个done channel就可以了" ID="ID_1484515829" CREATED="1645857746771" MODIFIED="1645857782733"/>
<node ID="ID_1483144205" CREATED="1645858007018" MODIFIED="1645858021652"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch1</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch2</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>, <font color="#b5cea8">1</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">done</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">v</font>&nbsp;:= &lt;-ch1:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch1:&quot;</font>, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp; <font color="#9cdcfe">v</font>&nbsp;:= &lt;-ch2:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;ch2:&quot;</font>, v)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-done:
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#b5cea8">0</font>; i &lt; <font color="#b5cea8">10</font>; i++ {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch2 &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;&nbsp;i &lt;= <font color="#b5cea8">5</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch1 &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done &lt;- <font color="#569cd6">struct</font>{}{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Second)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>

</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="HTTP" POSITION="right" ID="ID_300092656" CREATED="1637059335243" MODIFIED="1637059484374">
<edge COLOR="#ff00ff"/>
<node TEXT="" ID="ID_352771514" CREATED="1637059485100" MODIFIED="1637059485100"/>
</node>
<node TEXT="Json" FOLDED="true" POSITION="right" ID="ID_1587562711" CREATED="1637060360539" MODIFIED="1637063125201">
<edge COLOR="#7c0000"/>
<node TEXT=" 序列化与返序列化" ID="ID_1813560576" CREATED="1637063126033" MODIFIED="1637063132250">
<node TEXT="json.Marshal json.Unmarshal" ID="ID_741322926" CREATED="1637063475703" MODIFIED="1637063494737"/>
<node ID="ID_1475768803" CREATED="1637063149378" MODIFIED="1637063307249"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">OrderItem</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Id &nbsp;&nbsp;&nbsp;<font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">`json:&quot;id&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Name &nbsp;<font color="#4ec9b0">string</font>&nbsp;<font color="#ce9178">`json:&quot;name&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Price <font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">`json:&quot;price&quot;`</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Order</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#4ec9b0">int</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">`json:&quot;id&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#4ec9b0">string</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ce9178">`json:&quot;name,omitempty&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;TotalPrice <font color="#4ec9b0">float64</font>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">`json:&quot;total_price&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;OrderItems []OrderItem <font color="#ce9178">`json:&quot;order_items&quot;`</font>
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(o *Order) <font color="#dcdcaa">Init</font>(Id <font color="#4ec9b0">int</font>, Name <font color="#4ec9b0">string</font>, OrderItems []OrderItem) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o.Id</font>&nbsp;= Id
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o.Name</font>&nbsp;= Name
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o.OrderItems</font>&nbsp;= OrderItems
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o.TotalPrice</font>&nbsp;= <font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">item</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;&nbsp;o.OrderItems {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.TotalPrice += <font color="#dcdcaa">float64</font>(item.Price)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_158315438" CREATED="1637063171409" MODIFIED="1637063206454"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;(o *Order) <font color="#dcdcaa">Serialize</font>() <font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">b</font>, <font color="#9cdcfe">err</font>&nbsp;:= json.<font color="#dcdcaa">Marshal</font>(o)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">string</font>(b)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(o *Order) <font color="#dcdcaa">Deserialize</font>(s <font color="#4ec9b0">string</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 这里的o是指针类型，才可以直接赋值</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">err</font>&nbsp;:= json.<font color="#dcdcaa">Unmarshal</font>([]<font color="#dcdcaa">byte</font>(s), o)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o1</font>&nbsp;:= Order{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;o1.<font color="#dcdcaa">Init</font>(<font color="#b5cea8">1</font>, <font color="#ce9178">&quot;order1&quot;</font>, []OrderItem{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Id: <font color="#b5cea8">1</font>, Name: <font color="#ce9178">&quot;item1&quot;</font>, Price: <font color="#b5cea8">100</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Id: <font color="#b5cea8">2</font>, Name: <font color="#ce9178">&quot;item2&quot;</font>, Price: <font color="#b5cea8">200</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s</font>&nbsp;:= o1.<font color="#dcdcaa">Serialize</font>()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">o2</font>&nbsp;:= Order{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;o2.<font color="#dcdcaa">Deserialize</font>(s)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(o1.<font color="#dcdcaa">Serialize</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(o2.<font color="#dcdcaa">Serialize</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(o1.<font color="#dcdcaa">Serialize</font>() == o2.<font color="#dcdcaa">Serialize</font>())
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="忽略空字段" ID="ID_820632400" CREATED="1637060926494" MODIFIED="1637060943044">
<node TEXT="需要 {&quot;id&quot;:2,&quot;total_price&quot;:200}， 而不是 {&quot;id&quot;:2,&quot;name&quot;:&quot;&quot;,&quot;total_price&quot;:200}" ID="ID_79178078" CREATED="1637060953478" MODIFIED="1637061097487"/>
<node TEXT="json tag:omitempty" ID="ID_9021663" CREATED="1637061141069" MODIFIED="1637067155039"/>
<node TEXT="&#x9;Name       string `json:&quot;name omitempty&quot;`" ID="ID_548221093" CREATED="1637061134886" MODIFIED="1637061137378"/>
</node>
<node TEXT="处理接收的JSON数据" ID="ID_1703774484" CREATED="1637064442740" MODIFIED="1637064457717">
<node TEXT="定义简单结构体，可以更方便操作数据" ID="ID_969526309" CREATED="1637064987401" MODIFIED="1637065293546"/>
<node ID="ID_383073857" CREATED="1637065318024" MODIFIED="1637065321834"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>&nbsp;:= <font color="#ce9178">`</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;{</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: [</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;synonym&quot;:&quot;连身裙;联衣裙&quot;,</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;weight&quot;:&quot;1.0&quot;,</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;word&quot;: &quot;连衣裙&quot;,</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;tag&quot;:&quot;品类&quot;</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;}</font>
      </div>
      <div>
        <font color="#ce9178">&nbsp;&nbsp;&nbsp;&nbsp;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">d</font>&nbsp;:= <font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Data []<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Synonym <font color="#4ec9b0">string</font>&nbsp; <font color="#ce9178">`json:&quot;synonym&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnKnown <font color="#4ec9b0">string</font>&nbsp; <font color="#ce9178">`json:&quot;unknown&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#ce9178">`json:&quot;data&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;json.<font color="#dcdcaa">Unmarshal</font>([]<font color="#dcdcaa">byte</font>(r), &amp;d)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%+v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, d)
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="gin" FOLDED="true" POSITION="right" ID="ID_284587335" CREATED="1637127209127" MODIFIED="1637127213882">
<edge COLOR="#007c00"/>
<node TEXT="安装" ID="ID_285790189" CREATED="1637127217797" MODIFIED="1637127221560">
<node TEXT="go get -u github.com/gin-gonic/gin" ID="ID_906880918" CREATED="1637127221764" MODIFIED="1637127238728"/>
</node>
<node TEXT="最小原型" ID="ID_1885300052" CREATED="1637127797914" MODIFIED="1637127954213">
<node ID="ID_128985851" CREATED="1637127963602" MODIFIED="1637127968230"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">package</font>&nbsp;main
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">import</font>&nbsp;<font color="#ce9178">&quot;github.com/gin-gonic/gin&quot;</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>&nbsp;:= gin.<font color="#dcdcaa">Default</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">GET</font>(<font color="#ce9178">&quot;/ping&quot;</font>, <font color="#569cd6">func</font>(c *gin.Context) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.<font color="#dcdcaa">JSON</font>(<font color="#b5cea8">200</font>, gin.H{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;message&quot;</font>: <font color="#ce9178">&quot;pong&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// Listen and Server on localhost:7000</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">Run</font>(<font color="#ce9178">&quot;:7000&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="middleware" ID="ID_1673554734" CREATED="1637127972009" MODIFIED="1637127984822">
<node ID="ID_1199979319" CREATED="1637305388825" MODIFIED="1637305392596"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>&nbsp;:= gin.<font color="#dcdcaa">Default</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">logger</font>, <font color="#9cdcfe">err</font>&nbsp;:= zap.<font color="#dcdcaa">NewProduction</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">Use</font>(<font color="#569cd6">func</font>(c *gin.Context) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">start</font>&nbsp;:= time.<font color="#dcdcaa">Now</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.<font color="#dcdcaa">Next</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.<font color="#dcdcaa">Info</font>(<font color="#ce9178">&quot;Incoming request&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 请求信息</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zap.<font color="#dcdcaa">String</font>(<font color="#ce9178">&quot;method&quot;</font>, c.Request.Method),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zap.<font color="#dcdcaa">String</font>(<font color="#ce9178">&quot;url&quot;</font>, c.Request.URL.<font color="#dcdcaa">String</font>()),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zap.<font color="#dcdcaa">String</font>(<font color="#ce9178">&quot;ip&quot;</font>, c.<font color="#dcdcaa">ClientIP</font>()),
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 与响应相关的信息</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zap.<font color="#dcdcaa">Int</font>(<font color="#ce9178">&quot;status&quot;</font>, c.Writer.<font color="#dcdcaa">Status</font>()),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zap.<font color="#dcdcaa">Duration</font>(<font color="#ce9178">&quot;latency&quot;</font>, time.<font color="#dcdcaa">Since</font>(start)),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">GET</font>(<font color="#ce9178">&quot;/ping&quot;</font>, <font color="#569cd6">func</font>(c *gin.Context) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.<font color="#dcdcaa">JSON</font>(<font color="#b5cea8">200</font>, gin.H{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;message&quot;</font>: <font color="#ce9178">&quot;pong&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">GET</font>(<font color="#ce9178">&quot;/1&quot;</font>, <font color="#569cd6">func</font>(c *gin.Context) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.<font color="#dcdcaa">String</font>(<font color="#b5cea8">200</font>, <font color="#ce9178">&quot;111111111&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// Listen and Server on localhost:7000</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;r.<font color="#dcdcaa">Run</font>(<font color="#ce9178">&quot;:7000&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 数据竞争（data race）" POSITION="right" ID="ID_379689809" CREATED="1641815220618" MODIFIED="1641815280292">
<edge COLOR="#0000ff"/>
<node TEXT="概念" ID="ID_531630734" CREATED="1641815298761" MODIFIED="1641815300581">
<node TEXT=" 指两个协程同时访问相同的内存空间，并且至少有一个写操作的情况" ID="ID_833301268" CREATED="1641815234077" MODIFIED="1641815243911"/>
<node TEXT="发生数据争用时，结果是不可预测的，难调试的并发错误" ID="ID_871089930" CREATED="1641815258418" MODIFIED="1641815476091"/>
</node>
<node TEXT="检测数据竞争" ID="ID_27649928" CREATED="1641813443888" MODIFIED="1641815281857">
<node TEXT="命令" ID="ID_794465764" CREATED="1641813671740" MODIFIED="1641813679399">
<node TEXT="用于开发环境，只有跑到数据竞争逻辑才能检测出来" ID="ID_838974672" CREATED="1641813890639" MODIFIED="1641813914403"/>
<node TEXT=" 此选项会消耗更多的cpu计算资源和内存" ID="ID_1978299050" CREATED="1641813932857" MODIFIED="1641813933907"/>
<node TEXT=" go run -race xxx.go" ID="ID_1650942319" CREATED="1641813470206" MODIFIED="1641813473929"/>
<node TEXT="go build -race xxx.go" ID="ID_102855462" CREATED="1641813682123" MODIFIED="1641813722036"/>
<node TEXT=" go test -race mypkg" ID="ID_720671484" CREATED="1641815548895" MODIFIED="1641815550269"/>
</node>
<node ID="ID_1399371640" CREATED="1641813635388" MODIFIED="1641813641167"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">a</font>&nbsp;:= <font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">a</font>&nbsp;= <font color="#b5cea8">2</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">a</font>&nbsp;= <font color="#b5cea8">3</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;a is &quot;</font>, a)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(<font color="#b5cea8">2</font>&nbsp;* time.Second)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 解决数据竞争" ID="ID_24371026" CREATED="1641815291938" MODIFIED="1641815292893">
<node TEXT="atomic原子操作" ID="ID_1345647031" CREATED="1641815099621" MODIFIED="1641815731437"/>
<node TEXT=" WaitGroup锁" ID="ID_1972134699" CREATED="1641815727655" MODIFIED="1641815729063"/>
<node TEXT=" Mutex互斥锁" ID="ID_657361604" CREATED="1641815738550" MODIFIED="1641815774646"/>
</node>
</node>
<node TEXT="context" POSITION="right" ID="ID_676525533" CREATED="1637237055298" MODIFIED="1637237059743">
<edge COLOR="#7c007c"/>
<node TEXT=" context 是什么" FOLDED="true" ID="ID_1040431056" CREATED="1637302523430" MODIFIED="1637302524332">
<node TEXT=" context是goroutine 的上下文" ID="ID_55993726" CREATED="1637302385758" MODIFIED="1644490932412">
<node TEXT=" 包含 goroutine 的运行状态、环境、现场等信息" ID="ID_1289717667" CREATED="1637302469142" MODIFIED="1637302470533"/>
<node TEXT="在 goroutine 之间传递上下文信息" ID="ID_1075710502" CREATED="1637302400286" MODIFIED="1637302479173">
<node ID="ID_1852749796" CREATED="1637302416945" MODIFIED="1637302416945"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      取消信号
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_775853098" CREATED="1637302416945" MODIFIED="1637302416945"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      超时时间
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_127793828" CREATED="1637302416947" MODIFIED="1637302416947"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      截止时间
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="key-value 等" ID="ID_1198257384" CREATED="1637302416948" MODIFIED="1644409615556"/>
</node>
</node>
<node TEXT=" context 几乎成为了并发控制和超时控制的标准做法" ID="ID_1169299807" CREATED="1637302432157" MODIFIED="1637302433204"/>
</node>
<node TEXT=" context 有什么作用" FOLDED="true" ID="ID_1900646013" CREATED="1637302577319" MODIFIED="1637302578263">
<node TEXT=" context 用来解决 goroutine 之间退出通知、元数据传递的功能" ID="ID_1536385127" CREATED="1637302804246" MODIFIED="1637302805635"/>
<node TEXT="gorotine之间的数据共享" ID="ID_1183027088" CREATED="1644409944227" MODIFIED="1644409963691">
<node TEXT=" 传递共享的值，如登陆的 token" ID="ID_760266356" CREATED="1644409768347" MODIFIED="1644410015322"/>
<node TEXT="Go Server中的一个http请求" ID="ID_476779493" CREATED="1637302610494" MODIFIED="1637302629561">
<node TEXT="" ID="ID_1137714159" CREATED="1637302648787" MODIFIED="1637302651746">
<hook URI="Go_files/png_5847232795045565472.png" SIZE="0.29069766" NAME="ExternalObject"/>
</node>
<node TEXT=" 在 Go 的 server 里，通常每来一个请求都会启动若干个 goroutine 同时工作" ID="ID_390462910" CREATED="1637302602413" MODIFIED="1637302603421"/>
<node TEXT=" 有些去数据库拿数据，有些调用下游接口获取相关数据" ID="ID_399016219" CREATED="1637302637094" MODIFIED="1637302637903"/>
<node TEXT=" goroutine 之间需要共享这个请求的基本数据" ID="ID_909141183" CREATED="1644409755226" MODIFIED="1644409762787"/>
</node>
</node>
<node TEXT=" 退出通知" ID="ID_804967720" CREATED="1644411023666" MODIFIED="1644411024566">
<node TEXT="手动退出" ID="ID_666880384" CREATED="1644474644419" MODIFIED="1644474647598">
<node TEXT=" 请求方直接放弃了这次请求" ID="ID_1406945400" CREATED="1644409844305" MODIFIED="1644409845273"/>
</node>
<node TEXT=" 超时退出" ID="ID_1675348876" CREATED="1644410025121" MODIFIED="1644474642432">
<node TEXT=" 处理请求的最大超时时间" ID="ID_1674090686" CREATED="1644409782489" MODIFIED="1644410031986"/>
<node TEXT="问题" ID="ID_1875288052" CREATED="1644410273143" MODIFIED="1644410284408">
<node TEXT=" 如果服务器压力大，处理的时间就会长，处理速度跟不上请求速度，会导致协程数不断增加。协程是要消耗系统资源的，会导致雪崩效应，整个服务不可用" ID="ID_797760572" CREATED="1644410111273" MODIFIED="1644410243532"/>
</node>
<node TEXT="方案" ID="ID_1647602251" CREATED="1644410295295" MODIFIED="1644410299025">
<node TEXT=" 如果超过这个值还没有接收到返回数据，就直接向客户端返回一个默认值或者错误" ID="ID_1254572629" CREATED="1644410268534" MODIFIED="1644410269862"/>
</node>
</node>
<node TEXT="减少资源消耗，避免泄漏" ID="ID_712574948" CREATED="1644474650609" MODIFIED="1644474677061"/>
</node>
</node>
<node TEXT="context的使用建议" FOLDED="true" ID="ID_1320762106" CREATED="1644461630798" MODIFIED="1644461643712">
<node TEXT=" 将 Context 类型作为函数的第一参数" ID="ID_724403903" CREATED="1644461654943" MODIFIED="1644461656099">
<node TEXT=" 不要将 Context 塞到结构体里" ID="ID_569920355" CREATED="1644461663903" MODIFIED="1644461664976"/>
<node TEXT="参数名一般都命名为 ctx" ID="ID_1814120057" CREATED="1644461671406" MODIFIED="1644461683517"/>
</node>
<node TEXT=" 不要向函数传入一个 nil 的 context" ID="ID_1864220966" CREATED="1644461697851" MODIFIED="1644461698822">
<node TEXT=" 实在不知道传什么，用context:todo" ID="ID_565732470" CREATED="1644461709114" MODIFIED="1644461718677"/>
</node>
<node TEXT=" context 存储的应该是一些共同的数据" ID="ID_758488333" CREATED="1644461734239" MODIFIED="1644461741791">
<node TEXT=" 不要把本应该作为函数参数的类型塞到 context 中" ID="ID_1485366247" CREATED="1644461748358" MODIFIED="1644461749282"/>
<node TEXT=" context放登陆的 session、cookie 等" ID="ID_1481661740" CREATED="1644461760813" MODIFIED="1644461771009"/>
</node>
<node TEXT=" context 是并发安全的" ID="ID_1493446471" CREATED="1644461780010" MODIFIED="1644461781152">
<node TEXT=" 同一个 context 可能会被传递到多个 goroutine" ID="ID_1377338513" CREATED="1644461785260" MODIFIED="1644461792255"/>
</node>
</node>
<node TEXT="接口、结构、方法" FOLDED="true" ID="ID_363481488" CREATED="1644474857710" MODIFIED="1644474900104">
<node TEXT="Context接口" ID="ID_182946359" CREATED="1644480528555" MODIFIED="1644480537055">
<node TEXT=" Context接口 Done()" ID="ID_648476421" CREATED="1644474862133" MODIFIED="1644474937953">
<node TEXT=" Done() &lt;-chan struct{}" ID="ID_1262386471" CREATED="1644474950805" MODIFIED="1644474951819"/>
<node TEXT=" Done() 返回一个 只读channel，接收 context 被取消的信号" ID="ID_1590178271" CREATED="1644475105936" MODIFIED="1644475126475"/>
<node TEXT="当这个channel被关闭时，可以读出零值，否则阻塞" ID="ID_742200024" CREATED="1644475166678" MODIFIED="1644475202288"/>
</node>
<node TEXT="  Context接口 Err()" ID="ID_709658862" CREATED="1644475225877" MODIFIED="1644475231864">
<node TEXT=" Err() error" ID="ID_1528201679" CREATED="1644475307116" MODIFIED="1644475308887"/>
<node TEXT="在 channel Done 关闭后，返回 context 取消原因" ID="ID_873484656" CREATED="1644475254749" MODIFIED="1644475434174"/>
<node TEXT="如果 channel Done未完成，返回 nil" ID="ID_1519709675" CREATED="1644475470658" MODIFIED="1644475489267"/>
<node TEXT=" 例如是被取消 Canceled，还是超时 DeadlineExceeded" ID="ID_1135421613" CREATED="1644475261308" MODIFIED="1644475513237"/>
</node>
<node TEXT="   Context接口 Deadline()" ID="ID_1789077386" CREATED="1644475277470" MODIFIED="1644475283213">
<node TEXT=" Deadline() (deadline time.Time, ok bool)" ID="ID_257707157" CREATED="1644475550065" MODIFIED="1644475551193"/>
<node TEXT=" 返回 context 的截止时间，是否被取消" ID="ID_1174782607" CREATED="1644477353949" MODIFIED="1644477364352"/>
</node>
<node TEXT="    Context接口 Value(key)" ID="ID_1765199271" CREATED="1644480468859" MODIFIED="1644480476794">
<node TEXT=" Value(key interface{}) interface{}" ID="ID_618443393" CREATED="1644480462592" MODIFIED="1644480464278"/>
<node TEXT="获取之前设置的 key 对应的 value" ID="ID_1768364758" CREATED="1644480486803" MODIFIED="1644480499724"/>
</node>
</node>
<node TEXT=" canceler接口" ID="ID_765940505" CREATED="1644480546747" MODIFIED="1644480553173">
<node ID="ID_1170665664" CREATED="1644481231121" MODIFIED="1644481234963"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">canceler</font>&nbsp;<font color="#569cd6">interface</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">cancel</font>(removeFromParent <font color="#4ec9b0">bool</font>, err <font color="#4ec9b0">error</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">Done</font>() &lt;-<font color="#569cd6">chan</font>&nbsp;<font color="#569cd6">struct</font>{}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="context实现canceler接口，成功可取消的Ctx" ID="ID_1868270419" CREATED="1644491133713" MODIFIED="1644491158680"/>
<node TEXT=" *cancelCtx 和 *timerCtx 指针实现了canceler接口" ID="ID_24846401" CREATED="1644480858132" MODIFIED="1644481274865"/>
<node TEXT="cancel参数" ID="ID_590995821" CREATED="1644491189552" MODIFIED="1644491201115">
<node TEXT=" err是一个固定的取消错误类型, errors.New(&quot;context canceled&quot;)" ID="ID_437553488" CREATED="1644481658278" MODIFIED="1644481672831"/>
<node TEXT="removeFromParent" ID="ID_1217787688" CREATED="1644481678303" MODIFIED="1644481936092">
<node TEXT=" true时，当前节点的 context 从父节点 context 中删除" ID="ID_1566569877" CREATED="1644481936757" MODIFIED="1644481942559"/>
<node TEXT=" 什么时候会传 true 呢" ID="ID_1799887806" CREATED="1644481931038" MODIFIED="1644481932834">
<node TEXT=" 调用 WithCancel() 方法的时候" ID="ID_1093942738" CREATED="1644481962717" MODIFIED="1644481963642"/>
<node TEXT=" 新创建一个可取消的 context 节点时，返回的 cancelFunc 函数会传入 true" ID="ID_1180774854" CREATED="1644481976301" MODIFIED="1644481977442"/>
<node TEXT=" 将这个 context 从它的父节点里“除名”，因为父节点可能有很多子节点，避免影响其它cancelCtx" ID="ID_1972303069" CREATED="1644482020735" MODIFIED="1644482052335"/>
</node>
</node>
</node>
</node>
<node TEXT="emptyCtx 结构体" ID="ID_1691797257" CREATED="1644481055089" MODIFIED="1644481064707">
<node TEXT="实现Context接口，但没有任何内容，要么是直接返回，要么是返回 nil" ID="ID_1122158773" CREATED="1644481065073" MODIFIED="1644481099499"/>
<node TEXT=" 空的 context，永远不会被 cancel，没有存储值，也没有 deadline" ID="ID_155841069" CREATED="1644481112689" MODIFIED="1644481114654"/>
<node TEXT=" Background()、TODO()所返回的context" ID="ID_108084246" CREATED="1644481147282" MODIFIED="1644481167837"/>
</node>
<node TEXT=" cancelCtx 结构体" ID="ID_599547235" CREATED="1644481184455" MODIFIED="1644481190123">
<node TEXT=" 可以取消的 Context，实现了 canceler 接口的Context" ID="ID_1850291502" CREATED="1644481335511" MODIFIED="1644481344029"/>
<node TEXT=" WithCancel() 方法" ID="ID_73447204" CREATED="1644482207781" MODIFIED="1644482210328"/>
</node>
<node TEXT=" timerCtx 结构体" ID="ID_1499183239" CREATED="1644482127092" MODIFIED="1644482154859">
<node TEXT=" timerCtx 基于 cancelCtx，只是多了一个 time.Timer 和一个 deadline" ID="ID_1316284294" CREATED="1644482137701" MODIFIED="1644482140894"/>
<node TEXT=" Timer 会在 deadline 到来时，自动取消 context" ID="ID_173767743" CREATED="1644482146941" MODIFIED="1644482147934"/>
<node TEXT=" WithTimeout 函数" ID="ID_778774838" CREATED="1644482244475" MODIFIED="1644482245456"/>
</node>
</node>
<node TEXT="传递共享数据" FOLDED="true" ID="ID_468634572" CREATED="1644461942699" MODIFIED="1644461950437">
<node TEXT="context的读与写" ID="ID_549396694" CREATED="1637307037744" MODIFIED="1637307048082">
<node TEXT="context并发安全，在函数调用的时候传递 context" ID="ID_1411670667" CREATED="1644461983199" MODIFIED="1644461999936"/>
<node ID="ID_427924284" CREATED="1637307112888" MODIFIED="1637307120006"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">myKey</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">keyTraceId</font>&nbsp;:= <font color="#dcdcaa">myKey</font>(<font color="#ce9178">&quot;traceId&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;:= context.<font color="#dcdcaa">Background</font>()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 读取上下文中的traceId</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">value</font>, <font color="#9cdcfe">ok</font>&nbsp;:= ctx.<font color="#dcdcaa">Value</font>(keyTraceId).(<font color="#4ec9b0">string</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(value, ok) <font color="#6a9955">// &quot;&quot; false</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 将traceId写入上下文</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;= context.<font color="#dcdcaa">WithValue</font>(ctx, keyTraceId, <font color="#ce9178">&quot;12345&quot;</font>)
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 读取上下文中的traceId</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">value</font>, <font color="#9cdcfe">ok</font>&nbsp;= ctx.<font color="#dcdcaa">Value</font>(keyTraceId).(<font color="#4ec9b0">string</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(value, ok) <font color="#6a9955">// &quot;12345&quot; true</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="context在请求中共享requestId" ID="ID_866586553" CREATED="1637307168920" MODIFIED="1637307185370">
<node ID="ID_808531122" CREATED="1644463002895" MODIFIED="1644463007789"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">TraceIDKey</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        <font color="#569cd6">const</font>&nbsp;requestIDKey <font color="#9cdcfe">TraceIDKey</font>&nbsp;= <font color="#ce9178">&quot;req-id&quot;</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">WithRequestID</font>(next http.Handler) http.Handler {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;http.<font color="#dcdcaa">HandlerFunc</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">func</font>(rw http.ResponseWriter, req *http.Request) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 从 header 中提取 request-id</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">reqID</font>&nbsp;&nbsp;:= req.Header.<font color="#dcdcaa">Get</font>(<font color="#ce9178">&quot;X-Request-ID&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 创建 valueCtx。使用自定义的类型，不容易冲突</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;&nbsp;:= context.<font color="#dcdcaa">WithValue</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.<font color="#dcdcaa">Context</font>(), requestIDKey, reqID)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 创建新的请求</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">req</font>&nbsp;&nbsp;= req.<font color="#dcdcaa">WithContext</font>(ctx)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 调用 HTTP 处理函数</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next.<font color="#dcdcaa">ServeHTTP</font>(rw, req)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// 获取 request-id</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">GetRequestID</font>(ctx context.Context) <font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">value</font>, <font color="#9cdcfe">ok</font>&nbsp;:= ctx.<font color="#dcdcaa">Value</font>(requestIDKey).(<font color="#4ec9b0">string</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;!ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;value
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">Handle</font>(rw http.ResponseWriter, req *http.Request) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 拿到 reqId，后面可以记录日志等等</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">reqID</font>&nbsp;:= <font color="#dcdcaa">GetRequestID</font>(req.<font color="#dcdcaa">Context</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;handle request:&quot;</font>, req.URL, reqID)
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">handler</font>&nbsp;:= <font color="#dcdcaa">WithRequestID</font>(http.<font color="#dcdcaa">HandlerFunc</font>(Handle))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;http.<font color="#dcdcaa">ListenAndServe</font>(<font color="#ce9178">&quot;:8080&quot;</font>, handler)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 取消 goroutine" FOLDED="true" ID="ID_724036060" CREATED="1644463444962" MODIFIED="1644463453597">
<node TEXT="功能" ID="ID_623165537" CREATED="1644468455913" MODIFIED="1644468459926">
<node TEXT="app打开界面，请求位置信息" ID="ID_866233837" CREATED="1644468408384" MODIFIED="1644468425886"/>
<node TEXT="服务器每秒向客户端发送实时位置信息" ID="ID_1065685809" CREATED="1644468375698" MODIFIED="1644468432877"/>
<node TEXT="app关闭界面，服务器停止这个goroutine" ID="ID_1387856303" CREATED="1644468436889" MODIFIED="1644468494671"/>
</node>
<node TEXT=" context.WithTimeOut" ID="ID_693181279" CREATED="1644470251922" MODIFIED="1644470263741">
<node TEXT=" WithTimeOut 函数返回的 context 和 cancelFun 是分开的" ID="ID_604251500" CREATED="1644470275567" MODIFIED="1644470277032"/>
<node TEXT=" 取消函数只能由外层函数调用，防止子节点 context 调用取消函数，从而严格控制信息的流向：由父节点 context 流向子节点 context" ID="ID_1860233874" CREATED="1644470296778" MODIFIED="1644470319951"/>
<node ID="ID_1757788669" CREATED="1644470350880" MODIFIED="1644470355849"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">Perform</font>(ctx context.Context) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">calculatePos</font>() <font color="#6a9955">// 计算位置</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">sendResult</font>() &nbsp; <font color="#6a9955">// 发送结果</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-ctx.<font color="#dcdcaa">Done</font>():
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 被取消，直接返回</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&lt;-time.<font color="#dcdcaa">After</font>(time.Second):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// block 1 秒钟</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>, <font color="#9cdcfe">cancel</font>&nbsp;:= context.<font color="#dcdcaa">WithTimeout</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.<font color="#dcdcaa">Background</font>(),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.Second*<font color="#b5cea8">5</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#dcdcaa">Perform</font>(ctx)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// ……</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// app 端返回页面，调用cancel 函数</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">cancel</font>()
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="防止goroutine泄漏" FOLDED="true" ID="ID_1463776089" CREATED="1644470367753" MODIFIED="1644470384972">
<node TEXT="消费者完成消费时，生产者应该停止生产，否则生产者goroutine无法回收，发生泄漏" ID="ID_1325965601" CREATED="1644470475296" MODIFIED="1644470564771"/>
<node TEXT="泄漏" ID="ID_898358671" CREATED="1644470578778" MODIFIED="1644470590036">
<node ID="ID_1270723773" CREATED="1644470922855" MODIFIED="1644470927301"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">gen</font>() &lt;-<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(time.Second)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;ch
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;<font color="#dcdcaa">gen</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;i == <font color="#b5cea8">5</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 主循环退出，但gen()协程还在运行</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// gen()协程泄露，无法回收</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">break</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// loop ...</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="ctx通知停止" ID="ID_812842672" CREATED="1644471258735" MODIFIED="1644471272098">
<node TEXT=" 增加一个 context，在 break 前调用 cancel 函数，取消 goroutine" ID="ID_1609272540" CREATED="1644471277358" MODIFIED="1644471279825"/>
<node TEXT=" gen 函数在接收到取消信号后，直接退出，系统回收资源" ID="ID_1794226640" CREATED="1644471286773" MODIFIED="1644471287715"/>
<node ID="ID_900837795" CREATED="1644471228261" MODIFIED="1644471234897"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">gen</font>(ctx context.Context) &lt;-<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ch</font>&nbsp;:= <font color="#dcdcaa">make</font>(<font color="#569cd6">chan</font>&nbsp;<font color="#4ec9b0">int</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;<font color="#4ec9b0">int</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">select</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-ctx.<font color="#dcdcaa">Done</font>():
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">case</font>&nbsp;&nbsp;&lt;-time.<font color="#dcdcaa">Tick</font>(time.Second):
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch &lt;- i
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;ch
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>, <font color="#9cdcfe">cancel</font>&nbsp;:= context.<font color="#dcdcaa">WithCancel</font>(context.<font color="#dcdcaa">Background</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;<font color="#dcdcaa">cancel</font>() &nbsp;<font color="#6a9955">// 避免没有一处调用，重复调用不影响</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">i</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;<font color="#dcdcaa">gen</font>(ctx) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;i == <font color="#b5cea8">5</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">cancel</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">break</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// loop ...</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" context.Value 的查找过程" ID="ID_494631407" CREATED="1644482340949" MODIFIED="1644482342024"/>
</node>
<node TEXT="GRPC" POSITION="right" ID="ID_1825885707" CREATED="1639294657717" MODIFIED="1639294677138">
<edge COLOR="#007c7c"/>
<node TEXT="概念" ID="ID_855433906" CREATED="1639310873514" MODIFIED="1639310876455">
<node TEXT=" Protobuf进行数据编码，提高数据压缩率" ID="ID_1808627511" CREATED="1639310881966" MODIFIED="1639310883121"/>
<node TEXT=" 使用HTTP2.0弥补了HTTP1.1的不足，改善传输性能" ID="ID_1225086884" CREATED="1639310883567" MODIFIED="1639312706642"/>
<node TEXT=" 同样在调用方和服务方使用协议约定文件，提供参数可选，为版本兼容留下缓冲空间" ID="ID_1244854861" CREATED="1639310888679" MODIFIED="1639310894690"/>
</node>
<node TEXT="通用RPC" ID="ID_1006933765" CREATED="1639361431325" MODIFIED="1639362352302">
<node TEXT=" 特点" ID="ID_370705101" CREATED="1639362353714" MODIFIED="1639362354837">
<node TEXT=" 具有需要约定调用语法" ID="ID_1044544799" CREATED="1639362338268" MODIFIED="1639362339234"/>
<node TEXT=" 需要约定内容编码方式" ID="ID_1902890431" CREATED="1639362343602" MODIFIED="1639362344621"/>
<node TEXT=" 需要网络传输" ID="ID_617796257" CREATED="1639362348026" MODIFIED="1639362348777"/>
</node>
<node TEXT="优化" ID="ID_563574120" CREATED="1639372131069" MODIFIED="1639372140047">
<node TEXT=" 尽可能快地序列化、反序列化" ID="ID_1799299048" CREATED="1639372432594" MODIFIED="1639372434109">
<node TEXT="减少CPU的消耗" ID="ID_692715991" CREATED="1639372436593" MODIFIED="1639372451342"/>
</node>
<node TEXT=" 序列化后的体积越小越好" ID="ID_1355349673" CREATED="1639372459714" MODIFIED="1639372460947">
<node TEXT=" 网络中传输，减少宽带占用" ID="ID_686148967" CREATED="1639372468882" MODIFIED="1639372515533"/>
<node TEXT=" 协议栈拷贝成本" ID="ID_216425959" CREATED="1639372551369" MODIFIED="1639372552876"/>
<node TEXT="GC效率" ID="ID_1636579263" CREATED="1639372553066" MODIFIED="1639372562315"/>
</node>
<node TEXT=" 跨语言，和语言无关。简单、类型明确" ID="ID_1540091059" CREATED="1639372671602" MODIFIED="1639372682691"/>
<node TEXT=" 易扩展，可以简单的迭代，向后兼容" ID="ID_863206318" CREATED="1639372676072" MODIFIED="1639372689072"/>
</node>
</node>
<node TEXT="协议 HTTP/2" FOLDED="true" ID="ID_347445620" CREATED="1639295015916" MODIFIED="1639295032159">
<node TEXT="与HTTP1相同的协议" ID="ID_961563035" CREATED="1639295063299" MODIFIED="1639295143645">
<node TEXT="方法 GET/POST..." ID="ID_427309142" CREATED="1639295068947" MODIFIED="1639295082238"/>
<node TEXT="头部 header" ID="ID_1962738632" CREATED="1639295083828" MODIFIED="1639295097268"/>
<node TEXT="body" ID="ID_1895914403" CREATED="1639295097427" MODIFIED="1639295099901"/>
</node>
<node TEXT="传输" ID="ID_1048013850" CREATED="1639295051483" MODIFIED="1639295159863">
<node TEXT=" HTTP 1.x 传输文本格式的数据" ID="ID_1187364339" CREATED="1639295377954" MODIFIED="1639295411152"/>
<node TEXT="HTTP/2是二进制传输" ID="ID_705821418" CREATED="1639295160051" MODIFIED="1639295187804"/>
<node TEXT="HTTP/2是流式转输(streaming)" ID="ID_28678870" CREATED="1639295196985" MODIFIED="1639295214412"/>
</node>
<node TEXT="头部压缩" ID="ID_615994002" CREATED="1639374172970" MODIFIED="1639374185013">
<node TEXT="双方约定一张头部表，传输用索引id代替对应的头部" ID="ID_985002323" CREATED="1639374362465" MODIFIED="1639374435596"/>
<node TEXT=" 每个header对应一个数组索引" ID="ID_10066288" CREATED="1639374216346" MODIFIED="1639374217469"/>
<node TEXT=" 每次只用传这个索引，而不是冗长的文本" ID="ID_996014287" CREATED="1639374222258" MODIFIED="1639374223485"/>
<node TEXT="静态表" ID="ID_1495368429" CREATED="1639374438857" MODIFIED="1639374447508">
<node TEXT=" 将高频使用的Header编成一个静态表" ID="ID_1838717808" CREATED="1639374209475" MODIFIED="1639374210476"/>
<node TEXT=" 静态表是协议级别的约定，是不变的内容" ID="ID_1560171120" CREATED="1639374477641" MODIFIED="1639374478671"/>
<node TEXT="如索引2代表 method: GET,索引3代表 method: POST" ID="ID_1624881561" CREATED="1639374242995" MODIFIED="1639374278164"/>
</node>
<node TEXT=" 动态表" ID="ID_64997872" CREATED="1639374329882" MODIFIED="1639374485218">
<node TEXT=" 动态表是基于当前TCP连接进行协商的结果" ID="ID_109293217" CREATED="1639374501384" MODIFIED="1639374504351"/>
<node TEXT=" 发送请求时会相互设置好header，让请求方和服务方维护同一份动态表，后续的请求可复用" ID="ID_1835882308" CREATED="1639374515072" MODIFIED="1639374524935"/>
<node TEXT=" 连接销毁时，动态表也会注销" ID="ID_151266576" CREATED="1639374529617" MODIFIED="1639374531151"/>
</node>
</node>
<node TEXT="多路复用(fuly multiplexed)" ID="ID_1433057501" CREATED="1639295238914" MODIFIED="1639295253757">
<node TEXT="http1并发请求会有的序列和阻塞机制" ID="ID_654330167" CREATED="1639295495162" MODIFIED="1639295550288">
<node TEXT="http1每个请求建一个链接，浏览器为了控制资源，还会对单个域名有 6-8个的TCP链接请求限制。" ID="ID_874274071" CREATED="1639295282683" MODIFIED="1639295525715"/>
<node TEXT=" 在同一个TCP连接中，没办法区分response是属于哪个请求" ID="ID_303781612" CREATED="1639374650633" MODIFIED="1639374652011"/>
<node TEXT="  在同一个TCP连接中，请求只能一个个串行排队发送，会导致TCP资源的闲置" ID="ID_1201323625" CREATED="1639374671399" MODIFIED="1639374766202"/>
</node>
<node TEXT=" HTTP2复用TCP连接" ID="ID_798042156" CREATED="1639375122271" MODIFIED="1639375142833">
<node TEXT="同一个TCP连接中就可以同时并发多个请求" ID="ID_1452233601" CREATED="1639374896495" MODIFIED="1639375139773"/>
<node TEXT=" 同域名下所有通信都在单个连接上完成，单个连接可以承载任意数量的双向数据流" ID="ID_1030917430" CREATED="1639374912687" MODIFIED="1639374913872"/>
<node TEXT="对比HTTP1,不用再同时建多个连接，提升了TCP的利用效率" ID="ID_1649252926" CREATED="1639375157214" MODIFIED="1639375173321"/>
<node TEXT="流" ID="ID_1115767890" CREATED="1639374795935" MODIFIED="1639374805498">
<node TEXT=" 每一次请求对应一个流，有一个唯一ID，用来区分不同的请求" ID="ID_887711464" CREATED="1639374813927" MODIFIED="1639374815092"/>
<node TEXT=" 流是一个逻辑上的概念，实际上就是一个int类型的ID，可顺序自增，只要不冲突即可" ID="ID_1989180906" CREATED="1639375205589" MODIFIED="1639375207678"/>
</node>
<node TEXT="帧" ID="ID_1968080489" CREATED="1639374816184" MODIFIED="1639374826065">
<node TEXT="帧是数据交互的基本单位" ID="ID_943925377" CREATED="1639375308788" MODIFIED="1639375334520">
<node TEXT=" 一个请求的数据会被分成多个帧，方便进行数据分割传输" ID="ID_1463965412" CREATED="1639374836857" MODIFIED="1639374840411"/>
<node TEXT="每条帧数据都会携带一个流ID" ID="ID_460022346" CREATED="1639374857959" MODIFIED="1639375243472"/>
<node TEXT=" 将帧按照流ID进行分组，即可分离出不同的请求" ID="ID_448198877" CREATED="1639374870400" MODIFIED="1639374871855"/>
</node>
<node TEXT=" 帧类型" ID="ID_327422476" CREATED="1639375296222" MODIFIED="1639375297229">
<node ID="ID_245402030" CREATED="1641297228035" MODIFIED="1641297228035"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      HEADERS：帧仅包含 HTTP header信息。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1908865963" CREATED="1641297228035" MODIFIED="1641297228035"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      DATA：帧包含消息的所有或部分请求数据。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1862459645" CREATED="1641297228042" MODIFIED="1641297228042"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      PRIORITY：指定分配给流的优先级。服务方可先处理高优先请求
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="等等" ID="ID_1459064923" CREATED="1639375380652" MODIFIED="1639375383783"/>
</node>
</node>
</node>
</node>
<node TEXT="安全性提升" ID="ID_332395526" CREATED="1639295320339" MODIFIED="1639295329380"/>
</node>
<node TEXT="Protobuf" FOLDED="true" ID="ID_286863093" CREATED="1639295639631" MODIFIED="1639296200665">
<node TEXT="概念" ID="ID_1614193935" CREATED="1639311056269" MODIFIED="1639311061809">
<node TEXT=" protobuf是一款用C++开发的跨语言、二进制编码的数据序列化协议，以超高的压缩率著称" ID="ID_1148300171" CREATED="1639311075053" MODIFIED="1639311077368"/>
<node TEXT=" 需要双方维护一个协议约束文件，以.proto结尾" ID="ID_1476718328" CREATED="1639311364779" MODIFIED="1639311365808"/>
<node TEXT=" 使用proto命令对文件进行解析，会生成对应的Stub程序，客户端和服务端都需要保存这份Stub程序用来进行编解码" ID="ID_547536357" CREATED="1639312529632" MODIFIED="1639312530928"/>
</node>
<node TEXT="可扩展性" ID="ID_1098825119" CREATED="1639372754537" MODIFIED="1639372764460">
<node TEXT="体现在protobuf的所有字段都是可选的" ID="ID_918874129" CREATED="1639372776064" MODIFIED="1639372786759">
<node TEXT=" protobuf 3 中定义的字段默认都是可选的(可以不传)" ID="ID_421837698" CREATED="1639310939205" MODIFIED="1639310940115"/>
<node TEXT="避免协议文件在不同端因为版本而出现解析问题" ID="ID_1379246576" CREATED="1639310955254" MODIFIED="1639311011315"/>
<node TEXT=" 在接口升级时，部分客户端不需要升级自己的Stub程序" ID="ID_1790705243" CREATED="1639311019629" MODIFIED="1639311020764"/>
</node>
<node TEXT="不填值的字段与填了类型零值的字段是等价的" ID="ID_1846069997" CREATED="1639307524216" MODIFIED="1639307560561">
<node TEXT="即int类型字段填0与不填，生成的二进制流是一样的，生成的json是不含零值字段的" ID="ID_1243250195" CREATED="1639307560759" MODIFIED="1639307722364"/>
<node TEXT="字段的设计必须要考虑到这个问题" ID="ID_152827040" CREATED="1639307916660" MODIFIED="1639307942463"/>
</node>
</node>
<node TEXT="对比JSON" ID="ID_1636032408" CREATED="1639312558400" MODIFIED="1639312568100">
<node TEXT="proto传输二进制，json传输文本" ID="ID_427900044" CREATED="1639312574319" MODIFIED="1639312596269"/>
<node TEXT="proto能对约定的方法名与字段压缩成编号" ID="ID_587282141" CREATED="1639312641111" MODIFIED="1639312681675"/>
<node TEXT="proto比json有几十倍空间和性能提升" ID="ID_1242082199" CREATED="1639312596408" MODIFIED="1639312626867"/>
<node TEXT=" json的设计是给人看的，protobuf则是利于机器" ID="ID_840183961" CREATED="1639373687604" MODIFIED="1639373689193"/>
</node>
<node TEXT="安装" ID="ID_1843616691" CREATED="1639300976343" MODIFIED="1639300978162">
<node TEXT="下载protoc文件，添加进环境变量" ID="ID_800100819" CREATED="1639300978456" MODIFIED="1639300997074"/>
<node TEXT="go安装对应的依赖包" ID="ID_1231867433" CREATED="1639301006942" MODIFIED="1639301046512"/>
</node>
<node TEXT="定义proto文件" ID="ID_225080482" CREATED="1639300868786" MODIFIED="1639300882218">
<node TEXT="定义trip结构的数据类型" ID="ID_1766183160" CREATED="1639300882639" MODIFIED="1639300898955"/>
<node ID="ID_1644235197" CREATED="1639300906103" MODIFIED="1639300917581"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">syntax</font>&nbsp;= <font color="#ce9178">&quot;proto3&quot;</font>;
      </div>
      <div>
        <font color="#569cd6">package</font>&nbsp;<font color="#ce9178">coolcar</font>; &nbsp;<font color="#6a9955">// proto文件的包名，作用不大</font>
      </div>
      <div>
        <font color="#6a9955">// 生成的proto文件的包路径，包名为trippb</font>
      </div>
      <div>
        <font color="#569cd6">option</font>&nbsp;go_package = <font color="#ce9178">&quot;coolcar/proto/gen/go;trippb&quot;</font>;
      </div>
      <div>
        <font color="#6a9955">// imprt trippb &quot;coolcar/proto/gen/go&quot;</font>
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// 定义数据结构, 二进制协议</font>
      </div>
      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">Trip</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 定义字段, 二进制数据的第一个字段是start</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">string</font>&nbsp;<font color="#9cdcfe">start</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">string</font>&nbsp;<font color="#9cdcfe">end</font>&nbsp;= <font color="#b5cea8">2</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int64</font>&nbsp;<font color="#9cdcfe">duration_sec</font>&nbsp;= <font color="#b5cea8">3</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int64</font>&nbsp;<font color="#9cdcfe">fee_cent</font>&nbsp;= <font color="#b5cea8">4</font>;
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="导出go代码" ID="ID_1172687362" CREATED="1639300919583" MODIFIED="1639300928114">
<node TEXT="protoc --go_out=paths=source_relative:gen/go trip.proto" ID="ID_923185119" CREATED="1639301083853" MODIFIED="1639301222956"/>
<node TEXT="生成go代码文件, trip.pb.go" ID="ID_664843883" CREATED="1639301155007" MODIFIED="1639301185143"/>
</node>
<node TEXT="代码引用导出的代码" ID="ID_1498642486" CREATED="1639301230484" MODIFIED="1639301248410">
<node ID="ID_1808956334" CREATED="1639301268525" MODIFIED="1639301271716"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">import</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;trippb <font color="#ce9178">&quot;coolcar/proto/gen/go&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;fmt&quot;</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;google.golang.org/protobuf/proto&quot;</font>
      </div>
      <div>
        )
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">trip</font>&nbsp;:= trippb.Trip{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;abc&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;def&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DurationSec: <font color="#b5cea8">60</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FeeCent: &nbsp;&nbsp;&nbsp; <font color="#b5cea8">100</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 序列化成二进制流</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">b</font>, <font color="#9cdcfe">_</font>&nbsp;:= proto.<font color="#dcdcaa">Marshal</font>(&amp;trip)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%X</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, b)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 0A036162631203646566183C2064</font>
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 二进制流反序列化</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">newTrip</font>&nbsp;:= trippb.Trip{}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;proto.<font color="#dcdcaa">Unmarshal</font>(b, &amp;newTrip)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(&amp;newTrip)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="定义数据结构" ID="ID_290715334" CREATED="1639492633170" MODIFIED="1639492637798">
<node TEXT="定义卡片的数据结构" ID="ID_1806612843" CREATED="1639567929023" MODIFIED="1639567940392">
<node TEXT="message" ID="ID_1713776174" CREATED="1639308057953" MODIFIED="1639308060843"/>
<node ID="ID_1211630187" CREATED="1639567943309" MODIFIED="1639570293596"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">Card</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int32</font>&nbsp;<font color="#9cdcfe">id</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">string</font>&nbsp;<font color="#9cdcfe">name</font>&nbsp;= <font color="#b5cea8">2</font>;
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1748706164" CREATED="1639567991271" MODIFIED="1639570281859"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">// 生成的go代码</font>
      </div>
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Card</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;state &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protoimpl.MessageState
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;sizeCache &nbsp;&nbsp;&nbsp;&nbsp;protoimpl.SizeCache
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;unknownFields protoimpl.UnknownFields
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Id &nbsp; <font color="#4ec9b0">int32</font>&nbsp;&nbsp;<font color="#ce9178">`protobuf:&quot;varint,1,opt,name=id,proto3&quot; json:&quot;id,omitempty&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Name <font color="#4ec9b0">string</font>&nbsp;<font color="#ce9178">`protobuf:&quot;bytes,2,opt,name=name,proto3&quot; json:&quot;name,omitempty&quot;`</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="定义列表结构" ID="ID_384720950" CREATED="1639570319673" MODIFIED="1639570330597">
<node TEXT="repeated" ID="ID_92269621" CREATED="1639308060987" MODIFIED="1639308064731"/>
<node ID="ID_1017576332" CREATED="1639570537863" MODIFIED="1639570645395"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">Book</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int32</font>&nbsp;<font color="#9cdcfe">id</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// cards</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">repeated</font>&nbsp;<font color="#569cd6">Card</font>&nbsp;<font color="#9cdcfe">cards</font>&nbsp;= <font color="#b5cea8">2</font>;
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_393751341" CREATED="1639570697069" MODIFIED="1639570701304"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">// 生成的go代码</font>
      </div>
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Book</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;state &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protoimpl.MessageState
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;sizeCache &nbsp;&nbsp;&nbsp;&nbsp;protoimpl.SizeCache
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;unknownFields protoimpl.UnknownFields
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Id <font color="#4ec9b0">int32</font>&nbsp;<font color="#ce9178">`protobuf:&quot;varint,1,opt,name=id,proto3&quot; json:&quot;id,omitempty&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// cards</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Cards []*Card <font color="#ce9178">`protobuf:&quot;bytes,2,rep,name=cards,proto3&quot; json:&quot;cards,omitempty&quot;`</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="enum" ID="ID_141851816" CREATED="1639308064924" MODIFIED="1639308069084">
<node ID="ID_298865668" CREATED="1639572215030" MODIFIED="1639572218905"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">enum</font>&nbsp;<font color="#4ec9b0">Gender</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">NONE</font>&nbsp;= <font color="#b5cea8">0</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">MAN</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">WOMAN</font>&nbsp;= <font color="#b5cea8">2</font>;
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1204077521" CREATED="1639572244728" MODIFIED="1639572251942"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Gender</font>&nbsp;<font color="#4ec9b0">int32</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">const</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Gender_NONE &nbsp;<font color="#9cdcfe">Gender</font>&nbsp;= <font color="#b5cea8">0</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Gender_MAN &nbsp; <font color="#9cdcfe">Gender</font>&nbsp;= <font color="#b5cea8">1</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;Gender_WOMAN <font color="#9cdcfe">Gender</font>&nbsp;= <font color="#b5cea8">2</font>
      </div>
      <div>
        )
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="设置Json中的枚举为数字类型" ID="ID_721389528" CREATED="1639572311318" MODIFIED="1641299989254">
<node TEXT="枚举在序列化成Json时，默认为字符串" ID="ID_1109880661" CREATED="1639572253663" MODIFIED="1639572311097"/>
<node TEXT="服务注册到GRPCGateway时，配置 mux" ID="ID_1767478710" CREATED="1639572374742" MODIFIED="1639572434360"/>
<node ID="ID_1436908527" CREATED="1639572445677" MODIFIED="1639572504981"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">mux</font>&nbsp;:= runtime.<font color="#dcdcaa">NewServeMux</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.<font color="#dcdcaa">WithMarshalerOption</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.MIMEWildcard,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;runtime.JSONPb{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarshalOptions: protojson.MarshalOptions{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UseEnumNumbers: <font color="#569cd6">true</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="定义服务" ID="ID_655600488" CREATED="1639492638338" MODIFIED="1639492641533">
<node TEXT="trip.proto" ID="ID_100500875" CREATED="1641387503895" MODIFIED="1641387510715">
<node ID="ID_277917884" CREATED="1639572944788" MODIFIED="1639572950896"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">GetTripRequest</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int32</font>&nbsp;<font color="#9cdcfe">id</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// 定义服务与rpc</font>
      </div>
      <div>
        <font color="#569cd6">service</font>&nbsp;<font color="#4ec9b0">TripService</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">rpc</font>&nbsp;<font color="#dcdcaa">GetTrip</font>(<font color="#4ec9b0">GetTripRequest</font>) <font color="#569cd6">returns</font>&nbsp;&nbsp;(<font color="#4ec9b0">Trip</font>);
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="trip.yaml" ID="ID_1609394307" CREATED="1641387513314" MODIFIED="1641387517015">
<node ID="ID_886350469" CREATED="1641387550220" MODIFIED="1641387554546"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">type</font>: <font color="#ce9178">google.api.Service</font>
      </div>
      <div>
        <font color="#569cd6">config_version</font>: <font color="#b5cea8">3</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">http</font>:
      </div>
      <div>
        &nbsp; <font color="#569cd6">rules</font>:
      </div>
      <div>
        &nbsp; <font color="#6a9955"># coolcar是proto文件中的package名, 路径是proto文件的路径</font>
      </div>
      <div>
        &nbsp;&nbsp;- <font color="#569cd6">selector</font>: <font color="#ce9178">coolcar.TripService.GetTrip</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955"># 暴露的restful接口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">get</font>: <font color="#ce9178">/trip/{id}</font>
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="生成代码的命令与数据结构不同" ID="ID_69698445" CREATED="1639572986723" MODIFIED="1639573012463">
<node TEXT=" protoc --grpc-gateway_out=paths=source_relative,grpc_api_configuration=trip.yaml:gen/go trip.proto" ID="ID_1717843708" CREATED="1639573013243" MODIFIED="1639573015514"/>
</node>
<node TEXT="注册服务接口用RegisterTripServiceHandlerFromEndpoint" ID="ID_1659863689" CREATED="1639573154515" MODIFIED="1639573164598"/>
</node>
</node>
<node TEXT="最小原型" ID="ID_1717145731" CREATED="1639492369988" MODIFIED="1639492376602">
<node TEXT="proto文件" ID="ID_941808666" CREATED="1639492393051" MODIFIED="1639492409770">
<node ID="ID_252548601" CREATED="1639492428027" MODIFIED="1639492441984"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">syntax</font>&nbsp;= <font color="#ce9178">&quot;proto3&quot;</font>;
      </div>
      <div>
        <font color="#569cd6">package</font>&nbsp;<font color="#ce9178">coolcar</font>; &nbsp;<font color="#6a9955">// proto文件的包名，作用不大</font>
      </div>
      <div>
        <font color="#6a9955">// 生成的proto文件的包路径，包名为trippb</font>
      </div>
      <div>
        <font color="#569cd6">option</font>&nbsp;go_package = <font color="#ce9178">&quot;coolcar/proto/gen/go;trippb&quot;</font>;
      </div>
      <div>
        <font color="#6a9955">// imprt trippb &quot;coolcar/proto/gen/go&quot;</font>
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// 定义数据结构, 二进制协议</font>
      </div>
      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">Trip</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 定义字段, 二进制数据的第一个字段是start</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int32</font>&nbsp;<font color="#9cdcfe">id</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">string</font>&nbsp;<font color="#9cdcfe">start</font>&nbsp;= <font color="#b5cea8">2</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">string</font>&nbsp;<font color="#9cdcfe">end</font>&nbsp;= <font color="#b5cea8">3</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int64</font>&nbsp;<font color="#9cdcfe">duration_sec</font>&nbsp;= <font color="#b5cea8">4</font>;
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int64</font>&nbsp;<font color="#9cdcfe">fee_cent</font>&nbsp;= <font color="#b5cea8">5</font>;
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">message</font>&nbsp;<font color="#4ec9b0">GetTripRequest</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">int32</font>&nbsp;<font color="#9cdcfe">id</font>&nbsp;= <font color="#b5cea8">1</font>;
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// 定义服务与rpc</font>
      </div>
      <div>
        <font color="#569cd6">service</font>&nbsp;<font color="#4ec9b0">TripService</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">rpc</font>&nbsp;<font color="#dcdcaa">GetTrip</font>(<font color="#4ec9b0">GetTripRequest</font>) <font color="#569cd6">returns</font>&nbsp;&nbsp;(<font color="#4ec9b0">Trip</font>);
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="服务器" ID="ID_1973112359" CREATED="1639492363986" MODIFIED="1639492369670">
<node ID="ID_842475470" CREATED="1639492505155" MODIFIED="1639492511767"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">package</font>&nbsp;tripservice
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">import</font>&nbsp;(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;context&quot;</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;trippb <font color="#ce9178">&quot;coolcar/proto/gen/go&quot;</font>
      </div>
      <div>
        )
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">Service</font>&nbsp;<font color="#569cd6">struct</font>{}
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(*Service) <font color="#dcdcaa">GetTrip</font>(c context.Context, req *trippb.GetTripRequest) (*trippb.Trip, <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;&amp;trippb.Trip{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Id: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.Id,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;New York&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;London&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DurationSec: <font color="#b5cea8">3600</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FeeCent: &nbsp;&nbsp;&nbsp; <font color="#b5cea8">2000</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}, <font color="#569cd6">nil</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1803873440" CREATED="1639492540339" MODIFIED="1639492548883"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">lit</font>, <font color="#9cdcfe">err</font>&nbsp;:= net.<font color="#dcdcaa">Listen</font>(<font color="#ce9178">&quot;tcp&quot;</font>, <font color="#ce9178">&quot;:8080&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Fatalf</font>(<font color="#ce9178">&quot;failed to listen: </font><font color="#9cdcfe">%v</font><font color="#ce9178">&quot;</font>, err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s</font>&nbsp;:= grpc.<font color="#dcdcaa">NewServer</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;trippb.<font color="#dcdcaa">RegisterTripServiceServer</font>(s, &amp;tripservice.Service{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Fatalf</font>(<font color="#ce9178">&quot;failed to serve: </font><font color="#9cdcfe">%v</font><font color="#ce9178">&quot;</font>, s.<font color="#dcdcaa">Serve</font>(lit))
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="客户端" ID="ID_1462603776" CREATED="1639492379155" MODIFIED="1639492382665">
<node TEXT="收到的是二进制数据，再转为对象" ID="ID_1142172501" CREATED="1639573234795" MODIFIED="1639573377236"/>
<node ID="ID_1621445108" CREATED="1639492588098" MODIFIED="1639573711126"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">conn</font>, <font color="#9cdcfe">err</font>&nbsp;:= grpc.<font color="#dcdcaa">Dial</font>(<font color="#ce9178">&quot;localhost:8081&quot;</font>, grpc.<font color="#dcdcaa">WithInsecure</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Fatalf</font>(<font color="#ce9178">&quot;failed to dial: </font><font color="#9cdcfe">%v</font><font color="#ce9178">&quot;</font>, err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">tsClient</font>&nbsp;:= trippb.<font color="#dcdcaa">NewTripServiceClient</font>(conn)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>, <font color="#9cdcfe">err</font>&nbsp;:= tsClient.<font color="#dcdcaa">GetTrip</font>(context.<font color="#dcdcaa">Background</font>(), &amp;trippb.GetTripRequest{Id: <font color="#b5cea8">111</font>})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.<font color="#dcdcaa">Fatalf</font>(<font color="#ce9178">&quot;failed to get trip: </font><font color="#9cdcfe">%v</font><font color="#ce9178">&quot;</font>, err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(r) &nbsp;<font color="#6a9955">// r is trippb.Trip</font>
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="gRPC over HTTP" FOLDED="true" ID="ID_387381913" CREATED="1639544487216" MODIFIED="1639544515959">
<node TEXT="反向代理" ID="ID_217896751" CREATED="1639544826619" MODIFIED="1639545224837">
<node TEXT="GRPC暴露给用HTTP的前端" ID="ID_966343374" CREATED="1639544559741" MODIFIED="1639544629905"/>
<node TEXT=" 分发请求给内网服务" ID="ID_766284802" CREATED="1639545225169" MODIFIED="1639545227455"/>
</node>
<node TEXT="方案" ID="ID_1731846333" CREATED="1639545238449" MODIFIED="1639545243500">
<node TEXT=" GRPC Web Proxy" ID="ID_799248472" CREATED="1639544535885" MODIFIED="1639544552769">
<node TEXT="用protobuf的二进制流通信，端到端全用grpc，更替rest api" ID="ID_326555746" CREATED="1639544670357" MODIFIED="1639548262261"/>
<node TEXT="http协议更适用于文本数据，实现要求较高" ID="ID_1995716732" CREATED="1639544923546" MODIFIED="1639544953942"/>
<node TEXT=" gRPC-Web是一个JavaScript客户端库，可以使Web应用程序直接与后端gRPC服务进行通信" ID="ID_1256471118" CREATED="1639548134546" MODIFIED="1639548135727"/>
</node>
<node TEXT=" GRPC Gateway" ID="ID_180663994" CREATED="1639544516558" MODIFIED="1639544535619">
<node TEXT="用json数据与前端通信" ID="ID_1447209575" CREATED="1639544965850" MODIFIED="1639545022495"/>
<node TEXT="向外暴露rest api接口，向内用rpc调用" ID="ID_919013439" CREATED="1639545093298" MODIFIED="1639545131461"/>
<node TEXT="分发请求时，把json转成二进制" ID="ID_1578297125" CREATED="1639545006178" MODIFIED="1639545043821"/>
<node ID="ID_215668271" CREATED="1639573413465" MODIFIED="1645710832636"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="rgb(86, 156, 214)">func</font>&nbsp;<font color="rgb(220, 220, 170)">startGRPCGateway</font>() {<br/>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">c</font>&nbsp;:= context.<font color="#dcdcaa">Background</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 可以取消的context</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">c</font>, <font color="#9cdcfe">cancel</font>&nbsp;:= context.<font color="#dcdcaa">WithCancel</font>(c)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;<font color="#dcdcaa">cancel</font>()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">mux</font>&nbsp;:= runtime.<font color="#dcdcaa">NewServeMux</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.<font color="#dcdcaa">WithMarshalerOption</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.MIMEWildcard,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;runtime.JSONPb{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarshalOptions: protojson.MarshalOptions{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UseEnumNumbers: <font color="#569cd6">true</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">endport</font>&nbsp;:= <font color="#ce9178">&quot;:8081&quot;</font>&nbsp;<font color="#6a9955">// trip服务的端口</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;trippb.<font color="#dcdcaa">RegisterTripServiceHandlerFromEndpoint</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mux,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endport,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]grpc.DialOption{grpc.<font color="#dcdcaa">WithInsecure</font>()},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        <br/>
        
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;start grpc gateway 8080&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;http.<font color="#dcdcaa">ListenAndServe</font>(<font color="#ce9178">&quot;:8080&quot;</font>, mux)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT=" Interceptor 拦截器" FOLDED="true" ID="ID_87433085" CREATED="1645764170953" MODIFIED="1645771002028" VGAP_QUANTITY="6.9 pt">
<node TEXT="概念" ID="ID_1633132233" CREATED="1645764988752" MODIFIED="1645764997684">
<node TEXT=" 功能类似middleware，在调用rpc方法之前" ID="ID_567724893" CREATED="1645764998552" MODIFIED="1645765036195"/>
<node TEXT=" 适合在这里处理验证、日志等流程" ID="ID_1816697016" CREATED="1645765009528" MODIFIED="1645765010987"/>
<node TEXT=" go-grpc-middleware 中也提供了多种常用 interceptor ，可以直接使用" ID="ID_1155888618" CREATED="1645768995821" MODIFIED="1645768996800"/>
</node>
<node TEXT="注册" ID="ID_1883021002" CREATED="1645770910571" MODIFIED="1645771002027">
<node TEXT="客户端拦截器 在 Dial的时候指定相应的 DialOption" ID="ID_562325488" CREATED="1645769052292" MODIFIED="1645769077822"/>
<node TEXT="服务器拦截器 在 NewServer 的时候指定相应的 ServerOption" ID="ID_537397479" CREATED="1645769097115" MODIFIED="1645769107876"/>
</node>
<node TEXT="分类" ID="ID_1551497963" CREATED="1645765136846" MODIFIED="1645765139328">
<node TEXT="一元拦截器 UnaryInterceptor" ID="ID_757865900" CREATED="1645765139535" MODIFIED="1645765154121">
<node TEXT="UnaryServerInterceptor 服务器" ID="ID_1190566990" CREATED="1645765358812" MODIFIED="1645765396768">
<node TEXT=" 提供了一个钩子来拦截服务器上单一RPC的执行" ID="ID_1279238838" CREATED="1645765230463" MODIFIED="1645765233180"/>
<node TEXT="注册" ID="ID_912226112" CREATED="1645764543334" MODIFIED="1645764546539">
<node TEXT=" grpc.UnaryInterceptor，接收一个UnaryServerInterceptor类型的函数" ID="ID_24011669" CREATED="1645764485053" MODIFIED="1645765288506"/>
<node ID="ID_1092914268" CREATED="1645764547125" MODIFIED="1645764551108"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">in</font>, <font color="#9cdcfe">err</font>&nbsp;:= shareauth.<font color="#dcdcaa">GetInterceptor</font>(PublicKeyPath)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Logger.<font color="#dcdcaa">Fatal</font>(<font color="#ce9178">&quot;failed to get auth interceptor&quot;</font>, zap.<font color="#dcdcaa">Error</font>(err))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">s</font>&nbsp;:= grpc.<font color="#dcdcaa">NewServer</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grpc.<font color="#dcdcaa">UnaryInterceptor</font>(in),
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="实现拦载器" ID="ID_1690254381" CREATED="1645764553381" MODIFIED="1645764704224">
<node TEXT="实现UnaryServerInterceptor类型" ID="ID_262021357" CREATED="1645764772314" MODIFIED="1645764777261"/>
<node TEXT="参数" ID="ID_1910104866" CREATED="1645769131971" MODIFIED="1645769133975">
<node ID="ID_617548142" CREATED="1645770047030" MODIFIED="1645770047030"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      ctx context.Context：请求上下文
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_899927400" CREATED="1645770047030" MODIFIED="1645770047030"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      req interface{}：RPC 方法的请求参数
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_842904168" CREATED="1645770047031" MODIFIED="1645770047031"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      info *UnaryServerInfo：RPC 方法的所有信息
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="handler UnaryHandler" ID="ID_1066885133" CREATED="1645770047033" MODIFIED="1645770220704">
<node TEXT=" 自定义的RPC 方法，在拦截器最后执行" ID="ID_1335430692" CREATED="1645770223007" MODIFIED="1645770541999"/>
<node ID="ID_327159496" CREATED="1645770215463" MODIFIED="1645770215463"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      hander(ctx, req) 执行的自定义的Rpc方法
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="空白" ID="ID_1724742790" CREATED="1645764704764" MODIFIED="1645764710295">
<node ID="ID_725451113" CREATED="1645764711459" MODIFIED="1645764726068"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;(i *interceptor) <font color="#dcdcaa">MyServerInterceptor</font>(ctx context.Context,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;req <font color="#569cd6">interface</font>{}, info *grpc.UnaryServerInfo,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;handler grpc.UnaryHandler) (resp <font color="#569cd6">interface</font>{}, err <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// ...处理</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">handler</font>(ctx, req)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node ID="ID_581582422" CREATED="1645764729324" MODIFIED="1645764759576"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;(i *interceptor) <font color="#dcdcaa">VerifyRequst</font>(ctx context.Context,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;req <font color="#569cd6">interface</font>{}, info *grpc.UnaryServerInfo,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;handler grpc.UnaryHandler) (resp <font color="#569cd6">interface</font>{}, err <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 从ctx中的metadata(request.HEADER)中获取token</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">tkn</font>, <font color="#9cdcfe">err</font>&nbsp;:= <font color="#dcdcaa">getTokenFromCtx</font>(ctx)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#569cd6">nil</font>, err
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// jwt验证</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">userID</font>, <font color="#9cdcfe">err</font>&nbsp;:= i.verifier.<font color="#dcdcaa">Verify</font>(tkn)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#569cd6">nil</font>, status.<font color="#dcdcaa">Error</font>(codes.Unauthenticated, <font color="#ce9178">&quot;&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 注入userID</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;= <font color="#dcdcaa">ContextWithUserID</font>(ctx, userID)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">handler</font>(ctx, req)
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" UnaryClientInterceptor 客户端" ID="ID_207531121" CREATED="1645765406980" MODIFIED="1645765412550">
<node TEXT="    // 加上拦截器&#xa;   opts = append(opts, grpc.WithUnaryInterceptor(Clientinterceptor))&#xa;&#xa;   conn, err := grpc.Dial(Address, opts...)" ID="ID_1156127087" CREATED="1645765479148" MODIFIED="1645765481158"/>
</node>
</node>
<node TEXT="流式拦截器 StreamInterceptor" ID="ID_566275198" CREATED="1645765154790" MODIFIED="1645765170618">
<node TEXT=" StreamServerInterceptor" ID="ID_959056276" CREATED="1645765599803" MODIFIED="1645765601710"/>
<node TEXT=" StreamClientInterceptor" ID="ID_200226570" CREATED="1645765605497" MODIFIED="1645765606486"/>
</node>
</node>
<node TEXT="链式拦截器" ID="ID_187058286" CREATED="1645770410446" MODIFIED="1645770417095">
<node TEXT=" 利用 Golang 的闭包 / 递归特性，在包装一下hander(ctx, req)实现" ID="ID_306284085" CREATED="1645770638812" MODIFIED="1645770672187"/>
<node TEXT="注意" ID="ID_99366043" CREATED="1645765521019" MODIFIED="1645765523156">
<node TEXT="服务器只能配置一个 UnaryInterceptor和StreamClientInterceptor，否则会报错" ID="ID_358784663" CREATED="1645765174446" MODIFIED="1645765518606"/>
<node TEXT=" 客户端只有最后一个配置才起作用" ID="ID_377883749" CREATED="1645765519186" MODIFIED="1645765557338"/>
<node TEXT=" 想配置多个，可以使用拦截器链，如go-grpc-middleware，或者自己实现" ID="ID_552888725" CREATED="1645765581867" MODIFIED="1645765583326"/>
</node>
<node TEXT=" 新版本的 gRPC内置的链式 Interceptor 实现" ID="ID_131185551" CREATED="1645770435869" MODIFIED="1645770466791">
<node TEXT=" WithChainUnaryInterceptor" ID="ID_1403321427" CREATED="1645770445118" MODIFIED="1645770449216"/>
<node TEXT="  WithChainStreamInterceptor" ID="ID_606579617" CREATED="1645770449414" MODIFIED="1645770450478"/>
</node>
</node>
</node>
<node TEXT="从grpc context 获取authenticated beaere token" ID="ID_719520006" CREATED="1645765709097" MODIFIED="1645765806458">
<node ID="ID_1975724698" CREATED="1645765742601" MODIFIED="1645765980762"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">getTokenFromCtx</font>(ctx context.Context) (<font color="#4ec9b0">string</font>, <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">unauthenticated</font>&nbsp;:= status.<font color="#dcdcaa">Error</font>(codes.Unauthenticated, <font color="#ce9178">&quot;&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 从ctx中的metadata(request.HEADER)中获取token</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">md</font>, <font color="#9cdcfe">ok</font>&nbsp;:= metadata.<font color="#dcdcaa">FromIncomingContext</font>(ctx)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;!ok {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>, unauthenticated
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">tkn</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 可以有多个authorization Header</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;<font color="#9cdcfe">_</font>, <font color="#9cdcfe">v</font>&nbsp;:= <font color="#c586c0">range</font>&nbsp;md[<font color="#ce9178">&quot;authorization&quot;</font>] {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;strings.<font color="#dcdcaa">HasPrefix</font>(v, <font color="#ce9178">&quot;Bearer &quot;</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">tkn</font>&nbsp;&nbsp;= v[<font color="#dcdcaa">len</font>(<font color="#ce9178">&quot;Bearer &quot;</font>):]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">break</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;tkn == <font color="#ce9178">&quot;&quot;</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#ce9178">&quot;&quot;</font>, unauthenticated
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;tkn, <font color="#569cd6">nil</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="grpc-gateway" ID="ID_1799151257" CREATED="1645710849886" MODIFIED="1645765728148"/>
<node TEXT=" 服务发现" ID="ID_618125047" CREATED="1645606588926" MODIFIED="1645606591305">
<node TEXT=" 客户端路由" ID="ID_1808763681" CREATED="1645606606238" MODIFIED="1645606607175">
<node TEXT=" 调用方负责获取被调用方的地址信息，并使用相应的负载均衡算法发起请求" ID="ID_1034416964" CREATED="1645606631278" MODIFIED="1645606632336"/>
<node TEXT="&lt;注册服务&gt;维护正在启动中的服务信息。服务启动时，向&lt;注册服务&gt;进行注册。退出时，请求注销" ID="ID_1956588190" CREATED="1645606645365" MODIFIED="1645606896375"/>
<node TEXT="客户端访问&lt;注册服务&gt;，获取服务列表(ip、端口)" ID="ID_1034569207" CREATED="1645606703783" MODIFIED="1645606798159"/>
<node TEXT=" 调用方通过负载均衡算法选取其中一个服务发起请求" ID="ID_534267840" CREATED="1645606766412" MODIFIED="1645606808621"/>
</node>
<node TEXT=" 代理层路由" ID="ID_1316755888" CREATED="1645606607621" MODIFIED="1645606907258">
<node TEXT=" 不是由调用方去获取被调方的地址，而是通过代理的方式，由代理去获取被调方的地址、发起调用请求" ID="ID_1964092533" CREATED="1645606917082" MODIFIED="1645606918290"/>
<node TEXT="客户端简单调用Proxy，Proxy请求&lt;注册服务&gt;，Proxy请求具体服务" ID="ID_260545769" CREATED="1645606918897" MODIFIED="1645607003120"/>
<node TEXT="代理层去进行 server 寻址、负载均衡等" ID="ID_1018431801" CREATED="1645607009250" MODIFIED="1645607023337"/>
</node>
<node TEXT="grpc是客户端路由模式" ID="ID_618866644" CREATED="1645607036530" MODIFIED="1645607046602"/>
<node TEXT=" grpc 的服务发现，主要通过 resolver 接口去定义，支持业务自己实现服务发现的 resolver" ID="ID_1109498180" CREATED="1645607366494" MODIFIED="1645607368407"/>
</node>
<node TEXT="负载均衡" ID="ID_1847847480" CREATED="1645607480421" MODIFIED="1645607493575">
<node TEXT=" grpc 的负载均衡是基于一次请求而不是一次连接的" ID="ID_341062559" CREATED="1645607501965" MODIFIED="1645607503011"/>
<node TEXT=" 来自同一个客户端的连接的多个请求，这些请求还是会被均衡到所有服务器" ID="ID_1233306722" CREATED="1645607511939" MODIFIED="1645607541016"/>
</node>
</node>
<node TEXT="微服务" POSITION="right" ID="ID_470252743" CREATED="1639632241502" MODIFIED="1639632246106">
<edge COLOR="#7c7c00"/>
<node TEXT="特性" ID="ID_699954574" CREATED="1639632499929" MODIFIED="1639632503964">
<node TEXT="初衷" ID="ID_195178346" CREATED="1639632856665" MODIFIED="1639632867883">
<node TEXT="快速开发/迭代" ID="ID_1385520304" CREATED="1639632504233" MODIFIED="1639632546773"/>
<node TEXT="独立布署" ID="ID_1383958832" CREATED="1639632546936" MODIFIED="1639632555636"/>
<node TEXT="错误隔离" ID="ID_564277826" CREATED="1639632555867" MODIFIED="1639632561452"/>
</node>
<node TEXT="治理特性" ID="ID_1566777316" CREATED="1639632613698" MODIFIED="1639632620268">
<node TEXT="引入微服务，同时也引入了复杂性" ID="ID_1301025331" CREATED="1639632670338" MODIFIED="1639632698549"/>
<node TEXT="因治理微服务复杂性而产生的特性" ID="ID_1663420736" CREATED="1639632254234" MODIFIED="1639632647235"/>
<node TEXT="" ID="ID_1170227839" CREATED="1639632649778" MODIFIED="1639632649778">
<node TEXT="自动化部署" ID="ID_1326814454" CREATED="1639632324210" MODIFIED="1639632333924"/>
<node TEXT="负载均衡" ID="ID_271885682" CREATED="1639632334169" MODIFIED="1639632348628"/>
<node TEXT="出错处理" ID="ID_790856574" CREATED="1639632348915" MODIFIED="1639632354389"/>
<node TEXT="链路跟踪" ID="ID_492260057" CREATED="1639632354625" MODIFIED="1639632361692"/>
<node TEXT="服务发现" ID="ID_1831832408" CREATED="1639632362017" MODIFIED="1639632367755"/>
<node TEXT="服务治理" ID="ID_1449543819" CREATED="1639632367979" MODIFIED="1639632373084"/>
</node>
</node>
<node TEXT="因治理物性而产生的特性" ID="ID_1760440359" CREATED="1639632721471" MODIFIED="1639632772922">
<node TEXT="动态扩容" ID="ID_1528746310" CREATED="1639632561666" MODIFIED="1639632568373"/>
<node TEXT="熔断，降级" ID="ID_124679831" CREATED="1639632568594" MODIFIED="1639632577173"/>
</node>
</node>
<node TEXT="划分" ID="ID_708923335" CREATED="1639632958711" MODIFIED="1639632961075">
<node TEXT="领域驱动" ID="ID_284469537" CREATED="1639632987704" MODIFIED="1639632996883">
<node TEXT="划分领域(对事物的逻辑角度)" ID="ID_191884107" CREATED="1639632999919" MODIFIED="1639633066834"/>
<node TEXT="确定上下文边界(对事务的实现角度)" ID="ID_347685037" CREATED="1639633007145" MODIFIED="1639633088965"/>
<node TEXT="上下文映射（在不同领域上的映射）" ID="ID_1533124442" CREATED="1639633013734" MODIFIED="1639633145803"/>
<node TEXT="确定微服务边界 （包含哪些领域）" ID="ID_789751439" CREATED="1639633022529" MODIFIED="1639633173613"/>
</node>
<node TEXT="" ID="ID_67276990" CREATED="1639632997126" MODIFIED="1639632997126"/>
</node>
<node TEXT="目录" ID="ID_1086093109" CREATED="1644581945188" MODIFIED="1644581952809">
<node TEXT="server 服务器根目录" ID="ID_1419311705" CREATED="1644581953044" MODIFIED="1644581968326">
<node TEXT="auth服务" ID="ID_801333955" CREATED="1644581971765" MODIFIED="1644591030716">
<node TEXT="auth 逻辑" ID="ID_272269309" CREATED="1644581976131" MODIFIED="1644581983175"/>
<node TEXT="dao 持久层" ID="ID_1935967778" CREATED="1644581983346" MODIFIED="1644582033978"/>
<node TEXT="api" ID="ID_753367941" CREATED="1644581991043" MODIFIED="1644646947350">
<node TEXT="grpc 的配置与生成代码" ID="ID_246243412" CREATED="1644646947931" MODIFIED="1644647453315"/>
<node TEXT="gen 目录放生成的代码" ID="ID_1506862177" CREATED="1644647411297" MODIFIED="1644647441987"/>
<node TEXT="auth.proto" ID="ID_570518385" CREATED="1644647352384" MODIFIED="1644647360069"/>
<node TEXT="auth.yaml" ID="ID_1328374306" CREATED="1644647360408" MODIFIED="1644647366387"/>
</node>
<node TEXT="wechat 第三方服务接入" ID="ID_1340155309" CREATED="1644647527503" MODIFIED="1644647540331"/>
</node>
<node TEXT="gateway服务" ID="ID_83932053" CREATED="1644646886823" MODIFIED="1644647034424">
<node TEXT="grpc转换json，暴露接口" ID="ID_1847230398" CREATED="1644646979492" MODIFIED="1644647028878"/>
</node>
<node TEXT="shared 各服务共享代码目录" ID="ID_848442606" CREATED="1644647548511" MODIFIED="1644647573873"/>
<node TEXT="cmd" ID="ID_138213650" CREATED="1644654625242" MODIFIED="1644654627467"/>
</node>
</node>
</node>
<node TEXT="mongodb" POSITION="right" ID="ID_1891010478" CREATED="1641877639034" MODIFIED="1641877648859">
<edge COLOR="#00ff00"/>
<node TEXT="引入" FOLDED="true" ID="ID_972111145" CREATED="1641877650437" MODIFIED="1641877663095">
<node TEXT=" go get go.mongodb.org/mongo-driver/mongo" ID="ID_1850446437" CREATED="1641877808069" MODIFIED="1641877811529"/>
</node>
<node TEXT="连接并获取集合" FOLDED="true" ID="ID_1291183567" CREATED="1644493575049" MODIFIED="1644493602676">
<node ID="ID_1704275806" CREATED="1644493605082" MODIFIED="1644495659841"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;:= context.<font color="#dcdcaa">Background</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">mc</font>, <font color="#9cdcfe">_</font>&nbsp;:= mongo.<font color="#dcdcaa">Connect</font>(ctx,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options.<font color="#dcdcaa">Client</font>().<font color="#dcdcaa">ApplyURI</font>(<font color="#ce9178">&quot;mongodb://localhost:27017&quot;</font>))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">db</font>&nbsp;:= mc.<font color="#dcdcaa">Database</font>(<font color="#ce9178">&quot;coolcar&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">col</font>&nbsp;:= db.<font color="#dcdcaa">Collection</font>(<font color="#ce9178">&quot;account&quot;</font>)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="插入一条" FOLDED="true" ID="ID_1267173478" CREATED="1644494561449" MODIFIED="1644494566372">
<node TEXT="col.InsertOne" ID="ID_1272506192" CREATED="1644494577553" MODIFIED="1644494583249"/>
<node ID="ID_1312355961" CREATED="1644494568192" MODIFIED="1644494572602"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">col</font>&nbsp;:= mc.<font color="#dcdcaa">Database</font>(<font color="#ce9178">&quot;coolcar&quot;</font>).<font color="#dcdcaa">Collection</font>(<font color="#ce9178">&quot;account&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">res</font>, <font color="#9cdcfe">err</font>&nbsp;:= col.<font color="#dcdcaa">InsertOne</font>(ctx, bson.M{<font color="#ce9178">&quot;openid&quot;</font>: <font color="#ce9178">&quot;aaa&quot;</font>})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%+v</font><font color="#ce9178">&nbsp;</font><font color="#9cdcfe">%+v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, res.InsertedID, err)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="插入多条" FOLDED="true" ID="ID_52169791" CREATED="1644493558464" MODIFIED="1644493563492">
<node TEXT="col.InsertMany" ID="ID_54978442" CREATED="1644495056621" MODIFIED="1644495062821"/>
<node ID="ID_1428636789" CREATED="1644495048259" MODIFIED="1644495054545"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">res</font>, <font color="#9cdcfe">err</font>&nbsp;:= col.<font color="#dcdcaa">InsertMany</font>(ctx, []<font color="#569cd6">interface</font>{}{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bson.M{<font color="#ce9178">&quot;openid&quot;</font>: <font color="#ce9178">&quot;111&quot;</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bson.M{<font color="#ce9178">&quot;openid&quot;</font>: <font color="#ce9178">&quot;222&quot;</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%+v</font><font color="#ce9178">&nbsp;</font><font color="#9cdcfe">%+v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, res.InsertedIDs, err)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="查找单条" FOLDED="true" ID="ID_1627132529" CREATED="1641879734929" MODIFIED="1641880009098">
<node TEXT="col.FindOne" ID="ID_34718086" CREATED="1644493507867" MODIFIED="1644493514228"/>
<node TEXT="Decode是有可能出错了，返回err" ID="ID_1029653109" CREATED="1644495351852" MODIFIED="1644495363724"/>
<node ID="ID_924648414" CREATED="1641879912489" MODIFIED="1645670021780"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">sr</font>&nbsp;:= col.<font color="#dcdcaa">FindOne</font>(ctx, bson.M{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">row</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 字段需要大写开头才能Decode</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID &nbsp;&nbsp;&nbsp;&nbsp;primitive.ObjectID <font color="#ce9178">`bson:&quot;_id&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenID <font color="#4ec9b0">string</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">`bson:&quot;openid&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;sr.<font color="#dcdcaa">Decode</font>(&amp;row)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Printf</font>(<font color="#ce9178">&quot;</font><font color="#9cdcfe">%+v</font><font color="#d7ba7d">\n</font><font color="#ce9178">&quot;</font>, row)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="查找多条" FOLDED="true" ID="ID_1631310076" CREATED="1641880001592" MODIFIED="1645860111321" VGAP_QUANTITY="6.9 pt">
<node TEXT="col.Find" ID="ID_388048823" CREATED="1644493516515" MODIFIED="1644493519413"/>
<node ID="ID_25941600" CREATED="1641880188431" MODIFIED="1645860111320"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ctx</font>&nbsp;:= context.<font color="#dcdcaa">Background</font>()
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">mc</font>, <font color="#9cdcfe">_</font>&nbsp;:= mongo.<font color="#dcdcaa">Connect</font>(ctx, options.<font color="#dcdcaa">Client</font>().<font color="#dcdcaa">ApplyURI</font>(<font color="#ce9178">&quot;mongodb://localhost:27017&quot;</font>))
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">col</font>&nbsp;:= mc.<font color="#dcdcaa">Database</font>(<font color="#ce9178">&quot;coolcar&quot;</font>).<font color="#dcdcaa">Collection</font>(<font color="#ce9178">&quot;account&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">cur</font>, <font color="#9cdcfe">_</font>&nbsp;:= col.<font color="#dcdcaa">Find</font>(ctx, bson.M{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">for</font>&nbsp;cur.<font color="#dcdcaa">Next</font>(ctx) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">row</font>&nbsp;<font color="#569cd6">struct</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID &nbsp;&nbsp;&nbsp;&nbsp;primitive.ObjectID <font color="#ce9178">`bson:&quot;_id&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenID <font color="#4ec9b0">string</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">`bson:&quot;openid&quot;`</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cur.<font color="#dcdcaa">Decode</font>(&amp;row)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(row.ID, row.OpenID)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="删除" FOLDED="true" ID="ID_356199509" CREATED="1644495478194" MODIFIED="1644495485651">
<node TEXT="DeleteOne" ID="ID_1972677338" CREATED="1645154370788" MODIFIED="1645154377856"/>
<node TEXT="DeleteMany" ID="ID_1415240073" CREATED="1645154377995" MODIFIED="1645154382823"/>
<node ID="ID_1800228430" CREATED="1645154241259" MODIFIED="1645180638913"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">del</font>&nbsp;:= <font color="#569cd6">func</font>(uid <font color="#4ec9b0">string</font>, col *mongo.Collection) <font color="#4ec9b0">int64</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">objID</font>, <font color="#9cdcfe">_</font>&nbsp;:= primitive.<font color="#dcdcaa">ObjectIDFromHex</font>(uid)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#9cdcfe">res</font>, <font color="#9cdcfe">err</font>&nbsp;:= col.<font color="#dcdcaa">DeleteOne</font>(ctx, &amp;bson.M{<font color="#ce9178">&quot;_id&quot;</font>: objID})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.<font color="#dcdcaa">Fatal</font>(<font color="#ce9178">&quot;failed to delete:&quot;</font>, err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;res.DeletedCount
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="修改" FOLDED="true" ID="ID_1143550568" CREATED="1644495485825" MODIFIED="1644495490940">
<node ID="ID_1281040295" CREATED="1645602020327" MODIFIED="1645602024110"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// r, err := col.InsertOne(ctx, bson.M{</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;&quot;username&quot;: &quot;update&quot;,</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;&quot;d1&quot;: bson.M{</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;d11&quot;: &quot;d11&quot;,</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;},</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;&quot;d2&quot;: bson.M{</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;d21&quot;: &quot;d21&quot;,</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// &nbsp;},</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// })</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// fmt.Println(&quot;insert result:&quot;, r, err)</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">r</font>, <font color="#9cdcfe">err</font>&nbsp;:= col.<font color="#dcdcaa">UpdateOne</font>(ctx,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bson.M{<font color="#ce9178">&quot;username&quot;</font>: <font color="#ce9178">&quot;update&quot;</font>},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bson.M{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;$set&quot;</font>: bson.M{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;d1.d11&quot;</font>: <font color="#ce9178">&quot;d11 2 d111&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;update result:&quot;</font>, r, err)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT="UpdateOne" ID="ID_1788432301" CREATED="1645602032942" MODIFIED="1645602037914"/>
<node TEXT="UpdateMany" ID="ID_852279060" CREATED="1645602038076" MODIFIED="1645602041160"/>
<node TEXT="用$set，不存在修改字段则新增" ID="ID_362209228" CREATED="1645602123277" MODIFIED="1645602158600"/>
<node TEXT="用$unset可以删除字段(区别字段值置空)" ID="ID_429584586" CREATED="1645602159140" MODIFIED="1645602187167"/>
</node>
<node TEXT="强类型化ID" FOLDED="true" ID="ID_1155591367" CREATED="1645860756185" MODIFIED="1645860763964">
<node TEXT="原由" ID="ID_931819198" CREATED="1645862531539" MODIFIED="1645862534654">
<node TEXT="如有两个mongo集合 user、session" ID="ID_1865499790" CREATED="1645860837886" MODIFIED="1645862596756"/>
<node TEXT=" user._id 用 userID 类型传值，session_id 用 seesionID类型传值" ID="ID_321805508" CREATED="1645862587841" MODIFIED="1645862589053"/>
</node>
<node TEXT="好处" ID="ID_412961805" CREATED="1645862520787" MODIFIED="1645862522511">
<node TEXT="id 如果都是string类型，可读性与易用性不如用一个特定的自定义类型" ID="ID_748629111" CREATED="1645860767408" MODIFIED="1645862842186"/>
<node TEXT="强类型化id之后，传参不会传错，可读性强" ID="ID_908024098" CREATED="1645860912470" MODIFIED="1645860962984"/>
</node>
<node TEXT="方案" ID="ID_1918070002" CREATED="1645862490427" MODIFIED="1645862517029">
<node TEXT="定义自定义类型" ID="ID_41080917" CREATED="1645863050230" MODIFIED="1645863058481">
<node ID="ID_1913081965" CREATED="1645862566787" MODIFIED="1645862578214"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">// UserID is the user id</font>
      </div>
      <div>
        <font color="#569cd6">type</font>&nbsp;<font color="#4ec9b0">UserID</font>&nbsp;<font color="#4ec9b0">string</font>
      </div>
      <br/>
      

      <div>
        <font color="#569cd6">func</font>&nbsp;(u UserID) <font color="#dcdcaa">String</font>() <font color="#4ec9b0">string</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;<font color="#dcdcaa">string</font>(u)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>

</richcontent>
</node>
<node TEXT="将传参的 userID string 改成 userID id.UserID，处理ide的类型报错即可（静态强类型语言对重构友好）" ID="ID_23952911" CREATED="1645862611410" MODIFIED="1645862697276"/>
</node>
<node TEXT="各个区分类型的相互传换问题" ID="ID_1294787197" CREATED="1645860978501" MODIFIED="1645861000184">
<node TEXT="写数据库时需要是OjbID，函数调用时需要是特定类型" ID="ID_1775279029" CREATED="1645861032886" MODIFIED="1645861064815"/>
<node TEXT="这个本质上都是同一个字符串，需要方便的转换" ID="ID_1217052089" CREATED="1645861003366" MODIFIED="1645861088310"/>
<node ID="ID_1573156582" CREATED="1645862714985" MODIFIED="1645862812424"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#6a9955">// ToObjID convert Stringer to ObjID.</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">ToObjID</font>(sid fmt.Stringer) (primitive.ObjectID, <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 只要sid实现了String方法，即可调用</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;primitive.<font color="#dcdcaa">ObjectIDFromHex</font>(sid.<font color="#dcdcaa">String</font>())
      </div>
      <div>
        }
      </div>
      <br/>
      

      <div>
        <font color="#6a9955">// ToUserID convert ObjectID to UserID.</font>
      </div>
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">ToUserID</font>(oid primitive.ObjectID) id.UserID {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;id.<font color="#dcdcaa">UserID</font>(oid.<font color="#dcdcaa">Hex</font>())
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>

</richcontent>
</node>
</node>
</node>
</node>
</node>
<node TEXT="docker" FOLDED="true" POSITION="right" ID="ID_1160555709" CREATED="1644655998548" MODIFIED="1644656000751">
<edge COLOR="#00ffff"/>
<node TEXT="获取docker并连接" ID="ID_1130915751" CREATED="1644657892002" MODIFIED="1644657902165">
<node TEXT=" go get github.com/docker/docker/client" ID="ID_1408479165" CREATED="1644657915794" MODIFIED="1644657916774"/>
<node ID="ID_1169350568" CREATED="1644657933067" MODIFIED="1644657935991"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 连接到docker</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">c</font>, <font color="#9cdcfe">err</font>&nbsp;:= client.<font color="#dcdcaa">NewClientWithOpts</font>(client.FromEnv, client.<font color="#dcdcaa">WithAPIVersionNegotiation</font>())
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="  创建容器" ID="ID_69151870" CREATED="1644657943954" MODIFIED="1644657944791">
<node ID="ID_966109223" CREATED="1644657970984" MODIFIED="1644658231411"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 创建容器</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">res</font>, <font color="#9cdcfe">err</font>&nbsp;:= c.<font color="#dcdcaa">ContainerCreate</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;container.Config{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Image: <font color="#ce9178">&quot;mongo&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExposedPorts: nat.PortSet{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;27017/tcp&quot;</font>: {},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;container.HostConfig{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PortBindings: nat.PortMap{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ce9178">&quot;27017/tcp&quot;</font>: []nat.PortBinding{{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostIP: &nbsp; <font color="#ce9178">&quot;127.0.0.1&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostPort: <font color="#ce9178">&quot;0&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">nil</font>, <font color="#569cd6">nil</font>, <font color="#ce9178">&quot;&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">containerID</font>&nbsp;:= res.ID
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="启动容器与删除容器" ID="ID_943514823" CREATED="1644657994833" MODIFIED="1644658007146">
<node ID="ID_725633801" CREATED="1644658032713" MODIFIED="1644658215659"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 启动容器</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;c.<font color="#dcdcaa">ContainerStart</font>(ctx, containerID, types.ContainerStartOptions{})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 删除容器</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;c.<font color="#dcdcaa">ContainerRemove</font>(ctx, containerID,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;types.ContainerRemoveOptions{Force: <font color="#569cd6">true</font>})
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="获取容器在主机的ip与端口" ID="ID_1459837034" CREATED="1644658037834" MODIFIED="1644658049314">
<node ID="ID_30064635" CREATED="1644658056752" MODIFIED="1644658247261"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 获取容器状态</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">cInfo</font>, <font color="#9cdcfe">_</font>&nbsp;:= c.<font color="#dcdcaa">ContainerInspect</font>(ctx, containerID)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">ports</font>&nbsp;:= cInfo.NetworkSettings.Ports[<font color="#ce9178">&quot;27017/tcp&quot;</font>][<font color="#b5cea8">0</font>]
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(ports.HostIP, ports.HostPort)
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="鉴权" POSITION="right" ID="ID_1893977913" CREATED="1645535390327" MODIFIED="1645535402855">
<edge COLOR="#7c7c00"/>
<node TEXT="SSL/TLS" ID="ID_597119780" CREATED="1645602864584" MODIFIED="1645602871564">
<node TEXT="概念" ID="ID_1975321898" CREATED="1645603032216" MODIFIED="1645603035963">
<node TEXT=" 互联网的通信安全，建立在SSL/TLS协议之上" ID="ID_506664836" CREATED="1645603207271" MODIFIED="1645603208064"/>
</node>
<node TEXT="作用" ID="ID_1367652263" CREATED="1645603062368" MODIFIED="1645603063849">
<node TEXT=" 所有信息都是加密传播，避免窃听风险" ID="ID_1983862919" CREATED="1645603119450" MODIFIED="1645603132855"/>
<node TEXT="  具有校验机制，一旦被篡改，通信双方会立刻发现" ID="ID_924570831" CREATED="1645603133649" MODIFIED="1645603140353"/>
<node TEXT=" 配备身份证书，防止身份被冒充" ID="ID_1281463978" CREATED="1645603141120" MODIFIED="1645603149962"/>
</node>
<node TEXT="基本思路" ID="ID_1379833305" CREATED="1645603064089" MODIFIED="1645603089898">
<node TEXT=" SSL/TLS协议的基本思路是采用公钥加密法" ID="ID_1428739788" CREATED="1645602872706" MODIFIED="1645602880042"/>
<node TEXT=" 客户端先向服务器端索要公钥，然后用公钥加密信息" ID="ID_482958889" CREATED="1645602880994" MODIFIED="1645602893579"/>
<node TEXT=" 服务器收到密文后，用自己的私钥解密" ID="ID_408782129" CREATED="1645602893881" MODIFIED="1645602894835"/>
</node>
<node TEXT=" 如何保证公钥不被篡改" ID="ID_1691789923" CREATED="1645603235320" MODIFIED="1645603236745">
<node TEXT=" 将公钥放在数字证书中。只要证书是可信的，公钥就是可信的" ID="ID_1738733532" CREATED="1645603240415" MODIFIED="1645603241654"/>
</node>
<node TEXT=" 公钥加密计算量太大，如何减少耗用的时间" ID="ID_1788210531" CREATED="1645603244809" MODIFIED="1645603251784">
<node TEXT="对称加密运算快，引入&quot;对话密钥&quot;（session key）" ID="ID_675942225" CREATED="1645603599727" MODIFIED="1645603861712"/>
<node TEXT="客户端与服务器每次会话生成对话密钥" ID="ID_1117440328" CREATED="1645603640174" MODIFIED="1645603905738"/>
<node TEXT="客户端用公钥加密对话密钥，对话密钥加密通信内容" ID="ID_966819605" CREATED="1645603701997" MODIFIED="1645603742728"/>
<node TEXT="服务器用私钥解密对话密钥，再用对话密钥解密通信内容" ID="ID_1813327545" CREATED="1645603743284" MODIFIED="1645603795088"/>
</node>
</node>
<node TEXT="Cookie" ID="ID_296860022" CREATED="1645620208514" MODIFIED="1645620217075">
<node TEXT="概念" ID="ID_576159663" CREATED="1645620223496" MODIFIED="1645620230194">
<node TEXT=" Cookie存在客户端中，保存用户偏好设置，易泄露" ID="ID_294607623" CREATED="1645620230375" MODIFIED="1645620925661"/>
<node TEXT="客户端自动保存请求响应头Set-Cookie: &lt;cookie名&gt;=&lt;cookie值&gt;" ID="ID_180317810" CREATED="1645620237064" MODIFIED="1645620311563"/>
<node TEXT="客户端在每次的请求中会加上Cookie" ID="ID_1919493399" CREATED="1645620285479" MODIFIED="1645620322215"/>
<node TEXT="可以存个SessionID，而不存状态数据" ID="ID_597079712" CREATED="1645620338320" MODIFIED="1645620356393"/>
</node>
</node>
<node TEXT="Session" ID="ID_1970719376" CREATED="1644840756487" MODIFIED="1644840760844">
<node TEXT="概念" ID="ID_652665718" CREATED="1644840769776" MODIFIED="1644840777827">
<node TEXT=" Session存在服务器中，是给客户端存一个随机的字符串session_id，不直接存储数据。" ID="ID_382762682" CREATED="1645620381609" MODIFIED="1645620383471"/>
<node TEXT="&quot;Session&quot;本身不带信息，只是Session表的索引ID" ID="ID_600611675" CREATED="1644840556034" MODIFIED="1644840707582"/>
<node TEXT=" Session表(sessionID, accountID, loginTime, expire...)" ID="ID_58636101" CREATED="1644840620241" MODIFIED="1644840670878"/>
<node TEXT="相关状态数据(如用户信息、过期时间)保存于服务器" ID="ID_304930047" CREATED="1645608290022" MODIFIED="1645608317583"/>
</node>
<node TEXT="过程" ID="ID_1162937250" CREATED="1645608339180" MODIFIED="1645608341143">
<node TEXT="服务器为登陆成功的用户生成SessionID，返回给客户端(Set-Cookie: )" ID="ID_1345946679" CREATED="1645607834849" MODIFIED="1645608387606"/>
<node TEXT=" 客户端一般将 SessionId 以 Cookie 的形式记录下来，后续请求传递 Cookie 来验证身份" ID="ID_315553919" CREATED="1645607884569" MODIFIED="1645607949764"/>
<node TEXT="服务器维护Session表，每个无状态的HTTP请求，通过协带的SessionID来确认用户，实现用户状态保持" ID="ID_1181720340" CREATED="1644840859657" MODIFIED="1645608146955"/>
<node TEXT=" 为了避免 Session Id被第三者截取和盗用，客户端和应用之前应使用 TLS 加密通信，session 也会设置有过期时间" ID="ID_1298095133" CREATED="1645607990431" MODIFIED="1645608017518"/>
</node>
<node TEXT="问题" ID="ID_733005162" CREATED="1645608324318" MODIFIED="1645608327399">
<node TEXT="状态在服务器，认证服务容易成为单点" ID="ID_1820999699" CREATED="1645608424602" MODIFIED="1645608459253"/>
<node TEXT="查Session表，容易成为性能瓶颈" ID="ID_1356806981" CREATED="1644840785656" MODIFIED="1644840833396"/>
</node>
</node>
<node TEXT="JWT" ID="ID_837020635" CREATED="1644840507059" MODIFIED="1645535412085">
<node TEXT="概念" ID="ID_944125746" CREATED="1644840510721" MODIFIED="1644840519516">
<node TEXT=" 服务器认证以后，生成一个 JSON 对象，发回给用户" ID="ID_1281089948" CREATED="1644841054255" MODIFIED="1644841063568"/>
<node TEXT=" JWT 默认是不加密的，JSON使用 Base64URL 算法转成字符串" ID="ID_795077503" CREATED="1644841439620" MODIFIED="1644841456235"/>
<node TEXT="由客户端存储状态，服务器不再保存状态(如Session)" ID="ID_613485386" CREATED="1644841064511" MODIFIED="1644841306007"/>
<node TEXT="查验JWT签名，就完全可以相信JWT所携带的数据" ID="ID_745535686" CREATED="1644927695209" MODIFIED="1644927754667"/>
<node TEXT="私钥对Header和Payoad签名，公钥验证签名" ID="ID_43891740" CREATED="1645602943305" MODIFIED="1645603014493"/>
</node>
<node TEXT="优缺点" ID="ID_201835087" CREATED="1644841571787" MODIFIED="1644841580132">
<node TEXT="状态数据在token" ID="ID_521833252" CREATED="1645621903286" MODIFIED="1645621918794">
<node TEXT="服务器变成无状态了，从而比较容易实现扩展" ID="ID_503676080" CREATED="1644841306710" MODIFIED="1644841327623"/>
<node TEXT=" 有效使用 JWT，可以降低服务器查询数据库的次数" ID="ID_1002573006" CREATED="1645621937510" MODIFIED="1645621938480"/>
<node TEXT=" 一旦 JWT 签发了，在到期之前就会始终有效。 无法在使用过程中废止某个 token，或者更改 token 的权限。除非额外实现逻辑" ID="ID_874621988" CREATED="1644841580594" MODIFIED="1644841654277"/>
<node TEXT="服务器无状态数据，意味着用户token泄露也无法及时中止。(一般设置比较短的有效期)" ID="ID_1424913469" CREATED="1644927623147" MODIFIED="1644927817330"/>
<node TEXT=" 为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输" ID="ID_1682901497" CREATED="1645621952551" MODIFIED="1645621953445"/>
</node>
</node>
<node TEXT="结构" ID="ID_1343802423" CREATED="1644841340390" MODIFIED="1644841345343">
<node TEXT="&quot;Header.Payload.Signature&quot;" ID="ID_1184133474" CREATED="1644841350140" MODIFIED="1644841360393"/>
<node TEXT="算法" ID="ID_1281668493" CREATED="1644843819411" MODIFIED="1644843826206">
<node TEXT=" 算法是验证jwt的信息合法性，信息本身还是明文" ID="ID_228513402" CREATED="1644843830972" MODIFIED="1644843872517"/>
<node TEXT=" HA256算法，对称签名。用密码加密，服务间共享这个密码，来验证JWT" ID="ID_1206622275" CREATED="1644843670254" MODIFIED="1644927852514"/>
<node TEXT="RS256算法，非对称签名。用私钥签名，其它服务用公钥验证签名即可" ID="ID_22633123" CREATED="1644843735150" MODIFIED="1644927861634"/>
</node>
</node>
<node TEXT="使用" ID="ID_633744378" CREATED="1644841698969" MODIFIED="1645622225319" VGAP_QUANTITY="6.9 pt">
<node TEXT="存放" ID="ID_1935257770" CREATED="1644841740290" MODIFIED="1644841742405">
<node TEXT="JWT可以储存在 Cookie 里面，也可以储存在 localStorage" ID="ID_493604921" CREATED="1644841712232" MODIFIED="1644841755220"/>
</node>
<node TEXT="请求" ID="ID_1309207669" CREATED="1644841723881" MODIFIED="1645622225319">
<node TEXT=" 放在 Cookie 里面自动发送，但是这样不能跨域" ID="ID_639723041" CREATED="1644841762291" MODIFIED="1644841763191"/>
<node TEXT=" 更好的做法是放在 HTTP 请求的头信息Authorization字段里面，&quot;Bearer &quot; + token" ID="ID_1411100489" CREATED="1644841777881" MODIFIED="1645706016275"/>
</node>
</node>
<node TEXT="go-jwt" ID="ID_1770815245" CREATED="1645619659597" MODIFIED="1645619666661">
<node TEXT="私钥签名" ID="ID_599636631" CREATED="1645619667292" MODIFIED="1645619690238">
<node ID="ID_915108126" CREATED="1645619794683" MODIFIED="1645619825949"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">jtk</font>&nbsp;:= jwt.<font color="#dcdcaa">NewWithClaims</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jwt.SigningMethodRS512,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jwt.StandardClaims{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExpiresAt: expire,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IssuedAt: &nbsp;now,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Issuer: &nbsp;&nbsp;&nbsp;<font color="#ce9178">&quot;gService&quot;</font>,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject: &nbsp;&nbsp;userID,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#6a9955">// 签名，生成token</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">tk</font>, <font color="#9cdcfe">err</font>&nbsp;:= jtk.<font color="#dcdcaa">SignedString</font>(j.privateKey)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="公钥验证" ID="ID_256313690" CREATED="1645619670973" MODIFIED="1645619694590">
<node ID="ID_100828788" CREATED="1645619915617" MODIFIED="1645619919203"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">jtk</font>, <font color="#9cdcfe">err</font>&nbsp;:= jwt.<font color="#dcdcaa">ParseWithClaims</font>(
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token,
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;jwt.StandardClaims{},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#569cd6">func</font>(t *jwt.Token) (<font color="#569cd6">interface</font>{}, <font color="#4ec9b0">error</font>) {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">return</font>&nbsp;&nbsp;j.publicKey, <font color="#569cd6">nil</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#9cdcfe">clm</font>, <font color="#9cdcfe">ok</font>&nbsp;:= jtk.Claims.(*jwt.StandardClaims)
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="grpc通信安全" ID="ID_740353304" CREATED="1645608509460" MODIFIED="1645622295288">
<node TEXT=" grpc-go 认证鉴权是通过 tls + oauth2 实现的" ID="ID_903564122" CREATED="1645608517763" MODIFIED="1645608518742"/>
<node TEXT="tls 保证通信的安全性, oahth2控制权限" ID="ID_633352250" CREATED="1645609867609" MODIFIED="1645609915007"/>
<node TEXT="在内网就没有必要用tls了，直接grpc.WithInsecure()" ID="ID_402317804" CREATED="1645608619642" MODIFIED="1645608652885"/>
<node TEXT="外网Web，TSL需要证书放公钥" ID="ID_1358596791" CREATED="1645608654289" MODIFIED="1645608709683"/>
<node TEXT="外网是grpc客户端" ID="ID_370976980" CREATED="1645608764729" MODIFIED="1645608796308">
<node TEXT=" 生成证书" ID="ID_1365013662" CREATED="1645608911399" MODIFIED="1645608912402">
<node TEXT=" 生成私钥" ID="ID_920199302" CREATED="1645608917119" MODIFIED="1645608918079">
<node TEXT=" openssl ecparam -genkey -name secp384r1 -out server.key" ID="ID_1982669327" CREATED="1645608921311" MODIFIED="1645608922230"/>
</node>
<node TEXT=" 使用私钥生成证书" ID="ID_1396334671" CREATED="1645608927090" MODIFIED="1645608928332">
<node TEXT=" openssl req -new -x509 -sha256 -key server.key -out server.pem -days 3650" ID="ID_951802896" CREATED="1645608933494" MODIFIED="1645608934628"/>
</node>
<node TEXT=" 填写信息（注意 Common Name 要填写服务名）" ID="ID_1165162164" CREATED="1645608948825" MODIFIED="1645608950322"/>
</node>
<node TEXT="服务器" ID="ID_1376522498" CREATED="1645608798072" MODIFIED="1645608801466">
<node TEXT="c, err := credentials.NewServerTLSFromFile(&quot;../keys/server.pem&quot;, &quot;../keys/server.key&quot;)&#xa;lis, err := net.Listen(&quot;tcp&quot;, port)&#xa;s := grpc.NewServer(grpc.Creds(c))" ID="ID_766739002" CREATED="1645608801697" MODIFIED="1645608877579"/>
</node>
<node TEXT="客户端" ID="ID_337913772" CREATED="1645608880497" MODIFIED="1645608894740">
<node TEXT=" cred, err := credentials.NewClientTLSFromFile(&quot;../keys/server.pem&quot;, &quot;helloauth&quot;)&#xa;conn, err := grpc.Dial(address, grpc.WithTransportCredentials(cred))&#xa;c := pb.NewGreeterClient(conn)" ID="ID_334339411" CREATED="1645609761642" MODIFIED="1645609768752"/>
</node>
</node>
</node>
</node>
<node TEXT="goroutine调度" POSITION="right" ID="ID_187888495" CREATED="1645002647781" MODIFIED="1645002663489">
<edge COLOR="#00007c"/>
<node TEXT=" GMP 模型" ID="ID_293204292" CREATED="1645002688032" MODIFIED="1645002688830">
<node TEXT=" G" ID="ID_70818005" CREATED="1645066267626" MODIFIED="1645066269440">
<node TEXT=" G表示 Goroutine，它是一个待执行的任务" ID="ID_478098779" CREATED="1645066277451" MODIFIED="1645066282621"/>
<node TEXT="G最终在M上得以执行" ID="ID_1450612337" CREATED="1645002738231" MODIFIED="1645066445057"/>
<node TEXT="G在调度器M上执行与切换，类似线程在进程上，只是G比线程内存占用更小" ID="ID_1072867652" CREATED="1645066438752" MODIFIED="1645066531781"/>
</node>
<node TEXT=" M" ID="ID_610739051" CREATED="1645066301166" MODIFIED="1645066302089">
<node TEXT=" M表示Machine ，是操作系统的线程" ID="ID_1820622302" CREATED="1645066316191" MODIFIED="1645068656913"/>
<node TEXT="M由操作系统的调度器调度和管理，M的活跃个数默认为cpu个数" ID="ID_1285443512" CREATED="1645066324519" MODIFIED="1645067311557"/>
<node TEXT=" 创建初始的 m，称为 m0, m0会启动一个调度循环：不断地找 g，执行，再找 g……" ID="ID_1837795195" CREATED="1645002890101" MODIFIED="1645066351948"/>
</node>
<node TEXT="P" ID="ID_469907245" CREATED="1645066356151" MODIFIED="1645066357090">
<node TEXT=" P表示处理器，作为G与M的中间层" ID="ID_1125261931" CREATED="1645066365289" MODIFIED="1645066385082"/>
<node TEXT="P可以被看做运行在线程上的本地调度器" ID="ID_1247212705" CREATED="1645066395624" MODIFIED="1645066399842"/>
<node TEXT=" P能提供线程需要的上下文环境，也会负责调度线程上的等待队列" ID="ID_1997581960" CREATED="1645067398897" MODIFIED="1645067401564"/>
<node TEXT=" 通过处理器 P 的调度，每一个内核线程都能够执行多个 Goroutine，它能在 Goroutine 进行一些 I/O 操作时及时让出计算资源，提高线程的利用率" ID="ID_1646591475" CREATED="1645067416226" MODIFIED="1645067417255"/>
</node>
</node>
</node>
<node TEXT="反射" POSITION="right" ID="ID_550440958" CREATED="1645004119920" MODIFIED="1645004133863">
<edge COLOR="#007c00"/>
<node TEXT="用处" ID="ID_1317392889" CREATED="1645004211707" MODIFIED="1645004214829">
<node TEXT=" reflect反射是程序在运行期间检查其自身结构的一种方式" ID="ID_237442627" CREATED="1645004513768" MODIFIED="1645004526998"/>
<node TEXT=" 反射作为一种元编程方式可以减少重复代码" ID="ID_1274955386" CREATED="1645004549377" MODIFIED="1645004550590"/>
<node TEXT="反射能力，能够让程序操作不同类型的对象" ID="ID_516766083" CREATED="1645004220963" MODIFIED="1645004557315"/>
<node TEXT=" 过量的使用反射会使逻辑变得难以理解并且运行缓慢" ID="ID_1338036209" CREATED="1645004570521" MODIFIED="1645004591119"/>
</node>
<node TEXT=" reflect.TypeOf" ID="ID_990278982" CREATED="1645004249962" MODIFIED="1645004251027">
<node TEXT="获取任意变量的类型" ID="ID_748285261" CREATED="1645004258903" MODIFIED="1645004295944"/>
</node>
<node TEXT=" reflect.ValueOf" ID="ID_461017213" CREATED="1645004254227" MODIFIED="1645004255160">
<node ID="ID_228689169" CREATED="1645004265973" MODIFIED="1645004265973"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      能获取数据的运行时表示
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 反射的三大法则" ID="ID_1978513105" CREATED="1645004615384" MODIFIED="1645004616186">
<node TEXT=" 第一法则" ID="ID_1336343756" CREATED="1645004810766" MODIFIED="1645004811535">
<node TEXT=" 从 interface{} 变量可以反射出反射对象" ID="ID_1223655607" CREATED="1645004624167" MODIFIED="1645004625044"/>
<node TEXT=" 由于 reflect.TypeOf、reflect.ValueOf 两个方法的入参都是 interface{} 类型，任何入参都会被类型转换成interface{}类型" ID="ID_966692639" CREATED="1645004902829" MODIFIED="1645004940611"/>
</node>
<node TEXT=" 从反射对象可以获取 interface{} 变量" ID="ID_668404530" CREATED="1645004630056" MODIFIED="1645004630794"/>
<node TEXT=" 要修改反射对象，其值必须可设置" ID="ID_1104165264" CREATED="1645004637879" MODIFIED="1645004639207"/>
</node>
</node>
<node TEXT="panic和recover" POSITION="right" ID="ID_1533438798" CREATED="1645005299483" MODIFIED="1645005314573">
<edge COLOR="#7c007c"/>
<node TEXT=" panic" ID="ID_205782307" CREATED="1645005356683" MODIFIED="1645005357475">
<node TEXT=" panic 能够改变程序的控制流" ID="ID_432255535" CREATED="1645005362219" MODIFIED="1645005363044"/>
<node TEXT=" 调用 panic 后会立刻停止执行当前函数的剩余代码" ID="ID_350896262" CREATED="1645005369027" MODIFIED="1645005370472"/>
<node TEXT="panic 只会触发当前 Goroutine 的 defer" ID="ID_1885619963" CREATED="1645005386082" MODIFIED="1645009641741"/>
<node TEXT=" panic 允许在 defer 中嵌套多次调用" ID="ID_1745691006" CREATED="1645009664787" MODIFIED="1645009665999"/>
</node>
<node TEXT=" recover" ID="ID_354618434" CREATED="1645005402972" MODIFIED="1645005408380">
<node TEXT=" 可以中止 panic 造成的程序崩溃" ID="ID_1087859367" CREATED="1645005414369" MODIFIED="1645005415193"/>
<node TEXT="recover 只有在 defer 中调用才会生效" ID="ID_1458017594" CREATED="1645005426763" MODIFIED="1645009652035"/>
</node>
<node TEXT="defer 跨协程失效" ID="ID_589194474" CREATED="1645009714338" MODIFIED="1645009718701">
<node TEXT=" panic 只会触发当前 Goroutine 的延迟函数调用" ID="ID_1073509748" CREATED="1645009726905" MODIFIED="1645009727836"/>
<node TEXT=" 一个 Goroutine 在 panic 时也不会执行其他 Goroutine 的defer函数" ID="ID_1085494288" CREATED="1645010002254" MODIFIED="1645010021386"/>
<node ID="ID_1856844194" CREATED="1645009858113" MODIFIED="1645009861409"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;<font color="#dcdcaa">println</font>(<font color="#ce9178">&quot;main defer&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">go</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;<font color="#dcdcaa">println</font>(<font color="#ce9178">&quot;g1 defer&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(<font color="#ce9178">&quot;g1&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 只有这个goroutine的defer才会执行</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;time.<font color="#dcdcaa">Sleep</font>(<font color="#b5cea8">1</font>&nbsp;* time.Second)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 该示例中main defer不会被执行" ID="ID_1828316649" CREATED="1645009866769" MODIFIED="1645009919220"/>
</node>
<node TEXT=" 崩溃恢复" ID="ID_852656663" CREATED="1645010620233" MODIFIED="1645010621108">
<node ID="ID_869706011" CREATED="1645010626225" MODIFIED="1645010629501"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        <font color="#569cd6">func</font>&nbsp;<font color="#dcdcaa">main</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;in main&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#c586c0">defer</font>&nbsp;<font color="#569cd6">func</font>() {
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#c586c0">if</font>&nbsp;<font color="#9cdcfe">err</font>&nbsp;:= <font color="#dcdcaa">recover</font>(); err != <font color="#569cd6">nil</font>&nbsp;{
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 拦截panic，从而不中断程序</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// panic后面的代码不会执行</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#6a9955">// 可以在这里进行一些恢复的操作</font>
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(<font color="#ce9178">&quot;recover&quot;</font>, err)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;}()
      </div>
      <br/>
      

      <div>
        &nbsp;&nbsp;&nbsp; <font color="#dcdcaa">panic</font>(<font color="#ce9178">&quot;unknown err&quot;</font>)
      </div>
      <div>
        }
      </div>
      <br/>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="文本处理" POSITION="right" ID="ID_1412807987" CREATED="1645015494492" MODIFIED="1645015501545">
<edge COLOR="#007c7c"/>
<node TEXT="文本查找" ID="ID_1467551298" CREATED="1645015501692" MODIFIED="1645015511432">
<node TEXT="string.Contains" ID="ID_1257839383" CREATED="1645087193409" MODIFIED="1645087206491">
<node ID="ID_1640493864" CREATED="1645087344141" MODIFIED="1645087348282"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">in1</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;= strings.<font color="#dcdcaa">Contains</font>(<font color="#ce9178">&quot;abcd&quot;</font>, <font color="#ce9178">&quot;bc&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">in2</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;= strings.<font color="#dcdcaa">Contains</font>(<font color="#ce9178">&quot;abcd&quot;</font>, <font color="#ce9178">&quot;bb&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(in1, in2) &nbsp;<font color="#6a9955">// true false</font>
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" func Index(s, sep string) int" ID="ID_709721302" CREATED="1645087431764" MODIFIED="1645087433324">
<node TEXT="返回查找文本的索引或-1" ID="ID_1206181977" CREATED="1645087433667" MODIFIED="1645087504653"/>
<node TEXT="Contains的内部实现" ID="ID_709079565" CREATED="1645087505284" MODIFIED="1645087516509"/>
</node>
<node TEXT="regexp" ID="ID_753867845" CREATED="1645088017985" MODIFIED="1645088030705">
<node ID="ID_1891999452" CREATED="1645088032705" MODIFIED="1645088037282"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <div style="color: rgb(212, 212, 212); background-color: rgb(30, 30, 30); font-family: Consolas, Courier New, monospace; font-size: 14px; line-height: 19px; white-space: pre">
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">in11</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;= regexp.<font color="#dcdcaa">MustCompile</font>(<font color="#ce9178">`bc\w`</font>).<font color="#dcdcaa">MatchString</font>(<font color="#ce9178">&quot;abcd&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp; <font color="#569cd6">var</font>&nbsp;<font color="#9cdcfe">in22</font>&nbsp;<font color="#4ec9b0">bool</font>&nbsp;= regexp.<font color="#dcdcaa">MustCompile</font>(<font color="#ce9178">`bb\w`</font>).<font color="#dcdcaa">MatchString</font>(<font color="#ce9178">&quot;abcd&quot;</font>)
      </div>
      <div>
        &nbsp;&nbsp;&nbsp;&nbsp;fmt.<font color="#dcdcaa">Println</font>(in11, in22) &nbsp;<font color="#6a9955">// true false</font>
      </div>
      <div>
        }
      </div>
    </div>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="文本更替" ID="ID_398504169" CREATED="1645015511602" MODIFIED="1645089260408"/>
<node TEXT="文本截取" ID="ID_895002863" CREATED="1645015522187" MODIFIED="1645015528327"/>
</node>
</node>
</map>
