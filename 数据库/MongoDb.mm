<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="mongodb" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1568106680748" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle" zoom="0.89">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3.0 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0.0 cm" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.8999999999999995 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="131" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="概念" FOLDED="true" POSITION="right" ID="ID_1868690089" CREATED="1568107725866" MODIFIED="1568107729871">
<edge COLOR="#0000ff"/>
<node TEXT="数据库" FOLDED="true" ID="ID_1385868437" CREATED="1568106682962" MODIFIED="1568107739276">
<node TEXT=" 一个mongodb中可以建立多个数据库" ID="ID_878487200" CREATED="1568106697025" MODIFIED="1568106698088"/>
<node TEXT=" MongoDB的默认数据库为&quot;db&quot;，该数据库存储在data目录中" ID="ID_1057196610" CREATED="1568106698630" MODIFIED="1568106704595"/>
<node TEXT=" 在MongoDB中可以创建数据库，如果你想使用MongoDB，创建数据库不是必要的" ID="ID_125656465" CREATED="1568106717739" MODIFIED="1568106718819"/>
<node TEXT=" 显示当前数据库对象或集合" ID="ID_918357517" CREATED="1568107258836" MODIFIED="1568107736712">
<node TEXT=" $ db" ID="ID_1990576704" CREATED="1568107264521" MODIFIED="1568107269681"/>
<node TEXT=" 显示当前数据库对象或集合" ID="ID_1819605261" CREATED="1568107269888" MODIFIED="1568107274962"/>
</node>
<node TEXT=" 显示所有数据库的列表, 并指定一个" ID="ID_1267138363" CREATED="1568107324268" MODIFIED="1568107734645">
<node TEXT="$ show dbs" ID="ID_389829316" CREATED="1568107491025" MODIFIED="1568107500067">
<node TEXT=" &gt; show dbs&#xa;admin   0.000GB&#xa;config  0.000GB&#xa;local   0.000GB" ID="ID_1937642008" CREATED="1568107509425" MODIFIED="1568107511659"/>
</node>
<node TEXT=" 运行&quot;use&quot;命令，可以连接到一个指定的数据库" ID="ID_433713435" CREATED="1568107357024" MODIFIED="1568107358194"/>
<node TEXT=" &gt; use local&#xa;switched to db local&#xa;&gt; db&#xa;local&#xa;&gt;" ID="ID_81954147" CREATED="1568107366994" MODIFIED="1568107368403"/>
</node>
</node>
<node TEXT=" 数据库名的定义" FOLDED="true" ID="ID_200687199" CREATED="1568107545762" MODIFIED="1568107731987">
<node TEXT=" 满足以下条件的任意UTF-8字符串" ID="ID_1318158415" CREATED="1568107560774" MODIFIED="1568107563010">
<node ID="ID_1646162454" CREATED="1568107572395" MODIFIED="1568107572395"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#26368;&#22810;64&#23383;&#33410;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1057135999" CREATED="1568107572393" MODIFIED="1568107572393"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#24212;&#20840;&#37096;&#23567;&#20889;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1864542879" CREATED="1568107572390" MODIFIED="1568107572390"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#19981;&#33021;&#26159;&#31354;&#23383;&#31526;&#20018;&#65288;&quot;&quot;)&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1896517" CREATED="1568107572390" MODIFIED="1568107572390"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#19981;&#24471;&#21547;&#26377;' '&#65288;&#31354;&#26684;)&#12289;.&#12289;$&#12289;/&#12289;\&#21644;\0 (&#31354;&#23383;&#31526;)&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 有一些数据库名是保留的" ID="ID_420741295" CREATED="1568107617072" MODIFIED="1568107619274">
<node TEXT="admin" ID="ID_995210652" CREATED="1568107621720" MODIFIED="1568107631830">
<node TEXT=" 从权限的角度来看，这是&quot;root&quot;数据库" ID="ID_1166694350" CREATED="1568107651116" MODIFIED="1568107652073"/>
<node TEXT=" 要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限" ID="ID_523137051" CREATED="1568107676789" MODIFIED="1568107685968"/>
<node TEXT=" 一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器" ID="ID_241046340" CREATED="1568107686985" MODIFIED="1568107687786"/>
</node>
<node TEXT=" local" ID="ID_640174634" CREATED="1568107623026" MODIFIED="1568107626656">
<node TEXT=" 这个数据永远不会被复制" ID="ID_1993236501" CREATED="1568107693560" MODIFIED="1568107696836"/>
<node TEXT=" 可以用来存储限于本地单台服务器的任意集合" ID="ID_506614504" CREATED="1568107697189" MODIFIED="1568107698227"/>
</node>
<node TEXT=" config" ID="ID_1357726449" CREATED="1568107626683" MODIFIED="1568107630003">
<node TEXT=" 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息" ID="ID_313427240" CREATED="1568107705367" MODIFIED="1568107707555"/>
</node>
</node>
</node>
<node TEXT="什么是文档" ID="ID_1937352859" CREATED="1568107747584" MODIFIED="1568107785338">
<node TEXT="文档是mongodb中的最核心的概念，是其核心单元， 文档是一组键值(key-value)对(即 BSON)" ID="ID_1531846530" CREATED="1568107757729" MODIFIED="1568127120911"/>
<node TEXT=" 可以将文档类比成关系型数据库中的每一行数据" ID="ID_419912743" CREATED="1568127128181" MODIFIED="1568127129551"/>
<node TEXT=" MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点" ID="ID_822911264" CREATED="1568107779781" MODIFIED="1568107781043"/>
<node TEXT=" 一个简单的文档" ID="ID_889380940" CREATED="1568107845424" MODIFIED="1568107849035">
<node TEXT="{&quot;site&quot;:&quot;www.runoob.com&quot;, &quot;name&quot;:&quot;菜鸟教程&quot;}" ID="ID_788354356" CREATED="1568107849505" MODIFIED="1568107857741"/>
</node>
<node TEXT="可类比js的对象，python字典" ID="ID_1113830694" CREATED="1602578908450" MODIFIED="1602578949192"/>
</node>
<node TEXT="什么是集合" ID="ID_593848385" CREATED="1568107889787" MODIFIED="1568107894857">
<node TEXT=" 集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库）中的表格" ID="ID_928956537" CREATED="1568107900435" MODIFIED="1568107925434"/>
<node TEXT=" 集合存在于数据库中，集合没有固定的结构" ID="ID_421968894" CREATED="1568107946392" MODIFIED="1568107947454">
<node TEXT=" 可以插入不同格式和类型的数据" ID="ID_260229507" CREATED="1568107961002" MODIFIED="1568107961989"/>
<node TEXT=" 通常插入集合的数据都会有一定的关联性" ID="ID_1072258192" CREATED="1568107971361" MODIFIED="1568107976176"/>
</node>
<node TEXT=" 将不同数据结构的文档插入到集合中" ID="ID_1533732343" CREATED="1568107989252" MODIFIED="1568107995460">
<node TEXT="{&quot;site&quot;:&quot;www.baidu.com&quot;}&#xa;{&quot;site&quot;:&quot;www.google.com&quot;,&quot;name&quot;:&quot;Google&quot;}&#xa;{&quot;site&quot;:&quot;www.runoob.com&quot;,&quot;name&quot;:&quot;菜鸟教程&quot;,&quot;num&quot;:5}" ID="ID_809560735" CREATED="1568107999745" MODIFIED="1568108002471"/>
</node>
<node TEXT=" 当第一个文档插入时，集合就会被创建" ID="ID_419025904" CREATED="1568108040357" MODIFIED="1568108041785"/>
</node>
<node TEXT=" capped collections" ID="ID_1420048818" CREATED="1568108079162" MODIFIED="1568108080347">
<node TEXT=" Capped collections 就是固定大小的collection" ID="ID_621054608" CREATED="1568108089585" MODIFIED="1568108090501"/>
<node TEXT=" 它有很高的性能以及队列过期的特性(过期按照插入的顺序)." ID="ID_833277905" CREATED="1568108099594" MODIFIED="1568108142740"/>
<node TEXT=" db.createCollection(&quot;mycoll&quot;, {capped:true, size:100000})" ID="ID_251971350" CREATED="1568108143905" MODIFIED="1568108144946"/>
<node TEXT="特性" ID="ID_1933453450" CREATED="1568108177033" MODIFIED="1568108183800">
<node TEXT=" 在 capped collection 中，你能添加新的对象。" ID="ID_172521122" CREATED="1568108187887" MODIFIED="1568108188769"/>
<node TEXT=" 能进行更新，然而，对象不会增加存储空间。如果增加，更新就会失败" ID="ID_279031538" CREATED="1568108194195" MODIFIED="1568108200770"/>
<node TEXT=" 使用 Capped Collection 不能删除一个文档，可以使用 drop() 方法删除 collection 所有的行。" ID="ID_1009318192" CREATED="1568108201696" MODIFIED="1568108218617"/>
<node TEXT=" 删除之后，你必须显式的重新创建这个 collection。" ID="ID_1612169544" CREATED="1568108219507" MODIFIED="1568108221853"/>
</node>
</node>
<node TEXT=" 元数据" ID="ID_906088642" CREATED="1568108234529" MODIFIED="1568108235411">
<node TEXT=" 数据库的信息是存储在集合中" ID="ID_770356038" CREATED="1568108241823" MODIFIED="1568108242736"/>
<node TEXT=" 它们使用了系统的命名空间： dbname.system.*" ID="ID_1231128914" CREATED="1568108243269" MODIFIED="1568108255602"/>
<node TEXT=" dbname.system.namespaces 列出所有名字空间。&#xa;dbname.system.indexes 列出所有索引。&#xa;dbname.system.profile 包含数据库概要(profile)信息。&#xa;dbname.system.users 列出所有可访问数据库的用户。&#xa;dbname.local.sources 包含复制对端（slave）的服务器信息和状态。" ID="ID_1415951580" CREATED="1568108283956" MODIFIED="1568108285692"/>
</node>
<node TEXT=" MongoDB 数据类型" ID="ID_565574729" CREATED="1568108275784" MODIFIED="1568108277010">
<node TEXT="String 字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。" ID="ID_211664837" CREATED="1568108300190" MODIFIED="1568604892589"/>
<node ID="ID_1131141113" CREATED="1568108300190" MODIFIED="1568108300190"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Integer &#25972;&#22411;&#25968;&#20540;&#12290;&#29992;&#20110;&#23384;&#20648;&#25968;&#20540;&#12290;&#26681;&#25454;&#20320;&#25152;&#37319;&#29992;&#30340;&#26381;&#21153;&#22120;&#65292;&#21487;&#20998;&#20026; 32 &#20301;&#25110; 64 &#20301;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1653764882" CREATED="1568108300192" MODIFIED="1568108300192"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Boolean &#24067;&#23572;&#20540;&#12290;&#29992;&#20110;&#23384;&#20648;&#24067;&#23572;&#20540;&#65288;&#30495;/&#20551;&#65289;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1226085362" CREATED="1568108300194" MODIFIED="1568108300194"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Double &#21452;&#31934;&#24230;&#28014;&#28857;&#20540;&#12290;&#29992;&#20110;&#23384;&#20648;&#28014;&#28857;&#20540;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1513719309" CREATED="1568108300197" MODIFIED="1568108300197"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Min/Max keys &#23558;&#19968;&#20010;&#20540;&#19982; BSON&#65288;&#20108;&#36827;&#21046;&#30340; JSON&#65289;&#20803;&#32032;&#30340;&#26368;&#20302;&#20540;&#21644;&#26368;&#39640;&#20540;&#30456;&#23545;&#27604;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_294647651" CREATED="1568108300199" MODIFIED="1568108300199"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Array &#29992;&#20110;&#23558;&#25968;&#32452;&#25110;&#21015;&#34920;&#25110;&#22810;&#20010;&#20540;&#23384;&#20648;&#20026;&#19968;&#20010;&#38190;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1844116862" CREATED="1568108300200" MODIFIED="1568108300200"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Timestamp &#26102;&#38388;&#25139;&#12290;&#35760;&#24405;&#25991;&#26723;&#20462;&#25913;&#25110;&#28155;&#21152;&#30340;&#20855;&#20307;&#26102;&#38388;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1202222679" CREATED="1568108300202" MODIFIED="1568108300202"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Object &#29992;&#20110;&#20869;&#23884;&#25991;&#26723;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_159345872" CREATED="1568108300204" MODIFIED="1568108300204"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Null &#29992;&#20110;&#21019;&#24314;&#31354;&#20540;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_809713552" CREATED="1568108300206" MODIFIED="1568108300206"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Symbol &#31526;&#21495;&#12290;&#35813;&#25968;&#25454;&#31867;&#22411;&#22522;&#26412;&#19978;&#31561;&#21516;&#20110;&#23383;&#31526;&#20018;&#31867;&#22411;&#65292;&#20294;&#19981;&#21516;&#30340;&#26159;&#65292;&#23427;&#19968;&#33324;&#29992;&#20110;&#37319;&#29992;&#29305;&#27530;&#31526;&#21495;&#31867;&#22411;&#30340;&#35821;&#35328;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1770627851" CREATED="1568108300208" MODIFIED="1568108300208"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Date &#26085;&#26399;&#26102;&#38388;&#12290;&#29992; UNIX &#26102;&#38388;&#26684;&#24335;&#26469;&#23384;&#20648;&#24403;&#21069;&#26085;&#26399;&#25110;&#26102;&#38388;&#12290;&#20320;&#21487;&#20197;&#25351;&#23450;&#33258;&#24049;&#30340;&#26085;&#26399;&#26102;&#38388;&#65306;&#21019;&#24314; Date &#23545;&#35937;&#65292;&#20256;&#20837;&#24180;&#26376;&#26085;&#20449;&#24687;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_783001290" CREATED="1568108300209" MODIFIED="1568108300209"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Object ID &#23545;&#35937; ID&#12290;&#29992;&#20110;&#21019;&#24314;&#25991;&#26723;&#30340; ID&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_491399985" CREATED="1568108300212" MODIFIED="1568108300212"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Binary Data &#20108;&#36827;&#21046;&#25968;&#25454;&#12290;&#29992;&#20110;&#23384;&#20648;&#20108;&#36827;&#21046;&#25968;&#25454;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1969696676" CREATED="1568108300213" MODIFIED="1568108300213"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Code &#20195;&#30721;&#31867;&#22411;&#12290;&#29992;&#20110;&#22312;&#25991;&#26723;&#20013;&#23384;&#20648; JavaScript &#20195;&#30721;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_882236566" CREATED="1568108300214" MODIFIED="1568108300214"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Regular expression &#27491;&#21017;&#34920;&#36798;&#24335;&#31867;&#22411;&#12290;&#29992;&#20110;&#23384;&#20648;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="连接" POSITION="right" ID="ID_1595089657" CREATED="1568108376103" MODIFIED="1568108380254">
<edge COLOR="#00ff00"/>
<node TEXT="window" ID="ID_957134264" CREATED="1602677113216" MODIFIED="1602677117861">
<node TEXT="启动服务" ID="ID_1270950505" CREATED="1602677118027" MODIFIED="1602677161952">
<node TEXT="mongod.exe" ID="ID_895711655" CREATED="1602677162211" MODIFIED="1602677186894"/>
</node>
<node TEXT="启动shell" ID="ID_612195412" CREATED="1602677187972" MODIFIED="1602677194319">
<node TEXT="cmd mongo.exe" ID="ID_1547653607" CREATED="1602677200394" MODIFIED="1602677206383"/>
</node>
</node>
</node>
<node TEXT="创建数据库" POSITION="right" ID="ID_131483145" CREATED="1568108393299" MODIFIED="1568108397292">
<edge COLOR="#ff00ff"/>
<node TEXT=" use DATABASE_NAME" ID="ID_717507768" CREATED="1568108405084" MODIFIED="1568108405940"/>
<node TEXT="如果数据库不存在，则创建数据库，否则切换到指定数据库" ID="ID_90949084" CREATED="1568108409898" MODIFIED="1568108519925"/>
<node TEXT=" 查看所有数据库" ID="ID_1910958791" CREATED="1568108529236" MODIFIED="1568108530170">
<node TEXT=" show dbs" ID="ID_282920418" CREATED="1568108533897" MODIFIED="1568108534693"/>
</node>
</node>
<node TEXT="删除数据库" POSITION="right" ID="ID_315050818" CREATED="1568108543703" MODIFIED="1568108558017">
<edge COLOR="#00ffff"/>
<node TEXT="查看当前数据库" ID="ID_613516538" CREATED="1568108592216" MODIFIED="1568108599913">
<node TEXT=" db" ID="ID_1567116939" CREATED="1568108609096" MODIFIED="1568108609978"/>
</node>
<node TEXT=" 删除当前数据库" ID="ID_1715951420" CREATED="1568108588655" MODIFIED="1568108589739">
<node TEXT=" db.dropDatabase()" ID="ID_1923127295" CREATED="1568108564030" MODIFIED="1568108565539"/>
</node>
</node>
<node TEXT="查看所有集合" POSITION="right" ID="ID_155352145" CREATED="1568108853004" MODIFIED="1568108901582">
<edge COLOR="#00007c"/>
<node TEXT="show tables" ID="ID_951351645" CREATED="1568108857804" MODIFIED="1568108862647"/>
</node>
<node TEXT="创建集合" POSITION="right" ID="ID_765435734" CREATED="1568108656468" MODIFIED="1568108904624">
<edge COLOR="#007c00"/>
<node TEXT=" db.createCollection(&quot;runoob&quot;)" ID="ID_749249657" CREATED="1568108835769" MODIFIED="1568108836787"/>
</node>
<node TEXT="删除集合" POSITION="right" ID="ID_1961359147" CREATED="1568108618924" MODIFIED="1568108622204">
<edge COLOR="#7c0000"/>
<node TEXT="语法格式" ID="ID_492590377" CREATED="1568108653599" MODIFIED="1568108912834">
<node TEXT="db.collection.drop" ID="ID_1450650136" CREATED="1568108623317" MODIFIED="1568108631457"/>
</node>
<node TEXT="删除集合" ID="ID_1730390574" CREATED="1568108837980" MODIFIED="1568108844709">
<node TEXT="db.runoob.drop()" ID="ID_403973285" CREATED="1568108845376" MODIFIED="1568108851927"/>
</node>
</node>
<node TEXT="插入文档" POSITION="right" ID="ID_869392896" CREATED="1568108995080" MODIFIED="1568108998893">
<edge COLOR="#7c007c"/>
<node TEXT=" MongoDB 使用 insert() 或 save() 方法向集合中插入文档" ID="ID_73742677" CREATED="1568109009269" MODIFIED="1568109011005"/>
<node TEXT="语法" ID="ID_1002973117" CREATED="1568109017715" MODIFIED="1568109020842">
<node TEXT=" db.COLLECTION_NAME.insert(document)" ID="ID_665341332" CREATED="1568109021033" MODIFIED="1568109022546"/>
<node TEXT="  db.col.save(document)" ID="ID_1483798759" CREATED="1568109088097" MODIFIED="1568109089403">
<node TEXT=" 如果不指定 _id 字段 save() 方法类似于 insert() 方法" ID="ID_402981870" CREATED="1568109094167" MODIFIED="1568109095602"/>
<node TEXT="如果指定 _id 字段，则会更新该 _id 的数据" ID="ID_1266318602" CREATED="1568109096236" MODIFIED="1568125257239"/>
</node>
</node>
<node TEXT="例" ID="ID_969475538" CREATED="1568109040939" MODIFIED="1568109042237">
<node TEXT=" &gt;db.col.insert({title: &apos;MongoDB 教程&apos;,&#xa;    description: &apos;MongoDB 是一个 Nosql 数据库&apos;,&#xa;    by: &apos;菜鸟教程&apos;,&#xa;    url: &apos;http://www.runoob.com&apos;,&#xa;    tags: [&apos;mongodb&apos;, &apos;database&apos;, &apos;NoSQL&apos;],&#xa;    likes: 100&#xa;})" ID="ID_884992493" CREATED="1568109042546" MODIFIED="1568109043930"/>
<node TEXT="col 是集合名，如果不存在则自动创建" ID="ID_1340615359" CREATED="1568109045198" MODIFIED="1568109061755"/>
<node TEXT=" 查看已插入文档 db.col.find()" ID="ID_926944669" CREATED="1568125095241" MODIFIED="1568125117209"/>
</node>
<node TEXT="批量插入" ID="ID_31570406" CREATED="1602582063700" MODIFIED="1602582068614">
<node TEXT=" 向集合中插入多个文档，使用批量插入会快一些" ID="ID_1019533772" CREATED="1602582772833" MODIFIED="1602582777244"/>
<node TEXT=" batchInsert 不是原子性的，已插入的不会因为中途错误而撤消" ID="ID_826374394" CREATED="1602684481667" MODIFIED="1602684532858"/>
<node TEXT=" &gt; db.foo.batchInsert([{&quot;_id&quot; : 0}, {&quot;_id&quot; : 1}, {&quot;_id&quot; : 2}])" ID="ID_998951548" CREATED="1602582796710" MODIFIED="1602582798507"/>
<node TEXT=" 如果试图插入 48  MB 以上的数据，多数驱动程序会将这个 批量插入请求拆分为多个 48  MB 的批量插入请求" ID="ID_1749481361" CREATED="1602582854790" MODIFIED="1602582856313"/>
</node>
</node>
<node TEXT="更新文档" POSITION="right" ID="ID_649360736" CREATED="1568125272724" MODIFIED="1568125279102">
<edge COLOR="#7c7c00"/>
<node TEXT=" MongoDB 使用 update() 和 save() 方法来更新集合中的文档" ID="ID_1050382401" CREATED="1568125308967" MODIFIED="1568125310398"/>
<node TEXT=" update() 方法" ID="ID_110912847" CREATED="1568125311175" MODIFIED="1568125329350">
<node TEXT="语法" ID="ID_1294704445" CREATED="1568125355107" MODIFIED="1568125358564">
<node TEXT=" db.collection.update(&#xa;   &lt;query&gt;,&#xa;   &lt;update&gt;,&#xa;   {&#xa;     upsert: &lt;boolean&gt;,&#xa;     multi: &lt;boolean&gt;,&#xa;     writeConcern: &lt;document&gt;&#xa;   }&#xa;)" ID="ID_1000338326" CREATED="1568125360363" MODIFIED="1568125366415"/>
</node>
<node TEXT="参数" ID="ID_871278749" CREATED="1568125369549" MODIFIED="1568125371806">
<node TEXT=" query : update的查询条件，类似sql update查询内where后面的。" ID="ID_21332030" CREATED="1568125382057" MODIFIED="1568125388223"/>
<node ID="ID_927906320" CREATED="1568125382058" MODIFIED="1568125382058"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      update : update&#30340;&#23545;&#35937;&#21644;&#19968;&#20123;&#26356;&#26032;&#30340;&#25805;&#20316;&#31526;&#65288;&#22914;$,$inc...&#65289;&#31561;&#65292;&#20063;&#21487;&#20197;&#29702;&#35299;&#20026;sql update&#26597;&#35810;&#20869;set&#21518;&#38754;&#30340;
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。" ID="ID_342876052" CREATED="1568125382061" MODIFIED="1568605801618"/>
<node TEXT="multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。" ID="ID_853494502" CREATED="1568125382071" MODIFIED="1568605695521"/>
<node ID="ID_166807318" CREATED="1568125382078" MODIFIED="1568125382078"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      writeConcern :&#21487;&#36873;&#65292;&#25243;&#20986;&#24322;&#24120;&#30340;&#32423;&#21035;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="只更新第一条记录" ID="ID_828829704" CREATED="1568127316981" MODIFIED="1568127327593">
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 1 } } , { $set : { &quot;test2&quot; : &quot;OK&quot;} } );" ID="ID_1812575690" CREATED="1568127332557" MODIFIED="1568127334400"/>
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 10 } } , { $inc : { &quot;count&quot; : 1} },false,false );" ID="ID_839071260" CREATED="1568127438144" MODIFIED="1568127439302"/>
</node>
<node TEXT=" 全部更新" ID="ID_888454591" CREATED="1568127371860" MODIFIED="1568127374069">
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 3 } } , { $set : { &quot;test2&quot; : &quot;OK&quot;} },false,true );" ID="ID_1391709544" CREATED="1568127378790" MODIFIED="1568127379885"/>
</node>
<node TEXT=" 全部更新" ID="ID_1911362571" CREATED="1568127418335" MODIFIED="1568127424200">
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 15 } } , { $inc : { &quot;count&quot; : 1} },false,true );" ID="ID_202556101" CREATED="1568127425324" MODIFIED="1568127427693"/>
</node>
<node TEXT="只添加第一条" ID="ID_322160502" CREATED="1568127381842" MODIFIED="1568127386846">
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 4 } } , { $set : { &quot;test5&quot; : &quot;OK&quot;} },true,false );" ID="ID_143524043" CREATED="1568127391316" MODIFIED="1568127392413"/>
</node>
<node TEXT=" 全部添加加进去" ID="ID_1763696003" CREATED="1568127394134" MODIFIED="1568127399142">
<node TEXT=" db.test0.update( { &quot;count&quot; : { $gt : 5 } } , { $set : { &quot;test5&quot; : &quot;OK&quot;} },true,true );" ID="ID_976557919" CREATED="1568127411591" MODIFIED="1568127412925"/>
</node>
<node TEXT=" save() 方法" ID="ID_1459250470" CREATED="1568125881895" MODIFIED="1568125890148">
<node TEXT=" save() 方法通过传入的文档来替换已有文档" ID="ID_1771903961" CREATED="1568125891446" MODIFIED="1568125893580"/>
<node TEXT="语法" ID="ID_583012784" CREATED="1568125915761" MODIFIED="1568125920054">
<node TEXT=" db.collection.save(&#xa;   &lt;document&gt;,&#xa;   {&#xa;     writeConcern: &lt;document&gt;&#xa;   }&#xa;)" ID="ID_124170562" CREATED="1568125920918" MODIFIED="1568125922803"/>
</node>
<node TEXT="参数" ID="ID_1490602194" CREATED="1568125927975" MODIFIED="1568125930044">
<node ID="ID_1041681367" CREATED="1568125938606" MODIFIED="1568125938606"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;document : &#25991;&#26723;&#25968;&#25454;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1828102168" CREATED="1568125938606" MODIFIED="1568125938606"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      writeConcern :&#21487;&#36873;&#65292;&#25243;&#20986;&#24322;&#24120;&#30340;&#32423;&#21035;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="  db.col.save(document)" ID="ID_18439499" CREATED="1568109088097" MODIFIED="1568109089403">
<node TEXT=" 如果不指定 _id 字段 save() 方法类似于 insert() 方法" ID="ID_1512290278" CREATED="1568109094167" MODIFIED="1568109095602"/>
<node TEXT="如果指定 _id 字段，save 会调用 upsert，更新该 _id 的数据" ID="ID_777493697" CREATED="1568109096236" MODIFIED="1602828692938"/>
</node>
</node>
<node TEXT="原子性的更新修改器" ID="ID_1271980994" CREATED="1602684735987" MODIFIED="1602684746512">
<node TEXT="计数修改" ID="ID_1224308367" CREATED="1602732539951" MODIFIED="1602762979741">
<node TEXT="专门来增加（和减少）数字的，只能 用于整型、长整型或双精度浮点型的值。" ID="ID_770267626" CREATED="1602732549000" MODIFIED="1602761871869"/>
<node TEXT="$inc 增加计数" ID="ID_638502674" CREATED="1602685407774" MODIFIED="1602685922472">
<node TEXT=" 增加已有键的值，或者该键不存在那就创建一个" ID="ID_291602577" CREATED="1602732568967" MODIFIED="1602762912855"/>
<node TEXT=" {&quot;_id&quot; : ObjectId,&#xa;&quot;url&quot; : &quot;www&quot;,&#xa;&quot;pv&quot; : 52 }" ID="ID_1467376249" CREATED="1602685419286" MODIFIED="1602685760833"/>
<node TEXT="db.analytics.update({&quot;url&quot; : &quot;www&quot;},{&quot;$inc&quot; : {&quot;pv&quot; : 1}})" ID="ID_1591986973" CREATED="1602685448206" MODIFIED="1602685766260"/>
</node>
</node>
<node TEXT="键值 新增与修改、删除" ID="ID_1359074263" CREATED="1602732500447" MODIFIED="1602732532450">
<node TEXT=" $set 修改" ID="ID_1809755765" CREATED="1602685923043" MODIFIED="1602685929454">
<node TEXT="&quot;$set&quot; 用来指定一个字段的值。如果这个字段不存在，则创建它。" ID="ID_1917210689" CREATED="1602685931299" MODIFIED="1602685949124"/>
<node TEXT="增加或修改性别" ID="ID_759663763" CREATED="1602731879593" MODIFIED="1602731891069">
<node TEXT="{ &quot;name&quot; : &quot;joe&quot;, &quot;age&quot; : 30 }" ID="ID_1319412930" CREATED="1602731591647" MODIFIED="1602731646817"/>
<node TEXT="db.users.update(&#xa;{&quot;name&quot;: &quot;joe&quot;},&#xa;{&quot;$set&quot;: {&quot;sex&quot;: &quot;male&quot;}}&#xa;)" ID="ID_282695717" CREATED="1602731656131" MODIFIED="1602731725128"/>
<node TEXT="{ &quot;name&quot; : &quot;joe&quot;, &quot;age&quot; : 30, &quot;sex&quot;: &quot;male&quot;}" ID="ID_1684395736" CREATED="1602731591647" MODIFIED="1602731758141"/>
</node>
<node TEXT="修改内嵌文档" ID="ID_1575934069" CREATED="1602731897353" MODIFIED="1602731906756">
<node TEXT=" {&quot;title&quot; : &quot;A Blog Post&quot;,&#xa;&quot;content&quot; : &quot;...&quot;,&#xa;&quot;author&quot; : {&quot;name&quot; : &quot;joe&quot;, “age&quot;: 20}&#xa;}" ID="ID_178542726" CREATED="1602732250009" MODIFIED="1602732299160"/>
<node TEXT="db.blogs.update(&#xa;{&quot;name&quot;: &quot;joe&quot;},&#xa;{&quot;$set&quot;: {&quot;author.sex&quot;: &quot;male&quot;}}&#xa;)" ID="ID_1941647663" CREATED="1602732350849" MODIFIED="1602732426698"/>
</node>
</node>
<node TEXT="$unset 删除键" ID="ID_633588543" CREATED="1602731771129" MODIFIED="1602731793252">
<node TEXT=" db.users.update(&#xa;{&quot;name&quot; : &quot;joe&quot;},&#xa; {&quot;$unset&quot; : {&quot;male&quot; : 1}}&#xa;)" ID="ID_174118819" CREATED="1602731829561" MODIFIED="1602731850756"/>
</node>
</node>
<node TEXT=" 数组修改器" ID="ID_990274104" CREATED="1602762934242" MODIFIED="1602762999453">
<node TEXT="$push" ID="ID_1651247500" CREATED="1602763024617" MODIFIED="1602763090716">
<node TEXT="$push 会向已有的数组末尾加入一个元素，要是没有就创建一个新的数组。" ID="ID_1598847972" CREATED="1602763031090" MODIFIED="1602763080457"/>
<node TEXT="添加数字进数组" ID="ID_886326938" CREATED="1602764005154" MODIFIED="1602764096448">
<node TEXT="{&#xa;&quot;title&quot; : &quot;A bob&apos;s Blog Post&quot;,&#xa;&quot;content&quot; : &quot;...&quot;,&#xa;&quot;author&quot; : { &quot;name&quot; : &quot;joe&quot;, &quot;sex&quot; : &quot;male&quot; }&#xa;}" ID="ID_505834394" CREATED="1602763588057" MODIFIED="1602764000186"/>
<node TEXT="db.blogs.update(&#xa;{&quot;author.name&quot;: &quot;bob&quot;},&#xa;{&quot;$push&quot;: {&quot;author.num&quot;: 4}}&#xa;)" ID="ID_3461801" CREATED="1602763448433" MODIFIED="1602763472639"/>
<node TEXT="{ &quot;title&quot; : &quot;A bob&apos;s Blog Post&quot;, &quot;content&quot; : &quot;...&quot;, &quot;author&quot; : { &quot;name&quot; : &quot;joe&quot;, &quot;sex&quot; : &quot;male&quot;, &quot;num : [4] } }" ID="ID_1827283317" CREATED="1602764030161" MODIFIED="1602764077213"/>
</node>
<node TEXT=" &quot;$each&quot; 子操作符" ID="ID_419816156" CREATED="1602764229834" MODIFIED="1602764231317">
<node TEXT=" 可以通过一次 &quot;$push&quot; 操作添加多个值进数组" ID="ID_1133192746" CREATED="1602764239746" MODIFIED="1602764248492"/>
<node TEXT=" db.blogs.update(&#xa;{&quot;author.name&quot;: &quot;bob&quot;},&#xa;{&quot;$push&quot;: {&quot;author.num&quot;: {&quot;$each&quot;: [10, 11]}}}&#xa;)" ID="ID_1978349295" CREATED="1602764343209" MODIFIED="1602764374232"/>
</node>
<node TEXT="&quot;$slice&quot;子操作符" ID="ID_1073734334" CREATED="1602765034346" MODIFIED="1602765049933">
<node TEXT="保证数组不超出slice设定的值" ID="ID_577924501" CREATED="1602765081443" MODIFIED="1602765262528"/>
<node TEXT=" db.blogs.update(&#xa;{&quot;author.name&quot;: &quot;bob&quot;},&#xa;{&quot;$push&quot;: {&quot;author.num&quot;: {&#xa;    &quot;$each&quot;: [10, 11],&#xa;    &quot;$slice&quot; : -10,&#xa;}}}&#xa;)" ID="ID_25389297" CREATED="1602764343209" MODIFIED="1602853192680">
<node TEXT="只保留添加完的后10个元素" ID="ID_1268659731" CREATED="1602765263067" MODIFIED="1602765430578"/>
</node>
</node>
<node TEXT="$slice 加 $sort" ID="ID_339289862" CREATED="1602765517349" MODIFIED="1602765540511">
<node TEXT="不能只将 &quot;$slice&quot; 或者 &quot;$sort&quot; 与 &quot;$push&quot; 配合使用，且必须使用 &quot;$each&quot;" ID="ID_147775055" CREATED="1602765510181" MODIFIED="1602765512588"/>
<node TEXT=" &quot;$sort&quot; 排序完之后再$slice" ID="ID_947937530" CREATED="1602765625635" MODIFIED="1602765669846"/>
<node TEXT=" db.blogs.update(&#xa;{&quot;author.name&quot;: &quot;bob&quot;},&#xa;{&quot;$push&quot;: {&quot;author.num&quot;: {&#xa;    &quot;$each&quot;: [10, 11],&#xa;    &quot;$slice&quot; : -10,&#xa;    &quot;$sort&quot; :  -1,&#xa;}}}&#xa;)" ID="ID_1455145677" CREATED="1602764343209" MODIFIED="1602765684610"/>
</node>
<node TEXT="将数组当集合用" ID="ID_1249941533" CREATED="1602766003554" MODIFIED="1602766022667">
<node TEXT=" 用 &quot;$ne&quot; 来实现" ID="ID_777186943" CREATED="1602766050880" MODIFIED="1602766052145">
<node TEXT="9不在 author.num数组中，才插入" ID="ID_183370003" CREATED="1602766086537" MODIFIED="1602766556590"/>
<node TEXT=" db.blogs.update(&#xa;{&quot;_id&quot;: ObjectId(&quot;5f87c02fae4d6a05ea1f777e&quot;), &quot;author.num&quot;: {&quot;$ne&quot;: 9}},&#xa;{&quot;$push&quot;: {&quot;author.num&quot;:9}}&#xa;)" ID="ID_414458094" CREATED="1602766434084" MODIFIED="1602766506866"/>
</node>
<node TEXT=" 用 &quot;$addToSet&quot; 来实现" ID="ID_93410978" CREATED="1602766059025" MODIFIED="1602766060246">
<node TEXT="  和 &quot;$each&quot; 组合起来，可以添加多个不同的值" ID="ID_1148153381" CREATED="1602766685770" MODIFIED="1602766691605"/>
<node TEXT=" db.blogs.update(&#xa;{&quot;_id&quot;: ObjectId(&quot;5f87c02fae4d6a05ea1f777e&quot;)}, {&quot;$addToSet&quot;: {&quot;author.num&quot;: 9}}&#xa;)" ID="ID_1235626514" CREATED="1602766645282" MODIFIED="1602766658509"/>
</node>
</node>
</node>
<node TEXT=" $pop" ID="ID_1494573088" CREATED="1602763501330" MODIFIED="1602767014383">
<node TEXT="根据指针删除元素" ID="ID_193243398" CREATED="1602767085775" MODIFIED="1602767192314">
<node TEXT=" {&quot;$pop&quot;:{&quot;key&quot;:1}} 从数组末尾删除 一个元素" ID="ID_597300829" CREATED="1602767115248" MODIFIED="1602767116674"/>
<node TEXT=" {&quot;$pop&quot;:{&quot;key&quot;:-1}} 从数组头部删除 一个元素" ID="ID_1023977857" CREATED="1602767121656" MODIFIED="1602767139874"/>
</node>
<node TEXT="根据值删除元素" ID="ID_289007124" CREATED="1602767193087" MODIFIED="1602767200105">
<node TEXT=" &quot;$pull&quot; 会将所有匹配的文档删除，而不是只删除一个。对" ID="ID_1988666299" CREATED="1602767260800" MODIFIED="1602767262330"/>
<node TEXT="删除&quot;luandry&quot;值" ID="ID_5484979" CREATED="1602767230607" MODIFIED="1602767245129">
<node TEXT=" {&quot;todo&quot; : [&quot;dishes&quot;, &quot;laundry&quot;, &quot;dry cleaning&quot;]}" ID="ID_1602369639" CREATED="1602767214663" MODIFIED="1602767216042"/>
<node TEXT=" db.lists.update({}, {&quot;$pull&quot; : {&quot;todo&quot; : &quot;laundry&quot;}})" ID="ID_10929628" CREATED="1602767226631" MODIFIED="1602767227706"/>
</node>
</node>
</node>
</node>
<node TEXT=" upsert" ID="ID_245342200" CREATED="1602767889396" MODIFIED="1602767904159">
<node TEXT=" 如果找到了匹配的文档，则正常更新" ID="ID_898780132" CREATED="1602768012325" MODIFIED="1602768018327"/>
<node TEXT=" 如果没找到了匹配的文档，则以这个查询条件和更新值为基础创建一个新的文档" ID="ID_410368279" CREATED="1602768032733" MODIFIED="1602768083649"/>
<node TEXT=" db.analytics.update({&quot;url&quot; : &quot;/blog&quot;}, {&quot;$inc&quot; : {&quot;pageviews&quot; : 1}}, true)" ID="ID_748082247" CREATED="1602768112589" MODIFIED="1602768114003"/>
</node>
</node>
<node TEXT=" 返回被更新的文档" ID="ID_254868935" CREATED="1602829542092" MODIFIED="1602829543161">
<node TEXT=" findAndModify返回的是修改之前的文档" ID="ID_773867011" CREATED="1602829551011" MODIFIED="1602829778398"/>
<node TEXT=" findAndModify 可以使用 &quot;update&quot; 键也可以使用 &quot;remove&quot; 键，必须要有一个" ID="ID_1894750136" CREATED="1602830698561" MODIFIED="1602830750452"/>
<node TEXT=" db.people.findAndModify( {&#xa;   query: { name: &quot;Tom&quot;, state: &quot;active&quot;, rating: { $gt: 10 } },&#xa;   sort: { rating: 1 },&#xa;   update: { $inc: { score: 1 } }&#xa;} );" ID="ID_626477364" CREATED="1602933063026" MODIFIED="1602933068666"/>
</node>
</node>
<node TEXT="删除文档" POSITION="right" ID="ID_1304522297" CREATED="1568126729290" MODIFIED="1568126743561">
<edge COLOR="#ff0000"/>
<node TEXT=" remove()函数是用来移除集合中的数据" ID="ID_142631552" CREATED="1568126744308" MODIFIED="1568126848654"/>
<node TEXT=" 在执行remove()函数前先执行find()命令来判断执行的条件是否正确，这是一个比较好的习惯" ID="ID_1029672998" CREATED="1568127485139" MODIFIED="1568127486428"/>
<node TEXT=" remove()" ID="ID_1155686263" CREATED="1568126857293" MODIFIED="1568126861479">
<node TEXT=" 语法" ID="ID_279308297" CREATED="1568126862157" MODIFIED="1568126866676">
<node TEXT="db.collection.remove(&#xa;   &lt;query&gt;,&#xa;   {&#xa;     justOne: &lt;boolean&gt;,&#xa;     writeConcern: &lt;document&gt;&#xa;   }&#xa;)" ID="ID_1702401133" CREATED="1568126873334" MODIFIED="1568127030164"/>
</node>
<node TEXT="参数" ID="ID_124877880" CREATED="1568127034079" MODIFIED="1568127037868">
<node ID="ID_1309042217" CREATED="1568606412490" MODIFIED="1568606412490"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      query :&#65288;&#21487;&#36873;&#65289;&#21024;&#38500;&#30340;&#25991;&#26723;&#30340;&#26465;&#20214;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1277632871" CREATED="1568606412490" MODIFIED="1568606412490"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      justOne : &#65288;&#21487;&#36873;&#65289;&#22914;&#26524;&#35774;&#20026; true &#25110; 1&#65292;&#21017;&#21482;&#21024;&#38500;&#19968;&#20010;&#25991;&#26723;&#65292;&#22914;&#26524;&#19981;&#35774;&#32622;&#35813;&#21442;&#25968;&#65292;&#25110;&#20351;&#29992;&#40664;&#35748;&#20540; false&#65292;&#21017;&#21024;&#38500;&#25152;&#26377;&#21305;&#37197;&#26465;&#20214;&#30340;&#25991;&#26723;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_880388561" CREATED="1568606412493" MODIFIED="1568606412493"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      writeConcern :&#65288;&#21487;&#36873;&#65289;&#25243;&#20986;&#24322;&#24120;&#30340;&#32423;&#21035;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="删除指定数据" ID="ID_555062063" CREATED="1568127779126" MODIFIED="1568127785216">
<node TEXT="删除所有user_id 为 &apos;testuser&apos; 的数据" ID="ID_172631485" CREATED="1568127805492" MODIFIED="1568127826576"/>
<node TEXT=" db.col.remove( { &quot;user_id&quot; : &quot;testuser&quot; } )" ID="ID_826455196" CREATED="1568127801954" MODIFIED="1568127898678"/>
</node>
<node TEXT="只想删除第一条找到的记录" ID="ID_956040996" CREATED="1568127830868" MODIFIED="1568127869924">
<node TEXT=" db.col.remove( { &quot;user_id&quot; : &quot;testuser&quot; }, 1 )" ID="ID_1372554267" CREATED="1568127801954" MODIFIED="1568127903694"/>
</node>
<node TEXT=" 删除所有数据" ID="ID_1861381042" CREATED="1568127885373" MODIFIED="1568127886567">
<node TEXT=" db.col.remove({})" ID="ID_168407457" CREATED="1568127891048" MODIFIED="1568127892831"/>
</node>
</node>
<node TEXT="查询文档" POSITION="right" ID="ID_1019382851" CREATED="1568127917357" MODIFIED="1568127957024" VGAP_QUANTITY="6.8999999999999995 pt">
<edge COLOR="#0000ff"/>
<node TEXT="使用 find() 方法，若只想查看一个文档，可用findOne" ID="ID_1004352113" CREATED="1568127948870" MODIFIED="1602678247046"/>
<node TEXT="语法" ID="ID_1734956713" CREATED="1568127951914" MODIFIED="1568127958276">
<node TEXT=" db.collection.find(query, projection)" ID="ID_1311640417" CREATED="1568127961379" MODIFIED="1568127963142"/>
<node TEXT="projection: 指定需要返回的键，1获取，0剔除" ID="ID_1078746033" CREATED="1602850236169" MODIFIED="1602919666015"/>
</node>
<node TEXT="参数" ID="ID_1810996602" CREATED="1568127967586" MODIFIED="1568127971433">
<node ID="ID_1882880808" CREATED="1568127986681" MODIFIED="1568127986681"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      query &#65306;&#21487;&#36873;&#65292;&#20351;&#29992;&#26597;&#35810;&#25805;&#20316;&#31526;&#25351;&#23450;&#26597;&#35810;&#26465;&#20214;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_161986947" CREATED="1568127986681" MODIFIED="1568127986681"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      projection &#65306;&#21487;&#36873;&#65292;&#20351;&#29992;&#25237;&#24433;&#25805;&#20316;&#31526;&#25351;&#23450;&#36820;&#22238;&#30340;&#38190;&#12290;&#26597;&#35810;&#26102;&#36820;&#22238;&#25991;&#26723;&#20013;&#25152;&#26377;&#38190;&#20540;&#65292; &#21482;&#38656;&#30465;&#30053;&#35813;&#21442;&#25968;&#21363;&#21487;&#65288;&#40664;&#35748;&#30465;&#30053;&#65289;&#12290;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="  pretty() 方法" ID="ID_260331855" CREATED="1568128014585" MODIFIED="1568128015573">
<node TEXT="以易读的方式来读取数据" ID="ID_1240127459" CREATED="1568128020823" MODIFIED="1568128033057"/>
<node TEXT=" pretty() 方法以格式化的方式来显示所有文档" ID="ID_1646253526" CREATED="1568128041518" MODIFIED="1568128043919"/>
<node TEXT=" db.col.find().pretty()" ID="ID_1328815494" CREATED="1568128029817" MODIFIED="1568128030780"/>
</node>
<node TEXT="比较操作，对比SQL的where" ID="ID_1470179439" CREATED="1568128280094" MODIFIED="1602919912528">
<node TEXT=" where by = &apos;菜鸟教程&apos;" ID="ID_213514513" CREATED="1568128309548" MODIFIED="1568128310503">
<node TEXT=" 等于 {&lt;key&gt;:&lt;value&gt;}" ID="ID_1687044864" CREATED="1568128319021" MODIFIED="1568128326271"/>
<node TEXT=" db.col.find({&quot;by&quot;:&quot;菜鸟教程&quot;}).pretty()" ID="ID_1046470260" CREATED="1568128331787" MODIFIED="1568128333014"/>
</node>
<node TEXT=" where likes &lt; 50" ID="ID_1973528746" CREATED="1568128340848" MODIFIED="1568128341933">
<node TEXT=" 小于 {&lt;key&gt;:{$lt:&lt;value&gt;}}" ID="ID_562615314" CREATED="1568128349245" MODIFIED="1568128355225"/>
<node TEXT=" db.col.find({&quot;likes&quot;:{$lt:50}}).pretty()" ID="ID_1136099641" CREATED="1568128356000" MODIFIED="1568128357869"/>
</node>
<node TEXT=" where likes &lt;= 50" ID="ID_1339342669" CREATED="1568128379704" MODIFIED="1568128382341">
<node TEXT=" 小于或等于 {&lt;key&gt;:{$lte:&lt;value&gt;}}" ID="ID_1831588321" CREATED="1568128386294" MODIFIED="1568128389460"/>
<node TEXT=" db.col.find({&quot;likes&quot;:{$lte:50}}).pretty()" ID="ID_691982162" CREATED="1568128392982" MODIFIED="1568128393924"/>
</node>
<node TEXT=" where likes &gt; 50" ID="ID_1779903488" CREATED="1568128399329" MODIFIED="1568128400295">
<node TEXT=" 大于 {&lt;key&gt;:{$gt:&lt;value&gt;}}" ID="ID_1662893501" CREATED="1568128404148" MODIFIED="1568128407159"/>
<node TEXT=" db.col.find({&quot;likes&quot;:{$gt:50}}).pretty()" ID="ID_1490363385" CREATED="1568128410804" MODIFIED="1568128411717"/>
</node>
<node TEXT=" where likes &gt;= 50" ID="ID_1823033833" CREATED="1568128418081" MODIFIED="1568128421766">
<node TEXT=" 大于或等于 {&lt;key&gt;:{$gte:&lt;value&gt;}}" ID="ID_80052486" CREATED="1568128422076" MODIFIED="1568128428310"/>
<node TEXT=" db.col.find({&quot;likes&quot;:{$gte:50}}).pretty()" ID="ID_1418110302" CREATED="1568128429002" MODIFIED="1568128429821"/>
</node>
<node TEXT=" where likes != 50" ID="ID_613883352" CREATED="1568128434106" MODIFIED="1568128435996">
<node TEXT=" 不等于 {&lt;key&gt;:{$ne:&lt;value&gt;}}" ID="ID_967540707" CREATED="1568128440254" MODIFIED="1568128442812"/>
<node TEXT=" db.col.find({&quot;likes&quot;:{$ne:50}}).pretty()" ID="ID_599402091" CREATED="1568128446456" MODIFIED="1568128447485"/>
</node>
</node>
<node TEXT=" MongoDB AND 条件" ID="ID_112481382" CREATED="1568128492866" MODIFIED="1568128493868">
<node TEXT="find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件" ID="ID_546036702" CREATED="1568128509573" MODIFIED="1568128518592"/>
<node TEXT="db.col.find({key1:value1, key2:value2}).pretty()" ID="ID_137980498" CREATED="1568128511127" MODIFIED="1568128516020"/>
</node>
<node TEXT=" MongoDB OR 条件" ID="ID_1968664012" CREATED="1568128525987" MODIFIED="1568128527037">
<node TEXT=" OR 条件语句使用了关键字 $or" ID="ID_322506815" CREATED="1568128536563" MODIFIED="1568128537462"/>
<node TEXT=" 语法" ID="ID_125195666" CREATED="1568128542161" MODIFIED="1568128543077">
<node TEXT=" &gt;db.col.find(&#xa;   {&#xa;      $or: [&#xa;         {key1: value1}, {key2:value2}&#xa;      ]&#xa;   }&#xa;).pretty()" ID="ID_905031345" CREATED="1568128547069" MODIFIED="1568128548477"/>
</node>
<node TEXT=" db.col.find({$or:[{&quot;by&quot;:&quot;菜鸟教程&quot;},{&quot;title&quot;: &quot;MongoDB 教程&quot;}]}).pretty()" ID="ID_1473730984" CREATED="1568128592880" MODIFIED="1568128594111"/>
</node>
<node TEXT="MongoDB IN 条件" ID="ID_1619925088" CREATED="1568711677849" MODIFIED="1568711684862">
<node TEXT="从 user 集合中检索 status 字段值为 &quot;P&quot; 或者 &quot;D&quot; 的所有文档" ID="ID_610416785" CREATED="1568711692672" MODIFIED="1568711700873"/>
<node TEXT=" db.users.find( { status: { $in: [ &quot;P&quot;, &quot;D&quot; ] } } )" ID="ID_1522862223" CREATED="1568711697223" MODIFIED="1568711698289"/>
</node>
<node TEXT=" AND 和 OR 联合使用" ID="ID_156667486" CREATED="1568128572798" MODIFIED="1568128574340">
<node TEXT=" db.col.find({&quot;likes&quot;: {$gt:50}, $or: [{&quot;by&quot;: &quot;菜鸟教程&quot;},{&quot;title&quot;: &quot;MongoDB 教程&quot;}]}).pretty()" ID="ID_63883182" CREATED="1568128585886" MODIFIED="1568128586901"/>
</node>
<node TEXT=" $not" ID="ID_168664646" CREATED="1602920015580" MODIFIED="1602920018400">
<node TEXT="取相反的结果" ID="ID_1424442595" CREATED="1602920196925" MODIFIED="1602920205359"/>
<node TEXT=" &quot;$not&quot; 是元条件句，即可以用在任何其他条件之上" ID="ID_626264927" CREATED="1602920025373" MODIFIED="1602920027073"/>
<node TEXT="价格小于等于1.99或不存在" ID="ID_66526959" CREATED="1602920408635" MODIFIED="1602920424671"/>
<node TEXT=" db.inventory.find( { price: { $not: { $gt: 1.99 } } } )" ID="ID_1191556290" CREATED="1602920274677" MODIFIED="1602920283431"/>
</node>
<node TEXT=" 指定需要返回的键" ID="ID_1840696015" CREATED="1602919699876" MODIFIED="1602919707608">
<node TEXT=" projection: 指定需要返回的键，1获取，0剔除" ID="ID_1005371333" CREATED="1602919744061" MODIFIED="1602919745579"/>
<node TEXT="find（或者 findOne）的第二个参数" ID="ID_1916588573" CREATED="1602919731982" MODIFIED="1602919756390"/>
<node TEXT=" db.users.find({}, {&quot;username&quot; : 1, &quot;_id&quot; : 0})" ID="ID_1974458021" CREATED="1602919772013" MODIFIED="1602919773288"/>
</node>
<node TEXT="查询数组" ID="ID_1907833474" CREATED="1602919779925" MODIFIED="1602924984622">
<node TEXT="水果列表" ID="ID_918310814" CREATED="1602925071088" MODIFIED="1602925075212">
<node TEXT=" db.food.insert({&quot;fruit&quot; : [&quot;apple&quot;, &quot;banana&quot;, &quot;peach&quot;]})" ID="ID_1627038758" CREATED="1602925080600" MODIFIED="1602925081508"/>
</node>
<node TEXT="查一个元素，找banana" ID="ID_1411241372" CREATED="1602925316310" MODIFIED="1602925386688">
<node TEXT=" db.food.find({&quot;fruit&quot; : &quot;banana&quot;})" ID="ID_1875308854" CREATED="1602925121479" MODIFIED="1602925122599"/>
<node TEXT=" 查询数组元素与查询标量值是一样的" ID="ID_1373825332" CREATED="1602925075383" MODIFIED="1602925114883"/>
<node TEXT="类似查文档 {&quot;fruit&quot; : &quot;apple&quot;, &quot;fruit&quot; : &quot;banana&quot;, &quot;fruit&quot; : &quot;peach&quot;}" ID="ID_397266015" CREATED="1602925125088" MODIFIED="1602925363002"/>
</node>
<node TEXT="匹配一组元素，找apple并有banana" ID="ID_124378541" CREATED="1602925277382" MODIFIED="1602925414928">
<node TEXT=" 用&quot;$all&quot; 通过多个元素来匹配数组，顺序无关紧要" ID="ID_1978490571" CREATED="1602925430052" MODIFIED="1602925501153"/>
<node TEXT=" db.food.find({fruit : {$all : [&quot;apple&quot;, &quot;banana&quot;]}})" ID="ID_814812306" CREATED="1602925421836" MODIFIED="1602925423162"/>
</node>
<node TEXT=" 查询数组特定位置的元素，第3个元素是否是peach" ID="ID_539432767" CREATED="1602925547959" MODIFIED="1602925570999">
<node TEXT=" db.food.find({&quot;fruit.2&quot; : &quot;peach&quot;})" ID="ID_735448018" CREATED="1602925578611" MODIFIED="1602925579533"/>
</node>
<node TEXT=" 查询特定长度的数组" ID="ID_158363012" CREATED="1602925594507" MODIFIED="1602925616943">
<node TEXT=" &quot;$size&quot; 查询数组匹配长度" ID="ID_738757171" CREATED="1602925609963" MODIFIED="1602925640406"/>
<node TEXT=" db.food.find({&quot;fruit&quot; : {&quot;$size&quot; : 3}})" ID="ID_512151093" CREATED="1602925645515" MODIFIED="1602925646326"/>
</node>
<node TEXT=" $slice操作符" ID="ID_1380535900" CREATED="1602925744106" MODIFIED="1602925745327">
<node TEXT=" 返回前 10 条评论" ID="ID_1981551546" CREATED="1602925755514" MODIFIED="1602925772417">
<node TEXT="db.blog.posts.findOne(&#xa;criteria,&#xa;{&quot;comments&quot; : {&quot;$slice&quot; : 10}}&#xa;)" ID="ID_48541418" CREATED="1602925767154" MODIFIED="1602925899868"/>
</node>
<node TEXT=" 返回后 10 条评论" ID="ID_483975273" CREATED="1602925790097" MODIFIED="1602925791145">
<node TEXT="db.blog.posts.findOne(&#xa;criteria,&#xa;{&quot;comments&quot; : {&quot;$slice&quot; : -10}}&#xa;)" ID="ID_97193656" CREATED="1602925767154" MODIFIED="1602925898559"/>
</node>
<node TEXT="返回第 24～33 个元素" ID="ID_1575419795" CREATED="1602925835978" MODIFIED="1602925852762">
<node TEXT=" 如果数组不够 33 个元素， 则返回第 23 个元素后面的所有元素" ID="ID_989358511" CREATED="1602925861114" MODIFIED="1602925862731"/>
<node TEXT=" db.blog.posts.findOne(&#xa;criteria,&#xa;{&quot;comments&quot; : {&quot;$slice&quot; : [23, 10]}}&#xa;)" ID="ID_1034131607" CREATED="1602925879826" MODIFIED="1602925896858"/>
</node>
</node>
</node>
<node TEXT=" 游标" ID="ID_1604973642" CREATED="1602928383473" MODIFIED="1602928388997">
<node TEXT=" 数据库使用游标返回 find 的执行结果" ID="ID_1360715860" CREATED="1602928390800" MODIFIED="1602928431392"/>
<node TEXT=" limit、skip和sort" ID="ID_1325756492" CREATED="1602928542568" MODIFIED="1602928543932">
<node TEXT=" 只返回 3 个结果" ID="ID_1445475406" CREATED="1602928552425" MODIFIED="1602928553089">
<node TEXT=" limit指定的是上限，而非 下限" ID="ID_854241228" CREATED="1602928580264" MODIFIED="1602928584755"/>
<node TEXT=" db.c.find().limit(3)" ID="ID_1859867631" CREATED="1602928562345" MODIFIED="1602928563339"/>
</node>
<node TEXT=" 略过前三个匹配的文档" ID="ID_1092224097" CREATED="1602928597560" MODIFIED="1602928632340">
<node TEXT=" db.c.find().skip(3)" ID="ID_1449287980" CREATED="1602928603473" MODIFIED="1602928604371"/>
</node>
<node TEXT="多键排序" ID="ID_1792937051" CREATED="1602928632921" MODIFIED="1602928640546">
<node TEXT=" 按照 &quot;username&quot; 升序及 &quot;age&quot; 降 序排序" ID="ID_896202000" CREATED="1602928652471" MODIFIED="1602928656054"/>
<node TEXT=" db.c.find().sort({username : 1, age : -1})" ID="ID_1831932825" CREATED="1602928645721" MODIFIED="1602928646986"/>
</node>
<node TEXT=" db.stock.find(&#xa;{&quot;desc&quot; : &quot;mp3&quot;}&#xa;).limit(50).skip(50).sort({&quot;price&quot; : -1})" ID="ID_580004470" CREATED="1602928701712" MODIFIED="1602928712812"/>
</node>
<node TEXT=" 结果分页" ID="ID_549084400" CREATED="1602928781760" MODIFIED="1602928783243">
<node TEXT=" 避免使用skip略过大量结果，因为要抛弃之前的数据，会很慢" ID="ID_223280457" CREATED="1602928737544" MODIFIED="1602928832929"/>
<node TEXT="方法" ID="ID_1353892672" CREATED="1602928858766" MODIFIED="1602928869882">
<node TEXT=" 用limit返回结果的第一页" ID="ID_959424301" CREATED="1602928874814" MODIFIED="1602929078207"/>
<node TEXT="修改查询条件，加上跳过第一页的查询" ID="ID_1914008457" CREATED="1602929078604" MODIFIED="1602929104191"/>
</node>
</node>
<node TEXT=" 随机选取文档" ID="ID_1246366280" CREATED="1602929128708" MODIFIED="1602929130638">
<node TEXT=" 插入文档时给每个文档都添加一个额外的随机键" ID="ID_1566193190" CREATED="1602929172923" MODIFIED="1602929178990"/>
<node TEXT="查询时计算一个随机数并将其作为查询条件" ID="ID_1666468180" CREATED="1602929179204" MODIFIED="1602929204335"/>
<node TEXT="// 插入&#xa;&gt; db.people.insert({&quot;name&quot; : &quot;joe&quot;, &quot;random&quot; : Math.random()})&#xa;&gt; db.people.insert({&quot;name&quot; : &quot;john&quot;, &quot;random&quot; : Math.random()})&#xa;// 查询&#xa;&gt; var random = Math.random()&#xa;&gt; result = db.foo.findOne({&quot;random&quot; : {&quot;$gt&quot; : random}})" ID="ID_457181515" CREATED="1602929214531" MODIFIED="1602929255734"/>
</node>
</node>
</node>
<node TEXT="查询嵌套文档" POSITION="right" ID="ID_565878462" CREATED="1602592713798" MODIFIED="1602592733306">
<edge COLOR="#00007c"/>
<node ID="ID_568239771" CREATED="1602592967530" MODIFIED="1602592967530"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt">// `storage` Collection<br/>{<br/>    <span style="color: #a5c261"><font color="#a5c261">"_id"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"alpha"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">"name"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"Storage Alpha"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font><span style="color: #a5c261"><font color="#a5c261">"items"</font></span>: [<br/>        {<br/>            <span style="color: #a5c261"><font color="#a5c261">"category"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"food"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">            </span></font><span style="color: #a5c261"><font color="#a5c261">"name"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"apple"<br/></font></span><font color="#a5c261"><span style="color: #a5c261">        </span></font>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font>{<br/>            <span style="color: #a5c261"><font color="#a5c261">"category"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"food"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">            </span></font><span style="color: #a5c261"><font color="#a5c261">"name"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"banana"<br/></font></span><font color="#a5c261"><span style="color: #a5c261">        </span></font>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font>{<br/>            <span style="color: #a5c261"><font color="#a5c261">"category"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"tool"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">            </span></font><span style="color: #a5c261"><font color="#a5c261">"name"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"hammer"<br/></font></span><font color="#a5c261"><span style="color: #a5c261">        </span></font>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">        </span></font>{<br/>            <span style="color: #a5c261"><font color="#a5c261">"category"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"furniture"</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">            </span></font><span style="color: #a5c261"><font color="#a5c261">"name"</font></span>: <span style="color: #a5c261"><font color="#a5c261">"couch"<br/></font></span><font color="#a5c261"><span style="color: #a5c261">        </span></font>}<br/>    ]<br/>}</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" $ 映射操作符" ID="ID_958740829" CREATED="1602592740012" MODIFIED="1602592741296">
<node TEXT=" 只会返回数组中第一个符合条件的元素" ID="ID_1497731970" CREATED="1602592769245" MODIFIED="1602592770464"/>
<node TEXT=" db.storage.find(&#xa;    {&#xa;        &apos;items.category&apos;: {&#xa;            $eq: &apos;food&apos;&#xa;        }&#xa;    },&#xa;    {&#xa;        &apos;items.$&apos;: 1&#xa;    }&#xa;)" ID="ID_1976551084" CREATED="1602592986627" MODIFIED="1602592988873"/>
</node>
<node TEXT=" $elemMatch 映射操作符" ID="ID_1685017767" CREATED="1602592776443" MODIFIED="1602592777518">
<node TEXT=" 和 $ 一样，$elemMatch 也只能返回数组中的第一条元素" ID="ID_1675284281" CREATED="1602592799995" MODIFIED="1602592800998"/>
<node TEXT=" db.storage.find(&#xa;    // 对 `items` 的过滤条件不需要写在查询条件中&#xa;    {&#xa;        &apos;_id&apos;: &quot;alpha&quot;&#xa;    },&#xa;    {&#xa;        &apos;items&apos;: {&#xa;            &apos;$elemMatch&apos;: {&#xa;                &apos;category&apos;: &apos;food&apos;&#xa;            }&#xa;        }&#xa;    }&#xa;)" ID="ID_540198455" CREATED="1602593008683" MODIFIED="1602593015528"/>
</node>
<node TEXT=" 聚合" ID="ID_952750576" CREATED="1602592808051" MODIFIED="1602592809003">
<node TEXT=" db.storage.aggregate(&#xa;    {&#xa;        $project: {&#xa;            &quot;items&quot;: {&#xa;                $filter: {&#xa;                    input: &quot;$items&quot;,&#xa;                    as: &quot;item&quot;,&#xa;                    cond: {&#xa;                        $eq: [ &apos;$$item.category&apos;, &apos;food&apos; ]&#xa;                    }&#xa;                }&#xa;            }&#xa;        }&#xa;    }&#xa;)" ID="ID_1142018722" CREATED="1602593337625" MODIFIED="1602593339076"/>
<node TEXT=" db.storage.aggregate(&#xa;    {&#xa;        $match : {&#xa;            &apos;items.category&apos;: &apos;food&apos;&#xa;        }&#xa;    },&#xa;    {&#xa;        $unwind : &apos;$items&apos;&#xa;    },&#xa;    {&#xa;        $match : {&#xa;            &apos;items.category&apos;: &apos;food&apos;&#xa;        }&#xa;    }&#xa;)" ID="ID_1929754097" CREATED="1602593483953" MODIFIED="1602593485495"/>
</node>
</node>
<node TEXT="$type操作符" FOLDED="true" POSITION="right" ID="ID_598240164" CREATED="1568128633394" MODIFIED="1568128645269">
<edge COLOR="#00ff00"/>
<node TEXT=" $type操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果" ID="ID_1449492722" CREATED="1568167168127" MODIFIED="1568167169796"/>
<node TEXT="类型" ID="ID_1183157927" CREATED="1568167195502" MODIFIED="1568167199561">
<node ID="ID_225272153" CREATED="1568167208766" MODIFIED="1568167208766"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Double 1
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_84296628" CREATED="1568167208767" MODIFIED="1568167208767"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      String 2
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1342365085" CREATED="1568167208768" MODIFIED="1568167208768"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Object 3
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1289435110" CREATED="1568167208769" MODIFIED="1568167208769"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      Array
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT="等等" ID="ID_1609984371" CREATED="1568167211855" MODIFIED="1568167214793"/>
</node>
<node TEXT=" 获取 &quot;col&quot; 集合中 title 为 String 的数据" ID="ID_1168887967" CREATED="1568167254074" MODIFIED="1568167255893">
<node ID="ID_1342421767" CREATED="1568167273420" MODIFIED="1568167273420"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      db.col.find({&quot;title&quot; : {$type : 2}})
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1375105992" CREATED="1568167273421" MODIFIED="1568167273421"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      db.col.find({&quot;title&quot; : {$type : 'string'}})
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="  Limit与Skip" FOLDED="true" POSITION="right" ID="ID_1084843197" CREATED="1568167476947" MODIFIED="1568167477904">
<edge COLOR="#00ffff"/>
<node TEXT="Limit() 方法" ID="ID_280716026" CREATED="1568167310342" MODIFIED="1568167479215">
<node TEXT=" limit()方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数" ID="ID_491401961" CREATED="1568167381315" MODIFIED="1568167382537"/>
<node TEXT="语法" ID="ID_314216141" CREATED="1568167387224" MODIFIED="1568167399339">
<node TEXT=" db.COLLECTION_NAME.find().limit(NUMBER)" ID="ID_459986002" CREATED="1568167395005" MODIFIED="1568167396209"/>
</node>
</node>
<node TEXT=" Skip() 方法" ID="ID_923520578" CREATED="1568167485992" MODIFIED="1568167487016">
<node TEXT=" 使用skip()方法来跳过指定数量的数据" ID="ID_722613590" CREATED="1568167500746" MODIFIED="1568167503217"/>
<node TEXT=" skip方法同样接受一个数字参数作为跳过的记录条数， 默认为0" ID="ID_885104818" CREATED="1568167536127" MODIFIED="1568167542267"/>
<node TEXT=" 语法" ID="ID_1952590279" CREATED="1568167511650" MODIFIED="1568167512801">
<node TEXT=" db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)" ID="ID_973398548" CREATED="1568167518574" MODIFIED="1568167519656"/>
</node>
</node>
</node>
<node TEXT="排序" FOLDED="true" POSITION="right" ID="ID_531551458" CREATED="1568167548554" MODIFIED="1568167551254">
<edge COLOR="#7c0000"/>
<node TEXT=" sort() 方法" ID="ID_295488894" CREATED="1568167563509" MODIFIED="1568167564320">
<node TEXT="接受参数，1 为升序排列，而 -1 是用于降序排列" ID="ID_597722177" CREATED="1568167585913" MODIFIED="1568167599990"/>
<node TEXT="语法" ID="ID_1917179165" CREATED="1568167721370" MODIFIED="1568167723909">
<node TEXT=" db.COLLECTION_NAME.find().sort({KEY:1})" ID="ID_1697654968" CREATED="1568167724772" MODIFIED="1568167725873"/>
</node>
</node>
<node TEXT=" col 集合中的数据按字段 likes 的降序排列" ID="ID_521403511" CREATED="1568167769471" MODIFIED="1568167770321">
<node TEXT=" db.col.find({},{&quot;title&quot;:1,_id:0}).sort({&quot;likes&quot;:-1})" ID="ID_1397957025" CREATED="1568167856423" MODIFIED="1568167857410"/>
</node>
</node>
<node TEXT=" 索引" POSITION="right" ID="ID_1765600412" CREATED="1568167884347" MODIFIED="1568167885632">
<edge COLOR="#00007c"/>
<node TEXT=" MongoDB 无需在整个数据文档中检索匹配查询条件和返回使用相同索引的查询结果" ID="ID_91339684" CREATED="1568172033183" MODIFIED="1568172034879"/>
<node TEXT=" 索引存在于RAM中，从索引中获取数据比通过扫描文档读取数据要快得多" ID="ID_1794008955" CREATED="1568172054792" MODIFIED="1568172055942"/>
<node TEXT=" createIndex() 方法" ID="ID_1570132935" CREATED="1568167901035" MODIFIED="1568167901850">
<node TEXT=" 语法" ID="ID_313624055" CREATED="1568167916983" MODIFIED="1568167918019">
<node TEXT=" db.collection.createIndex(keys, options)" ID="ID_1746242840" CREATED="1568167923226" MODIFIED="1568167924080"/>
<node TEXT=" Key 值为你要创建的索引字段, {key: 1/-1}" ID="ID_91341102" CREATED="1568167940625" MODIFIED="1568168084382"/>
<node TEXT=" 1 为按升序创建索引, -1 为降序" ID="ID_1953155770" CREATED="1568168108867" MODIFIED="1568168135550"/>
</node>
<node TEXT="创建title字段升序" ID="ID_1567865824" CREATED="1568168149519" MODIFIED="1568168160355">
<node TEXT=" db.col.createIndex({&quot;title&quot;:1})" ID="ID_974399811" CREATED="1568168167516" MODIFIED="1568168171385"/>
</node>
<node TEXT=" 多个字段创建索引（关系型数据库中称作复合索引）" ID="ID_80846755" CREATED="1568168184283" MODIFIED="1568168185184">
<node TEXT=" db.col.createIndex({&quot;title&quot;:1,&quot;description&quot;:-1})" ID="ID_1526820320" CREATED="1568168190401" MODIFIED="1568168192057"/>
<node TEXT="最左前缀原则，白给的隐式索引， {&quot;title&quot;: 1}" ID="ID_1250972031" CREATED="1603095692610" MODIFIED="1603095922111"/>
<node TEXT="注意复合索引的顺序很重要" ID="ID_1853237658" CREATED="1603095259467" MODIFIED="1603095372921"/>
</node>
</node>
<node TEXT="查看集合索引" ID="ID_1989262482" CREATED="1568168208251" MODIFIED="1568168218143">
<node TEXT=" db.col.getIndexes()" ID="ID_516930704" CREATED="1568168222107" MODIFIED="1568168223009"/>
</node>
<node TEXT=" 查看集合索引大小" ID="ID_1100947155" CREATED="1568168223883" MODIFIED="1568168227657">
<node TEXT="db.col.totalIndexSize()" ID="ID_1643665379" CREATED="1568168230512" MODIFIED="1568168241256"/>
</node>
<node TEXT=" 删除集合所有索引" ID="ID_1958167244" CREATED="1568168234498" MODIFIED="1568168235193">
<node TEXT=" db.col.dropIndexes()" ID="ID_924276410" CREATED="1568168237788" MODIFIED="1568168238664"/>
</node>
<node TEXT=" 删除集合指定索引" ID="ID_514067668" CREATED="1568168244845" MODIFIED="1568168245888">
<node TEXT=" db.col.dropIndex(&quot;索引名称&quot;)" ID="ID_1544806947" CREATED="1568168249194" MODIFIED="1568168250160"/>
</node>
<node TEXT="覆盖索引查询" ID="ID_1624905435" CREATED="1568171633123" MODIFIED="1568171642054">
<node TEXT=" 覆盖查询是以下的查询" ID="ID_443237927" CREATED="1568171652867" MODIFIED="1568171655753">
<node TEXT=" 所有的查询字段是索引的一部分" ID="ID_1312097383" CREATED="1568171660147" MODIFIED="1568171661241"/>
<node TEXT=" 所有的查询返回字段在同一个索引中" ID="ID_1793232378" CREATED="1568171670280" MODIFIED="1568171671764"/>
</node>
<node TEXT=" 使用覆盖索引查询" ID="ID_1351076466" CREATED="1568172152006" MODIFIED="1568172153103">
<node TEXT=" {&#xa;   &quot;_id&quot;: ObjectId(&quot;53402597d852426020000002&quot;),&#xa;   &quot;contact&quot;: &quot;987654321&quot;,&#xa;   &quot;dob&quot;: &quot;01-01-1991&quot;,&#xa;   &quot;gender&quot;: &quot;M&quot;,&#xa;   &quot;name&quot;: &quot;Tom Benzamin&quot;,&#xa;   &quot;user_name&quot;: &quot;tombenzamin&quot;&#xa;}" ID="ID_1151737181" CREATED="1568172160490" MODIFIED="1568172161663"/>
<node TEXT="创建联合索引" ID="ID_197673347" CREATED="1568172162939" MODIFIED="1568172176888">
<node TEXT=" db.users.ensureIndex({gender:1,user_name:1})" ID="ID_1234482361" CREATED="1568172177356" MODIFIED="1568172178673"/>
</node>
<node TEXT="查询" ID="ID_387673484" CREATED="1568172179531" MODIFIED="1568172183425">
<node TEXT=" 索引会覆盖以下查询，MongoDB的不会去数据库文件中查找。相反，它会从索引中提取数据" ID="ID_1096716347" CREATED="1568172200789" MODIFIED="1568172234002"/>
<node TEXT=" db.users.find({gender:&quot;M&quot;},{user_name:1,_id:0})" ID="ID_1110961206" CREATED="1568172195247" MODIFIED="1568172196705"/>
<node TEXT=" 没有排除_id，查询就不会被覆盖" ID="ID_927996550" CREATED="1568172279168" MODIFIED="1568172306263"/>
</node>
</node>
<node TEXT="有数组的情况" ID="ID_103933865" CREATED="1603095757043" MODIFIED="1603095796479">
<node TEXT=" 如果在一个含有数组的字段上做索引，这个索引永远也无法覆盖查询" ID="ID_446760762" CREATED="1603095774203" MODIFIED="1603095788553"/>
<node TEXT=" 即便将数组字段从需要返回的字段中剔除，这样的索引仍然无法覆盖查询" ID="ID_868152030" CREATED="1603095783746" MODIFIED="1603106478259"/>
</node>
</node>
<node TEXT="索引的代价" ID="ID_1143102013" CREATED="1602935990831" MODIFIED="1602935995213">
<node TEXT=" 对于添加的每一个索引，每次写操作（插入、更新、删除）都将耗费更多的时间" ID="ID_1460446833" CREATED="1602935998205" MODIFIED="1602935999483"/>
<node TEXT=" 因为数据发生变动时，MongoDB不仅要更新文档， 还要更新集合上的所有索引" ID="ID_326541301" CREATED="1602936011717" MODIFIED="1602936014920"/>
</node>
<node TEXT=" $操作符如何使用索引" ID="ID_1767865208" CREATED="1603096098715" MODIFIED="1603096100011">
<node TEXT="低效率的操作符" ID="ID_972615346" CREATED="1603095742258" MODIFIED="1603095754895">
<node TEXT=" 无法使用索引" ID="ID_1867285940" CREATED="1603096390083" MODIFIED="1603096391543">
<node TEXT=" $where&quot; 查询无法使用索引" ID="ID_1415439025" CREATED="1603096125716" MODIFIED="1603096245082"/>
<node TEXT=" $exists查一个键是否存在的查询无法使用索引" ID="ID_1900279150" CREATED="1603096137491" MODIFIED="1603096250710"/>
</node>
<node TEXT=" 取反查询" ID="ID_10331574" CREATED="1603096475555" MODIFIED="1603096485102">
<node TEXT=" 通常来说，取反的效率是比较低的，因为要扫描整个索引" ID="ID_1834532241" CREATED="1603096403251" MODIFIED="1603096533022"/>
<node TEXT=" &quot;$ne&quot; 查询" ID="ID_639660205" CREATED="1603096380291" MODIFIED="1603096586007">
<node TEXT=" $ne&quot; 查询可以使用索引，但并不是很有效。" ID="ID_1581487119" CREATED="1603096437427" MODIFIED="1603096543752"/>
</node>
<node TEXT="  &quot;$not&quot; 查询" ID="ID_1439262103" CREATED="1603096578965" MODIFIED="1603096580881">
<node TEXT=" 大多数使用 &quot;$not&quot; 的查询都会退化为进行全表扫描" ID="ID_1501395376" CREATED="1603096572131" MODIFIED="1603096577782"/>
</node>
<node TEXT="   &quot;$nin&quot; 查询" ID="ID_1549173020" CREATED="1603096605467" MODIFIED="1603096609465">
<node TEXT=" &quot;$nin&quot; 就总是进行全表扫描" ID="ID_694932079" CREATED="1603096595941" MODIFIED="1603096599226"/>
</node>
</node>
</node>
<node TEXT="范围" ID="ID_107181895" CREATED="1603097307998" MODIFIED="1603097311770">
<node TEXT=" 在一次查询中使 用两个范围通常会导致低效的查询计划" ID="ID_1648667658" CREATED="1603097321406" MODIFIED="1603097325361"/>
<node TEXT=" 应该将会用于精确匹配的字段（比如 &quot;x&quot; : &quot;foo&quot;）放在索引的前面，将 用于范围匹配的字段（比如 &quot;y&quot; : {&quot;$gt&quot; : 3， &quot;$lt&quot; : 5}）放在最后" ID="ID_981004732" CREATED="1603097352239" MODIFIED="1603097361912"/>
<node TEXT=" 确保第一个索引键进行精确匹配，然后再使用第二个索引范围在这个结果集内部进行搜索，从而减少需要扫描的文档数量" ID="ID_675150231" CREATED="1603097379468" MODIFIED="1603097423823"/>
</node>
<node TEXT=" OR查询" ID="ID_307145615" CREATED="1603097103178" MODIFIED="1603097104251">
<node TEXT=" MongoDB一次查询只会使用其中的一个索引" ID="ID_849023533" CREATED="1603097115634" MODIFIED="1603097136030"/>
<node TEXT=" &quot;$or&quot;是个例 外，&quot;$or&quot; 可以对每个子句都使用索引，因为 &quot;$or&quot; 实际上是执行两次查询然后将结果集合并" ID="ID_707152763" CREATED="1603097163002" MODIFIED="1603097188045"/>
<node TEXT=" 该尽可能使用&quot;$in&quot; 而不是 &quot;$or&quot;" ID="ID_756306642" CREATED="1603097220440" MODIFIED="1603097222196"/>
</node>
</node>
<node TEXT="索引对象和数组" ID="ID_1215464462" CREATED="1603097459162" MODIFIED="1603097465838">
<node TEXT=" MongoDB 允许深入文档内部，对嵌套字段和数组建立索引。套对象和数组字段可以与复合索引中的顶级字段一起使用" ID="ID_1337687680" CREATED="1603097753078" MODIFIED="1603097844765"/>
<node TEXT=" 索引嵌套文档" ID="ID_993814238" CREATED="1603097855005" MODIFIED="1603097856400">
<node TEXT=" 建立嵌套索引" ID="ID_1106229518" CREATED="1603097931171" MODIFIED="1603097939575">
<node TEXT=" db.users.ensureIndex({&quot;loc.city&quot; : 1})" ID="ID_645554760" CREATED="1603097891643" MODIFIED="1603097892856"/>
<node TEXT=" 可以在&quot;x.y.z.w.a.b.c&quot; 上建立索引" ID="ID_422945940" CREATED="1603097893693" MODIFIED="1603097943000"/>
</node>
<node TEXT=" 注意" ID="ID_385814195" CREATED="1603097924045" MODIFIED="1603097925461">
<node TEXT=" 对嵌套文档本身（&quot;loc&quot;）建立索引，与对嵌套文档的某个字段（&quot;loc.city&quot;）建立索引是不同的" ID="ID_1404592802" CREATED="1603097957428" MODIFIED="1603097961848"/>
<node TEXT="整个子文档建立索引，只会提高整个子文档的查询速度，而不能应用于单独查询子文档内的字段" ID="ID_1678910190" CREATED="1603097972155" MODIFIED="1603098032367"/>
</node>
</node>
<node TEXT=" 索引数组" ID="ID_274869291" CREATED="1603098334065" MODIFIED="1603098335096">
<node TEXT="对数组建立索引可以高效地搜索数组中的特定元素" ID="ID_1125898185" CREATED="1603098354440" MODIFIED="1603098365188"/>
<node TEXT=" 对数组建立索引，实际上是对数组的每一个元素建立一个索引条目。因此数组索引的代价比单值索引高" ID="ID_1679041197" CREATED="1603098416505" MODIFIED="1603098512738"/>
<node TEXT=" 一个索引中的数组字段最多只能有一个，避免在多键索引中索引条目爆炸性增长" ID="ID_934361160" CREATED="1603098579863" MODIFIED="1603098602650"/>
<node TEXT=" 无法将整个数组作为一个实体建立索引" ID="ID_103648310" CREATED="1603098532495" MODIFIED="1603098539478"/>
<node TEXT=" 在&quot;comments&quot; 数组的 &quot;date&quot; 键上建立索引" ID="ID_142692683" CREATED="1603098452400" MODIFIED="1603098463198">
<node TEXT=" db.blog.ensureIndex({&quot;comments.date&quot; : 1})" ID="ID_493449926" CREATED="1603098467823" MODIFIED="1603098469016"/>
<node TEXT=" 如果一篇文章有 20 条评论，那么它就拥有 20 个索引条目" ID="ID_559999824" CREATED="1603098481143" MODIFIED="1603098483988"/>
</node>
</node>
<node TEXT=" 多键索引" ID="ID_437882951" CREATED="1603098744390" MODIFIED="1603098745555">
<node TEXT=" 多键索引可能会比非多键索引慢一些。可能会有多个索引条目指向同一个文档，还要去重" ID="ID_298749589" CREATED="1603098796590" MODIFIED="1603098920041"/>
<node TEXT=" 对于某个索引的键，如果这个键在某个文档中是一个数组，那么这个索引就会被标 记为多键索引" ID="ID_866732698" CREATED="1603098844703" MODIFIED="1603098849507"/>
<node TEXT=" 引只要被 标记为多键索引，就无法再变成非多键索引了，只能删了重建" ID="ID_566278870" CREATED="1603098865918" MODIFIED="1603098879146"/>
</node>
</node>
<node TEXT="索引基数" ID="ID_984919509" CREATED="1603098940798" MODIFIED="1603098948233">
<node TEXT="基数（cardinality）就是集合中某个字段拥有不同值的数量。比如性别字段有两种可能值，基数就为2" ID="ID_1442869362" CREATED="1603099022829" MODIFIED="1603099082042"/>
<node TEXT=" 一个字段的基数越高，这个键上的索引就越有用" ID="ID_1046756424" CREATED="1603099114925" MODIFIED="1603099143528"/>
<node TEXT=" 一般说来，应该在基数比较高的键上建立索引，或者至少应该把基数较高的键放在 复合索引的前面（低基数的键之前）" ID="ID_1256630145" CREATED="1603099138142" MODIFIED="1603099139477"/>
</node>
<node TEXT="使用explanin() 和 hint()" ID="ID_1048219865" CREATED="1603098960662" MODIFIED="1603098972400">
<node TEXT=" explain()" ID="ID_867886384" CREATED="1603099271109" MODIFIED="1603099271952">
<node TEXT=" 对于任意查询，都可以在最后添加一个 explain() 调用" ID="ID_547428067" CREATED="1603099280037" MODIFIED="1603099289285"/>
<node TEXT=" explain() 能够提供大量与查询相关的信息" ID="ID_1773238605" CREATED="1603099245958" MODIFIED="1603099270408"/>
<node TEXT=" 分片返回的是多个 explain() 的聚合，因为查询会在 多个服务器上执行" ID="ID_1207724709" CREATED="1603099348508" MODIFIED="1603099356360"/>
<node TEXT="返回参数" ID="ID_449884168" CREATED="1603099410340" MODIFIED="1603099417313">
<node TEXT=" &quot;cursor&quot;的BtreeCursor 表示本次查询使用了索引" ID="ID_1849337056" CREATED="1603099887125" MODIFIED="1603099931400"/>
<node TEXT="&quot;millis&quot; 表明了这个查询的执行速度" ID="ID_1687922819" CREATED="1603099417501" MODIFIED="1603099432671"/>
<node TEXT=" &quot;n&quot; 表示实际返回的文档数量" ID="ID_1345692010" CREATED="1603099445679" MODIFIED="1603099464243"/>
<node TEXT=" &quot;nscannedObjects&quot; 是所扫描的文档数量" ID="ID_1427194426" CREATED="1603099493884" MODIFIED="1603099501920"/>
<node TEXT=" &quot;scanAndOrder&quot;  表示是否对结果进行了排序" ID="ID_945003769" CREATED="1603099587637" MODIFIED="1603099603584"/>
</node>
</node>
<node TEXT="hint()" ID="ID_94410202" CREATED="1603100328820" MODIFIED="1603100332855">
<node TEXT=" 用hit() 强制 MongoDB 使用特定的索引" ID="ID_1824688806" CREATED="1603100338654" MODIFIED="1603100340928"/>
<node TEXT=" db.c.find({&quot;age&quot; : 14, &quot;username&quot; : /.*/})&#xa;.hint({&quot;username&quot; : 1, &quot;age&quot; : 1})" ID="ID_1267472458" CREATED="1603100353380" MODIFIED="1603100364386"/>
<node TEXT="如果强制使用的索引，而这个查询不知道如何使用这个索引，会比不使用索引还要慢" ID="ID_1695401868" CREATED="1603100423253" MODIFIED="1603100610000"/>
</node>
</node>
<node TEXT=" 何时不应该使用索引" ID="ID_41448578" CREATED="1603101092227" MODIFIED="1603101093319">
<node TEXT=" 结果集 在原集合中所占的比例越大，索引的速度就越慢。不如全表扫描一次" ID="ID_1528110435" CREATED="1603101105324" MODIFIED="1603101162311"/>
<node TEXT=" 如果查询需要返回集合内30%及以上的文档，那就应该对索引和全表扫描的速度进行比较" ID="ID_1305428093" CREATED="1603101195996" MODIFIED="1603101214659"/>
<node TEXT=" 用索引会进行两次查找" ID="ID_1407854196" CREATED="1603101120972" MODIFIED="1603101128687">
<node TEXT=" 一次是查找索引条目" ID="ID_1039614367" CREATED="1603101133836" MODIFIED="1603101135221"/>
<node TEXT=" 一次是根据索引指针去查找相应的文档" ID="ID_390394643" CREATED="1603101139508" MODIFIED="1603101145063"/>
</node>
</node>
<node TEXT="索引类型" ID="ID_190886734" CREATED="1603101383535" MODIFIED="1603101388090">
<node TEXT=" 唯一索引" ID="ID_178222648" CREATED="1603101397646" MODIFIED="1603101399280">
<node TEXT="唯一索引可以确保集合的每一个文档的指定键都有唯一值" ID="ID_869419191" CREATED="1603107951500" MODIFIED="1603107958848"/>
<node TEXT=" 如果想保证同一文档的 &quot;username&quot; 键拥有不同的值，可创建一个唯一索引" ID="ID_659858937" CREATED="1603107987714" MODIFIED="1603108009992"/>
<node TEXT=" db.users.ensureIndex({&quot;username&quot; : 1}, {&quot;unique&quot; : true})" ID="ID_1563326172" CREATED="1603108015435" MODIFIED="1603108017213"/>
<node TEXT=" 超出 8  KB 大小的键不会受到唯一索引的约束" ID="ID_1991925981" CREATED="1603163873946" MODIFIED="1603163877794"/>
</node>
<node TEXT=" 复合唯一索引" ID="ID_1926392041" CREATED="1603101405022" MODIFIED="1603101405959">
<node TEXT="单个键的值可以相同，但所有键的组合值必须是唯一的" ID="ID_530013513" CREATED="1603163922542" MODIFIED="1603163935895"/>
<node TEXT="db.persons.createIndex({name:1,email:1},{unique:true})" ID="ID_934417681" CREATED="1603184972455" MODIFIED="1603184975563"/>
</node>
<node TEXT=" 去除重复" ID="ID_928628939" CREATED="1603101422524" MODIFIED="1603101423298">
<node TEXT=" &quot;dropDups&quot; 选项" ID="ID_1178695009" CREATED="1603164006270" MODIFIED="1603164009597"/>
<node TEXT=" 如果遇到重复的值，第一个会被保留，之后的重复文档都会被删除。" ID="ID_1399875609" CREATED="1603164016166" MODIFIED="1603164017620"/>
<node TEXT="db.people.ensureIndex({&quot;username&quot; : 1}, {&quot;unique&quot; : true, &quot;dropDups&quot; : true})" ID="ID_1668140825" CREATED="1603164022742" MODIFIED="1603185001429"/>
</node>
<node TEXT=" 稀疏索引" ID="ID_334708338" CREATED="1603101427084" MODIFIED="1603101428093">
<node TEXT=" 稀疏索引 配合 唯一索引" ID="ID_1153061815" CREATED="1603164512120" MODIFIED="1603164520454">
<node TEXT=" 希望唯一索引只对包含相应键的文档生效，可以加上稀疏索引" ID="ID_601569028" CREATED="1603164410468" MODIFIED="1603164537022"/>
<node TEXT="如果有一个可能存在也可能不存在的字段，但是当它存在时，它必须是唯一的" ID="ID_848933828" CREATED="1603164489541" MODIFIED="1603164524311"/>
</node>
<node TEXT=" 稀疏索引不必是唯一的。只要去掉 unique 选项，就可以创建一个非唯一的稀疏 索引" ID="ID_1292970066" CREATED="1603185024030" MODIFIED="1603185025017"/>
<node TEXT="例子" ID="ID_993981617" CREATED="1603186789463" MODIFIED="1603186793843">
<node TEXT="docs" ID="ID_499818606" CREATED="1603186794095" MODIFIED="1603186796367">
<node TEXT="{ &quot;_id&quot; : 0 }&#xa;{ &quot;_id&quot; : 1, &quot;x&quot; : 1 }&#xa;{ &quot;_id&quot; : 2, &quot;x&quot; : 2 }&#xa;{ &quot;_id&quot; : 3, &quot;x&quot; : 3 }" ID="ID_1327509333" CREATED="1603186801744" MODIFIED="1603186818915"/>
</node>
<node TEXT="无稀疏索引" ID="ID_877068377" CREATED="1603186821877" MODIFIED="1603186851030">
<node TEXT="&gt; db.foo.find({&quot;x&quot; : {&quot;$ne&quot; : 2}})&#xa;{ &quot;_id&quot; : 0 }&#xa;{ &quot;_id&quot; : 1, &quot;x&quot; : 1 }&#xa;{ &quot;_id&quot; : 3, &quot;x&quot; : 3 }" ID="ID_499814767" CREATED="1603186861842" MODIFIED="1603186872603"/>
</node>
<node TEXT="有稀疏索引" ID="ID_1533196241" CREATED="1603186851505" MODIFIED="1603186853269">
<node TEXT=" _id&quot; 为 0 的文档就不会包含在索引中，因此不会返回" ID="ID_172951042" CREATED="1603186908566" MODIFIED="1603186917768"/>
<node TEXT="&gt; db.foo.find({&quot;x&quot; : {&quot;$ne&quot; : 2}})&#xa;{ &quot;_id&quot; : 1, &quot;x&quot; : 1 }&#xa;{ &quot;_id&quot; : 3, &quot;x&quot; : 3 }" ID="ID_1120232123" CREATED="1603186861842" MODIFIED="1603186882052"/>
</node>
</node>
</node>
</node>
<node TEXT="索引管理" ID="ID_841277566" CREATED="1603187027917" MODIFIED="1603187042439">
<node TEXT="管理" ID="ID_1653664577" CREATED="1603187302344" MODIFIED="1603187304654">
<node TEXT=" 每个索引只需要创建一次，重复创建相同的索引，是没有任何作用的。" ID="ID_1813794205" CREATED="1603187051795" MODIFIED="1603187060687"/>
<node TEXT=" 所有的数据库索引信息都存储在 system.indexes 集合中" ID="ID_580660083" CREATED="1603187068938" MODIFIED="1603187070204"/>
<node TEXT=" db.col.getIndexes() 来查看该集合上的所有索引信息" ID="ID_825834157" CREATED="1603187134991" MODIFIED="1603187152179"/>
</node>
<node TEXT=" 标识索引" ID="ID_985108076" CREATED="1603187284481" MODIFIED="1603187286140">
<node TEXT=" 索引名称的默认形式是 keyname1_dir1_keyname2_dir2_..._ keynameN_dirN" ID="ID_549392889" CREATED="1603187473809" MODIFIED="1603187477848"/>
<node TEXT=" keynameX 是索引的键，dirX 是索引的方向（1 或者 -1）" ID="ID_216566731" CREATED="1603187497904" MODIFIED="1603187510700"/>
<node TEXT="创建索引时指定索引名称，db.foo.ensureIndex({&quot;a&quot; : 1, &quot;b&quot; : 1, &quot;c&quot; : 1, ..., &quot;z&quot; : 1}, ... {&quot;name&quot; : &quot;alphabet&quot;})" ID="ID_679653818" CREATED="1603187531231" MODIFIED="1603187556774"/>
</node>
</node>
</node>
<node TEXT="特殊的索引与集合" FOLDED="true" POSITION="right" ID="ID_602049467" CREATED="1603187799817" MODIFIED="1603187811021">
<edge COLOR="#007c00"/>
<node TEXT=" 固定集合" ID="ID_28006203" CREATED="1603187842160" MODIFIED="1603187843193">
<node TEXT="概念" ID="ID_701535702" CREATED="1603192335174" MODIFIED="1603192337706">
<node TEXT=" 集合需要事先创建好，而且它的大小是固定的，不能修改" ID="ID_1470803875" CREATED="1603192032809" MODIFIED="1603192542860"/>
<node TEXT="如果已经没有空间了，最老的文档会被删除以释放空间，新插入的文档会占据这块空间" ID="ID_1679526880" CREATED="1603192312391" MODIFIED="1603192323983"/>
<node TEXT=" 固定集合不能被分片" ID="ID_475983558" CREATED="1603192269686" MODIFIED="1603192270880"/>
<node TEXT=" 固定集合可以用于记录日志" ID="ID_1562981200" CREATED="1603192284286" MODIFIED="1603192286574"/>
</node>
<node TEXT="创建固定集合" ID="ID_324336653" CREATED="1603192344217" MODIFIED="1603192351690">
<node TEXT="size指定字节大小" ID="ID_1482319156" CREATED="1603192424846" MODIFIED="1603192438353">
<node TEXT=" db.createCollection(&quot;my_collection&quot;, {&quot;capped&quot; : true, &quot;size&quot; : 1024})" ID="ID_627460997" CREATED="1603192379575" MODIFIED="1603192444010"/>
</node>
<node TEXT="max指定文档数量" ID="ID_1352718410" CREATED="1603192446151" MODIFIED="1603192467282">
<node TEXT=" db.createCollection(&quot;my_collection2&quot;, {&quot;capped&quot; : true, &quot;size&quot; : 100000, &quot;max&quot; : 100});" ID="ID_1026271510" CREATED="1603192479112" MODIFIED="1603192490605"/>
</node>
</node>
<node TEXT="自然排序" ID="ID_1298129507" CREATED="1603192565086" MODIFIED="1603192569144">
<node TEXT=" 自然顺序就是文档的插入固定集合的顺序。而普通集合并不维护文档的插入顺序" ID="ID_1675347206" CREATED="1603192811277" MODIFIED="1603192972681"/>
<node TEXT="自然排序返回 结果集中文档的顺序就是文档在磁盘上的顺序" ID="ID_1500134921" CREATED="1603192791150" MODIFIED="1603192793688"/>
</node>
<node TEXT="循环游标" ID="ID_1812456223" CREATED="1603192855758" MODIFIED="1603192875305"/>
</node>
<node TEXT=" TTL索引" ID="ID_1534200696" CREATED="1603192561037" MODIFIED="1603193133555">
<node TEXT="概念" ID="ID_1525607774" CREATED="1603193203341" MODIFIED="1603193211570">
<node TEXT=" TTL 索引 （time-to-live  index，具有生命周期的索引）" ID="ID_1216706345" CREATED="1603193144557" MODIFIED="1603193157504"/>
<node TEXT=" 允许为每一个文档设置一个超时时间，超时则被删" ID="ID_1464451240" CREATED="1603193154526" MODIFIED="1603193178122"/>
<node TEXT=" TLL对于缓存问题（比如会话的保存）非常有用" ID="ID_1859037890" CREATED="1603193188390" MODIFIED="1603193195865"/>
</node>
<node TEXT=" 创建TTL索引" ID="ID_864501298" CREATED="1603193215630" MODIFIED="1603193224785">
<node TEXT="&gt; // 超时时间为 24 小时&#xa;&gt; db.foo.ensureIndex({&quot;lastUpdated&quot; : 1}, {&quot;expireAfterSecs&quot; : 60*60*24})" ID="ID_493455385" CREATED="1603193232566" MODIFIED="1603193251972"/>
<node TEXT=" MongoDB 每分钟对 TTL 索引进行一次清理，所以不应该依赖以秒为单位的时间保证索引的存活状态" ID="ID_1472792366" CREATED="1603193294061" MODIFIED="1603193300586"/>
</node>
</node>
<node TEXT=" 全文本索引" ID="ID_1552626849" CREATED="1603193364862" MODIFIED="1603193365781">
<node TEXT="概念" ID="ID_595875995" CREATED="1603193415390" MODIFIED="1603193420155">
<node TEXT=" 用于在文档中搜索文本，比用正则表达式快" ID="ID_444398493" CREATED="1603193420672" MODIFIED="1603193519612"/>
<node TEXT=" 创建任何一种索引的开销都比较大，而创建全文本索引的成本更高。应在离线状态下创建" ID="ID_1009312142" CREATED="1603193552808" MODIFIED="1603193604571"/>
</node>
</node>
</node>
<node TEXT="聚合" POSITION="right" ID="ID_1604656279" CREATED="1568168285162" MODIFIED="1568168301250">
<edge COLOR="#007c00"/>
<node TEXT="聚合的方法使用aggregate()" ID="ID_1472860313" CREATED="1568168307522" MODIFIED="1568168515448">
<node TEXT=" 语法" ID="ID_1758136575" CREATED="1568168321370" MODIFIED="1568168322136">
<node TEXT=" db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)" ID="ID_1177839140" CREATED="1568168325428" MODIFIED="1568168326240"/>
</node>
</node>
<node TEXT=" 计算每个作者所写的文章数" ID="ID_672131320" CREATED="1568169039460" MODIFIED="1568169040449">
<node TEXT="mysql" ID="ID_1821500882" CREATED="1568169116707" MODIFIED="1568169119756">
<node TEXT="SELECT by_user, COUNT(*) FROM mycol GROUP BY by_user" ID="ID_269520870" CREATED="1568169045007" MODIFIED="1568169090711"/>
</node>
<node TEXT=" aggregate()" ID="ID_1946814474" CREATED="1568169125235" MODIFIED="1568169126080">
<node TEXT=" db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : 1}}}])" ID="ID_1241857571" CREATED="1568169114121" MODIFIED="1568169115273"/>
</node>
</node>
<node TEXT=" 聚合的表达式" ID="ID_1143447122" CREATED="1568169154033" MODIFIED="1568169155759">
<node TEXT=" $sum" ID="ID_366928173" CREATED="1568169166657" MODIFIED="1568169167544">
<node TEXT=" 计算总和。" ID="ID_544912869" CREATED="1568169170724" MODIFIED="1568169172090"/>
<node TEXT=" db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : &quot;$likes&quot;}}}])" ID="ID_1553871543" CREATED="1568169172307" MODIFIED="1568169176520"/>
</node>
<node TEXT=" $avg" ID="ID_1167372403" CREATED="1568169195007" MODIFIED="1568169197980">
<node TEXT=" 计算平均值" ID="ID_1645161567" CREATED="1568169198284" MODIFIED="1568169199986"/>
<node TEXT="db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$avg : &quot;$likes&quot;}}}])" ID="ID_1834587155" CREATED="1568169203438" MODIFIED="1568169210070"/>
</node>
<node TEXT=" $min" ID="ID_448100697" CREATED="1568169213857" MODIFIED="1568169214848">
<node TEXT=" 获取集合中所有文档对应值得最小值。" ID="ID_1987435933" CREATED="1568169219810" MODIFIED="1568169220688"/>
<node TEXT="db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$min : &quot;$likes&quot;}}}])" ID="ID_936539442" CREATED="1568169223741" MODIFIED="1568169227188"/>
</node>
<node TEXT=" $max" ID="ID_223862357" CREATED="1568169234474" MODIFIED="1568169237377">
<node TEXT=" 获取集合中所有文档对应值得最大值。" ID="ID_1043176575" CREATED="1568169237678" MODIFIED="1568169238456"/>
<node TEXT=" db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$max : &quot;$likes&quot;}}}])" ID="ID_510290992" CREATED="1568169242538" MODIFIED="1568169243650"/>
</node>
</node>
<node TEXT="管道" ID="ID_403230464" CREATED="1568169297753" MODIFIED="1568169305386">
<node TEXT="什么是管道" ID="ID_466839896" CREATED="1568169338103" MODIFIED="1568169347020">
<node TEXT="管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。" ID="ID_1171354994" CREATED="1568169318465" MODIFIED="1568169321971"/>
<node TEXT="MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理" ID="ID_766838237" CREATED="1568169322311" MODIFIED="1568169331704"/>
<node TEXT=" 管道操作是可以重复的" ID="ID_1269608120" CREATED="1568169332295" MODIFIED="1568169337184"/>
</node>
<node TEXT=" 常用的几个操作" ID="ID_1706140763" CREATED="1568169385246" MODIFIED="1568169386266">
<node TEXT=" $group" ID="ID_1763585752" CREATED="1568169447788" MODIFIED="1568169451922">
<node TEXT=" 将集合中的文档分组，可用于统计结果" ID="ID_329930645" CREATED="1568169452221" MODIFIED="1568169453377"/>
</node>
<node TEXT=" $project" ID="ID_1053109394" CREATED="1568169396048" MODIFIED="1568169396927">
<node TEXT="修改输入文档的结构" ID="ID_1448051433" CREATED="1568169401324" MODIFIED="1568169409601"/>
<node TEXT=" 可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档" ID="ID_1128962500" CREATED="1568169402725" MODIFIED="1568169408008"/>
<node TEXT="结果只包含_id,tilte和author三个字段" ID="ID_1886496956" CREATED="1568169491649" MODIFIED="1568169511281">
<node TEXT=" db.article.aggregate(&#xa;    { $project : {&#xa;        title : 1 ,&#xa;        author : 1 ,&#xa;    }}&#xa; );" ID="ID_1642897523" CREATED="1568169516332" MODIFIED="1568169517688"/>
</node>
<node TEXT=" 结果只包含tilte和author两个字段" ID="ID_483671788" CREATED="1568169530959" MODIFIED="1568169545343">
<node TEXT=" db.article.aggregate(&#xa;    { $project : {&#xa;        _id : 0 ,&#xa;        title : 1 ,&#xa;        author : 1&#xa;    }});" ID="ID_116424856" CREATED="1568169541306" MODIFIED="1568169542611"/>
</node>
</node>
<node TEXT=" $match" ID="ID_1787476191" CREATED="1568169414744" MODIFIED="1568169415944">
<node TEXT=" 用于过滤数据，只输出符合条件的文档" ID="ID_54712915" CREATED="1568169421751" MODIFIED="1568169422664"/>
<node TEXT=" $match使用MongoDB的标准查询操作" ID="ID_1661473867" CREATED="1568169427105" MODIFIED="1568169427905"/>
<node TEXT="多个管道" ID="ID_654819049" CREATED="1568169654759" MODIFIED="1568169659721">
<node TEXT=" $match用于获取分数大于70小于或等于90记录" ID="ID_1713521139" CREATED="1568169665091" MODIFIED="1568169668725"/>
<node TEXT="然后将符合条件的记录送到下一阶段$group管道操作符进行处理" ID="ID_171356325" CREATED="1568169668885" MODIFIED="1568169677187"/>
<node TEXT=" db.articles.aggregate( [&#xa;                        { $match : { score : { $gt : 70, $lte : 90 } } },&#xa;                        { $group: { _id: null, count: { $sum: 1 } } }&#xa;                       ] );" ID="ID_762769303" CREATED="1568169677865" MODIFIED="1568169679168"/>
</node>
</node>
<node TEXT=" $limit" ID="ID_612826560" CREATED="1568169432908" MODIFIED="1568169436144">
<node TEXT=" 用来限制MongoDB聚合管道返回的文档数" ID="ID_1144906055" CREATED="1568169437949" MODIFIED="1568169438952"/>
</node>
<node TEXT=" $skip" ID="ID_1614478590" CREATED="1568169633328" MODIFIED="1568169634224">
<node TEXT=" 在聚合管道中跳过指定数量的文档，并返回余下的文档" ID="ID_1133931884" CREATED="1568169639698" MODIFIED="1568169640760"/>
<node TEXT=" 前五个文档被&quot;过滤&quot;掉" ID="ID_397388175" CREATED="1568169620362" MODIFIED="1568169622239">
<node TEXT=" db.article.aggregate(&#xa;    { $skip : 5 });" ID="ID_767669244" CREATED="1568169645160" MODIFIED="1568169646314"/>
</node>
</node>
</node>
</node>
</node>
<node TEXT="聚合" POSITION="right" ID="ID_1386439993" CREATED="1603194235236" MODIFIED="1603194247922">
<edge COLOR="#7c007c"/>
<node TEXT=" 聚合框架" ID="ID_1293056351" CREATED="1603194783880" MODIFIED="1603194784874">
<node TEXT=" 使用聚合框架可以对集合中的文档进行变换和组合" ID="ID_771260672" CREATED="1603194791191" MODIFIED="1603194794150"/>
<node TEXT=" 聚合的结果必须要限制在 16  MB 以内（MongoDB 支持的最大响应消息 大小）" ID="ID_1605004692" CREATED="1603195342190" MODIFIED="1603195343752"/>
<node TEXT=" 创建一个管道（pipeline）" ID="ID_1789963793" CREATED="1603194971800" MODIFIED="1603194972796">
<node TEXT=" 用于对一连串的文档进行处理" ID="ID_731975169" CREATED="1603194980482" MODIFIED="1603194984852"/>
<node TEXT="构件组成" ID="ID_321340893" CREATED="1603194996663" MODIFIED="1603195035892">
<node ID="ID_409627609" CREATED="1603195028463" MODIFIED="1603195028463"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      筛选（filtering）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_152425983" CREATED="1603195028464" MODIFIED="1603195028464"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      投射（projecting）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1745755771" CREATED="1603195028466" MODIFIED="1603195028466"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      分组（grouping）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1413352206" CREATED="1603195028467" MODIFIED="1603195028467"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      排序（sorting）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_637150337" CREATED="1603195028469" MODIFIED="1603195028469"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      限制（limiting）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1535239493" CREATED="1603195028471" MODIFIED="1603195028471"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      跳过（skipping）
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="例子" ID="ID_1741376929" CREATED="1603195044725" MODIFIED="1603195047178">
<node TEXT="要求" ID="ID_164039217" CREATED="1603195082060" MODIFIED="1603195085505">
<node ID="ID_379531572" CREATED="1603195076984" MODIFIED="1603195076984"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &nbsp;(1) 将每个文章文档中的作者投射出来。
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" (2) 将作者按照名字排序，并统计出现的次数。" ID="ID_1107035401" CREATED="1603195076984" MODIFIED="1603195100287"/>
<node ID="ID_822923424" CREATED="1603195076987" MODIFIED="1603195076987"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &nbsp;(3) 将作者按照名字出现次数降序排列。
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_398971342" CREATED="1603195076989" MODIFIED="1603195076989"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &nbsp;(4) 将返回结果限制为前5个。
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="管道与操作符" ID="ID_1289108778" CREATED="1603195134485" MODIFIED="1603195256708">
<node TEXT=" &gt; db.articles.aggregate(&#xa;{&quot;$project&quot; : {&quot;author&quot; : 1}},&#xa;{&quot;$group&quot; : {&quot;_id&quot; : &quot;$author&quot;, &quot;count&quot; : {&quot;$sum&quot; : 1}}}, {&quot;$sort&quot; : {&quot;count&quot; : -1}},&#xa;{&quot;$limit&quot; : 5}&#xa;)" ID="ID_1279741624" CREATED="1603195131268" MODIFIED="1603195166038"/>
</node>
</node>
</node>
</node>
<node TEXT="管道操作符" ID="ID_1271133060" CREATED="1603195355093" MODIFIED="1603195361218">
<node TEXT="概念" ID="ID_161972683" CREATED="1603195378806" MODIFIED="1603195383330">
<node TEXT="管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。" ID="ID_803780156" CREATED="1568169318465" MODIFIED="1568169321971"/>
<node TEXT=" 每个操作符都会接受一连串的文档，对这些文档做一些类型转换，最后将转换后的 文档作为结果传递给下一个操作符" ID="ID_653174247" CREATED="1603195395581" MODIFIED="1603195411016"/>
<node TEXT=" 对于最后一个管道操作符，是将结果返回给客户端" ID="ID_1723512494" CREATED="1603195416860" MODIFIED="1603195423547"/>
<node TEXT="不同的管道操作符可以按任意顺序组合在一起使用，而且可以被重复任意多次" ID="ID_1355243519" CREATED="1603195582817" MODIFIED="1603195592678"/>
</node>
<node TEXT=" $match" ID="ID_221722431" CREATED="1603195603160" MODIFIED="1603195608760">
<node TEXT=" $match 用于对文档集合进行筛选，之后就可以在筛选得到的文档子集上做聚合" ID="ID_1908800128" CREATED="1603195683920" MODIFIED="1603195685303"/>
<node TEXT="应该尽可能将 &quot;$match&quot; 放在管道的前面位置" ID="ID_150964479" CREATED="1603195704855" MODIFIED="1603195742429">
<node TEXT=" 快速过滤不需要的文档，减少道的工作量" ID="ID_514971002" CREATED="1603195743056" MODIFIED="1603195772250"/>
<node TEXT=" 投射和分组之前执行 &quot;$match&quot;，查询可以使用索引" ID="ID_1706563065" CREATED="1603195781709" MODIFIED="1603195782737"/>
</node>
</node>
<node TEXT=" $project" ID="ID_244688676" CREATED="1603195841973" MODIFIED="1603195843172">
<node TEXT=" 使用 &quot;$project&quot; 可以从 子文档中提取字段、重命名字段" ID="ID_142758309" CREATED="1603195868324" MODIFIED="1603195902351"/>
<node TEXT=" 提取字段" ID="ID_1687582401" CREATED="1603195882868" MODIFIED="1603195883692">
<node TEXT="包含或不包含" ID="ID_1299012885" CREATED="1603196749909" MODIFIED="1603196762321"/>
<node TEXT=" 返回的结果文档中只包含一个 &quot;author&quot; 字段" ID="ID_1174346464" CREATED="1603195927579" MODIFIED="1603195928805"/>
<node TEXT=" &gt; db.articles.aggregate(&#xa;{&quot;$project&quot; : {&quot;author&quot; : 1, &quot;_id&quot; : 0}}&#xa;)" ID="ID_1486398956" CREATED="1603195910667" MODIFIED="1603195918926"/>
</node>
<node TEXT=" 重命名字段" ID="ID_355307350" CREATED="1603195903428" MODIFIED="1603195904348">
<node TEXT=" 将结果中的&quot;_id&quot; 重命名为 &quot;userId&quot;" ID="ID_1526275283" CREATED="1603195947036" MODIFIED="1603195957993"/>
<node TEXT=" 必须明确指定将 &quot;_id&quot; 排除，否则这个字段的值会被返回两次" ID="ID_1833324204" CREATED="1603196064866" MODIFIED="1603196066408"/>
<node TEXT="重命名之后的字段不能用原字段的索引" ID="ID_621285209" CREATED="1603196115738" MODIFIED="1603196133214"/>
<node TEXT=" &gt; db.users.aggregate(&#xa;{&quot;$project&quot; : {&quot;userId&quot; : &quot;$_id&quot;, &quot;_id&quot; : 0}}&#xa;)" ID="ID_1471579964" CREATED="1603195964619" MODIFIED="1603195972622"/>
</node>
<node TEXT="数学表达式" ID="ID_1317984919" CREATED="1603196729788" MODIFIED="1603196776555">
<node TEXT=" $add" ID="ID_1849170126" CREATED="1603196872236" MODIFIED="1603197006214">
<node TEXT=" &quot;$add&quot; : [expr1[, expr2, ..., exprN]]" ID="ID_742830854" CREATED="1603196885684" MODIFIED="1603197018655"/>
<node TEXT=" 这个操作符接受一个或多个表达式作为参数，将这些表达式相加。" ID="ID_496923710" CREATED="1603196897108" MODIFIED="1603196898322"/>
<node TEXT=" 将 &quot;salary&quot; 和 &quot;bonus&quot; 字段的值相加" ID="ID_873281024" CREATED="1603196910124" MODIFIED="1603196911222">
<node TEXT=" &gt; db.employees.aggregate(&#xa;{ &quot;$project&quot; : {&#xa;&quot;totalPay&quot; : { &quot;$add&quot; : [&quot;$salary&quot;, &quot;$bonus&quot;] }&#xa;}})" ID="ID_119803694" CREATED="1603196915053" MODIFIED="1603196971912"/>
</node>
</node>
<node TEXT=" $subtract" ID="ID_1770221939" CREATED="1603196997253" MODIFIED="1603197012344">
<node TEXT=" &quot;$subtract&quot; : [expr1, expr2]" ID="ID_370488848" CREATED="1603197026725" MODIFIED="1603197028240"/>
<node TEXT=" 接受两个表达式作为参数，用第一个表达式减去第二个表达式作为结果。" ID="ID_79960667" CREATED="1603197036108" MODIFIED="1603197038481"/>
<node TEXT=" 扣除缴纳 401(k)的金额" ID="ID_528177809" CREATED="1603197064188" MODIFIED="1603197086875">
<node TEXT="&gt; db.employees.aggregate(&#xa;  {&quot;$project&quot; : {&#xa;    &quot;totalPay&quot; : {&#xa;      &quot;$subtract&quot; : [{&quot;$add&quot; : [&quot;$salary&quot;, &quot;$bonus&quot;]}, &quot;$401k&quot;]&#xa;}}})" ID="ID_1895701727" CREATED="1603197210861" MODIFIED="1603197260758"/>
</node>
</node>
<node TEXT=" $multiply" ID="ID_1093318417" CREATED="1603197272997" MODIFIED="1603197281288">
<node TEXT=" &quot;$multiply&quot; : [expr1[, expr2, ..., exprN]]" ID="ID_1807238400" CREATED="1603197310029" MODIFIED="1603197315056"/>
<node TEXT=" 接受一个或者多个表达式，并且将它们相乘。" ID="ID_982907748" CREATED="1603197318861" MODIFIED="1603197319811"/>
</node>
<node TEXT=" $divide" ID="ID_1004741662" CREATED="1603197288700" MODIFIED="1603197290688">
<node TEXT="  &quot;$divide&quot; : [expr1, expr2]" ID="ID_760559394" CREATED="1603197325453" MODIFIED="1603197326930"/>
<node TEXT=" 接受两个表达式，用第一个表达式除以第二个表达式的商作为结果。" ID="ID_1899341833" CREATED="1603197331517" MODIFIED="1603197332548"/>
</node>
<node TEXT=" $mod" ID="ID_206480458" CREATED="1603197299068" MODIFIED="1603197300864">
<node TEXT="  &quot;$mod&quot; : [expr1, expr2]" ID="ID_586058160" CREATED="1603197347396" MODIFIED="1603197349196"/>
<node TEXT=" 接受两个表达式，将第一个表达式除以第二个表达式得到的余数作为结果。" ID="ID_592102524" CREATED="1603197339196" MODIFIED="1603197342291"/>
</node>
</node>
<node TEXT="日期表达式" ID="ID_1525650256" CREATED="1603197380260" MODIFIED="1603197386337">
<node TEXT=" 提取日期信息的表达式" ID="ID_851450604" CREATED="1603197536919" MODIFIED="1603197545434">
<node ID="ID_1301549330" CREATED="1603197584183" MODIFIED="1603197584183"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &quot;year&quot;、&quot;$month&quot;、&quot;$week&quot;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_171470429" CREATED="1603197584183" MODIFIED="1603197584183"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &quot;$dayOfMonth&quot;、&quot;$dayOfWeek&quot;、&quot;$dayOfYear&quot;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1854167120" CREATED="1603197584184" MODIFIED="1603197584184"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &quot;$hour&quot;、&quot;$minute&quot;、 &quot;$second&quot;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 返回每个雇员入职的月份" ID="ID_719820473" CREATED="1603197596940" MODIFIED="1603197598035">
<node TEXT=" &gt; db.employees.aggregate(&#xa;  {&quot;$project&quot;:{&#xa;    &quot;hiredIn&quot; : {&quot;$month&quot; : &quot;$hireDate&quot;}}&#xa;}" ID="ID_1152649393" CREATED="1603197679325" MODIFIED="1603197681337"/>
</node>
<node TEXT=" 计算出每个雇员的在职几年" ID="ID_1139719922" CREATED="1603197704590" MODIFIED="1603197800618">
<node TEXT="&gt; db.employees.aggregate(&#xa;  {&quot;$project&quot; : {&#xa;    &quot;tenure&quot; : {&quot;$subtract&quot; : [&#xa;      {&quot;$year&quot; : new Date()}, {&quot;$year&quot; : &quot;$hireDate&quot;}&#xa;    ]}}&#xa;})" ID="ID_1026977041" CREATED="1603197805494" MODIFIED="1603197842906"/>
</node>
</node>
<node TEXT="字符串表达式" ID="ID_210056454" CREATED="1603197848645" MODIFIED="1603197854946"/>
<node TEXT=" 逻辑表达式" ID="ID_125601379" CREATED="1603197985111" MODIFIED="1603197986057">
<node TEXT="比较表达式" ID="ID_1750876995" CREATED="1603198163889" MODIFIED="1603198170660">
<node TEXT=" $cmp" ID="ID_1720627784" CREATED="1603198040039" MODIFIED="1603198046779">
<node TEXT=" &quot;$cmp&quot; : [expr1, expr2]" ID="ID_328610036" CREATED="1603198034329" MODIFIED="1603198035834"/>
<node TEXT="如果 expr1 等于 expr2，返回 0" ID="ID_34719998" CREATED="1603198084961" MODIFIED="1603198088584"/>
<node TEXT="如果 expr1  &lt; expr2， 返回一个负数" ID="ID_848951024" CREATED="1603198084961" MODIFIED="1603198091196"/>
<node ID="ID_628495174" CREATED="1603198084962" MODIFIED="1603198084962"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      如果 expr1 &gt;expr2，返回一个正数
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" $strcasecmp" ID="ID_736318246" CREATED="1603198116625" MODIFIED="1603198118860">
<node TEXT="  &quot;$strcasecmp&quot; : [string1, string2]" ID="ID_1957277981" CREATED="1603198124472" MODIFIED="1603198125890"/>
<node TEXT=" 比较 string1 和 string2，区分大小写。只对罗马字符组成的字符串有效。" ID="ID_1960183310" CREATED="1603198139303" MODIFIED="1603198141064"/>
</node>
<node TEXT=" &quot;$eq&quot;/&quot;$ne&quot;/&quot;$gt&quot;/&quot;$gte&quot;/&quot;$lt&quot;/&quot;$lte&quot;" ID="ID_160780083" CREATED="1603198149863" MODIFIED="1603198179583"/>
</node>
<node TEXT="布尔表达式" ID="ID_1585930297" CREATED="1603198185560" MODIFIED="1603198194045">
<node TEXT="  &quot;$and&quot; : [expr1[, expr2, ..., exprN]]" ID="ID_1437622446" CREATED="1603198212647" MODIFIED="1603198213754"/>
<node TEXT="  &quot;$or&quot; : [expr1[, expr2, ..., exprN]]" ID="ID_1921295229" CREATED="1603198230991" MODIFIED="1603198233315"/>
<node TEXT=" &quot;$not&quot; : expr" ID="ID_1017804294" CREATED="1603198246447" MODIFIED="1603198247489"/>
</node>
<node TEXT=" 控制语句" ID="ID_467842909" CREATED="1603198257423" MODIFIED="1603198259078">
<node TEXT=" $cond" ID="ID_323142072" CREATED="1603198281288" MODIFIED="1603198284551">
<node TEXT=" &quot;$cond&quot; : [booleanExpr, trueExpr, falseExpr]" ID="ID_1820942357" CREATED="1603198298985" MODIFIED="1603198300717"/>
<node TEXT=" 如果 booleanExpr 的值是 true，那就返回 trueExpr，否则返回 falseExpr。" ID="ID_1351140880" CREATED="1603198312953" MODIFIED="1603198314477"/>
</node>
<node TEXT=" $ifNull" ID="ID_5101796" CREATED="1603198290009" MODIFIED="1603198293695">
<node TEXT=" &quot;$ifNull&quot; : [expr, replacementExpr]" ID="ID_1200037436" CREATED="1603198305192" MODIFIED="1603198306353"/>
<node TEXT=" 如果 expr 是 null，返回 replacementExpr，否则返回 expr。" ID="ID_1677217080" CREATED="1603198319168" MODIFIED="1603198320174"/>
</node>
</node>
</node>
</node>
<node TEXT=" $group" ID="ID_1816419994" CREATED="1603198491674" MODIFIED="1603198497215">
<node TEXT="概念" ID="ID_1732780805" CREATED="1603269298031" MODIFIED="1603269303755">
<node TEXT=" $group 操作可以将文档依据特定字段的不同值进行分组。" ID="ID_1148553343" CREATED="1603198763604" MODIFIED="1603198764790"/>
<node TEXT="$group不能以流式工作方式对文档进行处理，需要收到所有的文档之后，才能对文档进行分组" ID="ID_1094074086" CREATED="1603269305902" MODIFIED="1603269752547"/>
<node TEXT="在分片的情况下，各分片执行&quot;$group&quot;，汇总到mongo统一分组，再到下一管道" ID="ID_1111701774" CREATED="1603270480813" MODIFIED="1603270550011"/>
</node>
<node TEXT="语法" ID="ID_260628640" CREATED="1603283123519" MODIFIED="1603283126148">
<node TEXT=" {&#xa;  $group:&#xa;    {&#xa;      _id: &lt;expression&gt;, // Group By Expression&#xa;      &lt;field1&gt;: { &lt;accumulator1&gt; : &lt;expression1&gt; },&#xa;      ...&#xa;    }&#xa; }" ID="ID_27041752" CREATED="1603283131525" MODIFIED="1603283133513"/>
<node TEXT=" _id" ID="ID_1344742343" CREATED="1603283178582" MODIFIED="1603283179662">
<node TEXT="必需参数" ID="ID_1782587370" CREATED="1603283136567" MODIFIED="1603283410458"/>
<node TEXT=" 将_id值指定为 null或任何其他常数值" ID="ID_1043577048" CREATED="1603283384028" MODIFIED="1603283394648">
<node ID="ID_1437760976" CREATED="1603283399446" MODIFIED="1603283399446"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      $group会计算文档的累积值
    </p>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" &gt; db.books.aggregate([{$group: {_id: null, count: {$sum: 1}}}])" ID="ID_369227813" CREATED="1603283618322" MODIFIED="1603283619325"/>
<node TEXT=" SELECT COUNT(*) AS count FROM sales" ID="ID_69086018" CREATED="1603283415996" MODIFIED="1603283417450"/>
</node>
</node>
<node TEXT=" field" ID="ID_1764293691" CREATED="1603283186583" MODIFIED="1603283187485">
<node TEXT=" *可选.*使用累加器运算符(avg、push等)计算" ID="ID_728077832" CREATED="1603283171261" MODIFIED="1603283313194"/>
</node>
</node>
<node TEXT="例子" ID="ID_117560735" CREATED="1603280254891" MODIFIED="1603280372249">
<node TEXT="集合" ID="ID_197768597" CREATED="1603280291771" MODIFIED="1603280300426">
<node TEXT="db.books.insertMany([&#xa;  { &quot;_id&quot; : 8751, &quot;title&quot; : &quot;The Banquet&quot;, &quot;author&quot; : &quot;Dante&quot;, &quot;copies&quot; : 2 },&#xa;  { &quot;_id&quot; : 8752, &quot;title&quot; : &quot;Divine Comedy&quot;, &quot;author&quot; : &quot;Dante&quot;, &quot;copies&quot; : 1 },&#xa;  { &quot;_id&quot; : 8645, &quot;title&quot; : &quot;Eclogues&quot;, &quot;author&quot; : &quot;Dante&quot;, &quot;copies&quot; : 2 },&#xa;  { &quot;_id&quot; : 7000, &quot;title&quot; : &quot;The Odyssey&quot;, &quot;author&quot; : &quot;Homer&quot;, &quot;copies&quot; : 10 },&#xa;  { &quot;_id&quot; : 7020, &quot;title&quot; : &quot;Iliad&quot;, &quot;author&quot; : &quot;Homer&quot;, &quot;copies&quot; : 10 }&#xa;])" ID="ID_1829020623" CREATED="1603280258388" MODIFIED="1603280290544"/>
</node>
<node TEXT="聚合" ID="ID_434606361" CREATED="1603280303483" MODIFIED="1603280306501">
<node TEXT="db.books.aggregate([&#xa;   { $group : { _id : &quot;$author&quot;, books: { $push: &quot;$title&quot; } } }&#xa; ])" ID="ID_1591746009" CREATED="1603280269260" MODIFIED="1603280289041"/>
</node>
<node TEXT="返回" ID="ID_206479273" CREATED="1603280309013" MODIFIED="1603280311975">
<node TEXT="{ &quot;_id&quot; : &quot;Homer&quot;, &quot;books&quot; : [ &quot;The Odyssey&quot;, &quot;Iliad&quot; ] }&#xa;{ &quot;_id&quot; : &quot;Dante&quot;, &quot;books&quot; : [ &quot;The Banquet&quot;, &quot;Divine Comedy&quot;, &quot;Eclogues&quot; ] }" ID="ID_1447421537" CREATED="1603280277107" MODIFIED="1603280286956"/>
</node>
</node>
<node TEXT=" 算术操作符" ID="ID_188540756" CREATED="1603268061816" MODIFIED="1603268063160">
<node TEXT=" $sum" ID="ID_517670231" CREATED="1603268127897" MODIFIED="1603268336536">
<node TEXT="对于分组中的每一个文档，将 value与计算结果相加" ID="ID_162787443" CREATED="1603268139018" MODIFIED="1603268145497"/>
<node TEXT=" 计算每个国家的总收入" ID="ID_376515288" CREATED="1603268176857" MODIFIED="1603268184467">
<node TEXT=" &gt; db.sales.aggregate(&#xa;    {&quot;$group&quot; : {&#xa;        &quot;_id&quot; : &quot;$country&quot;, &quot;totalRevenue&quot; : {&#xa;            &quot;$sum&quot; : &quot;$revenue&quot;} }&#xa;    })" ID="ID_1379602564" CREATED="1603268313401" MODIFIED="1603268315234"/>
</node>
</node>
<node TEXT=" $avg" ID="ID_1270314781" CREATED="1603268322561" MODIFIED="1603268339046">
<node TEXT=" 返回每个分组的平均值" ID="ID_204836104" CREATED="1603268362888" MODIFIED="1603268364095"/>
<node TEXT=" 每个国家的平均收入" ID="ID_1149322940" CREATED="1603268399880" MODIFIED="1603268401221">
<node TEXT=" 每个国家的平均收入，以及每个国家的销量" ID="ID_996096464" CREATED="1603268598888" MODIFIED="1603268611066"/>
<node TEXT=" &gt; db.sales.aggregate(&#xa;    {&quot;$group&quot; : {&#xa;        &quot;_id&quot; : &quot;$country&quot;,&quot;totalRevenue&quot; : {&#xa;            &quot;$avg&quot; : &quot;$revenue&quot;},&#xa;            &quot;numSales&quot; : {&quot;$sum&quot; : 1} }&#xa;    })" ID="ID_806693660" CREATED="1603268590495" MODIFIED="1603268591734"/>
</node>
</node>
</node>
<node TEXT=" 极值操作符" ID="ID_1523170650" CREATED="1603268728559" MODIFIED="1603268729484">
<node TEXT="最大、最小" ID="ID_427669597" CREATED="1603268775720" MODIFIED="1603268782774">
<node TEXT=" $max、$min" ID="ID_1573967710" CREATED="1603268786687" MODIFIED="1603268807647"/>
<node TEXT=" 找到其中的最高分与最低分" ID="ID_1618352956" CREATED="1603268962663" MODIFIED="1603268967692"/>
<node TEXT=" &gt; db.scores.aggregate(&#xa;    { &quot;$group&quot; : {&#xa;        &quot;_id&quot; : &quot;$grade&quot;,&#xa;        &quot;lowestScore&quot; : {&quot;$min&quot; : &quot;$score&quot;},&#xa;        &quot;highestScore&quot; : {&quot;$max&quot; : &quot;$score&quot;} }&#xa;    })" ID="ID_1050259005" CREATED="1603268939207" MODIFIED="1603268940728"/>
</node>
<node TEXT="第一个值、最后一个值" ID="ID_240654307" CREATED="1603268811337" MODIFIED="1603268839085">
<node TEXT=" $first、$last" ID="ID_1410535551" CREATED="1603268845920" MODIFIED="1603268855228"/>
<node TEXT=" 对于已有序的数据集非常有用，否则不如$min、$max高效" ID="ID_857212351" CREATED="1603269013745" MODIFIED="1603269202009"/>
<node TEXT="&gt; db.scores.aggregate(&#xa;    {&quot;$sort&quot; : {&quot;score&quot; : 1} },&#xa;    { &quot;$group&quot; : {&#xa;        &quot;_id&quot; : &quot;$grade&quot;,&#xa;        &quot;lowestScore&quot; : {&quot;$first&quot; : &quot;$score&quot;},&#xa;        &quot;highestScore&quot; : {&quot;$last&quot; : &quot;$score&quot;} }&#xa;    }&#xa;)" ID="ID_1049607010" CREATED="1603269032944" MODIFIED="1603269135646"/>
</node>
</node>
</node>
<node TEXT=" $unwind" ID="ID_1129815641" CREATED="1603270561165" MODIFIED="1603270567529">
<node TEXT=" 拆分（unwind）可以将数组中的每一个值拆分为单独的文档" ID="ID_682392985" CREATED="1603270645205" MODIFIED="1603270648593"/>
<node TEXT=" 查询中得到特定的子文档" ID="ID_507935550" CREATED="1603270893229" MODIFIED="1603270900673">
<node TEXT="只返回特定的comment，而没有上层字段" ID="ID_23706355" CREATED="1603270947884" MODIFIED="1603270977721"/>
<node TEXT=" &gt; db.blog.aggregate(&#xa;    {&quot;$project&quot; : {&quot;comments&quot; : &quot;$comments&quot;}},&#xa;    {&quot;$unwind&quot; : &quot;$comments&quot;},&#xa;    {&quot;$match&quot; : {&quot;comments.author&quot; : &quot;Mark&quot;}}&#xa;)" ID="ID_1533310662" CREATED="1603270941678" MODIFIED="1603270942909"/>
</node>
</node>
<node TEXT=" $sort" ID="ID_1262419873" CREATED="1603270999022" MODIFIED="1603271002923">
<node TEXT=" 如果要对大量的文档进行排序，强烈建议在管道的第一阶段进行排序，这时的排序操作可以使用索引" ID="ID_266893691" CREATED="1603271054438" MODIFIED="1603271057882"/>
<node TEXT=" 排序方向可以是 1（升序）和 -1（降序）" ID="ID_1181240923" CREATED="1603273061342" MODIFIED="1603273062498"/>
<node TEXT=" 与 &quot;$group”一样，&quot;$sort&quot; 也是一个无法使用流式工作方式的操作符" ID="ID_1600968685" CREATED="1603273074565" MODIFIED="1603273081319"/>
<node TEXT=" 分片环境下，先在各 个分片上进行排序，然后再发送到 mongos 做进一步处理" ID="ID_1505804316" CREATED="1603273187165" MODIFIED="1603273202344"/>
</node>
<node TEXT=" $limit" ID="ID_348248391" CREATED="1603273218300" MODIFIED="1603273219338">
<node TEXT=" $limit 会接受一个数字 n，返回结果集中的前 n 个文档" ID="ID_486974027" CREATED="1603273226276" MODIFIED="1603273227305"/>
</node>
<node TEXT=" $skip" ID="ID_1573963132" CREATED="1603273289989" MODIFIED="1603273291287">
<node TEXT=" $skip 也是接受一个数字 n，丢弃结果集中的前 n 个文档，将剩余文档作为结果返回" ID="ID_309360034" CREATED="1603273345163" MODIFIED="1603273363282"/>
<node TEXT=" 如果需要跳过大量的数据，那么这个操作符的效率会很低" ID="ID_1609245492" CREATED="1603273357611" MODIFIED="1603273361390"/>
</node>
<node TEXT="使用管道" ID="ID_1688715255" CREATED="1603273385251" MODIFIED="1603273389799">
<node TEXT="尽量在管道的开始阶段就将尽可能多的文档和字段过滤掉" ID="ID_1189725675" CREATED="1603273850345" MODIFIED="1603273883909"/>
<node TEXT="尽量将 &quot;$project&quot;、&quot;$group&quot; 或者 &quot;$unwind&quot; 操作 放在后面" ID="ID_539365244" CREATED="1603273860545" MODIFIED="1603273879670"/>
<node TEXT=" MongoDB 不允许单一的聚合操作占用过多的系统内存：如果 MongoDB 发现某个聚 合操作占用了 20% 以上的内存，这个操作就会直接输出错误" ID="ID_790998077" CREATED="1603273935680" MODIFIED="1603273937607"/>
</node>
</node>
<node TEXT=" MapReduce" ID="ID_287007915" CREATED="1603273373451" MODIFIED="1603273979562">
<node TEXT=" MapReduce 使用JavaScript，能够表达任意复杂的逻辑，但非常慢，不应该用在实时的数据分析中" ID="ID_1196392934" CREATED="1603273996929" MODIFIED="1603274037452"/>
<node TEXT=" MapReduce 能够在多台服务器之间并行执行，每台机器可以只负责完成一部分不同的工作" ID="ID_162566616" CREATED="1603274052415" MODIFIED="1603274096732"/>
<node TEXT="基本语法" ID="ID_1245046636" CREATED="1603371806112" MODIFIED="1603371811235">
<node TEXT=" &gt;db.collection.mapReduce(&#xa;   //map 函数&#xa;   function() {emit(key,value);},&#xa;   //reduce 函数&#xa;   function(key,values) {return reduceFunction},&#xa;   {&#xa;      out: collection,&#xa;      query: document,&#xa;      sort: document,&#xa;      limit: number&#xa;   }&#xa;)" ID="ID_1712466349" CREATED="1603371816943" MODIFIED="1603371903821"/>
<node TEXT="第三参数，过滤" ID="ID_1975155188" CREATED="1603437607308" MODIFIED="1603438020801">
<node TEXT="out 统计结果存放集合 (设置{inline:1} 将不会创建集合，全在内存中执行)。" ID="ID_1504633944" CREATED="1603437618560" MODIFIED="1603438183247"/>
<node ID="ID_1204525292" CREATED="1603437618560" MODIFIED="1603437618560"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      query 一个筛选条件，只有满足条件的文档才会调用map函数。（query。limit，sort可以随意组合）
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_106170931" CREATED="1603437618563" MODIFIED="1603437618563"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      sort 和limit结合的sort排序参数（也是在发往map函数前给文档排序），可以优化分组机制
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1839360194" CREATED="1603437618567" MODIFIED="1603437618567"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      limit 发往map函数的文档数量的上限（要是没有limit，单独使用sort的用处不大）
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT=" 步骤" ID="ID_1560845434" CREATED="1603274110239" MODIFIED="1603274111501">
<node TEXT=" 映射（map）" ID="ID_1111682027" CREATED="1603274121631" MODIFIED="1603274125164">
<node TEXT=" 将操作映射到集合中的每个文档" ID="ID_1928723372" CREATED="1603274133935" MODIFIED="1603274142347"/>
<node TEXT=" 这个操作要么“无作为” ，要么“产生一些键和 X 个值”" ID="ID_1637959143" CREATED="1603274153199" MODIFIED="1603274155725"/>
<node TEXT=" 生成键值对序列,作为 reduce 函数参数" ID="ID_1214301263" CREATED="1603437466893" MODIFIED="1603437468353"/>
</node>
<node TEXT=" 洗牌（shuffle）" ID="ID_1180397382" CREATED="1603277928687" MODIFIED="1603277930275">
<node TEXT=" 按照键分组，并将产生的键值组成列表放到对应的键中" ID="ID_1051615084" CREATED="1603277949418" MODIFIED="1603277951919"/>
</node>
<node TEXT=" 化简（reduce）" ID="ID_744877619" CREATED="1603277957459" MODIFIED="1603277970808">
<node TEXT=" 统计函数，把列表中的值化简成一个单值" ID="ID_576882588" CREATED="1603277982250" MODIFIED="1603437563746"/>
<node TEXT=" reduce函数的任务就是将key-values变成key-value，也就是把values数组变成一个单一的值value" ID="ID_197656086" CREATED="1603437566581" MODIFIED="1603437569815"/>
</node>
</node>
<node TEXT=" 找出集合中的所有键" ID="ID_606877097" CREATED="1603278002154" MODIFIED="1603278003868">
<node TEXT="映射" ID="ID_1943562870" CREATED="1603278585538" MODIFIED="1603278602134">
<node TEXT=" this 就是当前映射文档的引用" ID="ID_1427599706" CREATED="1603278730352" MODIFIED="1603278834043"/>
<node TEXT=" emit" ID="ID_845988535" CREATED="1603278746872" MODIFIED="1603278751958">
<node TEXT=" emit 函数“返回”要处理的值" ID="ID_1640346451" CREATED="1603278781760" MODIFIED="1603278784065"/>
<node TEXT=" emit 会给 MapReduce 一个键和一个值" ID="ID_898944944" CREATED="1603278794704" MODIFIED="1603278805790"/>
<node TEXT=" 文档中的每个键都调用了一次emit" ID="ID_733890459" CREATED="1603278844280" MODIFIED="1603278856405"/>
</node>
<node TEXT=" &gt; map = function() {&#xa;    for (var key in this) {&#xa;        emit(key, {count : 1})&#xa;  }}" ID="ID_1978875127" CREATED="1603278716560" MODIFIED="1603278717966"/>
</node>
</node>
</node>
<node TEXT="集合的聚合命令" ID="ID_1194323186" CREATED="1603438550317" MODIFIED="1603438559155">
<node TEXT="对集合聚合的普通命令，不需要使用聚合框架" ID="ID_1167638293" CREATED="1603438559973" MODIFIED="1603438620204"/>
<node TEXT=" count" ID="ID_87836857" CREATED="1603438626165" MODIFIED="1603438628947">
<node TEXT=" 总的文档数量" ID="ID_1923613115" CREATED="1603438689364" MODIFIED="1603438691593">
<node TEXT=" 不论集合有多大，count 都会很快返回总的文档数量" ID="ID_101915728" CREATED="1603438640349" MODIFIED="1603438642079"/>
<node TEXT=" db.foo.count()" ID="ID_1204866282" CREATED="1603438632229" MODIFIED="1603438633235"/>
</node>
<node TEXT="带条件过滤" ID="ID_1708452774" CREATED="1603438694948" MODIFIED="1603438705850">
<node TEXT="增加查询条件会使 count 变慢，不如直接查询" ID="ID_1652204548" CREATED="1603438706245" MODIFIED="1603438724458"/>
<node TEXT=" db.foo.count({&quot;x&quot; : 1})" ID="ID_8463257" CREATED="1603438728844" MODIFIED="1603438729745"/>
</node>
</node>
<node TEXT=" distinct" ID="ID_706400213" CREATED="1603438734939" MODIFIED="1603438736814">
<node TEXT="概念" ID="ID_301949586" CREATED="1603438787181" MODIFIED="1603438789641">
<node TEXT=" distinct 用来找出给定键的所有不同值" ID="ID_288638961" CREATED="1603438769452" MODIFIED="1603438770528"/>
<node TEXT=" 使用时必须指定集合和键" ID="ID_922743235" CREATED="1603438774717" MODIFIED="1603438776905"/>
</node>
<node TEXT="例子" ID="ID_595554395" CREATED="1603438781411" MODIFIED="1603438785465">
<node TEXT=" col" ID="ID_1722345632" CREATED="1603438794020" MODIFIED="1603438797818">
<node TEXT="{&quot;name&quot; : &quot;Ada&quot;, &quot;age&quot; : 20}&#xa;{&quot;name&quot; : &quot;Fred&quot;, &quot;age&quot; : 35}&#xa;{&quot;name&quot; : &quot;Susan&quot;, &quot;age&quot; : 60}&#xa;{&quot;name&quot; : &quot;Andy&quot;, &quot;age&quot; : 35}" ID="ID_1832192667" CREATED="1603438807292" MODIFIED="1603438815752"/>
</node>
<node TEXT=" 查找" ID="ID_390358377" CREATED="1603438823084" MODIFIED="1603438832305">
<node TEXT=" &gt; db.runCommand({&quot;distinct&quot; : &quot;people&quot;, &quot;key&quot; : &quot;age&quot;})&#xa;{&quot;values&quot; : [20, 35, 60], &quot;ok&quot; : 1}" ID="ID_78878844" CREATED="1603438832964" MODIFIED="1603438838925"/>
</node>
</node>
</node>
<node TEXT=" group" ID="ID_594480097" CREATED="1603438877932" MODIFIED="1603438880500">
<node TEXT="和SQL 中的 GROUP BY 差不多" ID="ID_1032556398" CREATED="1603438890075" MODIFIED="1603438896377"/>
</node>
</node>
</node>
<node TEXT="应用程序设计" POSITION="right" ID="ID_568096118" CREATED="1603439280091" MODIFIED="1603439288823">
<edge COLOR="#007c7c"/>
<node TEXT=" 范式化与反范式化" ID="ID_1627857551" CREATED="1603439992536" MODIFIED="1603439993764">
<node TEXT=" 范式化" ID="ID_154090191" CREATED="1603439998295" MODIFIED="1603440000739">
<node TEXT=" 将数据分散到多个不同的集合，不同集合之间可以相互引用数据" ID="ID_1981595046" CREATED="1603440009358" MODIFIED="1603440011253"/>
<node TEXT=" 虽然很多文档可以引用某一块数据，但是这块数据只存储在一个 集合中" ID="ID_615862842" CREATED="1603440032631" MODIFIED="1603440033820"/>
<node TEXT=" 如果要修改这块数据，只需修改保存这块数据的那一个文档就行了" ID="ID_386957134" CREATED="1603440039279" MODIFIED="1603440042596"/>
<node TEXT=" MongoDB没有提供连接（join）工具，所以在不同集合之间执行连接查询需 要进行多次查询" ID="ID_1158677901" CREATED="1603440048478" MODIFIED="1603440049518"/>
</node>
<node TEXT=" 反范式化" ID="ID_1097340592" CREATED="1603440051527" MODIFIED="1603440055728">
<node TEXT=" 每个文档所需的数据都嵌入在文档内部" ID="ID_1937674386" CREATED="1603440066934" MODIFIED="1603440068238"/>
<node TEXT=" 每个文档都拥有自己的数据副本，而不是所以文档共同引用同一个数据副本。" ID="ID_688255657" CREATED="1603440073495" MODIFIED="1603440074702"/>
<node TEXT=" 如果信息发生了变化，那么所有相关文档都需要进行更新" ID="ID_1270553106" CREATED="1603440083070" MODIFIED="1603440086615"/>
<node TEXT=" 执行查询时，只需要一次查询，就可以得到所有数据" ID="ID_1396308610" CREATED="1603440094127" MODIFIED="1603441871063"/>
</node>
<node TEXT="优缺点" ID="ID_1527895812" CREATED="1603440111775" MODIFIED="1603440118923">
<node TEXT="范式化能够提高数据写入速度" ID="ID_1672221519" CREATED="1603440119488" MODIFIED="1603442394594">
<node TEXT=" 适用更新更频繁的信息" ID="ID_1703469571" CREATED="1603442390689" MODIFIED="1603442392069"/>
<node TEXT=" 如果这些数据变化频繁，引用更好，可减少文档更新量" ID="ID_1568409341" CREATED="1603442402089" MODIFIED="1603443114684"/>
</node>
<node TEXT=" 反范式化能够提高数据读取速度" ID="ID_280892594" CREATED="1603441894690" MODIFIED="1603442388007">
<node TEXT=" 适合写入更频繁的信息" ID="ID_292964885" CREATED="1603442377169" MODIFIED="1603442378154"/>
<node TEXT=" 如果数据变化不频繁，嵌入更好，可减少查询次数" ID="ID_1557603094" CREATED="1603442442456" MODIFIED="1603443068129"/>
</node>
</node>
<node TEXT="内嵌数据与引用数据的比较" ID="ID_1528648758" CREATED="1603442570128" MODIFIED="1603442584981">
<node TEXT="文档大小" ID="ID_335369761" CREATED="1603442633615" MODIFIED="1603442638021">
<node TEXT="子文档较小，更适合内嵌" ID="ID_370323718" CREATED="1603442878463" MODIFIED="1603442941393"/>
<node TEXT="子文档较大，更适合引用" ID="ID_1858752527" CREATED="1603442888615" MODIFIED="1603442900718"/>
</node>
<node TEXT="更新频率" ID="ID_1478064307" CREATED="1603442638169" MODIFIED="1603442649774">
<node TEXT=" 数据不会定期改变，更适合内嵌" ID="ID_1328944959" CREATED="1603442902551" MODIFIED="1603442916694"/>
<node TEXT=" 数据经常改变 ，更适合引用" ID="ID_716249174" CREATED="1603442921280" MODIFIED="1603442932058"/>
</node>
<node TEXT=" 一致性强弱" ID="ID_122178915" CREATED="1603442650463" MODIFIED="1603442682892">
<node TEXT="最终数据一致即可，更适合内嵌" ID="ID_318103464" CREATED="1603442878463" MODIFIED="1603442959681"/>
<node TEXT="中间阶段的数据必须一致，更适合引用" ID="ID_128720596" CREATED="1603442888615" MODIFIED="1603442962512"/>
</node>
<node TEXT="数据增加量" ID="ID_514152308" CREATED="1603442669769" MODIFIED="1603442710421">
<node TEXT="文档数据小幅增加，更适合内嵌" ID="ID_1468682531" CREATED="1603442878463" MODIFIED="1603442978237"/>
<node TEXT="文档数据大幅增加，更适合引用" ID="ID_1099227275" CREATED="1603442888615" MODIFIED="1603442980104"/>
</node>
<node TEXT="速度倾向" ID="ID_1521974359" CREATED="1603442730368" MODIFIED="1603442764973">
<node TEXT="需要快速读取，更适合内嵌" ID="ID_1585895592" CREATED="1603442878463" MODIFIED="1603442994094"/>
<node TEXT="需要快速写入 ，更适合引用" ID="ID_660041457" CREATED="1603442888615" MODIFIED="1603443002318"/>
</node>
</node>
</node>
<node TEXT="学生、课程" ID="ID_903173814" CREATED="1603440818253" MODIFIED="1603440940740">
<node TEXT="范式" ID="ID_589743365" CREATED="1603440836148" MODIFIED="1603440857170">
<node TEXT="学生、课程 各一个集合，然后用第三个集合描述两者的关系" ID="ID_1247673343" CREATED="1603440857460" MODIFIED="1603441001880"/>
</node>
<node TEXT="反范式" ID="ID_1325130181" CREATED="1603441060987" MODIFIED="1603441068656">
<node TEXT="课程引用嵌入学生文档" ID="ID_1121438034" CREATED="1603441149277" MODIFIED="1603441325191">
<node TEXT="少了描述关系的集合，可节省一次查询" ID="ID_538766578" CREATED="1603441336258" MODIFIED="1603441367873"/>
<node TEXT="还需要用课程ID查课程集合，总共两次查询" ID="ID_1614518068" CREATED="1603441427851" MODIFIED="1603441456088"/>
<node TEXT="{&quot;_id&quot; : ObjectId(&quot;512512a5d86041c7dca81914&quot;),&#xa;&quot;name&quot; : &quot;John Doe&quot;,&#xa;&quot;classes&quot; : [&#xa;    ObjectId(&quot;512512ced86041c7dca81916&quot;),&#xa;    ObjectId(&quot;512512f0d86041c7dca81919&quot;),&#xa;    ]}" ID="ID_970422016" CREATED="1603441162692" MODIFIED="1603441571768"/>
</node>
<node TEXT="完全反范式" ID="ID_1980943095" CREATED="1603441457970" MODIFIED="1603441465440">
<node TEXT="将课程文档嵌入学生文档" ID="ID_798294438" CREATED="1603441475723" MODIFIED="1603441500112"/>
<node TEXT=" {&quot;_id&quot; : ObjectId(&quot;512512a5d86041c7dca81914&quot;),&#xa;&quot;name&quot; : &quot;John Doe&quot;,&#xa;&quot;classes&quot; : [&#xa;    {&quot;class&quot; : &quot;Math&quot;,&quot;credits&quot; : 3,&quot;room&quot; : &quot;204&quot;},&#xa;    {&quot;class&quot; : &quot;History&quot;,&quot;credits&quot; : 4,&quot;room&quot; : &quot;321&quot;}&#xa;    ]}" ID="ID_1601437281" CREATED="1603441579034" MODIFIED="1603441606640"/>
<node TEXT="优点是只需要一次查询就可以得到学生的课程信息，缺点是会占用更多的存储空间，而且数据同步更困难。" ID="ID_1066168158" CREATED="1603441625243" MODIFIED="1603441628785"/>
<node TEXT="优点" ID="ID_1887452008" CREATED="1603441638475" MODIFIED="1603441642687">
<node TEXT=" 只需要一次查询就可以得到学生的课程信息" ID="ID_627302903" CREATED="1603441648874" MODIFIED="1603441650025"/>
</node>
<node TEXT="缺点" ID="ID_1656970753" CREATED="1603441652402" MODIFIED="1603441654151">
<node TEXT=" 会占用更多的存储空间" ID="ID_1317673171" CREATED="1603441660314" MODIFIED="1603441661518"/>
<node TEXT=" 数据同步更困难，如果数学的积分改成了4分，那么每个选了数学的学生文档都要更新" ID="ID_1432016588" CREATED="1603441667450" MODIFIED="1603441721240"/>
</node>
</node>
<node TEXT="混合嵌入与引用" ID="ID_374763851" CREATED="1603442033521" MODIFIED="1603442048887">
<node TEXT="建一个子文档保存常用信息(冗余)和引用ID" ID="ID_343025855" CREATED="1603442049793" MODIFIED="1603442108398"/>
<node TEXT=" {&quot;_id&quot; : ObjectId(&quot;512512a5d86041c7dca81914&quot;),&#xa;&quot;name&quot; : &quot;John Doe&quot;,&#xa;&quot;classes&quot; : [&#xa;    {&quot;_id&quot; : ObjectId(&quot;512512ced86041c7dca81916&quot;),&#xa;     &quot;class&quot; : &quot;Trigonometry&quot;},&#xa;    {&quot;_id&quot; : ObjectId(&quot;512512f0d86041c7dca81919&quot;),&#xa;     &quot;class&quot; : &quot;AP European History&quot;}&#xa;    ]}" ID="ID_1765657674" CREATED="1603442227970" MODIFIED="1603442229171"/>
</node>
</node>
</node>
<node TEXT="基数" ID="ID_1421099624" CREATED="1603443188183" MODIFIED="1603443191460">
<node TEXT=" 一个集合中包含的对其他集合的引用数量叫做基数（cardinality）" ID="ID_1424888041" CREATED="1603443442063" MODIFIED="1603443443155"/>
<node TEXT=" 常见的关系有一 对一、一对多、多对多" ID="ID_488853131" CREATED="1603443470830" MODIFIED="1603443473508"/>
<node TEXT=" 确定MongoDB少与多的关系" ID="ID_1514006247" CREATED="1603443598982" MODIFIED="1603443607292">
<node TEXT=" 在MongoDB中，many（多）可以被分拆为两个子分类：many（多）和few（少）" ID="ID_616415996" CREATED="1603443623518" MODIFIED="1603443628474"/>
<node TEXT=" 博客文章和标签可能是多对少的关系：文章数量实际上很可能比标签数量多。" ID="ID_1624869408" CREATED="1603443799838" MODIFIED="1603443801273"/>
<node TEXT=" “少”的关系使用内嵌的方式会比较好" ID="ID_284374684" CREATED="1603443815270" MODIFIED="1603443816591"/>
<node TEXT="  “多”的关系使用引用的方式比较好" ID="ID_1747373065" CREATED="1603443823726" MODIFIED="1603443828077"/>
</node>
</node>
<node TEXT="优化文档增长" ID="ID_51098768" CREATED="1603450976958" MODIFIED="1603450983134">
<node TEXT="文档增长如果超出为文档预留的空间，会造成文档移动，影响写入速度" ID="ID_949936687" CREATED="1603451054894" MODIFIED="1603451118563"/>
<node TEXT=" 如果增长程 度是可预知的，可以为文档预留足够的增长空间" ID="ID_246052591" CREATED="1603451219079" MODIFIED="1603451523367"/>
<node TEXT=" 检查一下填充因子：如果它大约是 1.2 或者更大，可以考虑手动填充" ID="ID_1959167128" CREATED="1603451130270" MODIFIED="1603451131836"/>
<node TEXT="新增手工填充文档" ID="ID_517102632" CREATED="1603451255941" MODIFIED="1603451285146">
<node TEXT="增加garbage字段，扩大文档体积" ID="ID_1373052710" CREATED="1603451404972" MODIFIED="1603451425451"/>
<node TEXT=" 如果文档中有一个字段需要增长，应该尽可能将这个字段放在文档最后的位置（&quot;garbage&quot; 之前）" ID="ID_997561419" CREATED="1603451547557" MODIFIED="1603451552773"/>
<node TEXT="{&quot;_id&quot; : ObjectId(),&#xa;&quot;restaurant&quot; : &quot;Le Cirque&quot;,&#xa;&quot;review&quot; : &quot;Hamburgers&quot;,&#xa;&quot;userId&quot; : ObjectId(),&#xa;&quot;tags&quot; : [],&#xa;&quot;garbage&quot; : &quot;................&quot;+&#xa;    &quot;........................&quot;+&#xa;    &quot;........................&quot; }" ID="ID_1962572411" CREATED="1603451268735" MODIFIED="1603451387484"/>
</node>
<node TEXT="更新文档" ID="ID_424450051" CREATED="1603451389237" MODIFIED="1603451402242">
<node TEXT="用 &quot;$unset&quot; 移除 &quot;garbage&quot; 字段" ID="ID_46017482" CREATED="1603451402548" MODIFIED="1603451457532"/>
<node TEXT=" &gt; db.reviews.update(&#xa;    {&quot;_id&quot; : id},&#xa;    {&quot;$push&quot; : {&quot;tags&quot; : {&quot;$each&quot; : [&#xa;        &quot;French&quot;, &quot;hamburgers&quot;]}}},&#xa;    &quot;$unset&quot; : {&quot;garbage&quot; : true}})" ID="ID_1600052207" CREATED="1603451516461" MODIFIED="1603451517718"/>
</node>
</node>
<node TEXT=" 删除旧数据" ID="ID_674470970" CREATED="1603451589893" MODIFIED="1603451592328">
<node ID="ID_742729203" CREATED="1603451650879" MODIFIED="1603451650879"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      使用固定集合
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" 将集合大小设为一个比较大的值，当集合被填满时， 将旧数据从固定集合中挤出。" ID="ID_519269553" CREATED="1603451689268" MODIFIED="1603451691710"/>
<node TEXT="插入数据时会大大降低数据在固定集合内的存活期" ID="ID_970476714" CREATED="1603451672765" MODIFIED="1603451677341"/>
</node>
<node ID="ID_1724903846" CREATED="1603451650879" MODIFIED="1603451650879"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      使用 TTL 集合
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" TTL 集合可以更精确地控制删除文档的时机" ID="ID_1785617228" CREATED="1603451753972" MODIFIED="1603451758713"/>
<node TEXT=" 通过遍历 TTL 索引来删除文档对于写入量非常大的集合来说这种方式可能不够快" ID="ID_1610617923" CREATED="1603451769947" MODIFIED="1603451785729"/>
<node TEXT=" 如果 TTL 集合能够承受足够的写入量，使用 TTL 集合删除旧数据可能是最简单的方式了" ID="ID_265910309" CREATED="1603451802627" MODIFIED="1603451807681"/>
</node>
<node TEXT=" 使用多个集合" ID="ID_1478287787" CREATED="1603451849796" MODIFIED="1603451851029">
<node TEXT=" 如每个月的文档单独使用一个集合" ID="ID_649459244" CREATED="1603452088275" MODIFIED="1603452095893">
<node TEXT=" 查询时要对当前月份和之前月份的集合都进行查询" ID="ID_1570795565" CREATED="1603452121531" MODIFIED="1603452126931"/>
<node TEXT=" 对于旧集合（6 个月之前的），可以直接将其删除" ID="ID_767950576" CREATED="1603452149715" MODIFIED="1603452168327"/>
</node>
<node TEXT=" 对于应用程序来说会比较复杂，因为需要使用动态的集合名称，也要动态处理对多个数据库的查询" ID="ID_1014736609" CREATED="1603452181753" MODIFIED="1603452200143"/>
</node>
</node>
<node TEXT=" 数据库和集合的设计" ID="ID_1268583912" CREATED="1603452205161" MODIFIED="1603452210394">
<node TEXT=" 具有相近模式的文档应该放在相同的集合中" ID="ID_140275921" CREATED="1603693898180" MODIFIED="1603693902932"/>
</node>
<node TEXT="一致性管理" ID="ID_1124048943" CREATED="1603695828856" MODIFIED="1603695834092">
<node TEXT=" 每个列队只对应一个连接" ID="ID_1714733203" CREATED="1603696572137" MODIFIED="1603696577163">
<node TEXT=" 连接上的请求会依次得到处理" ID="ID_709412630" CREATED="1603696609245" MODIFIED="1603696613448"/>
<node TEXT=" 一个连接拥有一个一致的 数据库视图" ID="ID_1749923716" CREATED="1603696619790" MODIFIED="1603696623854"/>
<node TEXT=" 可以总是读取到这个连接最新写入的数据" ID="ID_1748420573" CREATED="1603696638156" MODIFIED="1603696640910"/>
</node>
<node TEXT="不同的shell对应不同的连接，一队列新插入的数据可能不会出现在另一队列的查询结果中" ID="ID_20265606" CREATED="1603696667819" MODIFIED="1603696743161"/>
<node TEXT=" Ruby、Python 和 Java 驱动用了连接池，如果向副本集备份节点发送读取请求，会有不一致的情况" ID="ID_1720921218" CREATED="1603697297612" MODIFIED="1603697346251"/>
<node TEXT=" 处理方式" ID="ID_614369592" CREATED="1603697442179" MODIFIED="1603697449471">
<node TEXT=" 有读取请求都发送到主数据库，得到的总是最新最准确的数据" ID="ID_659661519" CREATED="1603697462140" MODIFIED="1603697494615"/>
<node TEXT=" 设置一个脚本自动检测副本集是否落后于主数据库，如果落后，就将副本集设为维护状态" ID="ID_1762859105" CREATED="1603697509883" MODIFIED="1603697514873"/>
</node>
</node>
<node TEXT=" 模式迁移" ID="ID_1165891899" CREATED="1603697533250" MODIFIED="1603697535237"/>
<node TEXT=" 不适合使用MongoDB的场景" ID="ID_8237043" CREATED="1603697610530" MODIFIED="1603697612296">
<node TEXT="事务" ID="ID_1850687206" CREATED="1603697772841" MODIFIED="1603697775927">
<node TEXT=" 对事务性有要求的应用程序不建议使用MongoDB" ID="ID_1803661754" CREATED="1603697634129" MODIFIED="1603697637338"/>
<node TEXT=" MongoDB 不支持事务（transaction），需要自己实现类事务" ID="ID_667546797" CREATED="1603697643610" MODIFIED="1603697807375"/>
</node>
<node TEXT=" 多个不同维度上对不同类型的数据进行连接" ID="ID_1329494028" CREATED="1603697757632" MODIFIED="1603697760972">
<node TEXT=" 关系型数据库善长的事情" ID="ID_1268672137" CREATED="1603697821816" MODIFIED="1603697826065"/>
<node TEXT=" MongoDB 不支持这么做，以后也很可能不支持" ID="ID_1688472351" CREATED="1603697830346" MODIFIED="1603697831821"/>
</node>
</node>
</node>
<node TEXT="关系" FOLDED="true" POSITION="right" ID="ID_1293609931" CREATED="1568169840110" MODIFIED="1568705330898">
<edge COLOR="#00ff00"/>
<node TEXT="概念" ID="ID_1596986333" CREATED="1568170169856" MODIFIED="1568170174463">
<node TEXT=" MongoDB 的关系表示多个文档之间在逻辑上的相互联系" ID="ID_1263309280" CREATED="1568170149226" MODIFIED="1568170150176"/>
<node TEXT=" 文档间可以通过嵌入和引用来建立联系" ID="ID_1745299324" CREATED="1568170154684" MODIFIED="1568170155648"/>
</node>
<node TEXT=" 关系类型" ID="ID_520285298" CREATED="1568170163028" MODIFIED="1568170167903">
<node ID="ID_1388808387" CREATED="1568170187096" MODIFIED="1568170187096"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      1:1 (1&#23545;1)
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1803232362" CREATED="1568170187096" MODIFIED="1568170187096"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      1: N (1&#23545;&#22810;)
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_72743417" CREATED="1568170187097" MODIFIED="1568170187097"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      N: 1 (&#22810;&#23545;1)
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1844078327" CREATED="1568170187097" MODIFIED="1568170187097"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      N: N (&#22810;&#23545;&#22810;)
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 嵌入式关系" ID="ID_1754055791" CREATED="1568170199197" MODIFIED="1568170200128">
<node TEXT=" 把用户地址嵌入到用户的文档" ID="ID_923739295" CREATED="1568170207301" MODIFIED="1568170210776"/>
<node ID="ID_1742044844" CREATED="1568705641347" MODIFIED="1568705641347"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt"> {<br/>   <span style="color: #a5c261"><font color="#a5c261">&quot;_id&quot;</font></span>:ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;52ffc33cd85242f436000001&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;contact&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;987654321&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;dob&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;01-01-1991&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;name&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Tom Benzamin&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;address&quot;</font></span>: [<br/>      {<br/>         <span style="color: #a5c261"><font color="#a5c261">&quot;building&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;22 A, Indiana Apt&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;pincode&quot;</font></span>: <span style="color: #6897bb"><font color="#6897bb">123456</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;city&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Los Angeles&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;state&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;California&quot;<br/></font></span><font color="#a5c261"><span style="color: #a5c261">      </span></font>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">      </span></font>{<br/>         <span style="color: #a5c261"><font color="#a5c261">&quot;building&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;170 A, Acropolis Apt&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;pincode&quot;</font></span>: <span style="color: #6897bb"><font color="#6897bb">456789</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;city&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Chicago&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">         </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;state&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Illinois&quot;<br/></font></span><font color="#a5c261"><span style="color: #a5c261">      </span></font>}]<br/>}</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="优点" ID="ID_1236230118" CREATED="1568170268443" MODIFIED="1568170270088">
<node TEXT="以上数据保存在单一的文档中，可以比较容易的获取很维护数据" ID="ID_280274637" CREATED="1568170256978" MODIFIED="1568170267387"/>
</node>
<node TEXT="缺点" ID="ID_600953174" CREATED="1568170272990" MODIFIED="1568170277531">
<node TEXT="如果用户和用户地址在不断增加，数据量不断变大，会影响读写性能" ID="ID_1752141837" CREATED="1568170264016" MODIFIED="1568170281335"/>
</node>
</node>
<node TEXT=" 引用式关系" ID="ID_1192803403" CREATED="1568170287173" MODIFIED="1568170288159">
<node TEXT="概念" ID="ID_1987142212" CREATED="1568170327170" MODIFIED="1568170332364">
<node TEXT=" 引用式关系是设计数据库时经常用到的方法" ID="ID_1463615715" CREATED="1568170316502" MODIFIED="1568170318428"/>
<node TEXT=" 把用户数据文档和用户地址数据文档分开，通过引用文档的 id 字段来建立关系。" ID="ID_218284381" CREATED="1568170318981" MODIFIED="1568170325273"/>
</node>
<node TEXT=" 用户文档的 address_ids 字段包含用户地址的对象id（ObjectId）数组" ID="ID_757897182" CREATED="1568170352352" MODIFIED="1568170353432"/>
<node ID="ID_1651367257" CREATED="1568705690467" MODIFIED="1568705690467"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt"> {<br/>   <span style="color: #a5c261"><font color="#a5c261">&quot;_id&quot;</font></span>:ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;52ffc33cd85242f436000001&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;contact&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;987654321&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;dob&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;01-01-1991&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;name&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Tom Benzamin&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;address_ids&quot;</font></span>: [<br/>      ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;52ffc4a5d85242602e000000&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">      </span></font>ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;52ffc4a5d85242602e000001&quot;</font></span>)<br/>   ]<br/>}</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT=" 这种方法需要两次查询" ID="ID_5887681" CREATED="1568170363962" MODIFIED="1568170364863">
<node TEXT=" 第一次查询用户地址的对象id（ObjectId）" ID="ID_1457875288" CREATED="1568170369046" MODIFIED="1568170369865">
<node TEXT=" var result = db.users.findOne({&quot;name&quot;:&quot;Tom Benzamin&quot;},{&quot;address_ids&quot;:1})" ID="ID_1623466457" CREATED="1568170381726" MODIFIED="1568170383247"/>
</node>
<node TEXT="第二次通过查询的id获取用户的详细地址信息" ID="ID_7827918" CREATED="1568170374815" MODIFIED="1568170377033">
<node TEXT=" var addresses = db.address.find({&quot;_id&quot;:{&quot;$in&quot;:result[&quot;address_ids&quot;]}})" ID="ID_1091870701" CREATED="1568170387472" MODIFIED="1568170388631"/>
</node>
</node>
</node>
</node>
<node TEXT=" 数据库引用" FOLDED="true" POSITION="right" ID="ID_1494769055" CREATED="1568170489985" MODIFIED="1568705327092">
<edge COLOR="#0000ff"/>
<node TEXT=" DBRefs vs 手动引用" FOLDED="true" ID="ID_1163168932" CREATED="1568170531094" MODIFIED="1568170532000">
<node TEXT="在不同的集合中 (address_home, address_office, address_mailing, 等)存储不同的地址" ID="ID_1378802125" CREATED="1568170573299" MODIFIED="1568170589443"/>
<node TEXT=" 这样在调用不同地址时，也需要指定集合" ID="ID_1894661736" CREATED="1568170585050" MODIFIED="1568170593176"/>
<node TEXT=" 一个文档从多个集合引用文档，我们应该使用 DBRefs" ID="ID_1697548645" CREATED="1568170605196" MODIFIED="1568170606223"/>
</node>
<node TEXT=" 使用 DBRefs" ID="ID_1015182787" CREATED="1568170612501" MODIFIED="1568170613528">
<node TEXT="语法" ID="ID_1117116371" CREATED="1568170620191" MODIFIED="1568170622064">
<node TEXT=" { $ref : , $id : , $db :  }" ID="ID_1739716983" CREATED="1568170625998" MODIFIED="1568170628511"/>
<node ID="ID_1322377572" CREATED="1568170636421" MODIFIED="1568170636421"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      $ref&#65306;&#38598;&#21512;&#21517;&#31216;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_215813677" CREATED="1568170636421" MODIFIED="1568170636421"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      $id&#65306;&#24341;&#29992;&#30340;id
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_243169876" CREATED="1568170636422" MODIFIED="1568170636422"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      $db:&#25968;&#25454;&#24211;&#21517;&#31216;&#65292;&#21487;&#36873;&#21442;&#25968;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT=" 用户数据文档使用了 DBRef, 字段 address" ID="ID_424779473" CREATED="1568170655215" MODIFIED="1568170656216">
<node TEXT="定义" ID="ID_1595910107" CREATED="1568170994856" MODIFIED="1568170996612">
<node ID="ID_307001014" CREATED="1568706017573" MODIFIED="1568706017573"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt"> {<br/>   <span style="color: #a5c261"><font color="#a5c261">&quot;_id&quot;</font></span>:ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;53402597d852426020000002&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;address&quot;</font></span>: {<br/>   <span style="color: #a5c261"><font color="#a5c261">&quot;$ref&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;address_home&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;$id&quot;</font></span>: ObjectId(<span style="color: #a5c261"><font color="#a5c261">&quot;534009e4d852427820000002&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;$db&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;runoob&quot;</font></span>}<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;contact&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;987654321&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;dob&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;01-01-1991&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">   </span></font><span style="color: #a5c261"><font color="#a5c261">&quot;name&quot;</font></span>: <span style="color: #a5c261"><font color="#a5c261">&quot;Tom Benzamin&quot;<br/></font></span>}</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="查找地址" ID="ID_1328331597" CREATED="1568171000094" MODIFIED="1568171066428">
<node TEXT=" 通过指定 $ref 参数（address_home 集合）来查找" ID="ID_1927812788" CREATED="1568171076337" MODIFIED="1568171077303"/>
<node TEXT=" &gt;var user = db.users.findOne({&quot;name&quot;:&quot;Tom Benzamin&quot;})&#xa;&gt;var dbRef = user.address&#xa;&gt;db[dbRef.$ref].findOne({&quot;_id&quot;:(dbRef.$id)})" ID="ID_42998789" CREATED="1568171092033" MODIFIED="1568171093111"/>
<node TEXT=" 在 MongoDB4.0 版本是这样写：db[dbRef.$ref].findOne({&quot;_id&quot;:ObjectId(dbRef.$id)})" ID="ID_1841506959" CREATED="1568171155068" MODIFIED="1568171172384"/>
</node>
</node>
</node>
</node>
<node TEXT=" 原子操作" FOLDED="true" POSITION="right" ID="ID_1717487991" CREATED="1568173287299" MODIFIED="1568705324214">
<edge COLOR="#7c7c00"/>
<node TEXT=" mongodb不支持事务" ID="ID_821325855" CREATED="1568173435468" MODIFIED="1568173437833"/>
<node TEXT=" mongodb文档的保存，修改，删除等，都是原子操作" ID="ID_1464250843" CREATED="1568173652600" MODIFIED="1568173662609"/>
<node TEXT=" 原子操作常用命令" ID="ID_1453499541" CREATED="1568186209513" MODIFIED="1568186216087">
<node TEXT=" $set" ID="ID_687835826" CREATED="1568186222782" MODIFIED="1568186223615">
<node TEXT=" 用来指定一个键并更新键值，若键不存在并创建。" ID="ID_175644426" CREATED="1568186227276" MODIFIED="1568186228182"/>
<node TEXT=" { $set : { field : value } }" ID="ID_65111953" CREATED="1568186231567" MODIFIED="1568186232485"/>
</node>
<node TEXT=" $unset" ID="ID_108614961" CREATED="1568186237484" MODIFIED="1568186238340">
<node TEXT=" 用来删除一个键" ID="ID_1930283215" CREATED="1568186241309" MODIFIED="1568186242060"/>
<node TEXT=" { $unset : { field : 1} }" ID="ID_1754320894" CREATED="1568186245524" MODIFIED="1568186246783"/>
</node>
<node TEXT=" $inc" ID="ID_447208788" CREATED="1568186253096" MODIFIED="1568186254188">
<node TEXT=" $inc可以对文档的某个值为数字型（只能为满足要求的数字）的键进行增减的操作。" ID="ID_834377193" CREATED="1568186258870" MODIFIED="1568186259709"/>
<node TEXT=" { $inc : { field : value } }" ID="ID_2940491" CREATED="1568186263930" MODIFIED="1568186264869"/>
</node>
<node TEXT=" $push" ID="ID_703539969" CREATED="1568186276735" MODIFIED="1568186277629">
<node TEXT="把value追加到field里面去，field一定要是数组类型才行" ID="ID_1429606006" CREATED="1568186290727" MODIFIED="1568186298263"/>
<node TEXT=" 如果field不存在，会新增一个数组类型加进去" ID="ID_426879980" CREATED="1568186292550" MODIFIED="1568186296068"/>
<node TEXT=" { $push : { field : value } }" ID="ID_141232808" CREATED="1568186281076" MODIFIED="1568186282076"/>
</node>
<node TEXT=" $pushAll" ID="ID_1031599452" CREATED="1568186304913" MODIFIED="1568186306141">
<node TEXT=" 同$push,只是一次可以追加多个值到一个数组字段内" ID="ID_1407431944" CREATED="1568186310223" MODIFIED="1568186311020"/>
<node TEXT=" { $pushAll : { field : value_array } }" ID="ID_842089686" CREATED="1568186315361" MODIFIED="1568186316285"/>
</node>
<node TEXT=" $pull" ID="ID_1111337544" CREATED="1568186322316" MODIFIED="1568186323164">
<node TEXT=" 从数组field内删除一个等于value值。" ID="ID_43835793" CREATED="1568186327288" MODIFIED="1568186328300"/>
<node TEXT=" { $pull : { field : _value } }" ID="ID_409926751" CREATED="1568186330714" MODIFIED="1568186331493"/>
</node>
<node TEXT=" $addToSet" ID="ID_1982805788" CREATED="1568186335189" MODIFIED="1568186336019">
<node TEXT=" 增加一个值到数组内，而且只有当这个值不在数组内才增加。" ID="ID_1851580619" CREATED="1568186339427" MODIFIED="1568186340229"/>
</node>
<node TEXT=" $pop" ID="ID_833652530" CREATED="1568186343089" MODIFIED="1568186346597">
<node TEXT=" 删除数组的第一个或最后一个元素" ID="ID_256673744" CREATED="1568186357049" MODIFIED="1568186358068"/>
<node TEXT=" { $pop : { field : 1 } }" ID="ID_1824448218" CREATED="1568186348963" MODIFIED="1568186352349"/>
</node>
<node TEXT=" $rename" ID="ID_453315286" CREATED="1568186359628" MODIFIED="1568186362878">
<node TEXT=" 修改字段名称" ID="ID_1936703069" CREATED="1568186365568" MODIFIED="1568186366469"/>
<node TEXT=" { $rename : { old_field_name : new_field_name } }" ID="ID_1874053080" CREATED="1568186367063" MODIFIED="1568186372764"/>
</node>
<node TEXT=" $bit" ID="ID_1046988548" CREATED="1568186373965" MODIFIED="1568186378101">
<node TEXT=" 位操作，integer类型" ID="ID_1449569541" CREATED="1568186381903" MODIFIED="1568186382733"/>
<node TEXT=" {$bit : { field : {and : 5}}}" ID="ID_1201666261" CREATED="1568186389451" MODIFIED="1568186390380"/>
</node>
</node>
<node TEXT=" findAndModify() 方法" ID="ID_1853021183" CREATED="1568188356702" MODIFIED="1568188357888">
<node TEXT=" 在一个相同的文档中如何确保嵌入字段关联原子操作（update：更新）的字段是同步的" ID="ID_1204409021" CREATED="1568188450788" MODIFIED="1568188452236"/>
<node ID="ID_1793689937" CREATED="1568706504389" MODIFIED="1568706504389"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt">book = {<br/>    _id: <span style="color: #6897bb"><font color="#6897bb">123456789</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>title: <span style="color: #a5c261"><font color="#a5c261">&quot;MongoDB: The Definitive Guide&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>author: [<span style="color: #a5c261"><font color="#a5c261">&quot;Kristina Chodorow&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #a5c261"><font color="#a5c261">&quot;Mike Dirolf&quot;</font></span>]<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>published_date: ISODate(<span style="color: #a5c261"><font color="#a5c261">&quot;2010-09-24&quot;</font></span>)<span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>pages: <span style="color: #6897bb"><font color="#6897bb">216</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>language: <span style="color: #a5c261"><font color="#a5c261">&quot;English&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>publisher_id: <span style="color: #a5c261"><font color="#a5c261">&quot;oreilly&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>available: <span style="color: #6897bb"><font color="#6897bb">3</font></span><span style="color: #cc7832"><font color="#cc7832">,<br/></font></span><font color="#cc7832"><span style="color: #cc7832">    </span></font>checkout: [{by: <span style="color: #a5c261"><font color="#a5c261">&quot;joe&quot;</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>date: ISODate(<span style="color: #a5c261"><font color="#a5c261">&quot;2012-10-15&quot;</font></span>)}]<br/>}</pre>
  </body>
</html>
</richcontent>
</node>
<node TEXT="使用 db.collection.findAndModify() 方法来判断书籍是否可结算并更新新的结算信息" ID="ID_328204788" CREATED="1568188414368" MODIFIED="1568188438179"/>
<node TEXT=" 在同一个文档中嵌入的 available 和 checkout 字段来确保这些字段是同步更新的" ID="ID_590591080" CREATED="1568188467301" MODIFIED="1568188468347"/>
<node TEXT=" db.books.findAndModify ( {&#xa;   query: {&#xa;            _id: 123456789,&#xa;            available: { $gt: 0 }&#xa;          },&#xa;   update: {&#xa;             $inc: { available: -1 },&#xa;             $push: { checkout: { by: &quot;abc&quot;, date: new Date() } }&#xa;           }&#xa;} )" ID="ID_1877238616" CREATED="1568188471591" MODIFIED="1568188472781"/>
</node>
</node>
<node TEXT="基本数据类型" POSITION="right" ID="ID_563196387" CREATED="1568875722426" MODIFIED="1568875730321">
<edge COLOR="#ff00ff"/>
<node TEXT="MongoDB 的文档与 JavaScript 中的对象相近，因而可认为它类似于JSON" ID="ID_1916166332" CREATED="1568875821011" MODIFIED="1568875861879"/>
<node TEXT="Json类型" ID="ID_1629793888" CREATED="1568876165154" MODIFIED="1568876170123">
<node TEXT=" 6 种数据类型" ID="ID_1901919084" CREATED="1568875775937" MODIFIED="1568875777167">
<node ID="ID_1288369607" CREATED="1568875766418" MODIFIED="1568875766418"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      null
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_381112495" CREATED="1568875766419" MODIFIED="1568875766419"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#24067;&#23572;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1778485996" CREATED="1568875766420" MODIFIED="1568875766420"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#25968;&#23383;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1272760143" CREATED="1568875766421" MODIFIED="1568875766421"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#23383;&#31526;&#20018;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_933218692" CREATED="1568875766422" MODIFIED="1568875766422"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#25968;&#32452;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1197356643" CREATED="1568875766423" MODIFIED="1568875766423"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#35937;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="缺乏的重要类型" ID="ID_602857043" CREATED="1568875878031" MODIFIED="1568875898600">
<node TEXT=" JSON 没有日期类型" ID="ID_1111345906" CREATED="1568875906119" MODIFIED="1568875906999"/>
<node TEXT=" JSON 只有一种数字类型" ID="ID_1450890922" CREATED="1568875913813" MODIFIED="1568875914798">
<node TEXT="无法区分浮点数和整数" ID="ID_1439043106" CREATED="1568875921772" MODIFIED="1568875937584"/>
<node TEXT="无法说区分 32 位和 64 位数字" ID="ID_455261302" CREATED="1568875932443" MODIFIED="1568875935066"/>
</node>
<node TEXT="JSON 无法表示一些通用类型" ID="ID_1963345971" CREATED="1568875948905" MODIFIED="1568875978009">
<node ID="ID_1530054770" CREATED="1568875988048" MODIFIED="1568875988048"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#27491;&#21017;&#34920;&#36798;&#24335;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_453946457" CREATED="1568875988048" MODIFIED="1568875988048"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#20989;&#25968;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="mongo类型" ID="ID_1678808814" CREATED="1568876183708" MODIFIED="1568876189205">
<node ID="ID_1270878631" CREATED="1568875766418" MODIFIED="1568875766418"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      null
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" null 用于表示空值或者不存在的字段" ID="ID_536178729" CREATED="1568876010306" MODIFIED="1568876011481"/>
<node TEXT=" {&quot;x&quot; : null}" ID="ID_11272421" CREATED="1568876014289" MODIFIED="1568876015106"/>
</node>
<node ID="ID_551932439" CREATED="1568875766419" MODIFIED="1568875766419"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#24067;&#23572;
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" 布尔类型有两个值 true 和 false" ID="ID_945678883" CREATED="1568876023321" MODIFIED="1568876024175"/>
<node TEXT=" {&quot;x&quot; : true}" ID="ID_903958585" CREATED="1568876027995" MODIFIED="1568876028887"/>
</node>
<node ID="ID_1391658339" CREATED="1568875766420" MODIFIED="1568875766420"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#25968;&#23383;
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" shell 默认使用 64 位浮点型数值" ID="ID_823713247" CREATED="1568876048140" MODIFIED="1568876049119"/>
<node TEXT=" {&quot;x&quot; : 3.14}" ID="ID_1294764467" CREATED="1568876081926" MODIFIED="1568876082945"/>
<node TEXT=" 整型值" ID="ID_19707747" CREATED="1568876091943" MODIFIED="1568876092904">
<node TEXT=" NumberInt 类" ID="ID_981950121" CREATED="1568876102311" MODIFIED="1568876103249">
<node TEXT=" 表示 4 字节带符号整数" ID="ID_603653144" CREATED="1568876107165" MODIFIED="1568876111681"/>
<node TEXT=" {&quot;x&quot; : NumberInt(&quot;3&quot;)}" ID="ID_605619351" CREATED="1568876125889" MODIFIED="1568876126905"/>
</node>
<node TEXT=" NumberLong类" ID="ID_1890708961" CREATED="1568876113342" MODIFIED="1568876116263">
<node TEXT=" 表示 8 字符带符号整数" ID="ID_1382191519" CREATED="1568876120118" MODIFIED="1568876121048"/>
<node TEXT=" {&quot;x&quot; : NumberLong(&quot;3&quot;)}" ID="ID_575990087" CREATED="1568876130168" MODIFIED="1568876131040"/>
</node>
</node>
</node>
<node ID="ID_508794278" CREATED="1568875766421" MODIFIED="1568875766421"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#23383;&#31526;&#20018;
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" UTF-8 字符串都可表示为字符串类型的数据" ID="ID_1343644732" CREATED="1568876138340" MODIFIED="1568876139152"/>
<node TEXT=" {&quot;x&quot; : &quot;foobar&quot;}" ID="ID_619111320" CREATED="1568876147117" MODIFIED="1568876147928"/>
</node>
<node TEXT="日期" ID="ID_233575711" CREATED="1568876220475" MODIFIED="1568876232103">
<node TEXT="日期被存储为自新纪元以来经过的毫秒数，不存储时区" ID="ID_1334881480" CREATED="1568876245009" MODIFIED="1568876250361"/>
<node TEXT=" {&quot;x&quot; : new Date()}" ID="ID_137557062" CREATED="1568876255019" MODIFIED="1568876257181"/>
</node>
<node TEXT=" 正则表达式" ID="ID_926645585" CREATED="1568876259363" MODIFIED="1568876264018">
<node TEXT=" 查询时，使用正则表达式作为限定条件" ID="ID_894300743" CREATED="1568876271892" MODIFIED="1568876272705"/>
<node TEXT=" 语法也与 JavaScript 的正则表达式语法&#xa;相同" ID="ID_529147715" CREATED="1568876279326" MODIFIED="1568876280122"/>
<node TEXT=" {&quot;x&quot; : /foobar/i}" ID="ID_899259980" CREATED="1568876283560" MODIFIED="1568876284439"/>
</node>
<node ID="ID_335663527" CREATED="1568875766422" MODIFIED="1568875766422"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#25968;&#32452;
    </p>
  </body>
</html>
</richcontent>
<node TEXT=" 数据列表或数据集可以表示为数组" ID="ID_1162407575" CREATED="1568876296452" MODIFIED="1568876298112"/>
<node TEXT=" {&quot;x&quot; : [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}" ID="ID_218686638" CREATED="1568876301210" MODIFIED="1568876302044"/>
</node>
<node TEXT=" 内嵌文档" ID="ID_1570834523" CREATED="1568876306425" MODIFIED="1568876307488">
<node TEXT=" 文档可嵌套其他文档，并能“深入”其中构建索 引、执行查询或者更新" ID="ID_974746686" CREATED="1568876311387" MODIFIED="1602681423202"/>
<node TEXT=" 被嵌套的文档作为父文档的值" ID="ID_313153353" CREATED="1568876323030" MODIFIED="1568876324663"/>
<node TEXT=" {&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}}" ID="ID_1516549252" CREATED="1568876332905" MODIFIED="1568876333751"/>
</node>
<node TEXT="对象id" ID="ID_1094962216" CREATED="1568875766423" MODIFIED="1568876344987">
<node TEXT=" 对象 id 由一个 12 个的十六进度数字组成，是文档的唯一标识。够 在分片环境中生成唯一的标示符" ID="ID_340582418" CREATED="1568876351364" MODIFIED="1602681996469"/>
<node TEXT=" {&quot;x&quot; : ObjectId()}" ID="ID_1756584463" CREATED="1568876358751" MODIFIED="1568876360134"/>
<node TEXT="" ID="ID_208009778" CREATED="1602681923941" MODIFIED="1602681928291">
<hook URI="MongoDb_files/png_4436071000537999246.png" SIZE="1.0" NAME="ExternalObject"/>
</node>
</node>
</node>
</node>
<node TEXT="高级索引" POSITION="right" ID="ID_1425942001" CREATED="1568705320234" MODIFIED="1568878116429">
<edge COLOR="#007c7c"/>
</node>
<node TEXT="索引限制" POSITION="right" ID="ID_1818578494" CREATED="1568878116689" MODIFIED="1568878124087">
<edge COLOR="#00ffff"/>
</node>
<node TEXT="ObjectId" POSITION="right" ID="ID_516580615" CREATED="1568878126550" MODIFIED="1568878133811">
<edge COLOR="#7c0000"/>
<node TEXT="ObjectId 是一个12字节 BSON 类型数据" ID="ID_727689132" CREATED="1568878138235" MODIFIED="1568878164673">
<node TEXT="前4个字节表示时间戳" ID="ID_1970902770" CREATED="1568878170005" MODIFIED="1568878179784"/>
<node TEXT="接下来的3个字节是机器标识码" ID="ID_1389123445" CREATED="1568878176703" MODIFIED="1568878190103"/>
<node TEXT="紧接的两个字节由进程id组成（PID）" ID="ID_1072261313" CREATED="1568878185791" MODIFIED="1568878193359"/>
<node TEXT=" 最后三个字节是随机数" ID="ID_1262235078" CREATED="1568878198003" MODIFIED="1568878199048"/>
</node>
<node TEXT="创建文档的时间戳" ID="ID_459759293" CREATED="1568878253180" MODIFIED="1568878269840">
<node TEXT=" 通过 getTimestamp 函数来获取文档的创建时间" ID="ID_1266224026" CREATED="1568878304993" MODIFIED="1568878305834"/>
<node TEXT="&gt;ObjectId(&quot;5349b4ddd2781d08c09890f4&quot;).getTimestamp()&#xa;// ISODate(&quot;2014-04-12T21:49:17Z&quot;)" ID="ID_279055029" CREATED="1568878306407" MODIFIED="1568878817312"/>
</node>
<node TEXT=" ObjectId 转换为字符串" ID="ID_1542541355" CREATED="1568878889228" MODIFIED="1568878890202">
<node TEXT=" &gt;new ObjectId().str&#xa;// 5349b4ddd2781d08c09890f3" ID="ID_1883559223" CREATED="1568878894645" MODIFIED="1568878901817"/>
</node>
</node>
</node>
</map>
