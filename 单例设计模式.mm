<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="单例设计模式" LOCALIZED_STYLE_REF="AutomaticLayout.level.root" FOLDED="false" ID="ID_1723255651" CREATED="1283093380553" MODIFIED="1537442967019" STYLE="bubble">
<font NAME="Noto Sans S Chinese Light" SIZE="14"/>
<hook NAME="MapStyle" zoom="1.077">
    <properties fit_to_viewport="false" show_icon_for_attributes="true" show_note_icons="true" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="combined" BORDER_WIDTH="3.0 px" MAX_WIDTH="10.1 cm" MIN_WIDTH="0.0 cm" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="sharp_bezier" WIDTH="7"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.floating" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="styles.ok" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="button_ok"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.needs_action" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="messagebox_warning"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.floating_node" VGAP_QUANTITY="6.8999999999999995 pt">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.connection" COLOR="#606060" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" COLOR="#ff0000" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="yes"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.question" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="help"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.key" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="password"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.idea" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="idea"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.note" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.date" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="calendar"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.website" COLOR="#006633" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.list" COLOR="#cc6600" VGAP_QUANTITY="6.8999999999999995 pt">
<icon BUILTIN="list"/>
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.quotation" COLOR="#338800" STYLE="fork" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.definition" COLOR="#666600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.description" COLOR="#996600" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12" BOLD="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.pending" COLOR="#b3b95c" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode TEXT="代码" COLOR="#c0fdce" BACKGROUND_COLOR="#000000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#003333"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#003366" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
<edge COLOR="#808080"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" COLOR="#006666" VGAP_QUANTITY="6.8999999999999995 pt">
<font NAME="Noto Sans S Chinese Light" SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" VGAP_QUANTITY="6.8999999999999995 pt">
<font SIZE="12"/>
</stylenode>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="89" RULE="ON_BRANCH_CREATION"/>
<hook NAME="accessories/plugins/AutomaticLayout.properties" VALUE="ALL"/>
<node TEXT="单例模式（Singleton Pattern）主要目的是确保某一个类只有一个实例存在" POSITION="right" ID="ID_183697761" CREATED="1537443004756" MODIFIED="1537443023045">
<edge COLOR="#007c00"/>
</node>
<node TEXT=" 该类只有一个实例而且该实例易于外界访问，从而方便对实例个数的控制并节约系统资源" POSITION="right" ID="ID_1003102367" CREATED="1537446290422" MODIFIED="1537446297479">
<edge COLOR="#7c7c00"/>
</node>
<node TEXT="例如" POSITION="right" ID="ID_1717025044" CREATED="1537443038531" MODIFIED="1537443053357">
<edge COLOR="#7c007c"/>
<node TEXT="前因" ID="ID_603786042" CREATED="1537443116955" MODIFIED="1537443123852">
<node TEXT=" 客户端通过一个 AppConfig 的类来读取配置文件的信息" ID="ID_1272485514" CREATED="1537443077661" MODIFIED="1537443079245"/>
<node TEXT=" 程序运行期间，有很多地方都需要使用配置文件的内容" ID="ID_145524258" CREATED="1537443088603" MODIFIED="1537443089805"/>
</node>
<node TEXT="后果" ID="ID_959543372" CREATED="1537443090947" MODIFIED="1537443098228">
<node TEXT=" 很多地方都需要创建 AppConfig 对象的实例" ID="ID_1651498501" CREATED="1537443111379" MODIFIED="1537443112565"/>
<node TEXT=" 多个 AppConfig 的实例对象会严重浪费内存资源" ID="ID_795936673" CREATED="1537443151003" MODIFIED="1537443158701"/>
</node>
</node>
<node TEXT="实现" POSITION="right" ID="ID_855520526" CREATED="1537443182979" MODIFIED="1537443186353">
<edge COLOR="#007c7c"/>
<node TEXT="使用模块" ID="ID_362896550" CREATED="1537443211432" MODIFIED="1537446457527">
<node TEXT=" Python 的模块就是天然的单例模式" ID="ID_1061603018" CREATED="1537443338130" MODIFIED="1537443339683"/>
<node TEXT=" 因为模块在第一次导入时，会生成 .pyc 文件，&#xa;当第二次导入时，就会直接加载 .pyc 文件" ID="ID_1693441904" CREATED="1537443349554" MODIFIED="1537443356932"/>
<node TEXT=" 只需把相关的函数和数据定义在一个模块中，就可以获得一个单例对象" ID="ID_1349358725" CREATED="1537443376641" MODIFIED="1537443379747"/>
<node ID="ID_1440683018" CREATED="1537443422600" MODIFIED="1537443429995"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt"><span style="color: #808080"><font color="#808080"># </font></span><span style="color: #808080; font-family: &#x5b8b;&#x4f53;"><font color="#808080" face="&#x5b8b;&#x4f53;">&#22312;</font></span><span style="color: #808080"><font color="#808080">mysingleton.py</font></span><span style="color: #808080; font-family: &#x5b8b;&#x4f53;"><font color="#808080" face="&#x5b8b;&#x4f53;">&#20013;<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>My_Singleton(<span style="color: #8888c6"><font color="#8888c6">object</font></span>):<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">foo</font></span>(<span style="color: #94558d"><font color="#94558d">self</font></span>):<br/>        <span style="color: #cc7832"><font color="#cc7832">pass</font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span></font>my_singleton = My_Singleton()</pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1403892102" CREATED="1537443471298" MODIFIED="1537443471298"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>mysingleton <span style="color: #cc7832"><font color="#cc7832">import </font></span>my_singleton<br/>my_singleton.foo()</pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用 __new__" ID="ID_1565168200" CREATED="1537443211432" MODIFIED="1537446515854">
<node TEXT=" 使用 __new__ 来控制实例的创建过程" ID="ID_1309147008" CREATED="1537443536480" MODIFIED="1537443554457">
<node TEXT="将类的实例和一个类变量 _instance 关联起来" ID="ID_1499514783" CREATED="1537443756182" MODIFIED="1568619741209"/>
<node TEXT="如果 cls._instance 为 None 则创建实例，&#xa;否则直接返回 cls._instance" ID="ID_461091381" CREATED="1537443764166" MODIFIED="1568619737923"/>
</node>
<node ID="ID_115839252" CREATED="1537443573017" MODIFIED="1537445142354"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Singleton(<span style="color: #8888c6"><font color="#8888c6">object</font></span>):<br/>    _instance = <span style="color: #cc7832"><font color="#cc7832">None<br/></font></span><font color="#cc7832"><span style="color: #cc7832"><br/></span><span style="color: #cc7832">    def </span></font><span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kw):<br/>        <span style="color: #cc7832"><font color="#cc7832">if not </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>._instance:<br/>            <span style="color: #94558d"><font color="#94558d">cls</font></span>._instance = <span style="color: #8888c6"><font color="#8888c6">super</font></span>(Singleton<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>).<span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kw)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>._instance<br/><br/><br/><span style="color: #cc7832"><font color="#cc7832">class </font></span>MyClass(Singleton):<br/>    a = <span style="color: #6897bb"><font color="#6897bb">1</font></span></pre>
  </body>
</html>
</richcontent>
<node ID="ID_146232216" CREATED="1537445177923" MODIFIED="1537445177923"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt">a = MyClass()<br/>b = MyClass()<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #8888c6"><font color="#8888c6">id</font></span>(a))<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #8888c6"><font color="#8888c6">id</font></span>(b))<br/><span style="color: #808080"><font color="#808080"># 1969921537248<br/></font></span><font color="#808080"><span style="color: #808080"># 1969921537248</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node ID="ID_943979955" CREATED="1537443211435" MODIFIED="1537443211435"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#20351;&#29992;&#35013;&#39280;&#22120;&#65288;decorator&#65289;
    </p>
  </body>
</html>
</richcontent>
<node ID="ID_869736611" CREATED="1568621513874" MODIFIED="1568621513874"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt"><span style="color: #cc7832"><font color="#cc7832">from </font></span>functools <span style="color: #cc7832"><font color="#cc7832">import </font></span>wraps<br/><span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">singleton</font></span>(cls):<br/>    instances = {}<br/>    <span style="color: #bbb529"><font color="#bbb529">@wraps</font></span>(cls)<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #ffc66d"><font color="#ffc66d">getinstance</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kw):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span>cls <span style="color: #cc7832"><font color="#cc7832">not in </font></span>instances:<br/>            instances[cls] = cls(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kw)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span>instances[cls]<br/>    <span style="color: #cc7832"><font color="#cc7832">return </font></span>getinstance<br/></pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1705315048" CREATED="1568621538529" MODIFIED="1568621538529"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: &#x5b8b;&#x4f53;; font-size: 10.5pt"><span style="color: #bbb529"><font color="#bbb529">@singleton<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>MyClass(<span style="color: #8888c6"><font color="#8888c6">object</font></span>):<br/>    a = <span style="color: #6897bb"><font color="#6897bb">1</font></span></pre>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="使用元类（metaclass）" ID="ID_308329558" CREATED="1537443211438" MODIFIED="1568622441658">
<node TEXT=" 元类（metaclass）可以控制类的创建过程" ID="ID_1390399071" CREATED="1537445694581" MODIFIED="1537445695652">
<node ID="ID_1492335858" CREATED="1537445706186" MODIFIED="1537445706186"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#25318;&#25130;&#31867;&#30340;&#21019;&#24314;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1474631614" CREATED="1537445706187" MODIFIED="1537445706187"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#20462;&#25913;&#31867;&#30340;&#23450;&#20041;
    </p>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_56052462" CREATED="1537445706193" MODIFIED="1537445706193"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      &#36820;&#22238;&#20462;&#25913;&#21518;&#30340;&#31867;
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node ID="ID_1881426836" CREATED="1537445827269" MODIFIED="1537445827269"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Singleton(<span style="color: #8888c6"><font color="#8888c6">type</font></span>):<br/>    _instances = {}<br/><br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #94558d"><font color="#94558d">cls </font></span><span style="color: #cc7832"><font color="#cc7832">not in </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>._instances:<br/>            <span style="color: #94558d"><font color="#94558d">cls</font></span>._instances[<span style="color: #94558d"><font color="#94558d">cls</font></span>] = <span style="color: #8888c6"><font color="#8888c6">super</font></span>(Singleton<span style="color: #cc7832"><font color="#cc7832">, </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>).<span style="color: #b200b2"><font color="#b200b2">__call__</font></span>(*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs)<br/>        <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>._instances[<span style="color: #94558d"><font color="#94558d">cls</font></span>]<br/><br/><span style="color: #808080"><font color="#808080"># Python3<br/></font></span><span style="color: #cc7832"><font color="#cc7832">class </font></span>MyClass(<span style="color: #aa4926"><font color="#aa4926">metaclass</font></span>=Singleton):<br/>    <span style="color: #cc7832"><font color="#cc7832">pass</font></span></pre>
  </body>
</html>
</richcontent>
</node>
<node ID="ID_1661552718" CREATED="1537445845652" MODIFIED="1537445845652"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: Source Code Pro; font-size: 12.0pt">a = MyClass()<br/>b = MyClass()<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #8888c6"><font color="#8888c6">id</font></span>(a))<br/><span style="color: #8888c6"><font color="#8888c6">print</font></span>(<span style="color: #8888c6"><font color="#8888c6">id</font></span>(b))<br/><span style="color: #808080"><font color="#808080"># 1795207523352<br/></font></span><font color="#808080"><span style="color: #808080"># 1795207523352</span></font></pre>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="并发下的双检锁单例" POSITION="right" ID="ID_507389654" CREATED="1603765030042" MODIFIED="1603765051894">
<edge COLOR="#ff0000"/>
<node ID="ID_578887968" CREATED="1603765086114" MODIFIED="1603765086114"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <pre style="background-color: #2b2b2b; color: #a9b7c6; font-family: JetBrains Mono,monospace; font-size: 9.8pt"><span style="color: #cc7832"><font color="#cc7832">class </font></span>Singleton(<span style="color: #8888c6"><font color="#8888c6">object</font></span>):<br/>    objs = {}<br/>    objs_locker = threading.Lock()<br/>    <span style="color: #cc7832"><font color="#cc7832">def </font></span><span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span><span style="color: #cc7832"><font color="#cc7832">, </font></span>*args<span style="color: #cc7832"><font color="#cc7832">, </font></span>**kwargs):<br/>        <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #94558d"><font color="#94558d">cls </font></span><span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>.objs:<br/>            <span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>.objs[<span style="color: #94558d"><font color="#94558d">cls</font></span>]<br/>        <span style="color: #94558d"><font color="#94558d">cls</font></span>.objs_locker.acquire()<br/>        <span style="color: #cc7832"><font color="#cc7832">try</font></span>:<br/>            <span style="color: #cc7832"><font color="#cc7832">if </font></span><span style="color: #94558d"><font color="#94558d">cls </font></span><span style="color: #cc7832"><font color="#cc7832">in </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>.objs:    <span style="color: #808080"><font color="#808080">## double check locking<br/></font></span><font color="#808080"><span style="color: #808080">                </span></font><span style="color: #cc7832"><font color="#cc7832">return </font></span><span style="color: #94558d"><font color="#94558d">cls</font></span>.objs[<span style="color: #94558d"><font color="#94558d">cls</font></span>]<br/>            <span style="color: #94558d"><font color="#94558d">cls</font></span>.objs[<span style="color: #94558d"><font color="#94558d">cls</font></span>] = <span style="color: #8888c6"><font color="#8888c6">object</font></span>.<span style="color: #b200b2"><font color="#b200b2">__new__</font></span>(<span style="color: #94558d"><font color="#94558d">cls</font></span>)<br/>        <span style="color: #cc7832"><font color="#cc7832">finally</font></span>:<br/>            <span style="color: #94558d"><font color="#94558d">cls</font></span>.objs_locker.release()</pre>
  </body>
</html>

</richcontent>
</node>
<node TEXT="可能出现的问题" ID="ID_500429545" CREATED="1603765117898" MODIFIED="1603765123326">
<node TEXT=" 如果 Singleton 的子类重载了 __new__() 方法，会覆盖或者干扰 Singleton 类中 __new__() 的执行" ID="ID_859968150" CREATED="1603765147130" MODIFIED="1603765149695"/>
<node TEXT=" 如果子类有 __init__() 方法，那么每次实例化该 Singleton 的时候，__init__() 都会被调用到，这显然是不应该的，__init__() 只应该在创建实例的时候被调用一次" ID="ID_671571318" CREATED="1603765195226" MODIFIED="1603765200891"/>
</node>
</node>
</node>
</map>
